---
phase: 05-vs-code-extension
plan: 04
type: execute
wave: 3
depends_on: ["05-01", "05-02", "05-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Syntax highlighting correctly colors keywords, strings, comments, operators in a .fun file"
    - "Block comment toggling works with Ctrl+Shift+A"
    - "Auto-closing pairs work for (, [, \", and (* *)"
    - "Snippets expand correctly with Tab navigation between placeholders"
    - ".vsix installs successfully with code --install-extension"
    - "Extension appears in VS Code Extensions panel"
    - "All LSP features work after VSIX installation (diagnostics, hover, completion, etc.)"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete VS Code extension by installing the .vsix and testing all features visually.

Purpose: Automated tests verify LSP logic, but syntax highlighting, snippet behavior, bracket matching, and extension panel appearance require visual verification in VS Code.
Output: Verification that all Phase 5 success criteria are met.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-vs-code-extension/05-01-SUMMARY.md
@.planning/phases/05-vs-code-extension/05-02-SUMMARY.md
@.planning/phases/05-vs-code-extension/05-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Automated verification of all build artifacts and tests</name>
  <files></files>
  <action>
Run all automated verifications in sequence:

1. **Validate all JSON files**:
```bash
cd /home/shoh/vibe-coding/LangLSP
node -e "JSON.parse(require('fs').readFileSync('client/syntaxes/funlang.tmLanguage.json')); console.log('grammar: OK')"
node -e "JSON.parse(require('fs').readFileSync('client/snippets/funlang.json')); console.log('snippets: OK')"
node -e "JSON.parse(require('fs').readFileSync('client/language-configuration.json')); console.log('langconfig: OK')"
node -e "const p=JSON.parse(require('fs').readFileSync('client/package.json')); console.log('grammars:', p.contributes.grammars?.length); console.log('snippets:', p.contributes.snippets?.length); console.log('icon:', p.icon)"
```

2. **Verify TypeScript compiles**:
```bash
cd /home/shoh/vibe-coding/LangLSP/client && npm run compile
```

3. **Run all F# tests** (including new integration tests):
```bash
cd /home/shoh/vibe-coding/LangLSP && dotnet test src/LangLSP.Tests/ --verbosity normal
```
Expect: all tests pass (119+ total, 0 failures).

4. **Verify VSIX exists**:
```bash
ls -la /home/shoh/vibe-coding/LangLSP/client/funlang-0.1.0.vsix
```

5. **Verify TextMate grammar structure** (spot check critical patterns):
```bash
node -e "
const g = JSON.parse(require('fs').readFileSync('client/syntaxes/funlang.tmLanguage.json'));
const r = g.repository;
console.log('scopeName:', g.scopeName);
console.log('has comments:', !!r.comments);
console.log('has strings:', !!r.strings);
console.log('has keywords:', !!r.keywords);
console.log('has operators:', !!r.operators);
console.log('has nested comments:', !!r['block-comment-nested']);
"
```

6. **Verify language config has block comments and onEnterRules**:
```bash
node -e "
const c = JSON.parse(require('fs').readFileSync('client/language-configuration.json'));
console.log('lineComment:', c.comments.lineComment);
console.log('blockComment:', c.comments.blockComment);
console.log('onEnterRules:', c.onEnterRules?.length);
console.log('brackets (no curly):', c.brackets.map(b => b[0]).join(','));
"
```

7. **Verify snippets have all six entries**:
```bash
node -e "
const s = JSON.parse(require('fs').readFileSync('client/snippets/funlang.json'));
console.log('snippet count:', Object.keys(s).length);
Object.keys(s).forEach(k => console.log(' -', k, '(prefix:', s[k].prefix + ')'));
"
```

If any check fails, identify the issue and fix it before proceeding.
  </action>
  <verify>
All 7 automated checks pass. Tests pass. VSIX exists. All JSON valid.
  </verify>
  <done>
All automated verifications pass. Build artifacts valid. Tests green. Ready for visual verification.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete FunLang VS Code extension with syntax highlighting, language configuration, code snippets, and .vsix packaging. Integration tests verify all LSP features work together.
  </what-built>
  <how-to-verify>
Visual verification in VS Code (test either via VSIX install or development mode):

**Option A: Install VSIX** (recommended for full verification):
```bash
code --install-extension /home/shoh/vibe-coding/LangLSP/client/funlang-0.1.0.vsix
```

**Option B: Development mode** (open workspace in VS Code):
Open the `client/` folder in VS Code with the extension development host (F5).

**Verification steps:**

1. **Syntax Highlighting (EXT-01)**: Open a .fun file with this content:
   ```
   // Line comment
   (* Block comment (* nested *) *)
   let add = fun x -> fun y -> x + y in
   let result = add 1 2 in
   if result > 0 then "positive" else "negative"
   ```
   - Keywords (`let`, `in`, `fun`, `if`, `then`, `else`) should be colored
   - Comments should be colored as comments
   - Strings should be colored as strings
   - Numbers should be colored as constants
   - Operators (`->`, `+`, `>`) should be colored

2. **Comment Toggle (EXT-02)**:
   - Select a line and press Ctrl+/ -- should toggle `//` line comment
   - Select multiple lines and press Ctrl+Shift+A -- should wrap with `(* ... *)`

3. **Auto-closing (EXT-02)**:
   - Type `(` -- should auto-close with `)`
   - Type `[` -- should auto-close with `]`
   - Type `"` -- should auto-close with `"`
   - Type `(*` -- should auto-close with `*)`

4. **Comment Continuation (EXT-02)**:
   - Type `// some comment` then press Enter -- new line should start with `// `

5. **Snippets (EXT-03)**:
   - Type `let` and select from autocomplete -- should expand with placeholders
   - Tab through placeholders
   - Try `match`, `if`, `fun`, `letrec`, `matchlist` snippets

6. **Extension Panel (EXT-04)**:
   - Open Extensions panel (Ctrl+Shift+X)
   - Search for "FunLang"
   - Should appear with icon and description

7. **LSP Features** (if server is running):
   - Hover over variable to see type
   - Ctrl+Space for completions
   - F12 for Go to Definition
   - Shift+F12 for Find References
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
- All automated checks pass (JSON valid, tests green, VSIX exists)
- Visual verification confirms syntax highlighting, comments, snippets
- Extension installs and appears in panel
</verification>

<success_criteria>
- Phase 5 success criteria 1-7 verified visually
- All automated tests pass
- Extension is installable and functional
</success_criteria>

<output>
After completion, create `.planning/phases/05-vs-code-extension/05-04-SUMMARY.md`
</output>
