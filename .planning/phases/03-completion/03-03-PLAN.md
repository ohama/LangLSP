---
phase: 03-completion
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - documentation/tutorial/07-completion.md
autonomous: true

must_haves:
  truths:
    - "Tutorial explains textDocument/completion LSP protocol in Korean"
    - "Tutorial shows how to implement keyword completion with code examples"
    - "Tutorial shows how to implement scope-based symbol completion with code examples"
    - "Tutorial shows how to add type annotations to completion items"
    - "Tutorial explains server capability registration for CompletionProvider"
  artifacts:
    - path: "documentation/tutorial/07-completion.md"
      provides: "Korean tutorial for Completion implementation"
      min_lines: 400
      contains: ["textDocument/completion", "CompletionItem", "CompletionList", "collectDefinitions"]
  key_links:
    - from: "documentation/tutorial/07-completion.md"
      to: "src/LangLSP.Server/Completion.fs"
      via: "code examples referencing implementation"
      pattern: "Completion\\.fs|handleCompletion|getKeywordCompletions"
---

<objective>
Write Korean tutorial for Completion implementation (TUT-07).

Purpose: Teach LSP beginners how to implement autocomplete functionality with keyword and symbol completion.

Output: documentation/tutorial/07-completion.md following the structure of existing tutorials (06-hover.md pattern).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-completion/03-RESEARCH.md

# Reference existing tutorial pattern
@documentation/tutorial/06-hover.md     # Tutorial structure to follow

# Implementation to reference
@src/LangLSP.Server/Completion.fs       # (created in 03-01)
@src/LangLSP.Server/Definition.fs       # collectDefinitions reuse
@src/LangLSP.Server/Hover.fs            # findVarTypeInAst reuse
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write 07-completion.md tutorial</name>
  <files>documentation/tutorial/07-completion.md</files>
  <action>
Create documentation/tutorial/07-completion.md in Korean following the 06-hover.md structure.

**Required sections:**

1. **Introduction (intro paragraph):**
   - 자동 완성이란 무엇인가
   - 코드 작성 효율성 향상
   - FunLang LSP에서 구현할 내용 미리보기

2. **목차 (Table of Contents):**
   - textDocument/completion 프로토콜
   - 구현 전략
   - 키워드 완성
   - 스코프 기반 심볼 완성
   - 타입 정보 표시
   - 서버 통합
   - 테스트 작성
   - 흔한 실수와 해결책

3. **textDocument/completion 프로토콜:**
   - CompletionParams 구조 (TypeScript interface)
   - CompletionList/CompletionItem 응답 구조
   - CompletionItemKind enum 설명 (Keyword, Variable, Function)
   - VS Code에서의 표시 예시 (ASCII diagram)

4. **구현 전략:**
   - 두 가지 완성 소스: 키워드 vs 스코프 심볼
   - 처리 흐름 다이어그램
   - 기존 인프라 재사용 설명:
     - Definition.collectDefinitions (스코프 추적)
     - Hover.findVarTypeInAst (타입 정보)
   - 클라이언트가 필터링하므로 서버는 전체 목록 반환

5. **키워드 완성:**
   - FunLang 키워드 목록 (let, in, if, then, else, match, with, fun, rec, true, false)
   - getKeywordCompletions 함수 전체 구현
   - CompletionItem 필드 설명 (Label, Kind, Detail, InsertText, InsertTextFormat)
   - F# 코드 예시

6. **스코프 기반 심볼 완성:**
   - Definition.collectDefinitions 재사용
   - 위치 기반 필터링 (커서 이전 정의만 포함)
   - 섀도잉 처리 (마지막 정의 우선)
   - getSymbolCompletions 함수 전체 구현
   - F# 코드 예시

7. **타입 정보 표시:**
   - Hover.findVarTypeInAst 재사용
   - Type.formatTypeNormalized 사용
   - Detail 필드에 "name: type" 형식
   - createSymbolCompletionItem 함수 구현
   - F# 코드 예시

8. **서버 통합:**
   - handleCompletion 메인 함수 전체 구현
   - 파싱 에러 시 키워드만 반환
   - CompletionList with IsIncomplete = false
   - Server.fs 수정: CompletionProvider capability 추가
   - Handlers.textDocumentCompletion 추가

9. **테스트 작성:**
   - Expecto 테스트 패턴
   - 키워드 테스트 예시
   - 심볼 테스트 예시
   - 스코프 필터링 테스트 예시
   - 타입 정보 테스트 예시

10. **흔한 실수와 해결책:**
    - CompletionList vs CompletionItem[] 혼동
    - 0-based vs 1-based 좌표
    - 스코프 외 심볼 포함
    - 타입 정보 누락
    - 트리거 문자 설정 문제

11. **다음 단계:**
    - Phase 4: Find References, Rename, Code Actions 소개
    - 고급 완성 기능 (트리거 문자, 지연 해결) 소개

**Style guidelines:**
- Korean language throughout (code comments in English OK)
- Code blocks with ```fsharp syntax highlighting
- ASCII diagrams for flow visualization
- Reference actual implementation in src/LangLSP.Server/Completion.fs
- Target 400-600 lines (similar to 06-hover.md)
- Use markdown headers consistently (## for sections, ### for subsections)
  </action>
  <verify>
File exists at documentation/tutorial/07-completion.md
wc -l documentation/tutorial/07-completion.md shows 400+ lines
grep -q "textDocument/completion" documentation/tutorial/07-completion.md
grep -q "CompletionItem" documentation/tutorial/07-completion.md
grep -q "collectDefinitions" documentation/tutorial/07-completion.md
  </verify>
  <done>
07-completion.md tutorial exists with 400+ lines covering all required sections in Korean
  </done>
</task>

</tasks>

<verification>
1. documentation/tutorial/07-completion.md exists
2. File has 400+ lines of Korean content
3. Contains all required sections (protocol, keywords, symbols, types, server integration, tests)
4. References actual Completion.fs implementation
5. Follows 06-hover.md structure and style
</verification>

<success_criteria>
- Tutorial explains textDocument/completion protocol clearly
- Includes complete code examples for all key functions
- Shows how to reuse Definition and Hover modules
- Covers testing strategies
- Documents common pitfalls and solutions
- TUT-07 requirement satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/03-completion/03-03-SUMMARY.md`
</output>
