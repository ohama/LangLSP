---
phase: 04-advanced-features
plan: 06
type: execute
wave: 4
depends_on: ["04-03"]
files_modified:
  - documentation/tutorial/11-code-actions.md
autonomous: true

must_haves:
  truths:
    - "Tutorial explains Code Actions concept with lightbulb icon example"
    - "Tutorial shows LSP protocol for textDocument/codeAction request/response"
    - "Tutorial walks through unused variable detection implementation"
    - "Tutorial shows quickfix CodeAction generation with WorkspaceEdit"
    - "Tutorial includes working code examples matching actual CodeActions.fs and Diagnostics.fs"
  artifacts:
    - path: "documentation/tutorial/11-code-actions.md"
      provides: "Code Actions tutorial in Korean (TUT-11)"
      min_lines: 400
  key_links:
    - from: "documentation/tutorial/11-code-actions.md"
      to: "src/LangLSP.Server/CodeActions.fs"
      via: "code examples matching implementation"
      pattern: "handleCodeAction|createPrefixUnderscoreAction"
    - from: "documentation/tutorial/11-code-actions.md"
      to: "src/LangLSP.Server/Diagnostics.fs"
      via: "code examples for unused variable detection"
      pattern: "findUnusedVariables"
---

<objective>
Write the Code Actions Korean tutorial (TUT-11) explaining how to implement textDocument/codeAction.

Purpose: Tutorial readers learn how to implement diagnostic-driven code actions (quickfixes), understand the integration between diagnostics and code actions, and create WorkspaceEdit-based fixes.
Output: documentation/tutorial/11-code-actions.md (~500-700 lines, Korean)
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/LangLSP.Server/CodeActions.fs
@src/LangLSP.Server/Diagnostics.fs
@src/LangLSP.Server/Protocol.fs
@documentation/tutorial/05-diagnostics.md
@documentation/tutorial/08-definition.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write Code Actions tutorial (11-code-actions.md)</name>
  <files>documentation/tutorial/11-code-actions.md</files>
  <action>
Create `documentation/tutorial/11-code-actions.md` in Korean, following established tutorial style.

Title: `# Code Actions Íµ¨ÌòÑÌïòÍ∏∞`

Opening paragraph: Explain Code Actions ‚Äî the lightbulb icon in editors that suggests fixes for issues. Focus on diagnostic-driven quickfixes: when the editor detects a problem, it can suggest automated fixes.

Structure:

## Î™©Ï∞®
1. Code ActionsÏù¥ÎûÄ
2. LSP ÌîÑÎ°úÌÜ†ÏΩú
3. DiagnosticsÏôÄÏùò Í¥ÄÍ≥Ñ
4. ÎØ∏ÏÇ¨Ïö© Î≥ÄÏàò Í∞êÏßÄ Íµ¨ÌòÑ
5. QuickFix CodeAction ÏÉùÏÑ±
6. handleCodeAction Íµ¨ÌòÑ
7. Server.fs ÌÜµÌï©
8. ÌÖåÏä§Ìä∏ ÏûëÏÑ±
9. ÌôïÏû• Í∞ÄÎä•ÏÑ±
10. Ï£ºÏùòÏÇ¨Ìï≠

## Content for each section:

**1. Code ActionsÏù¥ÎûÄ**
- Lightbulb icon (or quickfix icon) in editors
- Two types: refactorings and quickfixes
- Phase 4 focuses on quickfixes (diagnostic-driven)
- VS Code usage: click lightbulb, Ctrl+. hotkey, or "Quick Fix" command
- Visual example:
  ```
  test.fun
  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  1 | let x = 1 in 42
        ~             (warning: Unused variable 'x')
        üí° Prefix 'x' with underscore
  ```
- After applying:
  ```
  1 | let _x = 1 in 42
  ```

**2. LSP ÌîÑÎ°úÌÜ†ÏΩú**
- textDocument/codeAction request
- CodeActionParams: TextDocumentIdentifier, Range, CodeActionContext (diagnostics, only)
- Response: (Command | CodeAction)[]
- CodeAction structure: title, kind ("quickfix"), diagnostics, isPreferred, edit (WorkspaceEdit)
- Server capability: CodeActionProvider with CodeActionKinds = ["quickfix"]
- Explain the flow: client sees diagnostic -> user triggers code action -> server returns actions -> user selects -> client applies edit

**3. DiagnosticsÏôÄÏùò Í¥ÄÍ≥Ñ**
- Code Actions are driven by diagnostics from Phase 1
- The client passes diagnostics in CodeActionContext
- Server matches diagnostics to available fixes
- Diagram showing the cycle: analyze -> diagnostic -> code action -> fix -> re-analyze
- Reference back to 05-diagnostics.md tutorial

**4. ÎØ∏ÏÇ¨Ïö© Î≥ÄÏàò Í∞êÏßÄ Íµ¨ÌòÑ**
- Show findUnusedVariables function from Diagnostics.fs
- Explain the algorithm:
  1. Traverse AST looking for Let bindings
  2. For each binding, check if variable name appears as Var in body
  3. Use References.collectReferences to find usages
  4. If no usages found (and name doesn't start with _), report as unused
- Show how unused variable diagnostic is created:
  - Severity = Warning (not Error)
  - Code = "unused-variable" (for CodeAction matching)
  - Tags = [Unnecessary] (VS Code renders as faded)
- Show updated analyze function

**5. QuickFix CodeAction ÏÉùÏÑ±**
- Show createPrefixUnderscoreAction function
- Explain: extracts variable name from diagnostic message, creates WorkspaceEdit that replaces name with "_" + name
- Why "prefix underscore" not "remove binding": removing is complex (need full Let span), prefixing is safe and follows convention
- Show the CodeAction structure with all fields

**6. handleCodeAction Íµ¨ÌòÑ**
- Show handleCodeAction function
- Explain: iterates diagnostics from context, matches fixable ones, generates CodeAction for each
- Matching logic: check Source = "funlang" and Code = "unused-variable"
- Return type: TextDocumentCodeActionResult (U2<Command, CodeAction>[])

**7. Server.fs ÌÜµÌï©**
- Show capability registration:
  ```fsharp
  CodeActionProvider = Some (U2.C2 {
      CodeActionKinds = Some [| "quickfix" |]
      ResolveProvider = Some false
      WorkDoneProgress = None
  })
  ```
- Show handler in Handlers module
- Explain: CodeActionKinds tells VS Code which kinds of actions this server provides

**8. ÌÖåÏä§Ìä∏ ÏûëÏÑ±**
- Show 2-3 test examples from CodeActionsTests.fs
- Test unused variable detection (diagnostics level)
- Test code action generation (actions level)
- Test that used variables don't trigger actions
- Show test helper pattern

**9. ÌôïÏû• Í∞ÄÎä•ÏÑ±**
- Type-based quickfixes (ACTION-02): suggest type annotations for type errors
- Extract variable/function refactoring
- Import suggestions
- Auto-fix formatting
- Explain how to extend the matching logic in handleCodeAction

**10. Ï£ºÏùòÏÇ¨Ìï≠**
- Only generate actions for high-confidence fixes
- Don't silently delete code (prefer safe transformations like underscore prefix)
- Handle edge cases: empty diagnostics, non-funlang diagnostics
- Performance: code actions are requested frequently (every cursor move if diagnostics present)

STYLE: Same Korean tutorial format as established. ~500-700 lines, code examples matching actual implementation.
  </action>
  <verify>
File exists at documentation/tutorial/11-code-actions.md with 400+ lines. Contains Korean text, code examples, all 10 sections.
  </verify>
  <done>
Tutorial 11-code-actions.md written in Korean covering Code Actions concept, LSP protocol, unused variable detection, quickfix generation, diagnostic integration, and extensibility (TUT-11).
  </done>
</task>

</tasks>

<verification>
- documentation/tutorial/11-code-actions.md exists with 400+ lines
- All 10 sections present
- Code examples match actual CodeActions.fs and Diagnostics.fs implementation
- Korean language throughout
</verification>

<success_criteria>
- TUT-11 requirement met: tutorial shows how to implement Code Actions with code examples
- Covers diagnostic-driven quickfix pattern
- Explains unused variable detection and underscore prefix fix
- Shows extensibility path for future code actions
</success_criteria>

<output>
After completion, create `.planning/phases/04-advanced-features/04-06-SUMMARY.md`
</output>
