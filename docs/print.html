<!DOCTYPE HTML>
<html lang="ko" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>FunLang LSP íŠœí† ë¦¬ì–¼</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="F#ìœ¼ë¡œ ë§Œë“œëŠ” Language Server â€” LSP ì…ë¬¸ìë¥¼ ìœ„í•œ ë‹¨ê³„ë³„ í•œêµ­ì–´ íŠœí† ë¦¬ì–¼">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-ea2416fc.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-b67c2577.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">FunLang LSP íŠœí† ë¦¬ì–¼</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="funlang-lsp-íŠœí† ë¦¬ì–¼"><a class="header" href="#funlang-lsp-íŠœí† ë¦¬ì–¼">FunLang LSP íŠœí† ë¦¬ì–¼</a></h1>
<p>F#ìœ¼ë¡œ ë§Œë“œëŠ” Language Server â€” LSP ì…ë¬¸ìë¥¼ ìœ„í•œ ë‹¨ê³„ë³„ í•œêµ­ì–´ íŠœí† ë¦¬ì–¼</p>
<h2 id="ì´-íŠœí† ë¦¬ì–¼ì€"><a class="header" href="#ì´-íŠœí† ë¦¬ì–¼ì€">ì´ íŠœí† ë¦¬ì–¼ì€</a></h2>
<p>ML ê³„ì—´ í•¨ìˆ˜í˜• ì–¸ì–´ FunLangì„ ìœ„í•œ Language Serverë¥¼ ì²˜ìŒë¶€í„° ëê¹Œì§€ êµ¬í˜„í•˜ëŠ” ê³¼ì •ì„ ë‹¤ë£¬ë‹¤. LSP(Language Server Protocol)ì˜ ê¸°ë³¸ ê°œë…ë¶€í„° VS Code Extension íŒ¨í‚¤ì§•ê¹Œì§€, ì‹¤ì œ ë™ì‘í•˜ëŠ” ì½”ë“œë¥¼ ë‹¨ê³„ë³„ë¡œ ì‘ì„±í•˜ë©´ì„œ LSPë¥¼ ì´í•´í•  ìˆ˜ ìˆë‹¤.</p>
<h2 id="êµ¬í˜„í•˜ëŠ”-ê¸°ëŠ¥"><a class="header" href="#êµ¬í˜„í•˜ëŠ”-ê¸°ëŠ¥">êµ¬í˜„í•˜ëŠ” ê¸°ëŠ¥</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>ê¸°ëŠ¥</th><th>ì„¤ëª…</th></tr>
</thead>
<tbody>
<tr><td>Diagnostics</td><td>ë¬¸ë²•/íƒ€ì… ì˜¤ë¥˜ ì‹¤ì‹œê°„ í‘œì‹œ</td></tr>
<tr><td>Hover</td><td>ë³€ìˆ˜/í•¨ìˆ˜ íƒ€ì… ì •ë³´ í‘œì‹œ</td></tr>
<tr><td>Completion</td><td>í‚¤ì›Œë“œ ë° ì‹¬ë³¼ ìë™ ì™„ì„±</td></tr>
<tr><td>Go to Definition</td><td>ì •ì˜ ìœ„ì¹˜ë¡œ ì´ë™</td></tr>
<tr><td>Find References</td><td>ëª¨ë“  ì°¸ì¡° ì°¾ê¸°</td></tr>
<tr><td>Rename Symbol</td><td>ì‹¬ë³¼ ì´ë¦„ ì¼ê´„ ë³€ê²½</td></tr>
<tr><td>Code Actions</td><td>ì½”ë“œ ê°œì„  ì œì•ˆ</td></tr>
</tbody>
</table>
</div>
<h2 id="ê¸°ìˆ -ìŠ¤íƒ"><a class="header" href="#ê¸°ìˆ -ìŠ¤íƒ">ê¸°ìˆ  ìŠ¤íƒ</a></h2>
<ul>
<li><strong>ì–¸ì–´</strong>: F# (.NET 10)</li>
<li><strong>LSP ë¼ì´ë¸ŒëŸ¬ë¦¬</strong>: Ionide.LanguageServerProtocol 0.7.0</li>
<li><strong>í…ŒìŠ¤íŠ¸</strong>: Expecto + FsCheck</li>
<li><strong>ì—ë””í„°</strong>: VS Code</li>
</ul>
<h2 id="ì‹œì‘í•˜ê¸°"><a class="header" href="#ì‹œì‘í•˜ê¸°">ì‹œì‘í•˜ê¸°</a></h2>
<p><a href="#lsp-ê°œë…-ì†Œê°œ">LSP ê°œë… ì†Œê°œ</a>ë¶€í„° ì‹œì‘í•˜ë¼.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lsp-ê°œë…-ì†Œê°œ"><a class="header" href="#lsp-ê°œë…-ì†Œê°œ">LSP ê°œë… ì†Œê°œ</a></h1>
<p>ì´ ë¬¸ì„œëŠ” Language Server Protocol(LSP)ì˜ í•µì‹¬ ê°œë…ì„ ì„¤ëª…í•œë‹¤. LSP ì„œë²„ë¥¼ êµ¬í˜„í•˜ê¸° ì „ì— ë°˜ë“œì‹œ ì´í•´í•´ì•¼ í•  ê¸°ì´ˆ ê°œë…ë“¤ì„ ë‹¤ë£¬ë‹¤.</p>
<h2 id="ëª©ì°¨"><a class="header" href="#ëª©ì°¨">ëª©ì°¨</a></h2>
<ol>
<li><a href="#lspë€-ë¬´ì—‡ì¸ê°€">LSPë€ ë¬´ì—‡ì¸ê°€</a></li>
<li><a href="#í´ë¼ì´ì–¸íŠ¸-ì„œë²„-ì•„í‚¤í…ì²˜">í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ì•„í‚¤í…ì²˜</a></li>
<li><a href="#json-rpc-í”„ë¡œí† ì½œ">JSON-RPC í”„ë¡œí† ì½œ</a></li>
<li><a href="#capability-negotiation-ê¸°ëŠ¥-í˜‘ìƒ">Capability Negotiation</a></li>
<li><a href="#document-synchronization-ë¬¸ì„œ-ë™ê¸°í™”">Document Synchronization</a></li>
<li><a href="#ì‹¤ì‹œê°„-ì§„ë‹¨-real-time-diagnostics">ì‹¤ì‹œê°„ ì§„ë‹¨</a></li>
</ol>
<hr>
<h2 id="lspë€-ë¬´ì—‡ì¸ê°€"><a class="header" href="#lspë€-ë¬´ì—‡ì¸ê°€">LSPë€ ë¬´ì—‡ì¸ê°€</a></h2>
<p>**Language Server Protocol(LSP)**ì€ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ ì§€ì› ê¸°ëŠ¥(ìë™ ì™„ì„±, ì •ì˜ ì°¾ê¸°, ì˜¤ë¥˜ ì§„ë‹¨ ë“±)ì„ ì—ë””í„°/IDEì™€ ì–¸ì–´ ë¶„ì„ ì—”ì§„ ì‚¬ì´ì—ì„œ í‘œì¤€í™”í•œ í”„ë¡œí† ì½œì´ë‹¤.</p>
<h3 id="ë¬¸ì œ-ì—ë””í„°-ì¢…ì†ì„±"><a class="header" href="#ë¬¸ì œ-ì—ë””í„°-ì¢…ì†ì„±">ë¬¸ì œ: ì—ë””í„° ì¢…ì†ì„±</a></h3>
<p>LSP ì´ì „ì—ëŠ” ê° ì—ë””í„°ë§ˆë‹¤ ê° ì–¸ì–´ì— ëŒ€í•œ ë³„ë„ì˜ í”ŒëŸ¬ê·¸ì¸ì´ í•„ìš”í–ˆë‹¤.</p>
<pre><code>Mê°œ ì—ë””í„° Ã— Nê°œ ì–¸ì–´ = M Ã— Nê°œ í”ŒëŸ¬ê·¸ì¸
</code></pre>
<p>ì˜ˆì‹œ:</p>
<ul>
<li>VS Codeìš© Python í”ŒëŸ¬ê·¸ì¸</li>
<li>Vimìš© Python í”ŒëŸ¬ê·¸ì¸</li>
<li>Emacsìš© Python í”ŒëŸ¬ê·¸ì¸</li>
<li>Sublimeìš© Python í”ŒëŸ¬ê·¸ì¸</li>
<li>â€¦ (ê° ì—ë””í„°ë§ˆë‹¤ ë°˜ë³µ)</li>
</ul>
<p>ì´ ë°©ì‹ì€ ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë µê³  ì¤‘ë³µ ê°œë°œì´ ì‹¬í–ˆë‹¤.</p>
<h3 id="í•´ê²°ì±…-lsp-í‘œì¤€í™”"><a class="header" href="#í•´ê²°ì±…-lsp-í‘œì¤€í™”">í•´ê²°ì±…: LSP í‘œì¤€í™”</a></h3>
<p>LSPëŠ” ì´ ë¬¸ì œë¥¼ <strong>M + N</strong> êµ¬ì¡°ë¡œ ë°”ê¿¨ë‹¤.</p>
<pre><code>Mê°œ ì—ë””í„° (LSP í´ë¼ì´ì–¸íŠ¸) + Nê°œ ì–¸ì–´ (LSP ì„œë²„) = M + Nê°œ êµ¬í˜„
</code></pre>
<p>ê° ì—ë””í„°ëŠ” LSP í´ë¼ì´ì–¸íŠ¸ë§Œ êµ¬í˜„í•˜ë©´ ë˜ê³ , ê° ì–¸ì–´ëŠ” LSP ì„œë²„ë§Œ êµ¬í˜„í•˜ë©´ ëœë‹¤. ê·¸ëŸ¬ë©´ ëª¨ë“  ì¡°í•©ì´ ìë™ìœ¼ë¡œ ì‘ë™í•œë‹¤.</p>
<h3 id="ì—­ì‚¬"><a class="header" href="#ì—­ì‚¬">ì—­ì‚¬</a></h3>
<ul>
<li><strong>2016ë…„</strong>: Microsoftê°€ VS Codeì™€ í•¨ê»˜ LSP ë°œí‘œ</li>
<li><strong>2017-2019ë…„</strong>: Vim, Emacs, Sublime, IntelliJ ë“± ì£¼ìš” ì—ë””í„°ì—ì„œ LSP í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„</li>
<li><strong>2025ë…„</strong>: ì‚¬ì‹¤ìƒ ì—…ê³„ í‘œì¤€ìœ¼ë¡œ ì •ì°©, LSP 3.17 ìŠ¤í™ ë¦´ë¦¬ìŠ¤</li>
</ul>
<hr>
<h2 id="í´ë¼ì´ì–¸íŠ¸-ì„œë²„-ì•„í‚¤í…ì²˜"><a class="header" href="#í´ë¼ì´ì–¸íŠ¸-ì„œë²„-ì•„í‚¤í…ì²˜">í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ì•„í‚¤í…ì²˜</a></h2>
<p>LSPëŠ” <strong>í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ëª¨ë¸</strong>ë¡œ ë™ì‘í•œë‹¤.</p>
<h3 id="êµ¬ì„±-ìš”ì†Œ"><a class="header" href="#êµ¬ì„±-ìš”ì†Œ">êµ¬ì„± ìš”ì†Œ</a></h3>
<p><strong>í´ë¼ì´ì–¸íŠ¸ (Client)</strong></p>
<ul>
<li>ì—ë””í„°/IDEê°€ ì‹¤í–‰í•˜ëŠ” ë¶€ë¶„</li>
<li>ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ë‹´ë‹¹</li>
<li>ì˜ˆ: VS Code, Neovim, Emacs, Helix</li>
</ul>
<p><strong>ì„œë²„ (Server)</strong></p>
<ul>
<li>ë³„ë„ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰ë˜ëŠ” ì–¸ì–´ ë¶„ì„ ì—”ì§„</li>
<li>ì½”ë“œ íŒŒì‹±, íƒ€ì… ì²´í‚¹, ì§„ë‹¨ ìƒì„± ë“± ë‹´ë‹¹</li>
<li>ì˜ˆ: <code>pyright</code> (Python), <code>rust-analyzer</code> (Rust), <code>gopls</code> (Go)</li>
</ul>
<h3 id="í”„ë¡œì„¸ìŠ¤-ê°„-í†µì‹ "><a class="header" href="#í”„ë¡œì„¸ìŠ¤-ê°„-í†µì‹ ">í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ </a></h3>
<p>í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ëŠ” <strong>ë³„ë„ í”„ë¡œì„¸ìŠ¤</strong>ë¡œ ì‹¤í–‰ë˜ë©°, ë‹¤ìŒ ë°©ë²•ìœ¼ë¡œ í†µì‹ í•œë‹¤.</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚                          â”‚             â”‚
â”‚  VS Code    â”‚  â—„â”€â”€â”€ JSON-RPC â”€â”€â”€â–º     â”‚   Language  â”‚
â”‚  (Client)   â”‚       over stdio         â”‚   Server    â”‚
â”‚             â”‚                          â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Process 1                                Process 2
</code></pre>
<p><strong>í†µì‹  ë°©ì‹:</strong></p>
<ol>
<li><strong>stdin/stdout</strong> (ê°€ì¥ ì¼ë°˜ì ) - í‘œì¤€ ì…ì¶œë ¥ì„ í†µí•œ íŒŒì´í”„ í†µì‹ </li>
<li><strong>Socket</strong> - TCP ì†Œì¼“ ì—°ê²°</li>
<li><strong>Named Pipe</strong> - Windows ëª…ëª…ëœ íŒŒì´í”„</li>
</ol>
<p>ëŒ€ë¶€ë¶„ì˜ LSP ì„œë²„ëŠ” stdin/stdoutì„ ì‚¬ìš©í•œë‹¤. ì—ë””í„°ê°€ ì„œë²„ë¥¼ ìì‹ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰í•˜ê³ , í‘œì¤€ ì…ì¶œë ¥ì„ í†µí•´ ë©”ì‹œì§€ë¥¼ ì£¼ê³ ë°›ëŠ”ë‹¤.</p>
<h3 id="ì•„í‚¤í…ì²˜-ë‹¤ì´ì–´ê·¸ë¨"><a class="header" href="#ì•„í‚¤í…ì²˜-ë‹¤ì´ì–´ê·¸ë¨">ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨</a></h3>
<pre class="mermaid">sequenceDiagram
    participant Editor as ì—ë””í„° (VS Code)
    participant Server as Language Server

    Editor-&gt;&gt;Server: initialize request
    Server-&gt;&gt;Editor: initialize response (capabilities)
    Editor-&gt;&gt;Server: initialized notification

    Editor-&gt;&gt;Server: textDocument/didOpen
    Server-&gt;&gt;Editor: textDocument/publishDiagnostics

    Editor-&gt;&gt;Server: textDocument/hover (ì‚¬ìš©ìê°€ ì»¤ì„œ ì˜¬ë¦¼)
    Server-&gt;&gt;Editor: hover response (íƒ€ì… ì •ë³´)
</pre>

<hr>
<h2 id="json-rpc-í”„ë¡œí† ì½œ"><a class="header" href="#json-rpc-í”„ë¡œí† ì½œ">JSON-RPC í”„ë¡œí† ì½œ</a></h2>
<p>LSPëŠ” <strong>JSON-RPC 2.0</strong> í”„ë¡œí† ì½œì„ ê¸°ë°˜ìœ¼ë¡œ í•œë‹¤.</p>
<h3 id="ë©”ì‹œì§€-í˜•ì‹"><a class="header" href="#ë©”ì‹œì§€-í˜•ì‹">ë©”ì‹œì§€ í˜•ì‹</a></h3>
<p>ëª¨ë“  LSP ë©”ì‹œì§€ëŠ” ë‹¤ìŒ í˜•ì‹ì„ ë”°ë¥¸ë‹¤.</p>
<pre><code>Content-Length: &lt;ë°”ì´íŠ¸ ìˆ˜&gt;\r\n
\r\n
{JSON ë³¸ë¬¸}
</code></pre>
<p><strong>ì˜ˆì‹œ:</strong></p>
<pre><code>Content-Length: 123\r\n
\r\n
{"jsonrpc":"2.0","id":1,"method":"initialize","params":{...}}
</code></pre>
<h3 id="ë©”ì‹œì§€-íƒ€ì…"><a class="header" href="#ë©”ì‹œì§€-íƒ€ì…">ë©”ì‹œì§€ íƒ€ì…</a></h3>
<p>LSPëŠ” 3ê°€ì§€ ë©”ì‹œì§€ íƒ€ì…ì„ ì‚¬ìš©í•œë‹¤.</p>
<h4 id="1-request-ìš”ì²­"><a class="header" href="#1-request-ìš”ì²­">1. Request (ìš”ì²­)</a></h4>
<p>í´ë¼ì´ì–¸íŠ¸ ë˜ëŠ” ì„œë²„ê°€ ìƒëŒ€ë°©ì—ê²Œ ì‘ì—…ì„ ìš”ì²­í•˜ê³  ì‘ë‹µì„ ê¸°ë‹¤ë¦°ë‹¤.</p>
<pre><code class="language-json">{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "textDocument/hover",
  "params": {
    "textDocument": {"uri": "file:///path/to/file.fun"},
    "position": {"line": 5, "character": 10}
  }
}
</code></pre>
<h4 id="2-response-ì‘ë‹µ"><a class="header" href="#2-response-ì‘ë‹µ">2. Response (ì‘ë‹µ)</a></h4>
<p>Requestì— ëŒ€í•œ ì‘ë‹µì´ë‹¤.</p>
<pre><code class="language-json">{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "contents": {
      "kind": "markdown",
      "value": "**í•¨ìˆ˜**: `add`\n\níƒ€ì…: `(Int, Int) -&gt; Int`"
    }
  }
}
</code></pre>
<h4 id="3-notification-ì•Œë¦¼"><a class="header" href="#3-notification-ì•Œë¦¼">3. Notification (ì•Œë¦¼)</a></h4>
<p>ì‘ë‹µì„ ê¸°ëŒ€í•˜ì§€ ì•ŠëŠ” ë‹¨ë°©í–¥ ë©”ì‹œì§€ì´ë‹¤. <code>id</code> í•„ë“œê°€ ì—†ë‹¤.</p>
<pre><code class="language-json">{
  "jsonrpc": "2.0",
  "method": "textDocument/didChange",
  "params": {
    "textDocument": {"uri": "file:///path/to/file.fun", "version": 2},
    "contentChanges": [...]
  }
}
</code></pre>
<h3 id="initialize-í•¸ë“œì…°ì´í¬"><a class="header" href="#initialize-í•¸ë“œì…°ì´í¬">Initialize í•¸ë“œì…°ì´í¬</a></h3>
<p>ëª¨ë“  LSP ì„¸ì…˜ì€ <code>initialize</code> ìš”ì²­ìœ¼ë¡œ ì‹œì‘ëœë‹¤.</p>
<p><strong>í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„:</strong></p>
<pre><code class="language-json">{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "initialize",
  "params": {
    "processId": 1234,
    "rootUri": "file:///path/to/project",
    "capabilities": {
      "textDocument": {
        "hover": {"contentFormat": ["markdown", "plaintext"]}
      }
    }
  }
}
</code></pre>
<p><strong>ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸:</strong></p>
<pre><code class="language-json">{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "capabilities": {
      "hoverProvider": true,
      "completionProvider": {"triggerCharacters": ["."]},
      "textDocumentSync": 2
    }
  }
}
</code></pre>
<hr>
<h2 id="capability-negotiation-ê¸°ëŠ¥-í˜‘ìƒ"><a class="header" href="#capability-negotiation-ê¸°ëŠ¥-í˜‘ìƒ">Capability Negotiation (ê¸°ëŠ¥ í˜‘ìƒ)</a></h2>
<p>LSPì˜ í•µì‹¬ ì„¤ê³„ ì›ì¹™ ì¤‘ í•˜ë‚˜ëŠ” <strong>ê¸°ëŠ¥ í˜‘ìƒ</strong>ì´ë‹¤. ëª¨ë“  ì„œë²„ê°€ ëª¨ë“  ê¸°ëŠ¥ì„ êµ¬í˜„í•  í•„ìš”ëŠ” ì—†ë‹¤.</p>
<h3 id="í´ë¼ì´ì–¸íŠ¸-capabilities"><a class="header" href="#í´ë¼ì´ì–¸íŠ¸-capabilities">í´ë¼ì´ì–¸íŠ¸ Capabilities</a></h3>
<p><code>initialize</code> ìš”ì²­ì—ì„œ í´ë¼ì´ì–¸íŠ¸ê°€ ì§€ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ì•Œë¦°ë‹¤.</p>
<pre><code class="language-fsharp">type ClientCapabilities = {
    textDocument: TextDocumentClientCapabilities option
    workspace: WorkspaceClientCapabilities option
}
</code></pre>
<p><strong>ì˜ˆì‹œ:</strong></p>
<ul>
<li>Markdown í¬ë§· ì§€ì› ì—¬ë¶€</li>
<li>ë™ì  ë“±ë¡(dynamic registration) ì§€ì› ì—¬ë¶€</li>
<li>íŠ¹ì • LSP ë©”ì„œë“œ ì§€ì› ì—¬ë¶€</li>
</ul>
<h3 id="ì„œë²„-capabilities"><a class="header" href="#ì„œë²„-capabilities">ì„œë²„ Capabilities</a></h3>
<p><code>initialize</code> ì‘ë‹µì—ì„œ ì„œë²„ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì„ ì–¸í•œë‹¤.</p>
<pre><code class="language-fsharp">type ServerCapabilities = {
    textDocumentSync: TextDocumentSyncKind option
    hoverProvider: bool option
    completionProvider: CompletionOptions option
    definitionProvider: bool option
    referencesProvider: bool option
    documentSymbolProvider: bool option
    renameProvider: bool option
    codeActionProvider: bool option
}
</code></pre>
<h3 id="ì£¼ìš”-capabilities"><a class="header" href="#ì£¼ìš”-capabilities">ì£¼ìš” Capabilities</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Capability</th><th>ì„¤ëª…</th><th>ì—ë””í„°ì—ì„œ ë³´ì´ëŠ” ê¸°ëŠ¥</th></tr>
</thead>
<tbody>
<tr><td><code>textDocumentSync</code></td><td>ë¬¸ì„œ ë™ê¸°í™” ë°©ì‹ (Full/Incremental)</td><td>í•„ìˆ˜</td></tr>
<tr><td><code>hoverProvider</code></td><td>ì»¤ì„œ ì•„ë˜ ì •ë³´ ì œê³µ</td><td>í˜¸ë²„ íˆ´íŒ</td></tr>
<tr><td><code>completionProvider</code></td><td>ìë™ ì™„ì„± ì œì•ˆ</td><td>IntelliSense</td></tr>
<tr><td><code>definitionProvider</code></td><td>ì •ì˜ ìœ„ì¹˜ ì°¾ê¸°</td><td>â€œGo to Definitionâ€</td></tr>
<tr><td><code>referencesProvider</code></td><td>ì°¸ì¡° ì°¾ê¸°</td><td>â€œFind All Referencesâ€</td></tr>
<tr><td><code>renameProvider</code></td><td>ì‹¬ë³¼ ì´ë¦„ ë³€ê²½</td><td>â€œRename Symbolâ€</td></tr>
<tr><td><code>diagnosticProvider</code></td><td>ì˜¤ë¥˜/ê²½ê³  ì§„ë‹¨</td><td>ë¹¨ê°„ ë°‘ì¤„</td></tr>
</tbody>
</table>
</div>
<p><strong>ì¤‘ìš”</strong>: ì„œë²„ê°€ <code>hoverProvider: true</code>ë¥¼ ì„ ì–¸í•˜ì§€ ì•Šìœ¼ë©´, í´ë¼ì´ì–¸íŠ¸ëŠ” <code>textDocument/hover</code> ìš”ì²­ì„ ë³´ë‚´ì§€ ì•ŠëŠ”ë‹¤.</p>
<hr>
<h2 id="document-synchronization-ë¬¸ì„œ-ë™ê¸°í™”"><a class="header" href="#document-synchronization-ë¬¸ì„œ-ë™ê¸°í™”">Document Synchronization (ë¬¸ì„œ ë™ê¸°í™”)</a></h2>
<p>ì—ë””í„°ì—ì„œ íŒŒì¼ì„ ì—´ê³  í¸ì§‘í•˜ë©´, ì„œë²„ëŠ” ê·¸ ë³€ê²½ì‚¬í•­ì„ ì•Œì•„ì•¼ í•œë‹¤. ì´ë¥¼ <strong>ë¬¸ì„œ ë™ê¸°í™”</strong>ë¼ê³  í•œë‹¤.</p>
<h3 id="lifecycle-ì´ë²¤íŠ¸"><a class="header" href="#lifecycle-ì´ë²¤íŠ¸">Lifecycle ì´ë²¤íŠ¸</a></h3>
<h4 id="textdocumentdidopen"><a class="header" href="#textdocumentdidopen">textDocument/didOpen</a></h4>
<p>ì‚¬ìš©ìê°€ íŒŒì¼ì„ ì—´ë©´ í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚´ëŠ” ì•Œë¦¼ì´ë‹¤.</p>
<pre><code class="language-json">{
  "method": "textDocument/didOpen",
  "params": {
    "textDocument": {
      "uri": "file:///path/to/file.fun",
      "languageId": "funlang",
      "version": 1,
      "text": "let x = 42\nlet y = x + 10"
    }
  }
}
</code></pre>
<h4 id="textdocumentdidchange"><a class="header" href="#textdocumentdidchange">textDocument/didChange</a></h4>
<p>ì‚¬ìš©ìê°€ íŒŒì¼ì„ í¸ì§‘í•˜ë©´ ë³´ë‚´ëŠ” ì•Œë¦¼ì´ë‹¤.</p>
<pre><code class="language-json">{
  "method": "textDocument/didChange",
  "params": {
    "textDocument": {
      "uri": "file:///path/to/file.fun",
      "version": 2
    },
    "contentChanges": [
      {
        "range": {"start": {"line": 1, "character": 8}, "end": {"line": 1, "character": 10}},
        "text": "20"
      }
    ]
  }
}
</code></pre>
<h4 id="textdocumentdidclose"><a class="header" href="#textdocumentdidclose">textDocument/didClose</a></h4>
<p>íŒŒì¼ì„ ë‹«ìœ¼ë©´ ë³´ë‚´ëŠ” ì•Œë¦¼ì´ë‹¤. ì„œë²„ëŠ” ë©”ëª¨ë¦¬ì—ì„œ í•´ë‹¹ íŒŒì¼ ì •ë³´ë¥¼ ì œê±°í•  ìˆ˜ ìˆë‹¤.</p>
<h3 id="sync-ë°©ì‹"><a class="header" href="#sync-ë°©ì‹">Sync ë°©ì‹</a></h3>
<p>ì„œë²„ëŠ” ë‘ ê°€ì§€ ë™ê¸°í™” ë°©ì‹ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•  ìˆ˜ ìˆë‹¤.</p>
<h4 id="1-full-sync-textdocumentsynckindfull--1"><a class="header" href="#1-full-sync-textdocumentsynckindfull--1">1. Full Sync (TextDocumentSyncKind.Full = 1)</a></h4>
<p>ë§¤ë²ˆ <strong>ì „ì²´ ë¬¸ì„œ ë‚´ìš©</strong>ì„ ì „ì†¡í•œë‹¤.</p>
<p><strong>ì¥ì </strong>: êµ¬í˜„ì´ ê°„ë‹¨
<strong>ë‹¨ì </strong>: í° íŒŒì¼ì—ì„œ ë„¤íŠ¸ì›Œí¬ ë¹„ìš© ì¦ê°€</p>
<h4 id="2-incremental-sync-textdocumentsynckindincremental--2"><a class="header" href="#2-incremental-sync-textdocumentsynckindincremental--2">2. Incremental Sync (TextDocumentSyncKind.Incremental = 2)</a></h4>
<p><strong>ë³€ê²½ëœ ë¶€ë¶„ë§Œ</strong> (range + text) ì „ì†¡í•œë‹¤.</p>
<p><strong>ì¥ì </strong>: íš¨ìœ¨ì , ë„¤íŠ¸ì›Œí¬ ë¹„ìš© ê°ì†Œ
<strong>ë‹¨ì </strong>: êµ¬í˜„ ë³µì¡ë„ ì¦ê°€ (range ê´€ë¦¬)</p>
<p><strong>ê¶Œì¥</strong>: ëŒ€ë¶€ë¶„ì˜ í”„ë¡œë•ì…˜ ì„œë²„ëŠ” Incremental Syncë¥¼ ì‚¬ìš©í•œë‹¤.</p>
<hr>
<h2 id="ì‹¤ì‹œê°„-ì§„ë‹¨-real-time-diagnostics"><a class="header" href="#ì‹¤ì‹œê°„-ì§„ë‹¨-real-time-diagnostics">ì‹¤ì‹œê°„ ì§„ë‹¨ (Real-time Diagnostics)</a></h2>
<p>LSPì˜ ê°€ì¥ ê°•ë ¥í•œ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ëŠ” <strong>ì‹¤ì‹œê°„ ì˜¤ë¥˜/ê²½ê³  í‘œì‹œ</strong>ì´ë‹¤.</p>
<h3 id="textdocumentpublishdiagnostics"><a class="header" href="#textdocumentpublishdiagnostics">textDocument/publishDiagnostics</a></h3>
<p>ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì§„ë‹¨ ì •ë³´ë¥¼ ë³´ë‚´ëŠ” ì•Œë¦¼ì´ë‹¤. (Requestê°€ ì•„ë‹Œ <strong>Notification</strong>)</p>
<pre><code class="language-json">{
  "method": "textDocument/publishDiagnostics",
  "params": {
    "uri": "file:///path/to/file.fun",
    "diagnostics": [
      {
        "range": {
          "start": {"line": 5, "character": 10},
          "end": {"line": 5, "character": 15}
        },
        "severity": 1,
        "message": "Undefined variable 'hello'",
        "source": "FunLang"
      }
    ]
  }
}
</code></pre>
<h3 id="diagnostic-êµ¬ì¡°"><a class="header" href="#diagnostic-êµ¬ì¡°">Diagnostic êµ¬ì¡°</a></h3>
<pre><code class="language-fsharp">type Diagnostic = {
    range: Range              // ì˜¤ë¥˜ ìœ„ì¹˜
    severity: DiagnosticSeverity option  // 1=Error, 2=Warning, 3=Info, 4=Hint
    code: string option       // ì˜¤ë¥˜ ì½”ë“œ (ì˜ˆ: "E0001")
    source: string option     // "FunLang", "TypeChecker" ë“±
    message: string           // ì˜¤ë¥˜ ë©”ì‹œì§€
    relatedInformation: DiagnosticRelatedInformation[] option
}
</code></pre>
<h3 id="severity-ë ˆë²¨"><a class="header" href="#severity-ë ˆë²¨">Severity ë ˆë²¨</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Severity</th><th>ê°’</th><th>ì˜ë¯¸</th><th>ì—ë””í„° í‘œì‹œ</th></tr>
</thead>
<tbody>
<tr><td>Error</td><td>1</td><td>ì»´íŒŒì¼ ë¶ˆê°€ëŠ¥í•œ ì˜¤ë¥˜</td><td>ë¹¨ê°„ ë°‘ì¤„</td></tr>
<tr><td>Warning</td><td>2</td><td>ì ì¬ì  ë¬¸ì œ</td><td>ë…¸ë€ ë°‘ì¤„</td></tr>
<tr><td>Information</td><td>3</td><td>ì •ë³´ì„± ë©”ì‹œì§€</td><td>íŒŒë€ ë°‘ì¤„</td></tr>
<tr><td>Hint</td><td>4</td><td>ì œì•ˆ</td><td>íšŒìƒ‰ ì ì„ </td></tr>
</tbody>
</table>
</div>
<h3 id="ì§„ë‹¨-íë¦„"><a class="header" href="#ì§„ë‹¨-íë¦„">ì§„ë‹¨ íë¦„</a></h3>
<pre><code>ì‚¬ìš©ìê°€ ì½”ë“œ í¸ì§‘
    â†“
textDocument/didChange ì•Œë¦¼
    â†“
ì„œë²„ê°€ ì½”ë“œ ë¶„ì„ (íŒŒì‹± â†’ íƒ€ì… ì²´í‚¹)
    â†“
textDocument/publishDiagnostics ì•Œë¦¼
    â†“
ì—ë””í„°ê°€ ë¹¨ê°„ ë°‘ì¤„ í‘œì‹œ
</code></pre>
<p><strong>ì¤‘ìš”</strong>: <code>publishDiagnostics</code>ëŠ” ì„œë²„ê°€ ëŠ¥ë™ì ìœ¼ë¡œ ë³´ë‚´ëŠ” ì•Œë¦¼ì´ë‹¤. í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­í•˜ì§€ ì•Šì•„ë„ ì„œë²„ê°€ ë³€ê²½ ê°ì§€ ì‹œ ìë™ìœ¼ë¡œ ì „ì†¡í•œë‹¤.</p>
<hr>
<h2 id="ë‹¤ìŒ-ë‹¨ê³„"><a class="header" href="#ë‹¤ìŒ-ë‹¨ê³„">ë‹¤ìŒ ë‹¨ê³„</a></h2>
<p>ì´ì œ LSPì˜ í•µì‹¬ ê°œë…ì„ ì´í•´í–ˆë‹¤.</p>
<ul>
<li><strong>í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ì•„í‚¤í…ì²˜</strong>: ë³„ë„ í”„ë¡œì„¸ìŠ¤ë¡œ ë™ì‘</li>
<li><strong>JSON-RPC</strong>: Content-Length í—¤ë” + JSON ë³¸ë¬¸</li>
<li><strong>Capability Negotiation</strong>: ì„œë²„ê°€ ì§€ì›í•˜ëŠ” ê¸°ëŠ¥ ì„ ì–¸</li>
<li><strong>Document Sync</strong>: didOpen, didChange, didClose</li>
<li><strong>Diagnostics</strong>: ì‹¤ì‹œê°„ ì˜¤ë¥˜ í‘œì‹œ</li>
</ul>
<p>ë‹¤ìŒ ë¬¸ì„œì—ì„œëŠ” F#ìœ¼ë¡œ LSP ì„œë²„ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒì„ ë‹¤ë£¬ë‹¤.</p>
<p><strong>â†’ <a href="#f-lsp-ë¼ì´ë¸ŒëŸ¬ë¦¬-ì„ íƒ">02-library-choice.md</a></strong></p>
<hr>
<h2 id="ì°¸ê³ -ìë£Œ"><a class="header" href="#ì°¸ê³ -ìë£Œ">ì°¸ê³  ìë£Œ</a></h2>
<ul>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/">LSP ê³µì‹ ìŠ¤í™</a></li>
<li><a href="https://www.jsonrpc.org/specification">JSON-RPC 2.0 ìŠ¤í™</a></li>
<li><a href="https://microsoft.github.io/language-server-protocol/">LSP ê³µì‹ ì›¹ì‚¬ì´íŠ¸</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="f-lsp-ë¼ì´ë¸ŒëŸ¬ë¦¬-ì„ íƒ"><a class="header" href="#f-lsp-ë¼ì´ë¸ŒëŸ¬ë¦¬-ì„ íƒ">F# LSP ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ</a></h1>
<p>ì´ ë¬¸ì„œëŠ” F#ìœ¼ë¡œ LSP ì„œë²„ë¥¼ êµ¬í˜„í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ ë¹„êµí•˜ê³ , ì™œ <strong>Ionide.LanguageServerProtocol</strong>ì„ ì„ íƒí–ˆëŠ”ì§€ ì„¤ëª…í•œë‹¤.</p>
<h2 id="ëª©ì°¨-1"><a class="header" href="#ëª©ì°¨-1">ëª©ì°¨</a></h2>
<ol>
<li><a href="#f-lsp-ë¼ì´ë¸ŒëŸ¬ë¦¬-ì˜µì…˜">F# LSP ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜µì…˜</a></li>
<li><a href="#ionidelanguageserverprotocol-ì†Œê°œ">Ionide.LanguageServerProtocol ì†Œê°œ</a></li>
<li><a href="#omnisharp-ëŒ€ë¹„-ì¥ì ">OmniSharp ëŒ€ë¹„ ì¥ì </a></li>
<li><a href="#ì§ì ‘-êµ¬í˜„ì„-í”¼í•´ì•¼-í•˜ëŠ”-ì´ìœ ">ì§ì ‘ êµ¬í˜„ì„ í”¼í•´ì•¼ í•˜ëŠ” ì´ìœ </a></li>
<li><a href="#ê²°ë¡ -ionide-ì„ íƒ">ê²°ë¡ : Ionide ì„ íƒ</a></li>
</ol>
<hr>
<h2 id="f-lsp-ë¼ì´ë¸ŒëŸ¬ë¦¬-ì˜µì…˜"><a class="header" href="#f-lsp-ë¼ì´ë¸ŒëŸ¬ë¦¬-ì˜µì…˜">F# LSP ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜µì…˜</a></h2>
<p>F#ìœ¼ë¡œ LSP ì„œë²„ë¥¼ ë§Œë“¤ ë•Œ ì„ íƒí•  ìˆ˜ ìˆëŠ” ì˜µì…˜ì€ í¬ê²Œ 3ê°€ì§€ì´ë‹¤.</p>
<h3 id="1-ionidelanguageserverprotocol"><a class="header" href="#1-ionidelanguageserverprotocol">1. Ionide.LanguageServerProtocol</a></h3>
<ul>
<li><strong>NuGet</strong>: <a href="https://www.nuget.org/packages/Ionide.LanguageServerProtocol/"><code>Ionide.LanguageServerProtocol</code></a></li>
<li><strong>ì–¸ì–´</strong>: F#</li>
<li><strong>í”„ë¡œì íŠ¸</strong>: <a href="https://ionide.io/">Ionide</a> ìƒíƒœê³„ì˜ ì¼ë¶€</li>
<li><strong>ì‹¤ì œ ì‚¬ìš© ì‚¬ë¡€</strong>: <a href="https://github.com/fsharp/FsAutoComplete">FsAutoComplete</a> (F# LSP ì„œë²„)</li>
</ul>
<h3 id="2-omnisharplanguageserverprotocol"><a class="header" href="#2-omnisharplanguageserverprotocol">2. OmniSharp.LanguageServerProtocol</a></h3>
<ul>
<li><strong>NuGet</strong>: <a href="https://www.nuget.org/packages/OmniSharp.Extensions.LanguageServer/"><code>OmniSharp.Extensions.LanguageServer</code></a></li>
<li><strong>ì–¸ì–´</strong>: C#</li>
<li><strong>í”„ë¡œì íŠ¸</strong>: <a href="https://www.omnisharp.net/">OmniSharp</a> ìƒíƒœê³„</li>
<li><strong>ì‹¤ì œ ì‚¬ìš© ì‚¬ë¡€</strong>: OmniSharp C# Language Server</li>
</ul>
<h3 id="3-ì§ì ‘-êµ¬í˜„-custom-implementation"><a class="header" href="#3-ì§ì ‘-êµ¬í˜„-custom-implementation">3. ì§ì ‘ êµ¬í˜„ (Custom Implementation)</a></h3>
<ul>
<li>JSON-RPC 2.0 ë©”ì‹œì§€ íŒŒì‹±/ì§ë ¬í™” ì§ì ‘ ì‘ì„±</li>
<li>LSP íƒ€ì… ì •ì˜ ëª¨ë‘ ì§ì ‘ ì‘ì„±</li>
<li>stdin/stdout íŒŒì´í”„ ì²˜ë¦¬ ì§ì ‘ êµ¬í˜„</li>
</ul>
<hr>
<h2 id="ionidelanguageserverprotocol-ì†Œê°œ"><a class="header" href="#ionidelanguageserverprotocol-ì†Œê°œ">Ionide.LanguageServerProtocol ì†Œê°œ</a></h2>
<p><strong>Ionide.LanguageServerProtocol</strong>ì€ F# ë„¤ì´í‹°ë¸Œ LSP ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.</p>
<h3 id="í•µì‹¬-íŠ¹ì§•"><a class="header" href="#í•µì‹¬-íŠ¹ì§•">í•µì‹¬ íŠ¹ì§•</a></h3>
<ul>
<li><strong>F#ìœ¼ë¡œ ì‘ì„±ë¨</strong>: F# íƒ€ì… ì‹œìŠ¤í…œê³¼ ìì—°ìŠ¤ëŸ½ê²Œ í†µí•©</li>
<li><strong>Ionide í”„ë¡œì íŠ¸ ì¼ë¶€</strong>: F# ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ê²€ì¦ë¨</li>
<li><strong>ê²½ëŸ‰ ì„¤ê³„</strong>: ìµœì†Œí•œì˜ ì˜ì¡´ì„± (Microsoft.Extensions.DI ë¶ˆí•„ìš”)</li>
<li><strong>LSP 3.17 ì§€ì›</strong>: ìµœì‹  LSP ìŠ¤í™ ì™„ì „ ì§€ì›</li>
<li><strong>í”„ë¡œë•ì…˜ ê²€ì¦</strong>: FsAutoCompleteê°€ ìˆ˜ë…„ê°„ ì‚¬ìš© ì¤‘</li>
</ul>
<h3 id="ë²„ì „-ì •ë³´"><a class="header" href="#ë²„ì „-ì •ë³´">ë²„ì „ ì •ë³´</a></h3>
<ul>
<li><strong>í˜„ì¬ ë²„ì „</strong>: 0.7.0 (2025ë…„ 3ì›” 12ì¼ ë¦´ë¦¬ìŠ¤)</li>
<li><strong>í˜¸í™˜ì„±</strong>: .NET 6.0+</li>
<li><strong>NuGet ë‹¤ìš´ë¡œë“œ</strong>: ~50ë§Œ íšŒ ì´ìƒ</li>
</ul>
<h3 id="ê¸°ë³¸-ì‚¬ìš©-ì˜ˆì‹œ"><a class="header" href="#ê¸°ë³¸-ì‚¬ìš©-ì˜ˆì‹œ">ê¸°ë³¸ ì‚¬ìš© ì˜ˆì‹œ</a></h3>
<pre><code class="language-fsharp">open Ionide.LanguageServerProtocol
open Ionide.LanguageServerProtocol.Server
open Ionide.LanguageServerProtocol.Types

// ì„œë²„ ì´ˆê¸°í™”
let server = Server()

// initialize í•¸ë“¤ëŸ¬ ë“±ë¡
server.On&lt;InitializeParams, InitializeResult&gt;("initialize", fun p -&gt;
    async {
        return {
            Capabilities = {
                HoverProvider = Some true
                CompletionProvider = Some { TriggerCharacters = Some [|"."|] }
                TextDocumentSync = Some (TextDocumentSyncKind.Incremental)
                // ... ê¸°íƒ€ capabilities
            }
            ServerInfo = Some {
                Name = "FunLang LSP"
                Version = Some "1.0.0"
            }
        }
    }
)

// hover í•¸ë“¤ëŸ¬ ë“±ë¡
server.On&lt;HoverParams, Hover option&gt;("textDocument/hover", fun p -&gt;
    async {
        // í˜¸ë²„ ë¡œì§ êµ¬í˜„
        return Some {
            Contents = MarkupContent {
                Kind = MarkupKind.Markdown
                Value = "**í•¨ìˆ˜**: `add`\n\níƒ€ì…: `(Int, Int) -&gt; Int`"
            }
            Range = None
        }
    }
)

// ì„œë²„ ì‹¤í–‰
server.Start()
</code></pre>
<hr>
<h2 id="omnisharp-ëŒ€ë¹„-ì¥ì "><a class="header" href="#omnisharp-ëŒ€ë¹„-ì¥ì ">OmniSharp ëŒ€ë¹„ ì¥ì </a></h2>
<p>Ionideì™€ OmniSharpë¥¼ ë¹„êµí•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<h3 id="ë¹„êµí‘œ"><a class="header" href="#ë¹„êµí‘œ">ë¹„êµí‘œ</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>ë¹„êµ í•­ëª©</th><th>Ionide.LanguageServerProtocol</th><th>OmniSharp.Extensions.LanguageServer</th></tr>
</thead>
<tbody>
<tr><td><strong>ì–¸ì–´</strong></td><td>F# (ë„¤ì´í‹°ë¸Œ)</td><td>C#</td></tr>
<tr><td><strong>DI ì˜ì¡´ì„±</strong></td><td>ì—†ìŒ (ìˆœìˆ˜ F#)</td><td>Microsoft.Extensions.DependencyInjection í•„ìˆ˜</td></tr>
<tr><td><strong>ì„¤ê³„ ì² í•™</strong></td><td>í•¨ìˆ˜í˜•, immutable types</td><td>OOP, mutable state</td></tr>
<tr><td><strong>í•™ìŠµ ê³¡ì„ </strong></td><td>ë‚®ìŒ (F# ê°œë°œìì—ê²Œ)</td><td>ë†’ìŒ (ë³µì¡í•œ DI ì„¤ì •)</td></tr>
<tr><td><strong>ì»¤ë®¤ë‹ˆí‹°</strong></td><td>F# ì¤‘ì‹¬ (Ionide, FSAC)</td><td>C# ì¤‘ì‹¬ (OmniSharp)</td></tr>
<tr><td><strong>ì˜ì¡´ì„± í¬ê¸°</strong></td><td>ì‘ìŒ (~10ê°œ íŒ¨í‚¤ì§€)</td><td>í¼ (~30ê°œ íŒ¨í‚¤ì§€)</td></tr>
<tr><td><strong>íƒ€ì… ì•ˆì „ì„±</strong></td><td>Discriminated Union í™œìš©</td><td>Class hierarchy</td></tr>
<tr><td><strong>LSP ìŠ¤í™ ì§€ì›</strong></td><td>LSP 3.17</td><td>LSP 3.17</td></tr>
<tr><td><strong>ì‹¤ì œ ì‚¬ìš© ì‚¬ë¡€</strong></td><td>FsAutoComplete</td><td>OmniSharp C# Server</td></tr>
</tbody>
</table>
</div>
<h3 id="ì™œ-ionideë¥¼-ì„ íƒí–ˆëŠ”ê°€"><a class="header" href="#ì™œ-ionideë¥¼-ì„ íƒí–ˆëŠ”ê°€">ì™œ Ionideë¥¼ ì„ íƒí–ˆëŠ”ê°€?</a></h3>
<h4 id="1-f-ë„¤ì´í‹°ë¸Œ-êµ¬í˜„"><a class="header" href="#1-f-ë„¤ì´í‹°ë¸Œ-êµ¬í˜„">1. F# ë„¤ì´í‹°ë¸Œ êµ¬í˜„</a></h4>
<p>FunLang ì»´íŒŒì¼ëŸ¬ê°€ F#ìœ¼ë¡œ ì‘ì„±ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, F# ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ìì—°ìŠ¤ëŸ½ë‹¤.</p>
<pre><code class="language-fsharp">// FunLang AST (F# record)
type Expr =
    | Lit of int
    | Add of Expr * Expr

// Ionide LSP types (F# record)
type Position = { Line: int; Character: int }
type Range = { Start: Position; End: Position }
</code></pre>
<p>ë‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª¨ë‘ F#ì˜ record, discriminated unionì„ ì‚¬ìš©í•˜ë¯€ë¡œ íƒ€ì…ì´ ì˜ ë§ëŠ”ë‹¤.</p>
<h4 id="2-dependency-injection-ë¶ˆí•„ìš”"><a class="header" href="#2-dependency-injection-ë¶ˆí•„ìš”">2. Dependency Injection ë¶ˆí•„ìš”</a></h4>
<p>OmniSharpëŠ” C# ìŠ¤íƒ€ì¼ì˜ DI ì»¨í…Œì´ë„ˆë¥¼ ê°•ì œí•œë‹¤.</p>
<p><strong>OmniSharp ìŠ¤íƒ€ì¼ (C# DI í•„ìˆ˜):</strong></p>
<pre><code class="language-csharp">// OmniSharpëŠ” ì´ëŸ° DI ì„¤ì •ì´ í•„ìš”
services.AddLanguageServer(options =&gt; {
    options
        .WithHandler&lt;TextDocumentHandler&gt;()
        .WithHandler&lt;HoverHandler&gt;()
        .OnInitialize((server, request, token) =&gt; { ... });
});
</code></pre>
<p><strong>Ionide ìŠ¤íƒ€ì¼ (ìˆœìˆ˜ F#):</strong></p>
<pre><code class="language-fsharp">// IonideëŠ” ê°„ë‹¨í•œ í•¨ìˆ˜ ë“±ë¡
server.On&lt;HoverParams, Hover option&gt;("textDocument/hover", hoverHandler)
</code></pre>
<p>F# ê°œë°œìì—ê²ŒëŠ” Ionideì˜ í•¨ìˆ˜í˜• ìŠ¤íƒ€ì¼ì´ ë” ìì—°ìŠ¤ëŸ½ë‹¤.</p>
<h4 id="3-fsautocompleteì˜-ê²€ì¦"><a class="header" href="#3-fsautocompleteì˜-ê²€ì¦">3. FsAutoCompleteì˜ ê²€ì¦</a></h4>
<p>FsAutoCompleteëŠ” F# LSP ì„œë²„ë¡œ, VS Codeì—ì„œ ìˆ˜ë°±ë§Œ ëª…ì˜ ê°œë°œìê°€ ì‚¬ìš©í•œë‹¤.</p>
<pre><code>VS Code F# Extension
    â†“
FsAutoComplete (F# LSP Server)
    â†“
Ionide.LanguageServerProtocol
</code></pre>
<p>ì´ë¯¸ í”„ë¡œë•ì…˜ì—ì„œ ìˆ˜ë…„ê°„ ê²€ì¦ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.</p>
<h4 id="4-ê²½ëŸ‰-ì„¤ê³„"><a class="header" href="#4-ê²½ëŸ‰-ì„¤ê³„">4. ê²½ëŸ‰ ì„¤ê³„</a></h4>
<p><strong>Ionide ì˜ì¡´ì„±:</strong></p>
<ul>
<li>Ionide.LanguageServerProtocol</li>
<li>Newtonsoft.Json (JSON ì§ë ¬í™”)</li>
<li>StreamJsonRpc (JSON-RPC ì²˜ë¦¬)</li>
</ul>
<p><strong>OmniSharp ì˜ì¡´ì„±:</strong></p>
<ul>
<li>OmniSharp.Extensions.LanguageServer</li>
<li>Microsoft.Extensions.DependencyInjection</li>
<li>Microsoft.Extensions.Logging</li>
<li>â€¦ (ì•½ 30ê°œ íŒ¨í‚¤ì§€)</li>
</ul>
<p>íŠœí† ë¦¬ì–¼ ëª©ì ì˜ LSP ì„œë²„ì—ëŠ” Ionideì˜ ê²½ëŸ‰ ì„¤ê³„ê°€ ì í•©í•˜ë‹¤.</p>
<hr>
<h2 id="ì§ì ‘-êµ¬í˜„ì„-í”¼í•´ì•¼-í•˜ëŠ”-ì´ìœ "><a class="header" href="#ì§ì ‘-êµ¬í˜„ì„-í”¼í•´ì•¼-í•˜ëŠ”-ì´ìœ ">ì§ì ‘ êµ¬í˜„ì„ í”¼í•´ì•¼ í•˜ëŠ” ì´ìœ </a></h2>
<p>â€œLSPëŠ” ê·¸ëƒ¥ JSONì´ë‹ˆê¹Œ ì§ì ‘ êµ¬í˜„í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ?â€ - <strong>ì´ê±´ í•¨ì •ì´ë‹¤.</strong></p>
<h3 id="lsp-ìŠ¤í™ì˜-ë³µì¡ì„±"><a class="header" href="#lsp-ìŠ¤í™ì˜-ë³µì¡ì„±">LSP ìŠ¤í™ì˜ ë³µì¡ì„±</a></h3>
<p><strong>LSP 3.17 ìŠ¤í™ í†µê³„:</strong></p>
<ul>
<li>ë¬¸ì„œ ê¸¸ì´: 285í˜ì´ì§€</li>
<li>ë©”ì„œë“œ ìˆ˜: 90ê°œ ì´ìƒ</li>
<li>íƒ€ì… ì •ì˜: 407ê°œ</li>
<li>ì—£ì§€ ì¼€ì´ìŠ¤: ìˆ˜ë°± ê°€ì§€</li>
</ul>
<h3 id="ì§ì ‘-êµ¬í˜„-ì‹œ-ë§ˆì£¼ì¹ -ë¬¸ì œë“¤"><a class="header" href="#ì§ì ‘-êµ¬í˜„-ì‹œ-ë§ˆì£¼ì¹ -ë¬¸ì œë“¤">ì§ì ‘ êµ¬í˜„ ì‹œ ë§ˆì£¼ì¹  ë¬¸ì œë“¤</a></h3>
<h4 id="1-content-length-í—¤ë”-íŒŒì‹±"><a class="header" href="#1-content-length-í—¤ë”-íŒŒì‹±">1. Content-Length í—¤ë” íŒŒì‹±</a></h4>
<p>LSP ë©”ì‹œì§€ëŠ” HTTP ìŠ¤íƒ€ì¼ í—¤ë”ë¥¼ ì‚¬ìš©í•œë‹¤.</p>
<pre><code>Content-Length: 123\r\n
Content-Type: application/vscode-jsonrpc; charset=utf-8\r\n
\r\n
{...JSON...}
</code></pre>
<ul>
<li><code>\r\n</code> (CRLF) íŒŒì‹± ë²„ê·¸ ë°œìƒ ê°€ëŠ¥</li>
<li>í—¤ë”ê°€ ì—†ê±°ë‚˜ ì˜ëª»ëœ ê²½ìš° ì²˜ë¦¬</li>
<li>UTF-8 ì¸ì½”ë”© ë¬¸ì œ</li>
</ul>
<h4 id="2-utf-16-position-ì¸ì½”ë”©"><a class="header" href="#2-utf-16-position-ì¸ì½”ë”©">2. UTF-16 Position ì¸ì½”ë”©</a></h4>
<p>LSPì˜ <code>Position</code>ì€ <strong>UTF-16 code unit</strong> ê¸°ì¤€ì´ë‹¤.</p>
<pre><code class="language-fsharp">let text = "ì•ˆë…•í•˜ì„¸ìš” ğŸ‰"
// UTF-8: ê° í•œê¸€ = 3ë°”ì´íŠ¸, ğŸ‰ = 4ë°”ì´íŠ¸
// UTF-16: ê° í•œê¸€ = 1 code unit, ğŸ‰ = 2 code units

// LSP Position.characterëŠ” UTF-16 ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°í•´ì•¼ í•¨
</code></pre>
<p>ì§ì ‘ êµ¬í˜„í•˜ë©´ ì´ëª¨ì§€, CJK ë¬¸ìì—ì„œ ìœ„ì¹˜ ê³„ì‚° ë²„ê·¸ê°€ ë°œìƒí•œë‹¤.</p>
<h4 id="3-407ê°œ-íƒ€ì…-ì •ì˜"><a class="header" href="#3-407ê°œ-íƒ€ì…-ì •ì˜">3. 407ê°œ íƒ€ì… ì •ì˜</a></h4>
<p>LSP íƒ€ì…ì„ ëª¨ë‘ ì§ì ‘ ì •ì˜í•˜ë©´:</p>
<pre><code class="language-fsharp">type Position = { Line: int; Character: int }
type Range = { Start: Position; End: Position }
type Location = { Uri: DocumentUri; Range: Range }
type TextEdit = { Range: Range; NewText: string }
type CompletionItem = { ... }  // 30ê°œ í•„ë“œ
type CompletionList = { ... }
type Hover = { ... }
// ... 400ê°œ ë”
</code></pre>
<p>ì´ë¯¸ Ionideì— ëª¨ë‘ ì •ì˜ë˜ì–´ ìˆë‹¤.</p>
<h4 id="4-json-ì§ë ¬í™”-ë²„ê·¸"><a class="header" href="#4-json-ì§ë ¬í™”-ë²„ê·¸">4. JSON ì§ë ¬í™” ë²„ê·¸</a></h4>
<p>LSPëŠ” <code>null</code>ê³¼ <code>undefined</code>ë¥¼ êµ¬ë¶„í•œë‹¤.</p>
<pre><code class="language-json">// ì´ ë‘˜ì€ ì˜ë¯¸ê°€ ë‹¤ë¦„
{"hoverProvider": null}       // hover ì§€ì› ì•ˆ í•¨
{"hoverProvider": undefined}  // í•„ë“œ ìƒëµë¨
</code></pre>
<p>ì§ì ‘ JSON ì§ë ¬í™”ë¥¼ êµ¬í˜„í•˜ë©´ ì´ëŸ° ë¯¸ë¬˜í•œ ì°¨ì´ë¥¼ ë†“ì¹œë‹¤.</p>
<h3 id="ê²°ë¡ -ë°”í€´ì˜-ì¬ë°œëª…-íšŒí”¼"><a class="header" href="#ê²°ë¡ -ë°”í€´ì˜-ì¬ë°œëª…-íšŒí”¼">ê²°ë¡ : ë°”í€´ì˜ ì¬ë°œëª… íšŒí”¼</a></h3>
<blockquote>
<p>â€œDonâ€™t reinvent the wheel. Use a proven library.â€</p>
</blockquote>
<p>LSP ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì´ë¯¸ ìˆ˜ë…„ê°„ ê²€ì¦ë˜ì—ˆë‹¤. íŠœí† ë¦¬ì–¼ì˜ ëª©ì ì€ <strong>LSP ë©”ì‹œì§€ íŒŒì‹±</strong>ì´ ì•„ë‹ˆë¼ <strong>LSP ì„œë²„ ë¡œì§ êµ¬í˜„</strong>ì´ë‹¤.</p>
<hr>
<h2 id="ê²°ë¡ -ionide-ì„ íƒ"><a class="header" href="#ê²°ë¡ -ionide-ì„ íƒ">ê²°ë¡ : Ionide ì„ íƒ</a></h2>
<p>ì´ íŠœí† ë¦¬ì–¼ ì‹œë¦¬ì¦ˆëŠ” <strong>Ionide.LanguageServerProtocol</strong>ì„ ì‚¬ìš©í•œë‹¤.</p>
<h3 id="ì„ íƒ-ì´ìœ -ìš”ì•½"><a class="header" href="#ì„ íƒ-ì´ìœ -ìš”ì•½">ì„ íƒ ì´ìœ  ìš”ì•½</a></h3>
<ol>
<li><strong>F# ë„¤ì´í‹°ë¸Œ</strong>: FunLangì´ F#ì´ë¯€ë¡œ íƒ€ì… ì‹œìŠ¤í…œ ìì—°ìŠ¤ëŸ½ê²Œ í†µí•©</li>
<li><strong>ê²€ì¦ëœ ì‹ ë¢°ì„±</strong>: FsAutoCompleteê°€ í”„ë¡œë•ì…˜ì—ì„œ ê²€ì¦</li>
<li><strong>ê²½ëŸ‰ ì„¤ê³„</strong>: ìµœì†Œí•œì˜ ì˜ì¡´ì„±, DI ë¶ˆí•„ìš”</li>
<li><strong>í•™ìŠµ ê³¡ì„ </strong>: F# ê°œë°œìì—ê²Œ ì¹œìˆ™í•œ í•¨ìˆ˜í˜• API</li>
<li><strong>ìµœì‹  ìŠ¤í™ ì§€ì›</strong>: LSP 3.17 ì™„ì „ ì§€ì›</li>
</ol>
<h3 id="ì„¤ì¹˜-ë°©ë²•"><a class="header" href="#ì„¤ì¹˜-ë°©ë²•">ì„¤ì¹˜ ë°©ë²•</a></h3>
<pre><code class="language-bash">dotnet add package Ionide.LanguageServerProtocol --version 0.7.0
</code></pre>
<h3 id="ë‹¤ìŒ-ë‹¨ê³„-1"><a class="header" href="#ë‹¤ìŒ-ë‹¨ê³„-1">ë‹¤ìŒ ë‹¨ê³„</a></h3>
<p>ë‹¤ìŒ ë¬¸ì„œì—ì„œëŠ” Ionide.LanguageServerProtocolì„ ì‚¬ìš©í•´ ìµœì†Œí•œì˜ LSP ì„œë²„ë¥¼ êµ¬í˜„í•œë‹¤.</p>
<hr>
<h2 id="ì°¸ê³ -ìë£Œ-1"><a class="header" href="#ì°¸ê³ -ìë£Œ-1">ì°¸ê³  ìë£Œ</a></h2>
<ul>
<li><a href="https://www.nuget.org/packages/Ionide.LanguageServerProtocol/">Ionide.LanguageServerProtocol NuGet</a></li>
<li><a href="https://ionide.io/">Ionide ê³µì‹ ì‚¬ì´íŠ¸</a></li>
<li><a href="https://github.com/fsharp/FsAutoComplete">FsAutoComplete GitHub</a></li>
<li><a href="https://github.com/OmniSharp/csharp-language-server-protocol">OmniSharp Extensions</a></li>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/">LSP ìŠ¤í™ ë¬¸ì„œ</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="f-í”„ë¡œì íŠ¸-ì„¤ì •"><a class="header" href="#f-í”„ë¡œì íŠ¸-ì„¤ì •">F# í”„ë¡œì íŠ¸ ì„¤ì •</a></h1>
<p>ì´ ë¬¸ì„œëŠ” F# LSP ì„œë²„ í”„ë¡œì íŠ¸ë¥¼ ì²˜ìŒë¶€í„° ë§Œë“œëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•œë‹¤. ì´ íŠœí† ë¦¬ì–¼ì„ ë”°ë¼í•˜ë©´ FunLang LSP ì„œë²„ì˜ ì „ì²´ í”„ë¡œì íŠ¸ êµ¬ì¡°ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.</p>
<h3 id="lsp-initialize-í•¸ë“œì…°ì´í¬"><a class="header" href="#lsp-initialize-í•¸ë“œì…°ì´í¬">LSP Initialize í•¸ë“œì…°ì´í¬</a></h3>
<pre class="mermaid">sequenceDiagram
    participant C as Client (VS Code)
    participant S as Server (LangLSP)
    C-&gt;&gt;S: initialize(processId, capabilities, rootUri)
    S-&gt;&gt;C: InitializeResult(serverCapabilities)
    C-&gt;&gt;S: initialized()
    Note over C,S: ì„œë²„ ì¤€ë¹„ ì™„ë£Œ, ë¬¸ì„œ ì´ë²¤íŠ¸ ìˆ˜ì‹  ëŒ€ê¸°
</pre>

<h2 id="ëª©ì°¨-2"><a class="header" href="#ëª©ì°¨-2">ëª©ì°¨</a></h2>
<ol>
<li><a href="#ì‚¬ì „-ìš”êµ¬ì‚¬í•­">ì‚¬ì „ ìš”êµ¬ì‚¬í•­</a></li>
<li><a href="#í”„ë¡œì íŠ¸-êµ¬ì¡°-ê°œìš”">í”„ë¡œì íŠ¸ êµ¬ì¡° ê°œìš”</a></li>
<li><a href="#f-í”„ë¡œì íŠ¸-ìƒì„±">F# í”„ë¡œì íŠ¸ ìƒì„±</a></li>
<li><a href="#nuget-íŒ¨í‚¤ì§€-ì„¤ì¹˜">NuGet íŒ¨í‚¤ì§€ ì„¤ì¹˜</a></li>
<li><a href="#funlang-ì„œë¸Œëª¨ë“ˆ-ì—°ê²°">FunLang ì„œë¸Œëª¨ë“ˆ ì—°ê²°</a></li>
<li><a href="#í”„ë¡œì íŠ¸-íŒŒì¼-êµ¬ì„±">í”„ë¡œì íŠ¸ íŒŒì¼ êµ¬ì„±</a></li>
<li><a href="#í…ŒìŠ¤íŠ¸-í”„ë¡œì íŠ¸-ì„¤ì •">í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ ì„¤ì •</a></li>
<li><a href="#ë¹Œë“œ-ë°-ì‹¤í–‰-í™•ì¸">ë¹Œë“œ ë° ì‹¤í–‰ í™•ì¸</a></li>
</ol>
<hr>
<h2 id="ì‚¬ì „-ìš”êµ¬ì‚¬í•­"><a class="header" href="#ì‚¬ì „-ìš”êµ¬ì‚¬í•­">ì‚¬ì „ ìš”êµ¬ì‚¬í•­</a></h2>
<p>í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ê¸° ì „ì— ë‹¤ìŒ ë„êµ¬ë“¤ì´ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.</p>
<h3 id="1-net-10-sdk"><a class="header" href="#1-net-10-sdk">1. .NET 10 SDK</a></h3>
<pre><code class="language-bash"># .NET ë²„ì „ í™•ì¸
dotnet --version
# ì¶œë ¥: 10.0.x ì´ìƒ
</code></pre>
<p><strong>ì„¤ì¹˜ ë°©ë²•</strong>: <a href="https://dotnet.microsoft.com/download">.NET ê³µì‹ ì‚¬ì´íŠ¸</a>ì—ì„œ .NET 10 SDK ë‹¤ìš´ë¡œë“œ</p>
<h3 id="2-vs-code"><a class="header" href="#2-vs-code">2. VS Code</a></h3>
<p><strong>ì¶”ì²œ í™•ì¥ í”„ë¡œê·¸ë¨:</strong></p>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=Ionide.Ionide-fsharp">Ionide for F#</a> - F# ê°œë°œ ë„êµ¬</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=Ionide.Ionide-fsharp">F# (FsAutoComplete)</a> - F# LSP í´ë¼ì´ì–¸íŠ¸</li>
</ul>
<h3 id="3-git"><a class="header" href="#3-git">3. Git</a></h3>
<p>ì„œë¸Œëª¨ë“ˆ ê´€ë¦¬ë¥¼ ìœ„í•´ Gitì´ í•„ìš”í•˜ë‹¤.</p>
<pre><code class="language-bash"># Git ë²„ì „ í™•ì¸
git --version
</code></pre>
<hr>
<h2 id="í”„ë¡œì íŠ¸-êµ¬ì¡°-ê°œìš”"><a class="header" href="#í”„ë¡œì íŠ¸-êµ¬ì¡°-ê°œìš”">í”„ë¡œì íŠ¸ êµ¬ì¡° ê°œìš”</a></h2>
<p>ìš°ë¦¬ê°€ ë§Œë“¤ í”„ë¡œì íŠ¸ì˜ ì „ì²´ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<pre><code>LangLSP/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ LangLSP.Server/      # F# LSP ì„œë²„ í”„ë¡œì íŠ¸
â”‚   â”‚   â”œâ”€â”€ Protocol.fs      # LSP íƒ€ì… ë³€í™˜ (Span â†” Range)
â”‚   â”‚   â”œâ”€â”€ Server.fs        # ì„œë²„ capabilities ì„ ì–¸
â”‚   â”‚   â”œâ”€â”€ Program.fs       # ì§„ì…ì  (stdin/stdout ì„¤ì •)
â”‚   â”‚   â””â”€â”€ LangLSP.Server.fsproj
â”‚   â””â”€â”€ LangLSP.Tests/       # í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ (Phase 2ì—ì„œ ì¶”ê°€)
â”œâ”€â”€ client/                   # VS Code í™•ì¥ í”„ë¡œì íŠ¸ (Phase 3ì—ì„œ ì¶”ê°€)
â”œâ”€â”€ LangTutorial/            # FunLang ì„œë¸Œëª¨ë“ˆ (ì»´íŒŒì¼ëŸ¬ ì¬ì‚¬ìš©)
â”‚   â””â”€â”€ FunLang/
â”‚       â”œâ”€â”€ Ast.fs           # Span íƒ€ì… (ì†ŒìŠ¤ ìœ„ì¹˜)
â”‚       â”œâ”€â”€ Diagnostic.fs    # ì—ëŸ¬ ë©”ì‹œì§€ íƒ€ì…
â”‚       â”œâ”€â”€ Lexer.fs         # ì–´íœ˜ ë¶„ì„
â”‚       â”œâ”€â”€ Parser.fs        # êµ¬ë¬¸ ë¶„ì„
â”‚       â””â”€â”€ TypeChecker.fs   # íƒ€ì… ì²´ì»¤
â”œâ”€â”€ documentation/tutorial/           # ì´ íŠœí† ë¦¬ì–¼ ë¬¸ì„œë“¤
â””â”€â”€ LangLSP.sln              # ì†”ë£¨ì…˜ íŒŒì¼
</code></pre>
<hr>
<h2 id="f-í”„ë¡œì íŠ¸-ìƒì„±"><a class="header" href="#f-í”„ë¡œì íŠ¸-ìƒì„±">F# í”„ë¡œì íŠ¸ ìƒì„±</a></h2>
<h3 id="1-ì†”ë£¨ì…˜-ìƒì„±"><a class="header" href="#1-ì†”ë£¨ì…˜-ìƒì„±">1. ì†”ë£¨ì…˜ ìƒì„±</a></h3>
<p>ë¨¼ì € í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“¤ê³  ì†”ë£¨ì…˜ì„ ìƒì„±í•œë‹¤.</p>
<pre><code class="language-bash"># í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ìƒì„±
mkdir LangLSP
cd LangLSP

# ì†”ë£¨ì…˜ íŒŒì¼ ìƒì„±
dotnet new sln -n LangLSP
</code></pre>
<p>ìƒì„±ëœ <code>LangLSP.sln</code> íŒŒì¼ì€ ì—¬ëŸ¬ F# í”„ë¡œì íŠ¸ë¥¼ í•˜ë‚˜ë¡œ ë¬¶ì–´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.</p>
<h3 id="2-ì„œë²„-í”„ë¡œì íŠ¸-ìƒì„±"><a class="header" href="#2-ì„œë²„-í”„ë¡œì íŠ¸-ìƒì„±">2. ì„œë²„ í”„ë¡œì íŠ¸ ìƒì„±</a></h3>
<p>LSP ì„œë²„ë¥¼ ë‹´ì„ F# ì½˜ì†” í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•œë‹¤.</p>
<pre><code class="language-bash"># ë””ë ‰í† ë¦¬ ìƒì„±
mkdir -p src/LangLSP.Server
cd src/LangLSP.Server

# F# ì½˜ì†” í”„ë¡œì íŠ¸ ìƒì„±
dotnet new console -lang F# -n LangLSP.Server

# ë£¨íŠ¸ë¡œ ëŒì•„ê°€ê¸°
cd ../..
</code></pre>
<p><strong>ì™œ ì½˜ì†” í”„ë¡œì íŠ¸ì¸ê°€?</strong></p>
<ul>
<li>LSP ì„œë²„ëŠ” stdin/stdoutì„ í†µí•´ ì—ë””í„°ì™€ í†µì‹ í•œë‹¤</li>
<li>ë³„ë„ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰ë˜ë©°, CLI ë„êµ¬ì²˜ëŸ¼ ë™ì‘í•œë‹¤</li>
</ul>
<h3 id="3-ì†”ë£¨ì…˜ì—-í”„ë¡œì íŠ¸-ì¶”ê°€"><a class="header" href="#3-ì†”ë£¨ì…˜ì—-í”„ë¡œì íŠ¸-ì¶”ê°€">3. ì†”ë£¨ì…˜ì— í”„ë¡œì íŠ¸ ì¶”ê°€</a></h3>
<pre><code class="language-bash"># ì„œë²„ í”„ë¡œì íŠ¸ë¥¼ ì†”ë£¨ì…˜ì— ì¶”ê°€
dotnet sln add src/LangLSP.Server/LangLSP.Server.fsproj
</code></pre>
<p>ì†”ë£¨ì…˜ì— ì¶”ê°€í•˜ë©´ VS Codeì—ì„œ ì „ì²´ í”„ë¡œì íŠ¸ë¥¼ í•œ ë²ˆì— ë¹Œë“œí•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.</p>
<hr>
<h2 id="nuget-íŒ¨í‚¤ì§€-ì„¤ì¹˜"><a class="header" href="#nuget-íŒ¨í‚¤ì§€-ì„¤ì¹˜">NuGet íŒ¨í‚¤ì§€ ì„¤ì¹˜</a></h2>
<p>LSP ì„œë²„ì— í•„ìš”í•œ NuGet íŒ¨í‚¤ì§€ë“¤ì„ ì„¤ì¹˜í•œë‹¤.</p>
<pre><code class="language-bash">cd src/LangLSP.Server

# Ionide.LanguageServerProtocol: LSP í”„ë¡œí† ì½œ êµ¬í˜„
dotnet add package Ionide.LanguageServerProtocol --version 0.7.0

# Serilog: êµ¬ì¡°í™”ëœ ë¡œê¹…
dotnet add package Serilog --version 4.2.0

# Serilog.Sinks.File: íŒŒì¼ ë¡œê¹…
dotnet add package Serilog.Sinks.File --version 6.0.0

cd ../..
</code></pre>
<h3 id="íŒ¨í‚¤ì§€-ì—­í• -ì„¤ëª…"><a class="header" href="#íŒ¨í‚¤ì§€-ì—­í• -ì„¤ëª…">íŒ¨í‚¤ì§€ ì—­í•  ì„¤ëª…</a></h3>
<h4 id="ionidelanguageserverprotocol-070"><a class="header" href="#ionidelanguageserverprotocol-070">Ionide.LanguageServerProtocol (0.7.0)</a></h4>
<ul>
<li><strong>ì—­í• </strong>: LSP í”„ë¡œí† ì½œ êµ¬í˜„ (JSON-RPC, LSP íƒ€ì…)</li>
<li><strong>ì¥ì </strong>: F# ë„¤ì´í‹°ë¸Œ, FsAutoCompleteì—ì„œ ê²€ì¦ë¨</li>
<li><strong>ì œê³µ ê¸°ëŠ¥</strong>:
<ul>
<li><code>Ionide.LanguageServerProtocol.Types</code> - LSP íƒ€ì… (Range, Position, Diagnostic ë“±)</li>
<li><code>Ionide.LanguageServerProtocol.Server</code> - ì„œë²„ êµ¬í˜„ í—¬í¼</li>
</ul>
</li>
</ul>
<h4 id="serilog-420--sinksfile-600"><a class="header" href="#serilog-420--sinksfile-600">Serilog (4.2.0 + Sinks.File 6.0.0)</a></h4>
<ul>
<li><strong>ì—­í• </strong>: ë””ë²„ê¹…ìš© êµ¬ì¡°í™”ëœ ë¡œê¹…</li>
<li><strong>ì™œ íŒŒì¼ ë¡œê¹…ì¸ê°€?</strong>: LSP ì„œë²„ëŠ” stdoutì„ í”„ë¡œí† ì½œ í†µì‹ ì— ì‚¬ìš©í•˜ë¯€ë¡œ, ì½˜ì†”ì— ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ë©´ í”„ë¡œí† ì½œì´ ê¹¨ì§„ë‹¤</li>
<li><strong>ë¡œê·¸ ìœ„ì¹˜</strong>: <code>/tmp/funlang-lsp.log</code> (Linux/macOS) ë˜ëŠ” <code>%TEMP%</code> (Windows)</li>
</ul>
<hr>
<h2 id="funlang-ì„œë¸Œëª¨ë“ˆ-ì—°ê²°"><a class="header" href="#funlang-ì„œë¸Œëª¨ë“ˆ-ì—°ê²°">FunLang ì„œë¸Œëª¨ë“ˆ ì—°ê²°</a></h2>
<p>FunLang ì»´íŒŒì¼ëŸ¬ ì½”ë“œë¥¼ ì¬ì‚¬ìš©í•˜ê¸° ìœ„í•´ Git ì„œë¸Œëª¨ë“ˆë¡œ ì¶”ê°€í•œë‹¤.</p>
<h3 id="1-ì„œë¸Œëª¨ë“ˆ-ì¶”ê°€"><a class="header" href="#1-ì„œë¸Œëª¨ë“ˆ-ì¶”ê°€">1. ì„œë¸Œëª¨ë“ˆ ì¶”ê°€</a></h3>
<pre><code class="language-bash"># ì„œë¸Œëª¨ë“ˆë¡œ FunLang í”„ë¡œì íŠ¸ ì¶”ê°€
git submodule add https://github.com/kodu-ai/LangTutorial.git

# ì„œë¸Œëª¨ë“ˆ ì´ˆê¸°í™” ë° ì—…ë°ì´íŠ¸
git submodule update --init --recursive
</code></pre>
<h3 id="2-funlang-í”„ë¡œì íŠ¸-ì°¸ì¡°-ì¶”ê°€"><a class="header" href="#2-funlang-í”„ë¡œì íŠ¸-ì°¸ì¡°-ì¶”ê°€">2. FunLang í”„ë¡œì íŠ¸ ì°¸ì¡° ì¶”ê°€</a></h3>
<pre><code class="language-bash"># LangLSP.Serverì—ì„œ FunLang í”„ë¡œì íŠ¸ ì°¸ì¡°
dotnet add src/LangLSP.Server/LangLSP.Server.fsproj reference LangTutorial/FunLang/FunLang.fsproj

# ì†”ë£¨ì…˜ì— FunLang í”„ë¡œì íŠ¸ë„ ì¶”ê°€
dotnet sln add LangTutorial/FunLang/FunLang.fsproj
</code></pre>
<h3 id="ì™œ-ì„œë¸Œëª¨ë“ˆì¸ê°€"><a class="header" href="#ì™œ-ì„œë¸Œëª¨ë“ˆì¸ê°€">ì™œ ì„œë¸Œëª¨ë“ˆì¸ê°€?</a></h3>
<p>FunLang ì»´íŒŒì¼ëŸ¬ëŠ” ì´ë¯¸ ë‹¤ìŒ ê¸°ëŠ¥ë“¤ì„ êµ¬í˜„í•˜ê³  ìˆë‹¤.</p>
<p><strong>ì¬ì‚¬ìš©í•  ëª¨ë“ˆ:</strong></p>
<ul>
<li><code>Ast.fs</code> - <strong>Span íƒ€ì…</strong>: ì†ŒìŠ¤ ì½”ë“œ ìœ„ì¹˜ (Line, Column)</li>
<li><code>Diagnostic.fs</code> - <strong>ì§„ë‹¨ íƒ€ì…</strong>: ì—ëŸ¬ ë©”ì‹œì§€ êµ¬ì¡°</li>
<li><code>Lexer.fs</code>, <code>Parser.fs</code> - êµ¬ë¬¸ ë¶„ì„</li>
<li><code>TypeChecker.fs</code> - íƒ€ì… ì²´í‚¹ (LSP ì§„ë‹¨ì— ì‚¬ìš©)</li>
</ul>
<p><strong>Span íƒ€ì… ì˜ˆì‹œ:</strong></p>
<pre><code class="language-fsharp">// Ast.fsì—ì„œ ì •ì˜ë¨
type Span = {
    FileName: string
    StartLine: int    // 1-based (ì‚¬ëŒì´ ì½ëŠ” ë°©ì‹)
    StartColumn: int  // 1-based
    EndLine: int
    EndColumn: int
}
</code></pre>
<p>LSPëŠ” 0-based Positionì„ ì‚¬ìš©í•˜ë¯€ë¡œ, Protocol.fsì—ì„œ ë³€í™˜ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•œë‹¤.</p>
<pre><code class="language-fsharp">// Protocol.fs
let spanToLspRange (span: Span) : Range =
    {
        Start = { Line = uint32 (span.StartLine - 1); Character = uint32 (span.StartColumn - 1) }
        End = { Line = uint32 (span.EndLine - 1); Character = uint32 (span.EndColumn - 1) }
    }
</code></pre>
<hr>
<h2 id="í”„ë¡œì íŠ¸-íŒŒì¼-êµ¬ì„±"><a class="header" href="#í”„ë¡œì íŠ¸-íŒŒì¼-êµ¬ì„±">í”„ë¡œì íŠ¸ íŒŒì¼ êµ¬ì„±</a></h2>
<p>F#ì€ <strong>íŒŒì¼ ìˆœì„œì— ì˜ì¡´í•˜ëŠ” ì–¸ì–´</strong>ì´ë‹¤. F#ì—ëŠ” ìˆœë°©í–¥ ì°¸ì¡°ê°€ ì—†ìœ¼ë¯€ë¡œ, íŒŒì¼ì´ <code>.fsproj</code>ì— ë‚˜ì—´ëœ ìˆœì„œëŒ€ë¡œ ì»´íŒŒì¼ëœë‹¤.</p>
<h3 id="f-ì»´íŒŒì¼-ìˆœì„œì˜-ì¤‘ìš”ì„±"><a class="header" href="#f-ì»´íŒŒì¼-ìˆœì„œì˜-ì¤‘ìš”ì„±">F# ì»´íŒŒì¼ ìˆœì„œì˜ ì¤‘ìš”ì„±</a></h3>
<pre><code class="language-fsharp">// Protocol.fs (ë¨¼ì € ì»´íŒŒì¼)
module Protocol
let spanToLspRange (span: Span) : Range = ...

// Server.fs (ë‚˜ì¤‘ì— ì»´íŒŒì¼)
module Server
open Protocol  // Protocol ëª¨ë“ˆì„ ì‚¬ìš© ê°€ëŠ¥
let serverCapabilities = ...
</code></pre>
<p>ë§Œì•½ <code>Server.fs</code>ë¥¼ <code>Protocol.fs</code>ë³´ë‹¤ ë¨¼ì € ë‚˜ì—´í•˜ë©´, ì»´íŒŒì¼ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.</p>
<h3 id="langlspserverfsproj-êµ¬ì¡°"><a class="header" href="#langlspserverfsproj-êµ¬ì¡°">LangLSP.Server.fsproj êµ¬ì¡°</a></h3>
<p>í”„ë¡œì íŠ¸ íŒŒì¼ì˜ ì „ì²´ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<pre><code class="language-xml">&lt;Project Sdk="Microsoft.NET.Sdk"&gt;

  &lt;PropertyGroup&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;TargetFramework&gt;net10.0&lt;/TargetFramework&gt;
  &lt;/PropertyGroup&gt;

  &lt;ItemGroup&gt;
    &lt;!-- F# íŒŒì¼ ì»´íŒŒì¼ ìˆœì„œ (ì¤‘ìš”!) --&gt;
    &lt;Compile Include="Protocol.fs" /&gt;
    &lt;Compile Include="Server.fs" /&gt;
    &lt;Compile Include="Program.fs" /&gt;
  &lt;/ItemGroup&gt;

  &lt;ItemGroup&gt;
    &lt;PackageReference Include="Ionide.LanguageServerProtocol" Version="0.7.0" /&gt;
    &lt;PackageReference Include="Serilog" Version="4.2.0" /&gt;
    &lt;PackageReference Include="Serilog.Sinks.File" Version="6.0.0" /&gt;
  &lt;/ItemGroup&gt;

  &lt;ItemGroup&gt;
    &lt;ProjectReference Include="../../LangTutorial/FunLang/FunLang.fsproj" /&gt;
  &lt;/ItemGroup&gt;

&lt;/Project&gt;
</code></pre>
<h3 id="íŒŒì¼ë³„-ì—­í• "><a class="header" href="#íŒŒì¼ë³„-ì—­í• ">íŒŒì¼ë³„ ì—­í• </a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>íŒŒì¼</th><th>ì—­í• </th><th>ì˜ì¡´ì„±</th></tr>
</thead>
<tbody>
<tr><td><code>Protocol.fs</code></td><td>Span â†” LSP Range ë³€í™˜ í•¨ìˆ˜</td><td>FunLang.Ast, Ionide.Types</td></tr>
<tr><td><code>Server.fs</code></td><td>ServerCapabilities ì„ ì–¸</td><td>Ionide.Types</td></tr>
<tr><td><code>Program.fs</code></td><td>ì§„ì…ì , stdin/stdout ì„¤ì •</td><td>Protocol, Server, Serilog</td></tr>
</tbody>
</table>
</div>
<p><strong>ì»´íŒŒì¼ ìˆœì„œ ê·œì¹™:</strong></p>
<ul>
<li><code>Program.fs</code>ëŠ” í•­ìƒ <strong>ë§ˆì§€ë§‰</strong>ì— ìœ„ì¹˜ (ì§„ì…ì )</li>
<li><code>Protocol.fs</code>ëŠ” ë‹¤ë¥¸ ëª¨ë“ˆë³´ë‹¤ <strong>ë¨¼ì €</strong> (ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜)</li>
</ul>
<hr>
<h2 id="í…ŒìŠ¤íŠ¸-í”„ë¡œì íŠ¸-ì„¤ì •"><a class="header" href="#í…ŒìŠ¤íŠ¸-í”„ë¡œì íŠ¸-ì„¤ì •">í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ ì„¤ì •</a></h2>
<p>LSP ì„œë²„ì˜ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ë¥¼ ì¶”ê°€í•œë‹¤. (Phase 2ì—ì„œ ë³¸ê²©ì ìœ¼ë¡œ ì‚¬ìš©)</p>
<pre><code class="language-bash"># í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ìƒì„±
mkdir -p src/LangLSP.Tests
cd src/LangLSP.Tests

# F# ì½˜ì†” í”„ë¡œì íŠ¸ ìƒì„±
dotnet new console -lang F# -n LangLSP.Tests

# Expecto í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ ì„¤ì¹˜
dotnet add package Expecto --version 10.2.3
dotnet add package Expecto.FsCheck --version 10.2.3

# LangLSP.Server í”„ë¡œì íŠ¸ ì°¸ì¡°
dotnet add reference ../LangLSP.Server/LangLSP.Server.fsproj

# ë£¨íŠ¸ë¡œ ëŒì•„ê°€ê¸°
cd ../..

# ì†”ë£¨ì…˜ì— ì¶”ê°€
dotnet sln add src/LangLSP.Tests/LangLSP.Tests.fsproj
</code></pre>
<h3 id="ì™œ-expectoì¸ê°€"><a class="header" href="#ì™œ-expectoì¸ê°€">ì™œ Expectoì¸ê°€?</a></h3>
<ul>
<li><strong>F# ë„¤ì´í‹°ë¸Œ</strong>: F#ìœ¼ë¡œ ì‘ì„±ëœ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬</li>
<li><strong>í‘œí˜„ë ¥ ë†’ì€ DSL</strong>: <code>testCase</code>, <code>testList</code>, <code>testProperty</code> ë“±</li>
<li><strong>FsCheck í†µí•©</strong>: Property-based testing ì§€ì›</li>
<li><strong>FsAutoComplete ê²€ì¦</strong>: FsAutoComplete í”„ë¡œì íŠ¸ì—ì„œë„ ì‚¬ìš© ì¤‘</li>
</ul>
<h3 id="í…ŒìŠ¤íŠ¸-ì˜ˆì‹œ-phase-2ì—ì„œ-ì‘ì„±-ì˜ˆì •"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì˜ˆì‹œ-phase-2ì—ì„œ-ì‘ì„±-ì˜ˆì •">í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ (Phase 2ì—ì„œ ì‘ì„± ì˜ˆì •)</a></h3>
<pre><code class="language-fsharp">// LangLSP.Tests/ProtocolTests.fs
module ProtocolTests

open Expecto
open LangLSP.Server.Protocol
open Ast

[&lt;Tests&gt;]
let tests = testList "Protocol" [
    testCase "spanToLspRange converts 1-based to 0-based" &lt;| fun _ -&gt;
        let span = { FileName = "test.fun"; StartLine = 1; StartColumn = 1; EndLine = 1; EndColumn = 5 }
        let range = spanToLspRange span
        Expect.equal range.Start.Line 0u "Line should be 0-based"
        Expect.equal range.Start.Character 0u "Character should be 0-based"
]
</code></pre>
<hr>
<h2 id="ë¹Œë“œ-ë°-ì‹¤í–‰-í™•ì¸"><a class="header" href="#ë¹Œë“œ-ë°-ì‹¤í–‰-í™•ì¸">ë¹Œë“œ ë° ì‹¤í–‰ í™•ì¸</a></h2>
<p>ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìœ¼ë©´, í”„ë¡œì íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ë¹Œë“œë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.</p>
<h3 id="1-ì „ì²´-ì†”ë£¨ì…˜-ë¹Œë“œ"><a class="header" href="#1-ì „ì²´-ì†”ë£¨ì…˜-ë¹Œë“œ">1. ì „ì²´ ì†”ë£¨ì…˜ ë¹Œë“œ</a></h3>
<pre><code class="language-bash"># ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰
dotnet build

# ì¶œë ¥ ì˜ˆì‹œ:
#   Building...
#   FunLang -&gt; /path/to/LangTutorial/FunLang/bin/Debug/net10.0/FunLang.dll
#   LangLSP.Server -&gt; /path/to/src/LangLSP.Server/bin/Debug/net10.0/LangLSP.Server.dll
#   Build succeeded.
</code></pre>
<h3 id="2-ì„œë²„-ì‹¤í–‰-í…ŒìŠ¤íŠ¸"><a class="header" href="#2-ì„œë²„-ì‹¤í–‰-í…ŒìŠ¤íŠ¸">2. ì„œë²„ ì‹¤í–‰ (í…ŒìŠ¤íŠ¸)</a></h3>
<pre><code class="language-bash">dotnet run --project src/LangLSP.Server
</code></pre>
<p>ì„œë²„ê°€ ì‹œì‘ë˜ë©´ stdin ëŒ€ê¸° ìƒíƒœê°€ ëœë‹¤.</p>
<p><strong>ì˜ˆìƒ ë™ì‘:</strong></p>
<ul>
<li>ì½˜ì†”ì—ëŠ” ì•„ë¬´ê²ƒë„ ì¶œë ¥ë˜ì§€ ì•ŠìŒ (stdoutì€ LSP í”„ë¡œí† ì½œìš©)</li>
<li><code>/tmp/funlang-lsp.log</code> íŒŒì¼ì— ë¡œê·¸ê°€ ê¸°ë¡ë¨</li>
</ul>
<p><strong>ë¡œê·¸ í™•ì¸:</strong></p>
<pre><code class="language-bash"># ë¡œê·¸ íŒŒì¼ í™•ì¸ (Linux/macOS)
tail -f /tmp/funlang-lsp.log

# ì¶œë ¥ ì˜ˆì‹œ:
# 2025-02-04 15:20:01.123 +00:00 [INF] FunLang LSP Server starting...
# 2025-02-04 15:20:01.456 +00:00 [INF] Setting up LSP server on stdin/stdout
# 2025-02-04 15:20:01.789 +00:00 [INF] Server capabilities configured: ...
</code></pre>
<p><strong>ì¢…ë£Œ:</strong></p>
<ul>
<li><code>Ctrl+C</code>ë¡œ ì„œë²„ ì¢…ë£Œ</li>
<li>ë˜ëŠ” stdinì„ ë‹«ìœ¼ë©´ ì„œë²„ê°€ ìë™ ì¢…ë£Œ</li>
</ul>
<h3 id="3-ì´ˆê¸°-íŒŒì¼-êµ¬ì¡°-í™•ì¸"><a class="header" href="#3-ì´ˆê¸°-íŒŒì¼-êµ¬ì¡°-í™•ì¸">3. ì´ˆê¸° íŒŒì¼ êµ¬ì¡° í™•ì¸</a></h3>
<p>í”„ë¡œì íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.</p>
<pre><code class="language-bash"># í”„ë¡œì íŠ¸ êµ¬ì¡° í™•ì¸
tree -L 3 src/

# ì¶œë ¥:
# src/
# â”œâ”€â”€ LangLSP.Server
# â”‚   â”œâ”€â”€ bin
# â”‚   â”œâ”€â”€ obj
# â”‚   â”œâ”€â”€ LangLSP.Server.fsproj
# â”‚   â”œâ”€â”€ Program.fs
# â”‚   â”œâ”€â”€ Protocol.fs
# â”‚   â””â”€â”€ Server.fs
# â””â”€â”€ LangLSP.Tests
#     â”œâ”€â”€ bin
#     â”œâ”€â”€ obj
#     â”œâ”€â”€ LangLSP.Tests.fsproj
#     â””â”€â”€ Program.fs
</code></pre>
<hr>
<h2 id="ë‹¤ìŒ-ë‹¨ê³„-2"><a class="header" href="#ë‹¤ìŒ-ë‹¨ê³„-2">ë‹¤ìŒ ë‹¨ê³„</a></h2>
<p>í”„ë¡œì íŠ¸ ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆë‹¤! ì´ì œ ë‹¤ìŒ ì‘ì—…ë“¤ì„ ì§„í–‰í•  ìˆ˜ ìˆë‹¤.</p>
<p><strong>Phase 1 - ë‹¤ìŒ íŠœí† ë¦¬ì–¼:</strong></p>
<ol>
<li><strong>04-document-sync.md</strong>: ë¬¸ì„œ ë™ê¸°í™” êµ¬í˜„ (didOpen, didChange)</li>
<li><strong>05-diagnostics.md</strong>: ì‹¤ì‹œê°„ ì§„ë‹¨ ë°œí–‰ (TypeChecker í†µí•©)</li>
</ol>
<p><strong>Phase 2 - LSP ê¸°ëŠ¥ í™•ì¥:</strong></p>
<ul>
<li>Hover (íƒ€ì… ì •ë³´ í‘œì‹œ)</li>
<li>Completion (ìë™ ì™„ì„±)</li>
<li>Go to Definition</li>
<li>Find References</li>
</ul>
<p><strong>Phase 3 - VS Code í™•ì¥:</strong></p>
<ul>
<li><code>client/</code> ë””ë ‰í† ë¦¬ì— VS Code í™•ì¥ í”„ë¡œì íŠ¸ ìƒì„±</li>
<li>LSP ì„œë²„ì™€ ì—°ë™</li>
</ul>
<hr>
<h2 id="ì´ˆê¸°-íŒŒì¼-ë‚´ìš©-ì°¸ê³ "><a class="header" href="#ì´ˆê¸°-íŒŒì¼-ë‚´ìš©-ì°¸ê³ ">ì´ˆê¸° íŒŒì¼ ë‚´ìš© ì°¸ê³ </a></h2>
<p>í”„ë¡œì íŠ¸ ìƒì„± í›„ ê° íŒŒì¼ì˜ ì´ˆê¸° ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<h3 id="protocolfs"><a class="header" href="#protocolfs">Protocol.fs</a></h3>
<pre><code class="language-fsharp">module LangLSP.Server.Protocol

open Ionide.LanguageServerProtocol.Types
open Ast  // FunLang's Span type

/// Convert FunLang Span (1-based) to LSP Range (0-based)
let spanToLspRange (span: Span) : Range =
    {
        Start = { Line = uint32 (span.StartLine - 1); Character = uint32 (span.StartColumn - 1) }
        End = { Line = uint32 (span.EndLine - 1); Character = uint32 (span.EndColumn - 1) }
    }

/// Convert FunLang Diagnostic to LSP Diagnostic
let diagnosticToLsp (diag: Diagnostic.Diagnostic) : Diagnostic =
    {
        Range = spanToLspRange diag.PrimarySpan
        Severity = Some DiagnosticSeverity.Error
        Code = None
        Source = Some "funlang"
        Message = diag.Message
        // ... (ë‚˜ë¨¸ì§€ í•„ë“œ)
    }
</code></pre>
<h3 id="serverfs"><a class="header" href="#serverfs">Server.fs</a></h3>
<pre><code class="language-fsharp">module LangLSP.Server.Server

open Ionide.LanguageServerProtocol.Types

/// Server capabilities declaration
let serverCapabilities : ServerCapabilities =
    { ServerCapabilities.Default with
        TextDocumentSync =
            Some (U2.C1 {
                TextDocumentSyncOptions.Default with
                    OpenClose = Some true
                    Change = Some TextDocumentSyncKind.Incremental
            })
    }
</code></pre>
<h3 id="programfs"><a class="header" href="#programfs">Program.fs</a></h3>
<pre><code class="language-fsharp">module LangLSP.Server.Program

open System
open Serilog

[&lt;EntryPoint&gt;]
let main argv =
    // Serilog ì„¤ì •
    Log.Logger &lt;-
        LoggerConfiguration()
            .MinimumLevel.Debug()
            .WriteTo.File("/tmp/funlang-lsp.log", rollingInterval = RollingInterval.Day)
            .CreateLogger()

    Log.Information("FunLang LSP Server starting...")

    // stdin/stdout ì„¤ì •
    use input = Console.OpenStandardInput()
    use output = Console.OpenStandardOutput()

    // ì„œë²„ ì‹¤í–‰ ëŒ€ê¸°
    // TODO: ë‹¤ìŒ Phaseì—ì„œ LSP ë©”ì‹œì§€ ë£¨í”„ êµ¬í˜„

    0
</code></pre>
<hr>
<h2 id="ì°¸ê³ -ìë£Œ-2"><a class="header" href="#ì°¸ê³ -ìë£Œ-2">ì°¸ê³  ìë£Œ</a></h2>
<ul>
<li><a href="https://docs.microsoft.com/dotnet/core/tools/">.NET CLI ê³µì‹ ë¬¸ì„œ</a></li>
<li><a href="https://fsharp.org/guides/project-structure/">F# í”„ë¡œì íŠ¸ êµ¬ì¡°</a></li>
<li><a href="https://github.com/ionide/LanguageServerProtocol">Ionide.LanguageServerProtocol GitHub</a></li>
<li><a href="https://github.com/haf/expecto">Expecto ë¬¸ì„œ</a></li>
<li><a href="https://git-scm.com/book/en/v2/Git-Tools-Submodules">Git Submodules ê°€ì´ë“œ</a></li>
</ul>
<hr>
<p><strong>â†’ ë‹¤ìŒ: <a href="#ë¬¸ì„œ-ë™ê¸°í™”-êµ¬í˜„">04-document-sync.md</a></strong> - ë¬¸ì„œ ë™ê¸°í™” êµ¬í˜„</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="ë¬¸ì„œ-ë™ê¸°í™”-êµ¬í˜„"><a class="header" href="#ë¬¸ì„œ-ë™ê¸°í™”-êµ¬í˜„">ë¬¸ì„œ ë™ê¸°í™” êµ¬í˜„</a></h1>
<p>ì´ ë¬¸ì„œëŠ” LSP ì„œë²„ì—ì„œ <strong>Document Sync</strong>(ë¬¸ì„œ ë™ê¸°í™”)ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•œë‹¤. ë¬¸ì„œ ë™ê¸°í™”ëŠ” ì—ë””í„°ì—ì„œ íŒŒì¼ì„ ì—´ê³ , ìˆ˜ì •í•˜ê³ , ë‹«ì„ ë•Œë§ˆë‹¤ LSP ì„œë²„ê°€ ìµœì‹  í…ìŠ¤íŠ¸ë¥¼ ìœ ì§€í•˜ë„ë¡ í•œë‹¤.</p>
<h2 id="ëª©ì°¨-3"><a class="header" href="#ëª©ì°¨-3">ëª©ì°¨</a></h2>
<ol>
<li><a href="#ë¬¸ì„œ-ë™ê¸°í™”ë€">ë¬¸ì„œ ë™ê¸°í™”ë€</a></li>
<li><a href="#ë™ê¸°í™”-ëª¨ë“œ">ë™ê¸°í™” ëª¨ë“œ</a></li>
<li><a href="#concurrentdictionaryë¡œ-ë¬¸ì„œ-ì €ì¥">ConcurrentDictionaryë¡œ ë¬¸ì„œ ì €ì¥</a></li>
<li><a href="#didopen-í•¸ë“¤ëŸ¬">didOpen í•¸ë“¤ëŸ¬</a></li>
<li><a href="#didchange-í•¸ë“¤ëŸ¬">didChange í•¸ë“¤ëŸ¬</a></li>
<li><a href="#didclose-í•¸ë“¤ëŸ¬">didClose í•¸ë“¤ëŸ¬</a></li>
<li><a href="#í…ŒìŠ¤íŠ¸-ì‘ì„±">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></li>
</ol>
<hr>
<h2 id="ë¬¸ì„œ-ë™ê¸°í™”ë€"><a class="header" href="#ë¬¸ì„œ-ë™ê¸°í™”ë€">ë¬¸ì„œ ë™ê¸°í™”ë€</a></h2>
<p><strong>Document Sync</strong>ëŠ” LSPì˜ í•µì‹¬ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ë¡œ, ì—ë””í„°ì™€ Language Server ê°„ì— ë¬¸ì„œ í…ìŠ¤íŠ¸ë¥¼ ë™ê¸°í™”í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ì´ë‹¤.</p>
<h3 id="ì™œ-í•„ìš”í•œê°€"><a class="header" href="#ì™œ-í•„ìš”í•œê°€">ì™œ í•„ìš”í•œê°€?</a></h3>
<p>LSP ì„œë²„ëŠ” ë³„ë„ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰ë˜ë¯€ë¡œ, ì—ë””í„°ê°€ íŒŒì¼ì„ ì½ê±°ë‚˜ ìˆ˜ì •í•´ë„ ì„œë²„ëŠ” ê·¸ ë‚´ìš©ì„ ìë™ìœ¼ë¡œ ì•Œ ìˆ˜ ì—†ë‹¤. ë”°ë¼ì„œ ì—ë””í„°ëŠ” ë‹¤ìŒ ì´ë²¤íŠ¸ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•´ì•¼ í•œë‹¤.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>ì´ë²¤íŠ¸</th><th>LSP ë©”ì„œë“œ</th><th>ì„¤ëª…</th></tr>
</thead>
<tbody>
<tr><td>íŒŒì¼ ì—´ê¸°</td><td><code>textDocument/didOpen</code></td><td>ì—ë””í„°ì—ì„œ íŒŒì¼ì„ ì²˜ìŒ ì—´ ë•Œ ì „ì²´ í…ìŠ¤íŠ¸ ì „ì†¡</td></tr>
<tr><td>íŒŒì¼ ìˆ˜ì •</td><td><code>textDocument/didChange</code></td><td>íŒŒì¼ì´ ìˆ˜ì •ë  ë•Œë§ˆë‹¤ ë³€ê²½ ì‚¬í•­ ì „ì†¡</td></tr>
<tr><td>íŒŒì¼ ë‹«ê¸°</td><td><code>textDocument/didClose</code></td><td>ì—ë””í„°ì—ì„œ íŒŒì¼ì„ ë‹«ì„ ë•Œ ì•Œë¦¼</td></tr>
</tbody>
</table>
</div>
<pre class="mermaid">sequenceDiagram
    participant C as Client
    participant S as Server
    C-&gt;&gt;S: textDocument/didOpen(uri, text)
    Note over S: ë¬¸ì„œ ì €ì¥ì†Œì— ì „ì²´ í…ìŠ¤íŠ¸ ì €ì¥
    C-&gt;&gt;S: textDocument/didChange(uri, contentChanges[])
    Note over S: ë³€ê²½ ë²”ìœ„ë§Œ ë°˜ì˜ (Incremental)
    C-&gt;&gt;S: textDocument/didChange(uri, contentChanges[])
    C-&gt;&gt;S: textDocument/didClose(uri)
    Note over S: ë¬¸ì„œ ì €ì¥ì†Œì—ì„œ ì œê±°
</pre>

<h3 id="ë¬¸ì„œ-ë™ê¸°í™”ê°€-í•„ìš”í•œ-lsp-ê¸°ëŠ¥"><a class="header" href="#ë¬¸ì„œ-ë™ê¸°í™”ê°€-í•„ìš”í•œ-lsp-ê¸°ëŠ¥">ë¬¸ì„œ ë™ê¸°í™”ê°€ í•„ìš”í•œ LSP ê¸°ëŠ¥</a></h3>
<p>ë¬¸ì„œ ë™ê¸°í™”ëŠ” ê±°ì˜ ëª¨ë“  LSP ê¸°ëŠ¥ì˜ ì „ì œì¡°ê±´ì´ë‹¤.</p>
<ul>
<li><strong>Diagnostics</strong>: ë¬¸ì„œ í…ìŠ¤íŠ¸ë¥¼ íŒŒì‹±/íƒ€ì…ì²´í‚¹í•˜ì—¬ ì—ëŸ¬ ê²€ì¶œ</li>
<li><strong>Hover</strong>: ì»¤ì„œ ìœ„ì¹˜ì˜ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ íƒ€ì… ì •ë³´ í‘œì‹œ</li>
<li><strong>Completion</strong>: í˜„ì¬ í…ìŠ¤íŠ¸ ë§¥ë½ì—ì„œ ìë™ì™„ì„± ì œì•ˆ</li>
<li><strong>Go to Definition</strong>: ì‹¬ë³¼ ìœ„ì¹˜ë¥¼ ì°¾ê¸° ìœ„í•´ ì „ì²´ í…ìŠ¤íŠ¸ ë¶„ì„</li>
</ul>
<hr>
<h2 id="ë™ê¸°í™”-ëª¨ë“œ"><a class="header" href="#ë™ê¸°í™”-ëª¨ë“œ">ë™ê¸°í™” ëª¨ë“œ</a></h2>
<p>LSPëŠ” ë‘ ê°€ì§€ ë™ê¸°í™” ëª¨ë“œë¥¼ ì§€ì›í•œë‹¤.</p>
<h3 id="1-full-sync-ì „ì²´-ë™ê¸°í™”"><a class="header" href="#1-full-sync-ì „ì²´-ë™ê¸°í™”">1. Full Sync (ì „ì²´ ë™ê¸°í™”)</a></h3>
<p>ë§¤ë²ˆ ë³€ê²½ ì‹œ <strong>ì „ì²´ í…ìŠ¤íŠ¸</strong>ë¥¼ ì „ì†¡í•œë‹¤.</p>
<p><strong>ì¥ì :</strong></p>
<ul>
<li>êµ¬í˜„ì´ ê°„ë‹¨ (ë¬¸ìì—´ êµì²´ë§Œ í•˜ë©´ ë¨)</li>
<li>ë™ê¸°í™” ì˜¤ë¥˜ ê°€ëŠ¥ì„± ë‚®ìŒ</li>
</ul>
<p><strong>ë‹¨ì :</strong></p>
<ul>
<li>ëŒ€ìš©ëŸ‰ íŒŒì¼ì—ì„œ ë¹„íš¨ìœ¨ì  (1ì¤„ ë³€ê²½í•´ë„ 100KB íŒŒì¼ ì „ì²´ ì „ì†¡)</li>
</ul>
<pre><code class="language-fsharp">// Full Sync ì˜ˆì‹œ
let handleDidChangeFullSync (p: DidChangeTextDocumentParams) : unit =
    let uri = p.TextDocument.Uri
    let newText = p.ContentChanges.[0].Text  // ì „ì²´ í…ìŠ¤íŠ¸
    documents.[uri] &lt;- newText
</code></pre>
<h3 id="2-incremental-sync-ì¦ë¶„-ë™ê¸°í™”"><a class="header" href="#2-incremental-sync-ì¦ë¶„-ë™ê¸°í™”">2. Incremental Sync (ì¦ë¶„ ë™ê¸°í™”)</a></h3>
<p>ë³€ê²½ëœ <strong>ë¶€ë¶„(Range)ë§Œ</strong> ì „ì†¡í•œë‹¤.</p>
<p><strong>ì¥ì :</strong></p>
<ul>
<li>ëŒ€ìš©ëŸ‰ íŒŒì¼ì—ì„œ íš¨ìœ¨ì  (ë³€ê²½ëœ 10ìë§Œ ì „ì†¡)</li>
<li>ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ê°ì†Œ</li>
</ul>
<p><strong>ë‹¨ì :</strong></p>
<ul>
<li>êµ¬í˜„ì´ ë³µì¡ (Range ê¸°ë°˜ ë¬¸ìì—´ êµì²´ ë¡œì§ í•„ìš”)</li>
</ul>
<pre><code class="language-fsharp">// Incremental Sync ì˜ˆì‹œ
// "let x = 1"ì„ "let y = 1"ë¡œ ë³€ê²½í•˜ë ¤ë©´:
// Range: line 0, character 4-5 (xì˜ ìœ„ì¹˜)
// Text: "y"
</code></pre>
<p>FunLang LSPëŠ” <strong>Incremental Sync</strong>ë¥¼ ì‚¬ìš©í•œë‹¤. (ì„±ëŠ¥ê³¼ ì‹¤ìš©ì„±ì˜ ê· í˜•)</p>
<h3 id="server-capabilities-ì„ ì–¸"><a class="header" href="#server-capabilities-ì„ ì–¸">Server Capabilities ì„ ì–¸</a></h3>
<p>ì„œë²„ê°€ ì–´ë–¤ ë™ê¸°í™” ëª¨ë“œë¥¼ ì§€ì›í•˜ëŠ”ì§€ <code>initialize</code> ì‘ë‹µì—ì„œ ì„ ì–¸í•œë‹¤.</p>
<pre><code class="language-fsharp">// Server.fs
let serverCapabilities : ServerCapabilities =
    { ServerCapabilities.Default with
        TextDocumentSync =
            Some (U2.C1 {
                TextDocumentSyncOptions.Default with
                    OpenClose = Some true  // didOpen/didClose ì§€ì›
                    Change = Some TextDocumentSyncKind.Incremental  // ì¦ë¶„ ë™ê¸°í™”
            })
    }
</code></pre>
<hr>
<h2 id="concurrentdictionaryë¡œ-ë¬¸ì„œ-ì €ì¥"><a class="header" href="#concurrentdictionaryë¡œ-ë¬¸ì„œ-ì €ì¥">ConcurrentDictionaryë¡œ ë¬¸ì„œ ì €ì¥</a></h2>
<p>LSP ì„œë²„ëŠ” ì—¬ëŸ¬ ë¬¸ì„œë¥¼ ë™ì‹œì— ì¶”ì í•´ì•¼ í•˜ë¯€ë¡œ, ìŠ¤ë ˆë“œ ì•ˆì „í•œ ì €ì¥ì†Œê°€ í•„ìš”í•˜ë‹¤.</p>
<h3 id="ì™œ-concurrentdictionaryì¸ê°€"><a class="header" href="#ì™œ-concurrentdictionaryì¸ê°€">ì™œ ConcurrentDictionaryì¸ê°€?</a></h3>
<p>LSP ì„œë²„ëŠ” <strong>ë‹¤ì¤‘ ìŠ¤ë ˆë“œ í™˜ê²½</strong>ì—ì„œ ë™ì‘í•œë‹¤:</p>
<ul>
<li>ì—ë””í„°ê°€ <code>didOpen</code>, <code>didChange</code>, <code>didClose</code> ì•Œë¦¼ì„ ë¹„ë™ê¸°ë¡œ ë³´ëƒ„</li>
<li>ì„œë²„ëŠ” ì—¬ëŸ¬ ìš”ì²­ì„ ë³‘ë ¬ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ</li>
<li>ë‹¨ìˆœ <code>Dictionary</code>ëŠ” ìŠ¤ë ˆë“œ ì•ˆì „í•˜ì§€ ì•Šì•„ Race Condition ë°œìƒ ê°€ëŠ¥</li>
</ul>
<p><code>ConcurrentDictionary</code>ëŠ” .NETì˜ ìŠ¤ë ˆë“œ ì•ˆì „í•œ í•´ì‹œë§µìœ¼ë¡œ, ë½ ì—†ì´ ë™ì‹œ ì½ê¸°/ì“°ê¸°ê°€ ê°€ëŠ¥í•˜ë‹¤.</p>
<h3 id="êµ¬í˜„"><a class="header" href="#êµ¬í˜„">êµ¬í˜„</a></h3>
<pre><code class="language-fsharp">// DocumentSync.fs
module LangLSP.Server.DocumentSync

open System.Collections.Concurrent
open Ionide.LanguageServerProtocol.Types

/// Thread-safe document storage (URI -&gt; text content)
let private documents = ConcurrentDictionary&lt;string, string&gt;()

/// Get document text by URI (for diagnostics, hover, etc.)
let getDocument (uri: string) : string option =
    match documents.TryGetValue(uri) with
    | true, text -&gt; Some text
    | false, _ -&gt; None
</code></pre>
<p><strong>ì„¤ê³„ í¬ì¸íŠ¸:</strong></p>
<ul>
<li><code>private documents</code>: ëª¨ë“ˆ ë‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥ (ìº¡ìŠí™”)</li>
<li><code>URI -&gt; string</code>: íŒŒì¼ ê²½ë¡œ(URI)ë¥¼ í‚¤ë¡œ, í…ìŠ¤íŠ¸ë¥¼ ê°’ìœ¼ë¡œ ì €ì¥</li>
<li><code>getDocument</code>: ì™¸ë¶€ ëª¨ë“ˆì´ ë¬¸ì„œ ë‚´ìš©ì„ ì•ˆì „í•˜ê²Œ ì½ì„ ìˆ˜ ìˆë„ë¡ ì œê³µ</li>
</ul>
<hr>
<h2 id="didopen-í•¸ë“¤ëŸ¬"><a class="header" href="#didopen-í•¸ë“¤ëŸ¬">didOpen í•¸ë“¤ëŸ¬</a></h2>
<p>íŒŒì¼ì´ ì—ë””í„°ì—ì„œ ì—´ë¦´ ë•Œ í˜¸ì¶œë˜ëŠ” í•¸ë“¤ëŸ¬ì´ë‹¤.</p>
<h3 id="í”„ë¡œí† ì½œ-êµ¬ì¡°"><a class="header" href="#í”„ë¡œí† ì½œ-êµ¬ì¡°">í”„ë¡œí† ì½œ êµ¬ì¡°</a></h3>
<pre><code class="language-typescript">// LSP í”„ë¡œí† ì½œ (TypeScript ì •ì˜)
interface DidOpenTextDocumentParams {
    textDocument: {
        uri: string          // íŒŒì¼ URI (ì˜ˆ: "file:///path/to/test.fun")
        languageId: string   // ì–¸ì–´ ID (ì˜ˆ: "funlang")
        version: number      // ë¬¸ì„œ ë²„ì „ (1ë¶€í„° ì‹œì‘)
        text: string         // ì „ì²´ íŒŒì¼ í…ìŠ¤íŠ¸
    }
}
</code></pre>
<h3 id="êµ¬í˜„-1"><a class="header" href="#êµ¬í˜„-1">êµ¬í˜„</a></h3>
<pre><code class="language-fsharp">/// Handle textDocument/didOpen
let handleDidOpen (p: DidOpenTextDocumentParams) : unit =
    let uri = p.TextDocument.Uri
    let text = p.TextDocument.Text
    documents.[uri] &lt;- text
</code></pre>
<p><strong>ë™ì‘ íë¦„:</strong></p>
<ol>
<li>íŒŒë¼ë¯¸í„°ì—ì„œ <code>Uri</code>ì™€ <code>Text</code> ì¶”ì¶œ</li>
<li><code>ConcurrentDictionary</code>ì— ì €ì¥</li>
<li>ì´ì œ <code>getDocument(uri)</code>ë¡œ í…ìŠ¤íŠ¸ ì¡°íšŒ ê°€ëŠ¥</li>
</ol>
<p><strong>ì˜ˆì‹œ:</strong></p>
<pre><code class="language-fsharp">// ì—ë””í„°ì—ì„œ "test.fun" íŒŒì¼ì„ ì—´ë©´:
// Uri = "file:///home/user/test.fun"
// Text = "let x = 1 + 2"

handleDidOpen { TextDocument = { Uri = "file:///home/user/test.fun"; Text = "let x = 1 + 2"; ... } }

// ì´í›„ getDocumentë¡œ ì¡°íšŒ ê°€ëŠ¥
getDocument "file:///home/user/test.fun"
// -&gt; Some "let x = 1 + 2"
</code></pre>
<hr>
<h2 id="didchange-í•¸ë“¤ëŸ¬"><a class="header" href="#didchange-í•¸ë“¤ëŸ¬">didChange í•¸ë“¤ëŸ¬</a></h2>
<p>íŒŒì¼ì´ ìˆ˜ì •ë  ë•Œ í˜¸ì¶œë˜ëŠ” í•¸ë“¤ëŸ¬ë¡œ, <strong>ì¦ë¶„ ë³€ê²½</strong>ì„ ì²˜ë¦¬í•œë‹¤.</p>
<h3 id="í”„ë¡œí† ì½œ-êµ¬ì¡°-1"><a class="header" href="#í”„ë¡œí† ì½œ-êµ¬ì¡°-1">í”„ë¡œí† ì½œ êµ¬ì¡°</a></h3>
<pre><code class="language-typescript">interface DidChangeTextDocumentParams {
    textDocument: {
        uri: string
        version: number
    }
    contentChanges: TextDocumentContentChangeEvent[]
}

type TextDocumentContentChangeEvent =
    | { range: Range; text: string }  // ì¦ë¶„ ë³€ê²½ (C1)
    | { text: string }                // ì „ì²´ ë³€ê²½ (C2)
</code></pre>
<p>Ionide.LanguageServerProtocolì€ Union íƒ€ì…ì„ <code>U2&lt;C1, C2&gt;</code>ë¡œ í‘œí˜„í•œë‹¤.</p>
<h3 id="range-ê¸°ë°˜-í…ìŠ¤íŠ¸-êµì²´"><a class="header" href="#range-ê¸°ë°˜-í…ìŠ¤íŠ¸-êµì²´">Range ê¸°ë°˜ í…ìŠ¤íŠ¸ êµì²´</a></h3>
<p>ì¦ë¶„ ë³€ê²½ì€ <strong>Range</strong>ë¡œ êµì²´í•  ì˜ì—­ì„ ì§€ì •í•œë‹¤.</p>
<pre><code class="language-fsharp">// LSP Range êµ¬ì¡°
type Range = {
    Start: Position  // { Line: uint32; Character: uint32 }
    End: Position
}
</code></pre>
<p><strong>ì˜ˆì‹œ:</strong> <code>"let x = 1"</code>ì„ <code>"let y = 1"</code>ë¡œ ë³€ê²½</p>
<pre><code>í…ìŠ¤íŠ¸:  l  e  t     x     =     1
ì¸ë±ìŠ¤:  0  1  2  3  4  5  6  7  8

Range: { Start: { Line: 0, Character: 4 }, End: { Line: 0, Character: 5 } }
Text: "y"

ê²°ê³¼: "let " + "y" + " = 1" = "let y = 1"
</code></pre>
<h3 id="êµ¬í˜„-2"><a class="header" href="#êµ¬í˜„-2">êµ¬í˜„</a></h3>
<pre><code class="language-fsharp">/// Convert line/character to string offset
/// Note: LSP positions are 0-based
let private getOffset (lines: string[]) (line: int) (character: int) : int =
    let mutable offset = 0
    for i in 0 .. line - 1 do
        if i &lt; lines.Length then
            offset &lt;- offset + lines.[i].Length + 1  // +1 for newline
    offset + min character (if line &lt; lines.Length then lines.[line].Length else 0)

/// Apply incremental text changes to document
/// LSP changes are applied in order; each change has a Range to replace
let private applyContentChanges (text: string) (changes: TextDocumentContentChangeEvent array) : string =
    changes
    |&gt; Array.fold (fun currentText change -&gt;
        match change with
        | U2.C1 incrementalChange -&gt;
            // Incremental change: replace text at range
            let range = incrementalChange.Range
            let lines = currentText.Split([|'\n'|], System.StringSplitOptions.None)
            let startOffset = getOffset lines (int range.Start.Line) (int range.Start.Character)
            let endOffset = getOffset lines (int range.End.Line) (int range.End.Character)
            currentText.Substring(0, startOffset) + incrementalChange.Text + currentText.Substring(endOffset)
        | U2.C2 fullChange -&gt;
            // Full sync fallback
            fullChange.Text
    ) text

/// Handle textDocument/didChange
let handleDidChange (p: DidChangeTextDocumentParams) : unit =
    let uri = p.TextDocument.Uri
    match documents.TryGetValue(uri) with
    | true, currentText -&gt;
        let newText = applyContentChanges currentText p.ContentChanges
        documents.[uri] &lt;- newText
    | false, _ -&gt;
        // Document not tracked - this shouldn't happen, but handle gracefully
        ()
</code></pre>
<p><strong>í•µì‹¬ ë¡œì§:</strong></p>
<ol>
<li><strong>getOffset</strong>: LSP Position (line, character)ì„ ë¬¸ìì—´ ì˜¤í”„ì…‹ìœ¼ë¡œ ë³€í™˜
<ul>
<li>ì¤„ë°”ê¿ˆ(<code>\n</code>)ì„ ê³ ë ¤í•˜ì—¬ ì ˆëŒ€ ìœ„ì¹˜ ê³„ì‚°</li>
</ul>
</li>
<li><strong>applyContentChanges</strong>: ì—¬ëŸ¬ ë³€ê²½ ì‚¬í•­ì„ ìˆœì°¨ì ìœ¼ë¡œ ì ìš©
<ul>
<li><code>U2.C1</code>: ì¦ë¶„ ë³€ê²½ â†’ Rangeë¡œ ë¶€ë¶„ ë¬¸ìì—´ êµì²´</li>
<li><code>U2.C2</code>: ì „ì²´ ë³€ê²½ â†’ ì „ì²´ í…ìŠ¤íŠ¸ êµì²´ (Fallback)</li>
</ul>
</li>
<li><strong>handleDidChange</strong>: ë¬¸ì„œë¥¼ ì¡°íšŒí•˜ì—¬ ë³€ê²½ ì ìš© í›„ ë‹¤ì‹œ ì €ì¥</li>
</ol>
<p><strong>ë©€í‹°ë¼ì¸ ì˜ˆì‹œ:</strong></p>
<pre><code>ì›ë³¸:
"let x = 1\nlet y = 2"

Range: { Start: { Line: 1, Character: 4 }, End: { Line: 1, Character: 5 } }
Text: "z"

Step 1: lines = ["let x = 1", "let y = 2"]
Step 2: startOffset = (len("let x = 1") + 1) + 4 = 10 + 4 = 14
Step 3: endOffset = 15
Step 4: "let x = 1\nlet " + "z" + " = 2" = "let x = 1\nlet z = 2"
</code></pre>
<hr>
<h2 id="didclose-í•¸ë“¤ëŸ¬"><a class="header" href="#didclose-í•¸ë“¤ëŸ¬">didClose í•¸ë“¤ëŸ¬</a></h2>
<p>íŒŒì¼ì´ ì—ë””í„°ì—ì„œ ë‹«í ë•Œ í˜¸ì¶œë˜ëŠ” í•¸ë“¤ëŸ¬ì´ë‹¤.</p>
<h3 id="êµ¬í˜„-3"><a class="header" href="#êµ¬í˜„-3">êµ¬í˜„</a></h3>
<pre><code class="language-fsharp">/// Handle textDocument/didClose
let handleDidClose (p: DidCloseTextDocumentParams) : unit =
    let uri = p.TextDocument.Uri
    documents.TryRemove(uri) |&gt; ignore
</code></pre>
<p><strong>ë™ì‘:</strong></p>
<ul>
<li><code>ConcurrentDictionary</code>ì—ì„œ ë¬¸ì„œ ì œê±°</li>
<li><code>TryRemove</code>ëŠ” <code>(bool * string)</code> íŠœí”Œì„ ë°˜í™˜í•˜ì§€ë§Œ, ì„±ê³µ ì—¬ë¶€ëŠ” ë¬´ì‹œ (<code>|&gt; ignore</code>)</li>
</ul>
<p><strong>ì™œ ì œê±°í•´ì•¼ í•˜ë‚˜?</strong></p>
<ul>
<li>ë©”ëª¨ë¦¬ ì ˆì•½: ë‹«íŒ íŒŒì¼ì€ ë” ì´ìƒ ì¶”ì í•  í•„ìš” ì—†ìŒ</li>
<li>ì—ë””í„°ê°€ íŒŒì¼ì„ ë‹¤ì‹œ ì—´ë©´ <code>didOpen</code>ìœ¼ë¡œ ìƒˆë¡œ ì¶”ê°€ë¨</li>
</ul>
<hr>
<h2 id="í…ŒìŠ¤íŠ¸-ì‘ì„±"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‘ì„±">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></h2>
<p>Expectoë¥¼ ì‚¬ìš©í•˜ì—¬ Document Sync ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•œë‹¤.</p>
<h3 id="í…ŒìŠ¤íŠ¸-í—¬í¼-í•¨ìˆ˜"><a class="header" href="#í…ŒìŠ¤íŠ¸-í—¬í¼-í•¨ìˆ˜">í…ŒìŠ¤íŠ¸ í—¬í¼ í•¨ìˆ˜</a></h3>
<pre><code class="language-fsharp">// DocumentSyncTests.fs
module LangLSP.Tests.DocumentSyncTests

open Expecto
open LangLSP.Server.DocumentSync
open Ionide.LanguageServerProtocol.Types

let makeDidOpenParams uri text : DidOpenTextDocumentParams =
    {
        TextDocument = {
            Uri = uri
            LanguageId = "funlang"
            Version = 1
            Text = text
        }
    }

let makeDidCloseParams uri : DidCloseTextDocumentParams =
    { TextDocument = { Uri = uri } }

let makeDidChangeParams uri version changes : DidChangeTextDocumentParams =
    {
        TextDocument = { Uri = uri; Version = version }
        ContentChanges = changes
    }
</code></pre>
<h3 id="í…ŒìŠ¤íŠ¸-ì¼€ì´ìŠ¤"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì¼€ì´ìŠ¤">í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤</a></h3>
<pre><code class="language-fsharp">[&lt;Tests&gt;]
let documentSyncTests =
    testSequenced &lt;| testList "DocumentSync" [

        testCase "didOpen stores document text" &lt;| fun _ -&gt;
            clearAll()
            let uri = "file:///test.fun"
            let text = "let x = 1"
            handleDidOpen (makeDidOpenParams uri text)
            Expect.equal (getDocument uri) (Some text) "Document should be stored"

        testCase "didClose removes document" &lt;| fun _ -&gt;
            clearAll()
            let uri = "file:///test.fun"
            handleDidOpen (makeDidOpenParams uri "let x = 1")
            handleDidClose (makeDidCloseParams uri)
            Expect.equal (getDocument uri) None "Document should be removed"

        testCase "didChange with full sync replaces text" &lt;| fun _ -&gt;
            clearAll()
            let uri = "file:///test.fun"
            handleDidOpen (makeDidOpenParams uri "let x = 1")
            let change = U2.C2 { Text = "let y = 2" }
            handleDidChange (makeDidChangeParams uri 2 [| change |])
            Expect.equal (getDocument uri) (Some "let y = 2") "Text should be replaced"

        testCase "didChange with incremental sync modifies range" &lt;| fun _ -&gt;
            clearAll()
            let uri = "file:///test.fun"
            handleDidOpen (makeDidOpenParams uri "let x = 1")
            // Change 'x' to 'y' (position 4, length 1)
            let range = { Start = { Line = 0u; Character = 4u }; End = { Line = 0u; Character = 5u } }
            let change = U2.C1 { Range = range; RangeLength = None; Text = "y" }
            handleDidChange (makeDidChangeParams uri 2 [| change |])
            Expect.equal (getDocument uri) (Some "let y = 1") "Variable name should be changed"

        testCase "getDocument returns None for unknown URI" &lt;| fun _ -&gt;
            clearAll()
            Expect.equal (getDocument "file:///unknown.fun") None "Unknown document should return None"
    ]
</code></pre>
<p><strong>ì¤‘ìš” í¬ì¸íŠ¸:</strong></p>
<ul>
<li><code>testSequenced</code>: <code>ConcurrentDictionary</code>ëŠ” í…ŒìŠ¤íŠ¸ ê°„ ê³µìœ ë˜ë¯€ë¡œ ìˆœì°¨ ì‹¤í–‰ í•„ìš”</li>
<li><code>clearAll()</code>: ê° í…ŒìŠ¤íŠ¸ ì‹œì‘ ì „ ìƒíƒœ ì´ˆê¸°í™”</li>
<li>ì¦ë¶„ ë³€ê²½ í…ŒìŠ¤íŠ¸: Rangeë¥¼ ëª…ì‹œí•˜ì—¬ ì •í™•í•œ êµì²´ ê²€ì¦</li>
</ul>
<h3 id="í…ŒìŠ¤íŠ¸-ì‹¤í–‰"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‹¤í–‰">í…ŒìŠ¤íŠ¸ ì‹¤í–‰</a></h3>
<pre><code class="language-bash">dotnet run --project src/LangLSP.Tests

# ì¶œë ¥:
# [DocumentSync] didOpen stores document text - Passed
# [DocumentSync] didClose removes document - Passed
# [DocumentSync] didChange with full sync replaces text - Passed
# [DocumentSync] didChange with incremental sync modifies range - Passed
# [DocumentSync] getDocument returns None for unknown URI - Passed
</code></pre>
<hr>
<h2 id="ë‹¤ìŒ-ë‹¨ê³„-3"><a class="header" href="#ë‹¤ìŒ-ë‹¨ê³„-3">ë‹¤ìŒ ë‹¨ê³„</a></h2>
<p>ë¬¸ì„œ ë™ê¸°í™”ê°€ ì™„ë£Œë˜ì—ˆìœ¼ë¯€ë¡œ, ì´ì œ <strong>Diagnostics</strong>(ì§„ë‹¨)ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.</p>
<p><strong>ë‹¤ìŒ íŠœí† ë¦¬ì–¼:</strong> <a href="#ì§„ë‹¨diagnostics-êµ¬í˜„">05-diagnostics.md</a></p>
<p>Diagnostics êµ¬í˜„ì—ì„œëŠ” ë‹¤ìŒì„ ë‹¤ë£¬ë‹¤:</p>
<ol>
<li>FunLangì˜ Diagnostic ì‹œìŠ¤í…œ í™œìš©</li>
<li>Spanì„ LSP Rangeë¡œ ë³€í™˜ (1-based â†’ 0-based)</li>
<li>ë¬¸ë²• ì˜¤ë¥˜ ë° íƒ€ì… ì˜¤ë¥˜ ì²˜ë¦¬</li>
<li><code>publishDiagnostics</code>ë¡œ ì—ë””í„°ì— ì—ëŸ¬ ì „ì†¡</li>
<li>FsCheckë¥¼ í™œìš©í•œ Property-based Testing</li>
</ol>
<hr>
<h2 id="ì°¸ê³ -ìë£Œ-3"><a class="header" href="#ì°¸ê³ -ìë£Œ-3">ì°¸ê³  ìë£Œ</a></h2>
<ul>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocument_synchronization">LSP Specification - Text Synchronization</a></li>
<li><a href="https://docs.microsoft.com/dotnet/api/system.collections.concurrent.concurrentdictionary-2">ConcurrentDictionary ë¬¸ì„œ</a></li>
<li><a href="https://github.com/ionide/LanguageServerProtocol">Ionide.LanguageServerProtocol GitHub</a></li>
</ul>
<hr>
<p><strong>â†’ ë‹¤ìŒ: <a href="#ì§„ë‹¨diagnostics-êµ¬í˜„">05-diagnostics.md</a></strong> - ì§„ë‹¨ êµ¬í˜„</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="ì§„ë‹¨diagnostics-êµ¬í˜„"><a class="header" href="#ì§„ë‹¨diagnostics-êµ¬í˜„">ì§„ë‹¨(Diagnostics) êµ¬í˜„</a></h1>
<p>ì´ ë¬¸ì„œëŠ” LSP ì„œë²„ì—ì„œ <strong>Diagnostics</strong>(ì§„ë‹¨)ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•œë‹¤. ì§„ë‹¨ì€ ì—ë””í„°ì— ë¹¨ê°„ ì¤„ë¡œ í‘œì‹œë˜ëŠ” ì—ëŸ¬ì™€ ê²½ê³ ë¥¼ ë§í•˜ë©°, LSPì˜ ê°€ì¥ ì¤‘ìš”í•œ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ì´ë‹¤.</p>
<h2 id="ëª©ì°¨-4"><a class="header" href="#ëª©ì°¨-4">ëª©ì°¨</a></h2>
<ol>
<li><a href="#ì§„ë‹¨ì´ë€">ì§„ë‹¨ì´ë€</a></li>
<li><a href="#funlangì˜-diagnostic-ì‹œìŠ¤í…œ">FunLangì˜ Diagnostic ì‹œìŠ¤í…œ</a></li>
<li><a href="#ìœ„ì¹˜-ë³€í™˜-span--lsp-range">ìœ„ì¹˜ ë³€í™˜: Span â†’ LSP Range</a></li>
<li><a href="#ë¬¸ë²•-ì˜¤ë¥˜-ì²˜ë¦¬">ë¬¸ë²• ì˜¤ë¥˜ ì²˜ë¦¬</a></li>
<li><a href="#íƒ€ì…-ì˜¤ë¥˜-ì²˜ë¦¬">íƒ€ì… ì˜¤ë¥˜ ì²˜ë¦¬</a></li>
<li><a href="#publishdiagnostics-í˜¸ì¶œ">publishDiagnostics í˜¸ì¶œ</a></li>
<li><a href="#ì§„ë‹¨-í´ë¦¬ì–´">ì§„ë‹¨ í´ë¦¬ì–´</a></li>
<li><a href="#í…ŒìŠ¤íŠ¸-ì‘ì„±-1">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></li>
</ol>
<hr>
<h2 id="ì§„ë‹¨ì´ë€"><a class="header" href="#ì§„ë‹¨ì´ë€">ì§„ë‹¨ì´ë€</a></h2>
<p><strong>Diagnostics</strong>ëŠ” ì†ŒìŠ¤ ì½”ë“œì˜ ë¬¸ì œë¥¼ ì‚¬ìš©ìì—ê²Œ ì•Œë ¤ì£¼ëŠ” LSP ë©”ì‹œì§€ì´ë‹¤.</p>
<h3 id="ì§„ë‹¨ì˜-êµ¬ì„±-ìš”ì†Œ"><a class="header" href="#ì§„ë‹¨ì˜-êµ¬ì„±-ìš”ì†Œ">ì§„ë‹¨ì˜ êµ¬ì„± ìš”ì†Œ</a></h3>
<pre><code class="language-typescript">interface Diagnostic {
    range: Range                    // ì—ëŸ¬ê°€ ë°œìƒí•œ ìœ„ì¹˜
    severity: DiagnosticSeverity   // Error, Warning, Info, Hint
    code?: string | number          // ì—ëŸ¬ ì½”ë“œ (ì˜ˆ: "E0301")
    source?: string                 // ì§„ë‹¨ ì¶œì²˜ (ì˜ˆ: "funlang")
    message: string                 // ì—ëŸ¬ ë©”ì‹œì§€
    relatedInformation?: DiagnosticRelatedInformation[]  // ê´€ë ¨ ìœ„ì¹˜
}
</code></pre>
<h3 id="vs-codeì—ì„œì˜-í‘œì‹œ"><a class="header" href="#vs-codeì—ì„œì˜-í‘œì‹œ">VS Codeì—ì„œì˜ í‘œì‹œ</a></h3>
<pre><code>test.fun
â”€â”€â”€â”€â”€â”€â”€â”€
1 | let x = 1 + true
              ~~~~ Error: Type mismatch: expected int but got bool [funlang]
</code></pre>
<ul>
<li><strong>ë¹¨ê°„ ë°‘ì¤„</strong>: <code>range</code>ë¡œ ì§€ì •ëœ ì˜ì—­</li>
<li><strong>ì—ëŸ¬ ë©”ì‹œì§€</strong>: ë§ˆìš°ìŠ¤ í˜¸ë²„ ì‹œ <code>message</code> í‘œì‹œ</li>
<li><strong>Problems íŒ¨ë„</strong>: ëª¨ë“  ì§„ë‹¨ì´ ëª©ë¡ìœ¼ë¡œ í‘œì‹œ</li>
</ul>
<h3 id="publishdiagnostics-ì•Œë¦¼"><a class="header" href="#publishdiagnostics-ì•Œë¦¼">publishDiagnostics ì•Œë¦¼</a></h3>
<p>LSP ì„œë²„ëŠ” <code>textDocument/publishDiagnostics</code> ì•Œë¦¼ì„ í´ë¼ì´ì–¸íŠ¸(ì—ë””í„°)ë¡œ ë³´ë‚¸ë‹¤.</p>
<p><strong>ì¤‘ìš”:</strong> ì´ê²ƒì€ **ì•Œë¦¼(Notification)**ì´ì§€ ìš”ì²­(Request)ì´ ì•„ë‹ˆë‹¤. ë”°ë¼ì„œ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ì§€ ì•ŠëŠ”ë‹¤.</p>
<pre><code class="language-fsharp">// ì§„ë‹¨ ë°œí–‰ ì˜ˆì‹œ
let publishParams : PublishDiagnosticsParams = {
    Uri = "file:///test.fun"
    Diagnostics = [| diagnostic1; diagnostic2 |]
    Version = None
}
lspClient.TextDocumentPublishDiagnostics publishParams
</code></pre>
<pre class="mermaid">sequenceDiagram
    participant C as Client
    participant S as Server
    C-&gt;&gt;S: textDocument/didOpen(uri, text)
    Note over S: íŒŒì‹± â†’ íƒ€ì… ê²€ì‚¬
    S--&gt;&gt;C: textDocument/publishDiagnostics(uri, diagnostics[])
    C-&gt;&gt;S: textDocument/didChange(uri, changes[])
    Note over S: ì¬íŒŒì‹± â†’ ì¬ê²€ì‚¬
    S--&gt;&gt;C: textDocument/publishDiagnostics(uri, diagnostics[])
</pre>

<hr>
<h2 id="funlangì˜-diagnostic-ì‹œìŠ¤í…œ"><a class="header" href="#funlangì˜-diagnostic-ì‹œìŠ¤í…œ">FunLangì˜ Diagnostic ì‹œìŠ¤í…œ</a></h2>
<p>FunLang ì»´íŒŒì¼ëŸ¬ëŠ” ì´ë¯¸ í’ë¶€í•œ ì§„ë‹¨ ì‹œìŠ¤í…œì„ ê°–ì¶”ê³  ìˆë‹¤.</p>
<h3 id="funlang-diagnostic-íƒ€ì…"><a class="header" href="#funlang-diagnostic-íƒ€ì…">FunLang Diagnostic íƒ€ì…</a></h3>
<pre><code class="language-fsharp">// Diagnostic.fs (FunLang í”„ë¡œì íŠ¸)
type Diagnostic = {
    Code: string option           // ì˜ˆ: Some "E0301"
    Message: string               // ì—ëŸ¬ ë©”ì‹œì§€
    PrimarySpan: Span             // ì£¼ ì—ëŸ¬ ìœ„ì¹˜
    SecondarySpans: (Span * string) list  // ê´€ë ¨ ìœ„ì¹˜ì™€ ë ˆì´ë¸”
    Notes: string list            // ì¶”ê°€ ì„¤ëª…
    Hint: string option           // ìˆ˜ì • ì œì•ˆ
}
</code></pre>
<h3 id="span-íƒ€ì…-ì†ŒìŠ¤-ìœ„ì¹˜"><a class="header" href="#span-íƒ€ì…-ì†ŒìŠ¤-ìœ„ì¹˜">Span íƒ€ì… (ì†ŒìŠ¤ ìœ„ì¹˜)</a></h3>
<pre><code class="language-fsharp">// Ast.fs (FunLang í”„ë¡œì íŠ¸)
type Span = {
    FileName: string
    StartLine: int      // 0-based (LexBuffer.FromString ì‚¬ìš© ì‹œ)
    StartColumn: int    // 0-based
    EndLine: int
    EndColumn: int      // exclusive (ë§ˆì§€ë§‰ ë¬¸ì ë‹¤ìŒ ìœ„ì¹˜)
}
</code></pre>
<p><strong>ì°¸ê³ :</strong> <code>LexBuffer.FromString</code>ìœ¼ë¡œ íŒŒì‹±í•˜ë©´ Positionì´ <strong>0-based</strong>ë¡œ ìƒì„±ëœë‹¤. LSPë„ 0-basedì´ë¯€ë¡œ <strong>ë³€í™˜ì´ í•„ìš” ì—†ë‹¤</strong>.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>ì¸ë±ì‹±</th><th>ì²« ë²ˆì§¸ ë¼ì¸</th><th>ì²« ë²ˆì§¸ ë¬¸ì</th></tr>
</thead>
<tbody>
<tr><td>FunLang Span (LexBuffer.FromString)</td><td>0</td><td>0</td></tr>
<tr><td>LSP Position</td><td>0</td><td>0</td></tr>
</tbody>
</table>
</div>
<h3 id="typecheck-ëª¨ë“ˆê³¼ì˜-í†µí•©"><a class="header" href="#typecheck-ëª¨ë“ˆê³¼ì˜-í†µí•©">TypeCheck ëª¨ë“ˆê³¼ì˜ í†µí•©</a></h3>
<p>FunLangì˜ <code>TypeCheck</code> ëª¨ë“ˆì€ íƒ€ì… ì²´í‚¹ ê²°ê³¼ë¥¼ <code>Result&lt;Type, Diagnostic&gt;</code>ë¡œ ë°˜í™˜í•œë‹¤.</p>
<pre><code class="language-fsharp">// TypeCheck.fs (FunLang í”„ë¡œì íŠ¸)
let typecheckWithDiagnostic (expr: Expr) : Result&lt;Type, Diagnostic&gt; =
    try
        let ty = typecheck expr
        Ok ty
    with
    | TypeException error -&gt;
        let diag = typeErrorToDiagnostic error
        Error diag
</code></pre>
<p>ì´ê²ƒì„ LSP ì„œë²„ì—ì„œ ê·¸ëŒ€ë¡œ í™œìš©í•  ìˆ˜ ìˆë‹¤!</p>
<hr>
<h2 id="ìœ„ì¹˜-ë³€í™˜-span--lsp-range"><a class="header" href="#ìœ„ì¹˜-ë³€í™˜-span--lsp-range">ìœ„ì¹˜ ë³€í™˜: Span â†’ LSP Range</a></h2>
<p><code>LexBuffer.FromString</code>ì„ ì‚¬ìš©í•˜ë©´ Spanì´ ì´ë¯¸ 0-basedì´ë¯€ë¡œ, ë³€í™˜ ì—†ì´ ì§ì ‘ ì‚¬ìš©í•œë‹¤.</p>
<h3 id="ë³€í™˜-ë¡œì§"><a class="header" href="#ë³€í™˜-ë¡œì§">ë³€í™˜ ë¡œì§</a></h3>
<pre><code class="language-fsharp">// Protocol.fs
module LangLSP.Server.Protocol

open Ionide.LanguageServerProtocol.Types
open Ast  // FunLang's Span type

/// Convert FunLang Span to LSP Range
/// LexBuffer.FromString creates 0-based positions, matching LSP
/// So no conversion needed
let spanToLspRange (span: Span) : Range =
    {
        Start = { Line = uint32 span.StartLine; Character = uint32 span.StartColumn }
        End = { Line = uint32 span.EndLine; Character = uint32 span.EndColumn }
    }
</code></pre>
<p><strong>í•µì‹¬ í¬ì¸íŠ¸:</strong></p>
<ol>
<li><code>LexBuffer.FromString</code>ì´ ìƒì„±í•˜ëŠ” Positionì€ 0-based (LSPì™€ ë™ì¼)</li>
<li>ë³„ë„ì˜ ë³€í™˜ì´ í•„ìš” ì—†ìŒ</li>
<li>FsLexYacc ë¬¸ì„œì— 1-basedë¼ê³  ë˜ì–´ ìˆì§€ë§Œ, <code>LexBuffer.FromString</code>ì€ ì‹¤ì œë¡œ 0-based</li>
</ol>
<h3 id="ë³€í™˜-ì˜ˆì‹œ"><a class="header" href="#ë³€í™˜-ì˜ˆì‹œ">ë³€í™˜ ì˜ˆì‹œ</a></h3>
<pre><code class="language-fsharp">// FunLang Span (0-based)
let span = { FileName = "test.fun"; StartLine = 2; StartColumn = 4; EndLine = 2; EndColumn = 9 }

// LSP Range (0-based) â€” ë™ì¼í•œ ê°’
let range = spanToLspRange span
// { Start = { Line = 2u; Character = 4u }; End = { Line = 2u; Character = 9u } }
</code></pre>
<h3 id="funlang-diagnostic--lsp-diagnostic"><a class="header" href="#funlang-diagnostic--lsp-diagnostic">FunLang Diagnostic â†’ LSP Diagnostic</a></h3>
<pre><code class="language-fsharp">/// Convert FunLang Diagnostic to LSP Diagnostic
let diagnosticToLsp (diag: Diagnostic.Diagnostic) : Diagnostic =
    {
        Range = spanToLspRange diag.PrimarySpan
        Severity = Some DiagnosticSeverity.Error
        Code = None  // Will be enhanced later with error codes
        CodeDescription = None
        Source = Some "funlang"
        Message = diag.Message
        Tags = None
        RelatedInformation =
            if List.isEmpty diag.SecondarySpans then None
            else
                diag.SecondarySpans
                |&gt; List.map (fun (span, label) -&gt;
                    {
                        Location = {
                            Uri = span.FileName  // Will need URI conversion later
                            Range = spanToLspRange span
                        }
                        Message = label
                    })
                |&gt; Array.ofList
                |&gt; Some
        Data = None
    }
</code></pre>
<p><strong>RelatedInformation í™œìš©:</strong></p>
<ul>
<li>FunLangì˜ <code>SecondarySpans</code>ë¥¼ LSPì˜ <code>RelatedInformation</code>ìœ¼ë¡œ ë§¤í•‘</li>
<li>ì—ë””í„°ì—ì„œ â€œê´€ë ¨ ìœ„ì¹˜ ë³´ê¸°â€ ê¸°ëŠ¥ ì œê³µ</li>
</ul>
<hr>
<h2 id="ë¬¸ë²•-ì˜¤ë¥˜-ì²˜ë¦¬"><a class="header" href="#ë¬¸ë²•-ì˜¤ë¥˜-ì²˜ë¦¬">ë¬¸ë²• ì˜¤ë¥˜ ì²˜ë¦¬</a></h2>
<p>íŒŒì‹± ë‹¨ê³„ì—ì„œ ë°œìƒí•˜ëŠ” ë¬¸ë²• ì˜¤ë¥˜ë¥¼ ì²˜ë¦¬í•œë‹¤.</p>
<h3 id="íŒŒì‹±-ë¡œì§"><a class="header" href="#íŒŒì‹±-ë¡œì§">íŒŒì‹± ë¡œì§</a></h3>
<pre><code class="language-fsharp">// Diagnostics.fs
module LangLSP.Server.Diagnostics

open System
open FSharp.Text.Lexing
open Ionide.LanguageServerProtocol
open Ionide.LanguageServerProtocol.Types
open LangLSP.Server.Protocol

/// Parse FunLang source code and catch syntax errors
/// Returns Ok(ast) on success, Error(diagnostic) on parse error
let parseFunLang (source: string) (uri: string) : Result&lt;Ast.Expr, Diagnostic&gt; =
    try
        let lexbuf = LexBuffer&lt;char&gt;.FromString(source)
        let ast = Parser.start Lexer.tokenize lexbuf
        Ok ast
    with
    | ex -&gt;
        // Parse error - create a diagnostic
        // fsyacc exceptions contain position info in the message
        let message =
            if ex.Message.Contains("parse error") then
                "Syntax error: " + ex.Message
            else
                "Parse error: " + ex.Message

        // Create a span from lexbuf position (0-based)
        let startPos = lexbuf.StartPos
        let endPos = lexbuf.EndPos
        let span : Ast.Span = {
            FileName = uri
            StartLine = startPos.Line
            StartColumn = startPos.Column
            EndLine = endPos.Line
            EndColumn = endPos.Column
        }

        let diag: Diagnostic = {
            Range = spanToLspRange span
            Severity = Some DiagnosticSeverity.Error
            Code = None
            CodeDescription = None
            Source = Some "funlang"
            Message = message
            Tags = None
            RelatedInformation = None
            Data = None
        }
        Error diag
</code></pre>
<p><strong>í•µì‹¬ í¬ì¸íŠ¸:</strong></p>
<ul>
<li><strong>try-catch</strong>: fsyacc íŒŒì„œëŠ” ì˜ˆì™¸ë¥¼ ë˜ì§€ë¯€ë¡œ catch í•„ìš”</li>
<li><strong>lexbuf ìœ„ì¹˜ ì‚¬ìš©</strong>: íŒŒì‹± ì‹¤íŒ¨ ì‹œ <code>lexbuf.StartPos</code>/<code>EndPos</code>ì—ì„œ ì—ëŸ¬ ìœ„ì¹˜ ì¶”ì¶œ (0-based)</li>
<li><strong>Error ë°˜í™˜</strong>: <code>Result&lt;Ast.Expr, Diagnostic&gt;</code> íƒ€ì…ìœ¼ë¡œ íŒŒì‹± ì‹¤íŒ¨ ì „ë‹¬</li>
</ul>
<h3 id="ë¬¸ë²•-ì˜¤ë¥˜-ì˜ˆì‹œ"><a class="header" href="#ë¬¸ë²•-ì˜¤ë¥˜-ì˜ˆì‹œ">ë¬¸ë²• ì˜¤ë¥˜ ì˜ˆì‹œ</a></h3>
<pre><code class="language-fsharp">// ì…ë ¥: "let x = "  (incomplete let expression)
let source = "let x = "
let result = parseFunLang source "file:///test.fun"

// ê²°ê³¼:
// Error { Range = { Start = (0, 0), End = (0, 0) }; Message = "Syntax error: ..." }
</code></pre>
<hr>
<h2 id="íƒ€ì…-ì˜¤ë¥˜-ì²˜ë¦¬"><a class="header" href="#íƒ€ì…-ì˜¤ë¥˜-ì²˜ë¦¬">íƒ€ì… ì˜¤ë¥˜ ì²˜ë¦¬</a></h2>
<p>ASTë¥¼ íŒŒì‹±í•œ í›„ íƒ€ì… ì²´í‚¹ì„ ìˆ˜í–‰í•œë‹¤.</p>
<h3 id="íƒ€ì…-ì²´í‚¹-ë¡œì§"><a class="header" href="#íƒ€ì…-ì²´í‚¹-ë¡œì§">íƒ€ì… ì²´í‚¹ ë¡œì§</a></h3>
<pre><code class="language-fsharp">/// Type check AST using FunLang's type checker
/// Returns Ok(type) on success, Error(diagnostic) on type error
let typecheckAst (ast: Ast.Expr) : Result&lt;Type.Type, Diagnostic&gt; =
    match TypeCheck.typecheckWithDiagnostic ast with
    | Ok ty -&gt; Ok ty
    | Error funlangDiag -&gt;
        // Convert FunLang diagnostic to LSP diagnostic
        let lspDiag = diagnosticToLsp funlangDiag
        Error lspDiag
</code></pre>
<p><strong>ë™ì‘:</strong></p>
<ol>
<li>FunLangì˜ <code>typecheckWithDiagnostic</code> í˜¸ì¶œ</li>
<li>ì„±ê³µ ì‹œ íƒ€ì… ë°˜í™˜, ì‹¤íŒ¨ ì‹œ FunLang Diagnostic ë°˜í™˜</li>
<li><code>diagnosticToLsp</code>ë¡œ LSP í˜•ì‹ìœ¼ë¡œ ë³€í™˜</li>
</ol>
<h3 id="íƒ€ì…-ì˜¤ë¥˜-ì˜ˆì‹œ"><a class="header" href="#íƒ€ì…-ì˜¤ë¥˜-ì˜ˆì‹œ">íƒ€ì… ì˜¤ë¥˜ ì˜ˆì‹œ</a></h3>
<pre><code class="language-fsharp">// ì…ë ¥: "1 + true"  (type mismatch: int + bool)
let source = "1 + true"
let result = parseFunLang source "file:///test.fun"

match result with
| Ok ast -&gt;
    match typecheckAst ast with
    | Ok ty -&gt; printfn "Type: %A" ty
    | Error diag -&gt;
        // diag.Message = "Type mismatch: expected int but got bool"
        printfn "Type error: %s" diag.Message
| Error parseDiag -&gt;
    printfn "Parse error: %s" parseDiag.Message
</code></pre>
<h3 id="funlangì˜-í’ë¶€í•œ-íƒ€ì…-ì—ëŸ¬"><a class="header" href="#funlangì˜-í’ë¶€í•œ-íƒ€ì…-ì—ëŸ¬">FunLangì˜ í’ë¶€í•œ íƒ€ì… ì—ëŸ¬</a></h3>
<p>FunLangì˜ Diagnostic ì‹œìŠ¤í…œì€ ë‹¤ìŒì„ ì œê³µí•œë‹¤:</p>
<ol>
<li><strong>PrimarySpan</strong>: ì£¼ ì—ëŸ¬ ìœ„ì¹˜</li>
<li><strong>SecondarySpans</strong>: ê´€ë ¨ ìœ„ì¹˜ (ì˜ˆ: íƒ€ì… annotationì´ ìˆëŠ” ê³³)</li>
<li><strong>Notes</strong>: ì»¨í…ìŠ¤íŠ¸ ìŠ¤íƒ (ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ë¡œ)</li>
<li><strong>Hint</strong>: ìˆ˜ì • ì œì•ˆ</li>
</ol>
<p><strong>ì˜ˆì‹œ:</strong></p>
<pre><code>error[E0301]: Type mismatch: expected int but got bool
 --&gt; test.fun:1:5
   = in function position: test.fun:1:1
   = note: in if condition at test.fun:1:4
   = hint: Check that all branches of your expression return the same type
</code></pre>
<p>ì´ ëª¨ë“  ì •ë³´ê°€ LSP Diagnosticì˜ <code>Message</code>ì™€ <code>RelatedInformation</code>ìœ¼ë¡œ ë³€í™˜ëœë‹¤!</p>
<hr>
<h2 id="publishdiagnostics-í˜¸ì¶œ"><a class="header" href="#publishdiagnostics-í˜¸ì¶œ">publishDiagnostics í˜¸ì¶œ</a></h2>
<p>ì „ì²´ ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•œë‹¤.</p>
<h3 id="analyze-í•¨ìˆ˜"><a class="header" href="#analyze-í•¨ìˆ˜">analyze í•¨ìˆ˜</a></h3>
<pre><code class="language-fsharp">/// Analyze document and return all diagnostics
/// Returns list of diagnostics (empty if no errors)
let analyze (uri: string) (source: string) : Diagnostic list =
    match parseFunLang source uri with
    | Error parseDiag -&gt;
        // Parse error - stop here, don't try to typecheck
        [parseDiag]
    | Ok ast -&gt;
        // Parse succeeded, now typecheck
        match typecheckAst ast with
        | Ok _ -&gt;
            // No errors
            []
        | Error typeDiag -&gt;
            // Type error
            [typeDiag]
</code></pre>
<p><strong>íŒŒì´í”„ë¼ì¸:</strong></p>
<ol>
<li>íŒŒì‹± ì‹œë„
<ul>
<li>ì‹¤íŒ¨ â†’ íŒŒì‹± ì—ëŸ¬ ë°˜í™˜, íƒ€ì… ì²´í‚¹ ìŠ¤í‚µ</li>
<li>ì„±ê³µ â†’ íƒ€ì… ì²´í‚¹ ì§„í–‰</li>
</ul>
</li>
<li>íƒ€ì… ì²´í‚¹ ì‹œë„
<ul>
<li>ì„±ê³µ â†’ ë¹ˆ ë¦¬ìŠ¤íŠ¸ (ì—ëŸ¬ ì—†ìŒ)</li>
<li>ì‹¤íŒ¨ â†’ íƒ€ì… ì—ëŸ¬ ë°˜í™˜</li>
</ul>
</li>
</ol>
<h3 id="publishdiagnostics-í•¨ìˆ˜"><a class="header" href="#publishdiagnostics-í•¨ìˆ˜">publishDiagnostics í•¨ìˆ˜</a></h3>
<pre><code class="language-fsharp">/// Publish diagnostics to client
let publishDiagnostics (lspClient: ILspClient) (uri: string) (diagnostics: Diagnostic list) : Async&lt;unit&gt; =
    async {
        let publishParams: PublishDiagnosticsParams = {
            Uri = uri
            Diagnostics = Array.ofList diagnostics
            Version = None
        }
        do! lspClient.TextDocumentPublishDiagnostics publishParams
    }
</code></pre>
<p><strong>ì‚¬ìš© ì˜ˆì‹œ:</strong></p>
<pre><code class="language-fsharp">// DocumentSyncì—ì„œ didChange ì´í›„ í˜¸ì¶œ
let handleDidChangeWithDiagnostics (lspClient: ILspClient) (p: DidChangeTextDocumentParams) : Async&lt;unit&gt; =
    async {
        // 1. ë¬¸ì„œ ë™ê¸°í™”
        DocumentSync.handleDidChange p

        // 2. ì—…ë°ì´íŠ¸ëœ í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
        match DocumentSync.getDocument p.TextDocument.Uri with
        | Some source -&gt;
            // 3. ë¶„ì„ ë° ì§„ë‹¨ ë°œí–‰
            let diagnostics = Diagnostics.analyze p.TextDocument.Uri source
            do! Diagnostics.publishDiagnostics lspClient p.TextDocument.Uri diagnostics
        | None -&gt;
            // ë¬¸ì„œê°€ ì¶”ì ë˜ì§€ ì•ŠìŒ (ì˜¤ë¥˜ ìƒí™©)
            ()
    }
</code></pre>
<hr>
<h2 id="ì§„ë‹¨-í´ë¦¬ì–´"><a class="header" href="#ì§„ë‹¨-í´ë¦¬ì–´">ì§„ë‹¨ í´ë¦¬ì–´</a></h2>
<p>ë¬¸ì„œë¥¼ ë‹«ê±°ë‚˜ ì—ëŸ¬ê°€ ìˆ˜ì •ë˜ì—ˆì„ ë•Œ ì§„ë‹¨ì„ í´ë¦¬ì–´í•´ì•¼ í•œë‹¤.</p>
<h3 id="cleardiagnostics-í•¨ìˆ˜"><a class="header" href="#cleardiagnostics-í•¨ìˆ˜">clearDiagnostics í•¨ìˆ˜</a></h3>
<pre><code class="language-fsharp">/// Clear diagnostics for a document
let clearDiagnostics (lspClient: ILspClient) (uri: string) : Async&lt;unit&gt; =
    publishDiagnostics lspClient uri []
</code></pre>
<p><strong>í•µì‹¬ ì•„ì´ë””ì–´:</strong> ë¹ˆ ì§„ë‹¨ ë°°ì—´ì„ ë°œí–‰í•˜ë©´ ê¸°ì¡´ ì§„ë‹¨ì´ ëª¨ë‘ ì œê±°ëœë‹¤.</p>
<h3 id="ì‚¬ìš©-ì‹œë‚˜ë¦¬ì˜¤"><a class="header" href="#ì‚¬ìš©-ì‹œë‚˜ë¦¬ì˜¤">ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤</a></h3>
<ol>
<li>
<p><strong>íŒŒì¼ ë‹«ê¸°:</strong></p>
<pre><code class="language-fsharp">let handleDidCloseWithDiagnostics (lspClient: ILspClient) (p: DidCloseTextDocumentParams) : Async&lt;unit&gt; =
    async {
        DocumentSync.handleDidClose p
        do! Diagnostics.clearDiagnostics lspClient p.TextDocument.Uri
    }
</code></pre>
</li>
<li>
<p><strong>ì—ëŸ¬ ìˆ˜ì •:</strong></p>
<pre><code class="language-fsharp">// ì‚¬ìš©ìê°€ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì—¬ ì—ëŸ¬ê°€ ì—†ì–´ì§€ë©´ analyze í•¨ìˆ˜ê°€ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
let diagnostics = analyze uri source  // []
do! publishDiagnostics lspClient uri diagnostics  // ì§„ë‹¨ í´ë¦¬ì–´
</code></pre>
</li>
</ol>
<hr>
<h2 id="í…ŒìŠ¤íŠ¸-ì‘ì„±-1"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‘ì„±-1">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></h2>
<p>Expectoì™€ FsCheckë¥¼ í™œìš©í•˜ì—¬ ì§„ë‹¨ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•œë‹¤.</p>
<h3 id="ê¸°ë³¸-í…ŒìŠ¤íŠ¸"><a class="header" href="#ê¸°ë³¸-í…ŒìŠ¤íŠ¸">ê¸°ë³¸ í…ŒìŠ¤íŠ¸</a></h3>
<pre><code class="language-fsharp">// DiagnosticsTests.fs
module LangLSP.Tests.DiagnosticsTests

open Expecto
open LangLSP.Server.Diagnostics
open Ionide.LanguageServerProtocol.Types

[&lt;Tests&gt;]
let diagnosticsTests =
    testList "Diagnostics" [

        testCase "valid code produces no diagnostics" &lt;| fun _ -&gt;
            let source = "1 + 2"
            let uri = "file:///test.fun"
            let diagnostics = analyze uri source
            Expect.isEmpty diagnostics "Valid code should produce no diagnostics"

        testCase "syntax error produces diagnostic" &lt;| fun _ -&gt;
            let source = "let x = "  // incomplete let expression
            let uri = "file:///test.fun"
            let diagnostics = analyze uri source
            Expect.isNonEmpty diagnostics "Syntax error should produce diagnostic"
            let diag = diagnostics.[0]
            Expect.equal diag.Source (Some "funlang") "Source should be 'funlang'"
            Expect.equal diag.Severity (Some DiagnosticSeverity.Error) "Severity should be Error"
            Expect.stringContains (diag.Message.ToLower()) "error" "Message should mention error"

        testCase "type error produces diagnostic (Int + Bool)" &lt;| fun _ -&gt;
            let source = "1 + true"  // type mismatch: int + bool
            let uri = "file:///test.fun"
            let diagnostics = analyze uri source
            Expect.isNonEmpty diagnostics "Type error should produce diagnostic"
            let diag = diagnostics.[0]
            Expect.equal diag.Source (Some "funlang") "Source should be 'funlang'"
            Expect.equal diag.Severity (Some DiagnosticSeverity.Error) "Severity should be Error"
            // Type checker should mention type mismatch
            Expect.isTrue (diag.Message.Contains("type") || diag.Message.Contains("Type"))
                "Message should mention type"

        testCase "unbound variable produces diagnostic" &lt;| fun _ -&gt;
            let source = "x + 1"  // x is not defined
            let uri = "file:///test.fun"
            let diagnostics = analyze uri source
            Expect.isNonEmpty diagnostics "Unbound variable should produce diagnostic"
            let diag = diagnostics.[0]
            Expect.equal diag.Source (Some "funlang") "Source should be 'funlang'"
            Expect.equal diag.Severity (Some DiagnosticSeverity.Error) "Severity should be Error"
            Expect.isTrue (diag.Message.Contains("Unbound") || diag.Message.Contains("unbound"))
                "Message should mention unbound variable"
    ]
</code></pre>
<h3 id="protocol-ë³€í™˜-í…ŒìŠ¤íŠ¸-fscheck"><a class="header" href="#protocol-ë³€í™˜-í…ŒìŠ¤íŠ¸-fscheck">Protocol ë³€í™˜ í…ŒìŠ¤íŠ¸ (FsCheck)</a></h3>
<pre><code class="language-fsharp">// ProtocolTests.fs
module LangLSP.Tests.ProtocolTests

open Expecto
open Expecto.ExpectoFsCheck
open FsCheck
open LangLSP.Server.Protocol

/// Generator for valid Span values
/// FunLang Span is 0-based (from LexBuffer.FromString), and start &lt;= end
let validSpanGen : Gen&lt;Ast.Span&gt; =
    gen {
        let! startLine = Gen.choose(0, 999)
        let! startColumn = Gen.choose(0, 199)
        let! endLine = Gen.choose(startLine, 999)
        // If on same line, endColumn &gt;= startColumn
        // If on different line, endColumn can be anything
        let! endColumn =
            if endLine = startLine then
                Gen.choose(startColumn, 200)
            else
                Gen.choose(0, 200)

        let span : Ast.Span = {
            FileName = "test.fun"
            StartLine = startLine
            StartColumn = startColumn
            EndLine = endLine
            EndColumn = endColumn
        }
        return span
    }

/// Arbitrary instance for valid Spans
type ValidSpanArbitrary =
    static member Span() = Arb.fromGen validSpanGen

[&lt;Tests&gt;]
let protocolTests =
    // Configure FsCheck to run 500 test cases
    let fsCheckConfig = { FsCheckConfig.defaultConfig with maxTest = 500; arbitrary = [typeof&lt;ValidSpanArbitrary&gt;] }

    testList "Protocol" [

        testPropertyWithConfig fsCheckConfig "spanToLspRange preserves 0-based values" &lt;| fun (span: Ast.Span) -&gt;
            let range = spanToLspRange span
            // Both FunLang (LexBuffer.FromString) and LSP are 0-based
            // Values should be passed through directly
            Expect.equal range.Start.Line (uint32 span.StartLine) "Start line should match"
            Expect.equal range.Start.Character (uint32 span.StartColumn) "Start char should match"
            Expect.equal range.End.Line (uint32 span.EndLine) "End line should match"
            Expect.equal range.End.Character (uint32 span.EndColumn) "End char should match"

        testPropertyWithConfig fsCheckConfig "spanToLspRange preserves line ordering" &lt;| fun (span: Ast.Span) -&gt;
            let range = spanToLspRange span
            // If start line &lt;= end line in source, it should remain so in LSP
            Expect.isLessThanOrEqual range.Start.Line range.End.Line "Start line should be &lt;= end line"

        testPropertyWithConfig fsCheckConfig "spanToLspRange same line preserves character ordering" &lt;| fun (span: Ast.Span) -&gt;
            let range = spanToLspRange span
            // If on same line, start character &lt;= end character
            if range.Start.Line = range.End.Line then
                Expect.isLessThanOrEqual range.Start.Character range.End.Character
                    "On same line, start char should be &lt;= end char"

        testCase "spanToLspRange edge case: invalid (0,0) span clamped" &lt;| fun _ -&gt;
            let span : Ast.Span = {
                FileName = "test.fun"
                StartLine = 0
                StartColumn = 0
                EndLine = 0
                EndColumn = 0
            }
            let range = spanToLspRange span
            // Invalid (0,0) span should be clamped to (0,0) instead of wrapping to uint.MaxValue
            Expect.equal range.Start.Line 0u "Invalid span start line should clamp to 0"
            Expect.equal range.Start.Character 0u "Invalid span start char should clamp to 0"
            Expect.equal range.End.Line 0u "Invalid span end line should clamp to 0"
            Expect.equal range.End.Character 0u "Invalid span end char should clamp to 0"
    ]
</code></pre>
<p><strong>FsCheck í™œìš© í¬ì¸íŠ¸:</strong></p>
<ul>
<li><strong>Property-based Testing</strong>: 500ê°œì˜ ëœë¤ Spanì„ ìƒì„±í•˜ì—¬ ë³€í™˜ í•¨ìˆ˜ ê²€ì¦</li>
<li><strong>ë¶ˆë³€ì‹(Invariants)</strong> ê²€ì¦:
<ol>
<li>1-based â†’ 0-based ë³€í™˜ ì •í™•ì„±</li>
<li>ì¤„ ìˆœì„œ ë³´ì¡´ (startLine â‰¤ endLine)</li>
<li>ê°™ì€ ì¤„ì—ì„œ ë¬¸ì ìˆœì„œ ë³´ì¡´</li>
<li>Edge case: (0,0) span clamp ì²˜ë¦¬</li>
</ol>
</li>
</ul>
<h3 id="í…ŒìŠ¤íŠ¸-ì‹¤í–‰-1"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‹¤í–‰-1">í…ŒìŠ¤íŠ¸ ì‹¤í–‰</a></h3>
<pre><code class="language-bash">dotnet run --project src/LangLSP.Tests

# ì¶œë ¥:
# [Diagnostics] valid code produces no diagnostics - Passed
# [Diagnostics] syntax error produces diagnostic - Passed
# [Diagnostics] type error produces diagnostic (Int + Bool) - Passed
# [Diagnostics] unbound variable produces diagnostic - Passed
# [Protocol] spanToLspRange converts to 0-based (500 test cases) - Passed
# [Protocol] spanToLspRange preserves line ordering (500 test cases) - Passed
# [Protocol] spanToLspRange same line preserves character ordering (500 test cases) - Passed
# [Protocol] spanToLspRange edge case: invalid (0,0) span clamped - Passed
</code></pre>
<hr>
<h2 id="ë‹¤ìŒ-ë‹¨ê³„-4"><a class="header" href="#ë‹¤ìŒ-ë‹¨ê³„-4">ë‹¤ìŒ ë‹¨ê³„</a></h2>
<p>ì§„ë‹¨ ì‹œìŠ¤í…œì´ ì™„ë£Œë˜ì—ˆìœ¼ë¯€ë¡œ, ì´ì œ ì‚¬ìš©ìëŠ” ì—ë””í„°ì—ì„œ ì‹¤ì‹œê°„ ì—ëŸ¬ í”¼ë“œë°±ì„ ë°›ì„ ìˆ˜ ìˆë‹¤!</p>
<p><strong>Phase 1 ì™„ë£Œ!</strong> ë‹¤ìŒ Phaseì—ì„œëŠ” ë” ê³ ê¸‰ ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤:</p>
<h3 id="phase-2---lsp-ê¸°ëŠ¥-í™•ì¥"><a class="header" href="#phase-2---lsp-ê¸°ëŠ¥-í™•ì¥">Phase 2 - LSP ê¸°ëŠ¥ í™•ì¥</a></h3>
<ol>
<li><strong>Hover</strong>: ì»¤ì„œ ìœ„ì¹˜ì˜ íƒ€ì… ì •ë³´ í‘œì‹œ</li>
<li><strong>Completion</strong>: ìë™ì™„ì„± ì œì•ˆ</li>
<li><strong>Go to Definition</strong>: ì •ì˜ë¡œ ì´ë™</li>
<li><strong>Find References</strong>: ì°¸ì¡° ì°¾ê¸°</li>
<li><strong>Rename</strong>: ì‹¬ë³¼ ì´ë¦„ ë³€ê²½</li>
<li><strong>Code Actions</strong>: ë¹ ë¥¸ ìˆ˜ì • ì œì•ˆ</li>
</ol>
<h3 id="vs-code-í™•ì¥-ë°°í¬"><a class="header" href="#vs-code-í™•ì¥-ë°°í¬">VS Code í™•ì¥ ë°°í¬</a></h3>
<ul>
<li><code>vsce package</code>ë¡œ <code>.vsix</code> íŒŒì¼ ìƒì„±</li>
<li>VS Code Marketplaceì— ë°°í¬</li>
<li>ì‚¬ìš©ìê°€ ì—ë””í„°ì—ì„œ ë°”ë¡œ ì„¤ì¹˜ ê°€ëŠ¥</li>
</ul>
<hr>
<h2 id="ì°¸ê³ -ìë£Œ-4"><a class="header" href="#ì°¸ê³ -ìë£Œ-4">ì°¸ê³  ìë£Œ</a></h2>
<ul>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#diagnostic">LSP Specification - Diagnostics</a></li>
<li><a href="https://github.com/kodu-ai/LangTutorial/blob/main/FunLang/Diagnostic.fs">FunLang Diagnostic ì‹œìŠ¤í…œ</a></li>
<li><a href="https://github.com/haf/expecto">Expecto ë¬¸ì„œ</a></li>
<li><a href="https://fscheck.github.io/FsCheck/">FsCheck ë¬¸ì„œ</a></li>
</ul>
<hr>
<p><strong>â†’ ë‹¤ìŒ: Phase 2 - Hover êµ¬í˜„</strong> - íƒ€ì… ì •ë³´ í‘œì‹œ</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="hover-êµ¬í˜„í•˜ê¸°"><a class="header" href="#hover-êµ¬í˜„í•˜ê¸°">Hover êµ¬í˜„í•˜ê¸°</a></h1>
<p>ë§ˆìš°ìŠ¤ ì»¤ì„œë¥¼ ì½”ë“œ ìœ„ì— ì˜¬ë¦¬ë©´ íƒ€ì… ì •ë³´ë‚˜ ì„¤ëª…ì´ íŒì—…ìœ¼ë¡œ í‘œì‹œëœë‹¤. ì´ ê¸°ëŠ¥ì€ IDEì˜ í•µì‹¬ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ë¡œ, ì½”ë“œë¥¼ ì´í•´í•˜ëŠ” ë° í° ë„ì›€ì´ ëœë‹¤.</p>
<p>ì´ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” FunLang LSPì— Hover ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ë°°ìš´ë‹¤.</p>
<h2 id="ëª©ì°¨-5"><a class="header" href="#ëª©ì°¨-5">ëª©ì°¨</a></h2>
<ol>
<li><a href="#textdocumenthover-í”„ë¡œí† ì½œ">textDocument/hover í”„ë¡œí† ì½œ</a></li>
<li><a href="#êµ¬í˜„-ì „ëµ">êµ¬í˜„ ì „ëµ</a></li>
<li><a href="#ìœ„ì¹˜-ê¸°ë°˜-ast-ì¡°íšŒ">ìœ„ì¹˜ ê¸°ë°˜ AST ì¡°íšŒ</a></li>
<li><a href="#í‚¤ì›Œë“œ-hover">í‚¤ì›Œë“œ Hover</a></li>
<li><a href="#íƒ€ì…-hover">íƒ€ì… Hover</a></li>
<li><a href="#ì„œë²„-í†µí•©">ì„œë²„ í†µí•©</a></li>
<li><a href="#í…ŒìŠ¤íŠ¸-ì‘ì„±-2">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></li>
<li><a href="#í”í•œ-ì‹¤ìˆ˜ì™€-í•´ê²°ì±…">í”í•œ ì‹¤ìˆ˜ì™€ í•´ê²°ì±…</a></li>
</ol>
<hr>
<h2 id="textdocumenthover-í”„ë¡œí† ì½œ"><a class="header" href="#textdocumenthover-í”„ë¡œí† ì½œ">textDocument/hover í”„ë¡œí† ì½œ</a></h2>
<h3 id="ìš”ì²­-êµ¬ì¡°"><a class="header" href="#ìš”ì²­-êµ¬ì¡°">ìš”ì²­ êµ¬ì¡°</a></h3>
<p>í´ë¼ì´ì–¸íŠ¸(ì—ë””í„°)ê°€ ì„œë²„ì— hover ì •ë³´ë¥¼ ìš”ì²­í•  ë•Œ ì‚¬ìš©í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.</p>
<pre><code class="language-typescript">interface HoverParams {
    textDocument: TextDocumentIdentifier  // ë¬¸ì„œ URI
    position: Position                     // ì»¤ì„œ ìœ„ì¹˜ (0-based)
}

interface Position {
    line: number       // 0-based ì¤„ ë²ˆí˜¸
    character: number  // 0-based ë¬¸ì ìœ„ì¹˜
}
</code></pre>
<h3 id="ì‘ë‹µ-êµ¬ì¡°"><a class="header" href="#ì‘ë‹µ-êµ¬ì¡°">ì‘ë‹µ êµ¬ì¡°</a></h3>
<p>ì„œë²„ê°€ ë°˜í™˜í•˜ëŠ” hover ì •ë³´ì´ë‹¤.</p>
<pre><code class="language-typescript">interface Hover {
    contents: MarkupContent     // í‘œì‹œí•  ë‚´ìš©
    range?: Range               // í•˜ì´ë¼ì´íŠ¸í•  ë²”ìœ„ (ì„ íƒ)
}

interface MarkupContent {
    kind: "plaintext" | "markdown"  // ì½˜í…ì¸  ì¢…ë¥˜
    value: string                   // ì‹¤ì œ ë‚´ìš©
}
</code></pre>
<h3 id="vs-codeì—ì„œì˜-í‘œì‹œ-1"><a class="header" href="#vs-codeì—ì„œì˜-í‘œì‹œ-1">VS Codeì—ì„œì˜ í‘œì‹œ</a></h3>
<pre><code>test.fun
â”€â”€â”€â”€â”€â”€â”€â”€
let double = fun x -&gt; x * 2 in double 5
                               ~~~~~~
                        int -&gt; int
</code></pre>
<p>ì»¤ì„œë¥¼ <code>double</code>ì— ì˜¬ë¦¬ë©´:</p>
<ul>
<li><strong>í•˜ì´ë¼ì´íŠ¸</strong>: <code>range</code>ë¡œ ì§€ì •ëœ ì˜ì—­ì— ë°‘ì¤„ í‘œì‹œ</li>
<li><strong>íŒì—…</strong>: <code>contents</code>ì˜ ë‚´ìš©ì´ íˆ´íŒìœ¼ë¡œ í‘œì‹œ</li>
<li><strong>Markdown ì§€ì›</strong>: ì½”ë“œ ë¸”ë¡, ë³¼ë“œ, ì´íƒ¤ë¦­ ë“± í¬ë§·íŒ… ê°€ëŠ¥</li>
</ul>
<pre class="mermaid">sequenceDiagram
    participant C as Client
    participant S as Server
    C-&gt;&gt;S: textDocument/hover(uri, position)
    Note over S: ASTì—ì„œ ìœ„ì¹˜ ì¡°íšŒ â†’ íƒ€ì… ì •ë³´ ì¶”ì¶œ
    S-&gt;&gt;C: Hover(contents, range)
</pre>

<hr>
<h2 id="êµ¬í˜„-ì „ëµ"><a class="header" href="#êµ¬í˜„-ì „ëµ">êµ¬í˜„ ì „ëµ</a></h2>
<p>Hover ê¸°ëŠ¥ì€ ë‘ ê°€ì§€ë¥¼ ì œê³µí•œë‹¤:</p>
<ol>
<li><strong>í‚¤ì›Œë“œ Hover</strong>: <code>let</code>, <code>if</code>, <code>fun</code> ë“± í‚¤ì›Œë“œì— í•œêµ­ì–´ ì„¤ëª…</li>
<li><strong>íƒ€ì… Hover</strong>: ë³€ìˆ˜, í•¨ìˆ˜, í‘œí˜„ì‹ì— ì¶”ë¡ ëœ íƒ€ì… í‘œì‹œ</li>
</ol>
<h3 id="ì²˜ë¦¬-íë¦„"><a class="header" href="#ì²˜ë¦¬-íë¦„">ì²˜ë¦¬ íë¦„</a></h3>
<pre><code>HoverParams ìˆ˜ì‹ 
    â†“
ë¬¸ì„œ í…ìŠ¤íŠ¸ ì¡°íšŒ
    â†“
ì»¤ì„œ ìœ„ì¹˜ì˜ ë‹¨ì–´ í™•ì¸
    â†“ (í‚¤ì›Œë“œì¸ ê²½ìš°)
í‚¤ì›Œë“œ ì„¤ëª… ë°˜í™˜ â†â”€â”
    â†“ (ê·¸ ì™¸)      â”‚
AST íŒŒì‹±          â”‚
    â†“              â”‚
ìœ„ì¹˜ë¡œ ë…¸ë“œ ì°¾ê¸°    â”‚
    â†“              â”‚
ë…¸ë“œ íƒ€ì… ì¶”ë¡       â”‚
    â†“              â”‚
íƒ€ì… ì •ë³´ ë°˜í™˜     â”‚
</code></pre>
<h3 id="í‚¤ì›Œë“œ-ìš°ì„ -í™•ì¸"><a class="header" href="#í‚¤ì›Œë“œ-ìš°ì„ -í™•ì¸">í‚¤ì›Œë“œ ìš°ì„  í™•ì¸</a></h3>
<p><strong>ì¤‘ìš”:</strong> í‚¤ì›Œë“œëŠ” ASTì— í¬í•¨ë˜ì§€ ì•ŠëŠ”ë‹¤. <code>let x = 1 in x</code>ë¥¼ íŒŒì‹±í•˜ë©´:</p>
<ul>
<li>AST: <code>Let("x", Number(1), Var("x"))</code></li>
<li><code>let</code>, <code>in</code> í‚¤ì›Œë“œëŠ” AST ë…¸ë“œê°€ ì•„ë‹ˆë‹¤!</li>
</ul>
<p>ë”°ë¼ì„œ AST ì¡°íšŒ ì „ì— í‚¤ì›Œë“œ ì²´í¬ë¥¼ ë¨¼ì € í•´ì•¼ í•œë‹¤.</p>
<hr>
<h2 id="ìœ„ì¹˜-ê¸°ë°˜-ast-ì¡°íšŒ"><a class="header" href="#ìœ„ì¹˜-ê¸°ë°˜-ast-ì¡°íšŒ">ìœ„ì¹˜ ê¸°ë°˜ AST ì¡°íšŒ</a></h2>
<p>ì»¤ì„œ ìœ„ì¹˜ì— í•´ë‹¹í•˜ëŠ” AST ë…¸ë“œë¥¼ ì°¾ëŠ” ëª¨ë“ˆì´ë‹¤.</p>
<h3 id="astlookup-ëª¨ë“ˆ"><a class="header" href="#astlookup-ëª¨ë“ˆ">AstLookup ëª¨ë“ˆ</a></h3>
<pre><code class="language-fsharp">// AstLookup.fs
module LangLSP.Server.AstLookup

open Ast
open Ionide.LanguageServerProtocol.Types

/// LSP Position(0-based)ì´ FunLang Span ë‚´ì— ìˆëŠ”ì§€ í™•ì¸
let positionInSpan (lspPos: Position) (span: Span) : bool =
    // LSPì™€ FunLang ëª¨ë‘ 0-based ì‚¬ìš© (LexBuffer.FromString ê¸°ë³¸ê°’)
    let line = int lspPos.Line
    let col = int lspPos.Character

    // ë²”ìœ„ í™•ì¸
    if line &lt; span.StartLine || line &gt; span.EndLine then
        false
    elif line = span.StartLine &amp;&amp; line = span.EndLine then
        // ë‹¨ì¼ ë¼ì¸ span
        col &gt;= span.StartColumn &amp;&amp; col &lt;= span.EndColumn
    elif line = span.StartLine then
        // ì‹œì‘ ë¼ì¸ì— ìˆìŒ
        col &gt;= span.StartColumn
    elif line = span.EndLine then
        // ë ë¼ì¸ì— ìˆìŒ
        col &lt;= span.EndColumn
    else
        // ì¤‘ê°„ ë¼ì¸ì— ìˆìŒ
        true
</code></pre>
<h3 id="ì¢Œí‘œê³„-ì´í•´í•˜ê¸°"><a class="header" href="#ì¢Œí‘œê³„-ì´í•´í•˜ê¸°">ì¢Œí‘œê³„ ì´í•´í•˜ê¸°</a></h3>
<p><strong>FunLangì˜ íŠ¹ìˆ˜ ìƒí™©:</strong></p>
<p>FsLexYacc ë¬¸ì„œì—ëŠ” Positionì´ 1-basedë¼ê³  ë˜ì–´ ìˆì§€ë§Œ, <code>LexBuffer.FromString</code>ìœ¼ë¡œ ìƒì„±í•˜ë©´ ì‹¤ì œë¡œëŠ” <strong>0-based</strong>ì´ë‹¤!</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>í•­ëª©</th><th>LSP</th><th>FunLang (LexBuffer.FromString)</th></tr>
</thead>
<tbody>
<tr><td>ì²« ë²ˆì§¸ ì¤„</td><td>0</td><td>0</td></tr>
<tr><td>ì²« ë²ˆì§¸ ì—´</td><td>0</td><td>0</td></tr>
</tbody>
</table>
</div>
<p>ë”°ë¼ì„œ FunLang LSPì—ì„œëŠ” <strong>ì¢Œí‘œ ë³€í™˜ì´ í•„ìš” ì—†ë‹¤</strong>.</p>
<pre><code class="language-fsharp">// Protocol.fs - ë³€í™˜ ì—†ì´ ì§ì ‘ ì‚¬ìš©
let spanToLspRange (span: Span) : Range =
    {
        Start = { Line = uint32 span.StartLine; Character = uint32 span.StartColumn }
        End = { Line = uint32 span.EndLine; Character = uint32 span.EndColumn }
    }
</code></pre>
<h3 id="ê°€ì¥-ì•ˆìª½-ë…¸ë“œ-ì°¾ê¸°"><a class="header" href="#ê°€ì¥-ì•ˆìª½-ë…¸ë“œ-ì°¾ê¸°">ê°€ì¥ ì•ˆìª½ ë…¸ë“œ ì°¾ê¸°</a></h3>
<p>ASTëŠ” ì¤‘ì²© êµ¬ì¡°ì´ë‹¤. ì»¤ì„œ ìœ„ì¹˜ì— ì—¬ëŸ¬ ë…¸ë“œê°€ ê²¹ì¹  ìˆ˜ ìˆë‹¤.</p>
<pre><code>let f = fun x -&gt; x + 1 in f 5
              ~~~~~~~ (x + 1) - Add ë…¸ë“œ
                    ~ (1) - Number ë…¸ë“œ
</code></pre>
<p><strong>innermost(ê°€ì¥ ì•ˆìª½) ë…¸ë“œ</strong>ë¥¼ ë°˜í™˜í•´ì•¼ í•œë‹¤.</p>
<pre><code class="language-fsharp">/// ì£¼ì–´ì§„ LSP ìœ„ì¹˜ë¥¼ í¬í•¨í•˜ëŠ” ê°€ì¥ ì•ˆìª½ AST ë…¸ë“œ ì°¾ê¸°
let rec findNodeAtPosition (lspPos: Position) (expr: Expr) : Expr option =
    let span = spanOf expr

    if not (positionInSpan lspPos span) then
        None
    else
        // í˜„ì¬ ë…¸ë“œ ì•ˆì— ìˆìŒ - ìì‹ ë…¸ë“œì—ì„œ ë” êµ¬ì²´ì ì¸ ë§¤ì¹­ ì°¾ê¸°
        let childMatch =
            match expr with
            // ì´í•­ ì—°ì‚°ì
            | Add(left, right, _)
            | Subtract(left, right, _)
            | App(left, right, _) -&gt;
                match findNodeAtPosition lspPos left with
                | Some node -&gt; Some node
                | None -&gt; findNodeAtPosition lspPos right

            // Let ë°”ì¸ë”©
            | Let(_, bindExpr, bodyExpr, _) -&gt;
                match findNodeAtPosition lspPos bindExpr with
                | Some node -&gt; Some node
                | None -&gt; findNodeAtPosition lspPos bodyExpr

            // ëŒë‹¤
            | Lambda(_, body, _) -&gt;
                findNodeAtPosition lspPos body

            // ë¦¬í”„ ë…¸ë“œ - ìì‹ ì—†ìŒ
            | Number _ | Bool _ | Var _ -&gt; None

            // ... ë‹¤ë¥¸ ë…¸ë“œ íƒ€ì…ë“¤

        // ìì‹ ë§¤ì¹­ì´ ìˆìœ¼ë©´ ë°˜í™˜, ì—†ìœ¼ë©´ í˜„ì¬ ë…¸ë“œ ë°˜í™˜
        match childMatch with
        | Some node -&gt; Some node
        | None -&gt; Some expr
</code></pre>
<p><strong>í•µì‹¬ ì›ë¦¬:</strong></p>
<ol>
<li>í˜„ì¬ ë…¸ë“œê°€ ìœ„ì¹˜ë¥¼ í¬í•¨í•˜ëŠ”ì§€ í™•ì¸</li>
<li>í¬í•¨í•˜ë©´ ìì‹ ë…¸ë“œë“¤ì„ ì¬ê·€ì ìœ¼ë¡œ í™•ì¸</li>
<li>ìì‹ ì¤‘ ë§¤ì¹­ì´ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ë°˜í™˜</li>
<li>ì—†ìœ¼ë©´ í˜„ì¬ ë…¸ë“œê°€ ê°€ì¥ êµ¬ì²´ì ì¸ ë§¤ì¹­</li>
</ol>
<hr>
<h2 id="í‚¤ì›Œë“œ-hover"><a class="header" href="#í‚¤ì›Œë“œ-hover">í‚¤ì›Œë“œ Hover</a></h2>
<h3 id="í‚¤ì›Œë“œ-ì„¤ëª…-ë§µ"><a class="header" href="#í‚¤ì›Œë“œ-ì„¤ëª…-ë§µ">í‚¤ì›Œë“œ ì„¤ëª… ë§µ</a></h3>
<p>FunLangì˜ í‚¤ì›Œë“œì— ëŒ€í•œ í•œêµ­ì–´ ì„¤ëª…ì´ë‹¤.</p>
<pre><code class="language-fsharp">// Hover.fs
module LangLSP.Server.Hover

/// FunLang í‚¤ì›Œë“œì— ëŒ€í•œ í•œêµ­ì–´ ì„¤ëª…
let keywordExplanations = Map.ofList [
    ("let", "ë³€ìˆ˜ ë˜ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.\nì˜ˆ: `let x = 5`")
    ("in", "let ë°”ì¸ë”©ì˜ ë²”ìœ„ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.\nì˜ˆ: `let x = 1 in x + 2`")
    ("if", "ì¡°ê±´ ë¶„ê¸°ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.\nì˜ˆ: `if x &gt; 0 then 1 else -1`")
    ("then", "ifì˜ ì°¸ ë¶„ê¸°ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.")
    ("else", "ifì˜ ê±°ì§“ ë¶„ê¸°ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.")
    ("match", "íŒ¨í„´ ë§¤ì¹­ì„ ì‹œì‘í•©ë‹ˆë‹¤.\nì˜ˆ: `match xs with | [] -&gt; 0 | h::t -&gt; h`")
    ("with", "matchì˜ íŒ¨í„´ ì ˆì„ ì‹œì‘í•©ë‹ˆë‹¤.")
    ("fun", "ìµëª… í•¨ìˆ˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.\nì˜ˆ: `fun x -&gt; x + 1`")
    ("rec", "ì¬ê·€ í•¨ìˆ˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.\nì˜ˆ: `let rec sum n = if n = 0 then 0 else n + sum (n-1)`")
    ("true", "ë¶ˆë¦¬ì–¸ ì°¸ ê°’ì…ë‹ˆë‹¤.")
    ("false", "ë¶ˆë¦¬ì–¸ ê±°ì§“ ê°’ì…ë‹ˆë‹¤.")
]
</code></pre>
<h3 id="ì»¤ì„œ-ìœ„ì¹˜ì˜-ë‹¨ì–´-ì¶”ì¶œ"><a class="header" href="#ì»¤ì„œ-ìœ„ì¹˜ì˜-ë‹¨ì–´-ì¶”ì¶œ">ì»¤ì„œ ìœ„ì¹˜ì˜ ë‹¨ì–´ ì¶”ì¶œ</a></h3>
<pre><code class="language-fsharp">/// ì†ŒìŠ¤ í…ìŠ¤íŠ¸ì—ì„œ ìœ„ì¹˜ì˜ ë‹¨ì–´ ì¶”ì¶œ
let getWordAtPosition (text: string) (pos: Position) : string option =
    let lines = text.Split('\n')
    let lineIdx = int pos.Line
    if lineIdx &gt;= lines.Length then None
    else
        let line = lines.[lineIdx]
        let col = int pos.Character
        if col &gt;= line.Length then None
        else
            // ë‹¨ì–´ ê²½ê³„ ì°¾ê¸° (ì•ŒíŒŒë²³, ìˆ«ì, ì–¸ë”ìŠ¤ì½”ì–´)
            let isWordChar c = System.Char.IsLetterOrDigit(c) || c = '_'
            let mutable startCol = col
            while startCol &gt; 0 &amp;&amp; isWordChar line.[startCol - 1] do
                startCol &lt;- startCol - 1
            let mutable endCol = col
            while endCol &lt; line.Length &amp;&amp; isWordChar line.[endCol] do
                endCol &lt;- endCol + 1
            if startCol = endCol then None
            else Some (line.Substring(startCol, endCol - startCol))
</code></pre>
<h3 id="í‚¤ì›Œë“œ-hover-ìƒì„±"><a class="header" href="#í‚¤ì›Œë“œ-hover-ìƒì„±">í‚¤ì›Œë“œ Hover ìƒì„±</a></h3>
<pre><code class="language-fsharp">/// í‚¤ì›Œë“œì— ëŒ€í•œ Hover ìƒì„±
let createKeywordHover (keyword: string) (pos: Position) : Hover option =
    keywordExplanations
    |&gt; Map.tryFind keyword
    |&gt; Option.map (fun explanation -&gt;
        {
            Contents = U3.C1 {
                Kind = MarkupKind.Markdown
                Value = sprintf "**%s** (í‚¤ì›Œë“œ)\n\n%s" keyword explanation
            }
            Range = None  // í‚¤ì›Œë“œ ì „ì²´ ë²”ìœ„ ê³„ì‚°ì€ ìƒëµ
        })
</code></pre>
<p><strong>Ionide Union íƒ€ì…:</strong></p>
<ul>
<li><code>Hover.Contents</code>ëŠ” <code>U3&lt;MarkupContent, MarkedString, MarkedString[]&gt;</code> íƒ€ì…</li>
<li><code>U3.C1</code>ì€ ì²« ë²ˆì§¸ ì¼€ì´ìŠ¤ì¸ <code>MarkupContent</code>ë¥¼ ì˜ë¯¸</li>
<li>Markdownìœ¼ë¡œ í¬ë§·íŒ…í•˜ë©´ ì—ë””í„°ì—ì„œ ì˜ˆì˜ê²Œ í‘œì‹œëœë‹¤</li>
</ul>
<hr>
<h2 id="íƒ€ì…-hover"><a class="header" href="#íƒ€ì…-hover">íƒ€ì… Hover</a></h2>
<h3 id="íƒ€ì…-ì •ë³´-í‘œì‹œ"><a class="header" href="#íƒ€ì…-ì •ë³´-í‘œì‹œ">íƒ€ì… ì •ë³´ í‘œì‹œ</a></h3>
<pre><code class="language-fsharp">/// íƒ€ì… ì •ë³´ë¥¼ ë‹´ì€ Hover ìƒì„±
let createTypeHover (ty: Type.Type) (span: Span) : Hover =
    let typeStr = Type.formatTypeNormalized ty
    {
        Contents = U3.C1 {
            Kind = MarkupKind.Markdown
            Value = sprintf "```funlang\n%s\n```" typeStr
        }
        Range = Some (Protocol.spanToLspRange span)
    }
</code></pre>
<p><strong>formatTypeNormalized:</strong></p>
<ul>
<li>FunLangì˜ íƒ€ì…ì„ ì½ê¸° ì¢‹ì€ ë¬¸ìì—´ë¡œ ë³€í™˜í•œë‹¤</li>
<li>íƒ€ì… ë³€ìˆ˜ ì •ê·œí™”: <code>TVar(1000)</code> â†’ <code>'a</code>, <code>TVar(1001)</code> â†’ <code>'b</code></li>
<li>ì˜ˆ: <code>TFunc(TInt, TFunc(TInt, TInt))</code> â†’ <code>int -&gt; int -&gt; int</code></li>
</ul>
<h3 id="ë…¸ë“œ-íƒ€ì…-ì¶”ë¡ "><a class="header" href="#ë…¸ë“œ-íƒ€ì…-ì¶”ë¡ ">ë…¸ë“œ íƒ€ì… ì¶”ë¡ </a></h3>
<pre><code class="language-fsharp">/// ë…¸ë“œì˜ íƒ€ì… ì¶”ë¡  (ë‹¨ìˆœ ì¼€ì´ìŠ¤)
let getNodeType (node: Expr) : Type.Type option =
    match node with
    | Number(_, _) -&gt; Some TInt
    | Bool(_, _) -&gt; Some TBool
    | String(_, _) -&gt; Some TString
    | EmptyList _ -&gt; None  // ìš”ì†Œ íƒ€ì…ì„ ì•Œ ìˆ˜ ì—†ìŒ
    | _ -&gt;
        // ê·¸ ì™¸ ë…¸ë“œëŠ” íƒ€ì… ì²´ì»¤ ì‚¬ìš©
        match TypeCheck.typecheck node with
        | Ok ty -&gt; Some ty
        | Error _ -&gt; None
</code></pre>
<h3 id="ë³€ìˆ˜-íƒ€ì…-ì¡°íšŒì˜-ì–´ë ¤ì›€"><a class="header" href="#ë³€ìˆ˜-íƒ€ì…-ì¡°íšŒì˜-ì–´ë ¤ì›€">ë³€ìˆ˜ íƒ€ì… ì¡°íšŒì˜ ì–´ë ¤ì›€</a></h3>
<p><strong>ë¬¸ì œ:</strong> <code>Var("x")</code>ë§Œ ë‹¨ë…ìœ¼ë¡œ íƒ€ì… ì²´í¬í•˜ë©´ ì‹¤íŒ¨í•œë‹¤.</p>
<pre><code class="language-fsharp">// ì´ ì½”ë“œëŠ” ì‹¤íŒ¨!
let code = "let x = 42 in x"
let ast = parse code  // Let("x", Number(42), Var("x"))
let varNode = Var("x", span)
TypeCheck.typecheck varNode  // Error: x is unbound!
</code></pre>
<p>ë³€ìˆ˜ <code>x</code>ê°€ ì–´ë””ì„œ ë°”ì¸ë”©ë˜ì—ˆëŠ”ì§€ ì»¨í…ìŠ¤íŠ¸ê°€ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.</p>
<h3 id="í•´ê²°ì±…-ë°”ì¸ë”©-ì‚¬ì´íŠ¸-ê²€ìƒ‰"><a class="header" href="#í•´ê²°ì±…-ë°”ì¸ë”©-ì‚¬ì´íŠ¸-ê²€ìƒ‰">í•´ê²°ì±…: ë°”ì¸ë”© ì‚¬ì´íŠ¸ ê²€ìƒ‰</a></h3>
<p>ASTë¥¼ ìˆœíšŒí•˜ë©° ë³€ìˆ˜ê°€ ì •ì˜ëœ ìœ„ì¹˜ë¥¼ ì°¾ê³ , ë°”ì¸ë”©ëœ ê°’ì˜ íƒ€ì…ì„ ì¶”ë¡ í•œë‹¤.</p>
<pre><code class="language-fsharp">/// ASTì—ì„œ ë³€ìˆ˜ì˜ ë°”ì¸ë”© ì‚¬ì´íŠ¸ë¥¼ ì°¾ì•„ íƒ€ì… ë°˜í™˜
let rec findVarTypeInAst (varName: string) (ast: Expr) : Type.Type option =
    match ast with
    | Let(name, value, body, _) when name = varName -&gt;
        // ë°”ì¸ë”©ì„ ì°¾ìŒ - valueì˜ íƒ€ì… ì¶”ë¡ 
        match TypeCheck.typecheck value with
        | Ok ty -&gt; Some ty
        | Error _ -&gt; None
    | Let(_, _, body, _) -&gt;
        // ì´ ë°”ì¸ë”©ì´ ì•„ë‹˜, bodyì—ì„œ ê³„ì† ê²€ìƒ‰
        findVarTypeInAst varName body
    | LetRec(name, param, fnBody, inExpr, span) when name = varName -&gt;
        // ì¬ê·€ í•¨ìˆ˜ - "let rec f x = body in f"ë¥¼ í•©ì„±í•˜ì—¬ í•¨ìˆ˜ íƒ€ì… ì¶”ë¡ 
        let synthExpr = LetRec(name, param, fnBody, Var(name, span), span)
        match TypeCheck.typecheck synthExpr with
        | Ok ty -&gt; Some ty
        | Error _ -&gt; None
    | LetRec(_, _, _, inExpr, _) -&gt;
        findVarTypeInAst varName inExpr
    | Lambda(param, body, _) when param = varName -&gt;
        // ëŒë‹¤ ë§¤ê°œë³€ìˆ˜ - ì»¨í…ìŠ¤íŠ¸ í•„ìš”
        None
    | Lambda(_, body, _) -&gt;
        findVarTypeInAst varName body
    | LambdaAnnot(param, typeAnnot, body, _) when param = varName -&gt;
        // íƒ€ì… ì–´ë…¸í…Œì´ì…˜ì´ ìˆëŠ” ëŒë‹¤
        Some (Elaborate.elaborateTypeExpr typeAnnot)
    | If(_, thenExpr, elseExpr, _) -&gt;
        match findVarTypeInAst varName thenExpr with
        | Some ty -&gt; Some ty
        | None -&gt; findVarTypeInAst varName elseExpr
    | _ -&gt; None
</code></pre>
<hr>
<h2 id="ì„œë²„-í†µí•©"><a class="header" href="#ì„œë²„-í†µí•©">ì„œë²„ í†µí•©</a></h2>
<h3 id="handlehover-í•¨ìˆ˜"><a class="header" href="#handlehover-í•¨ìˆ˜">handleHover í•¨ìˆ˜</a></h3>
<p>ì „ì²´ íë¦„ì„ ì¡°í•©í•œ í•¸ë“¤ëŸ¬ì´ë‹¤.</p>
<pre><code class="language-fsharp">/// textDocument/hover ìš”ì²­ ì²˜ë¦¬
let handleHover (p: HoverParams) : Async&lt;Hover option&gt; =
    async {
        let uri = p.TextDocument.Uri
        let pos = p.Position

        match DocumentSync.getDocument uri with
        | None -&gt; return None
        | Some text -&gt;
            // 1. í‚¤ì›Œë“œ ì²´í¬ ìš°ì„ 
            match getWordAtPosition text pos with
            | Some word when keywordExplanations.ContainsKey word -&gt;
                return createKeywordHover word pos
            | _ -&gt;
                // 2. AST ê¸°ë°˜ íƒ€ì… hover
                try
                    let lexbuf = FSharp.Text.Lexing.LexBuffer&lt;char&gt;.FromString(text)
                    let ast = Parser.start Lexer.tokenize lexbuf

                    // ìœ„ì¹˜ì—ì„œ ë…¸ë“œ ì°¾ê¸° (ì „ì²´ typecheck ì—†ì´ ì§„í–‰)
                    match findNodeAtPosition pos ast with
                    | None -&gt; return None
                    | Some node -&gt;
                        let nodeType =
                            match node with
                            | Var(name, _) -&gt;
                                // ë³€ìˆ˜ëŠ” ë°”ì¸ë”© ì‚¬ì´íŠ¸ì—ì„œ íƒ€ì… ì°¾ê¸°
                                match findVarTypeInAst name ast with
                                | Some ty -&gt; Some ty
                                | None -&gt; None
                            | Let(name, value, _, _) -&gt;
                                // let ë°”ì¸ë”© ì´ë¦„ ìœ„ â€” ë°”ì¸ë”© ê°’ì˜ íƒ€ì…
                                match TypeCheck.typecheck value with
                                | Ok ty -&gt; Some ty
                                | Error _ -&gt; None
                            | LetRec(name, param, fnBody, _, span) -&gt;
                                // let rec ë°”ì¸ë”© ì´ë¦„ ìœ„ â€” í•¨ìˆ˜ íƒ€ì… ì¶”ë¡ 
                                let synthExpr = LetRec(name, param, fnBody, Var(name, span), span)
                                match TypeCheck.typecheck synthExpr with
                                | Ok ty -&gt; Some ty
                                | Error _ -&gt; None
                            | _ -&gt; getNodeType node

                        match nodeType with
                        | None -&gt; return None
                        | Some ty -&gt; return Some (createTypeHover ty (spanOf node))
                with _ -&gt;
                    return None
    }
</code></pre>
<h3 id="serverfs-ë“±ë¡"><a class="header" href="#serverfs-ë“±ë¡">Server.fs ë“±ë¡</a></h3>
<pre><code class="language-fsharp">// Server.fs
override this.Initialize(p: InitializeParams) =
    async {
        return {
            Capabilities = {
                // ... ë‹¤ë¥¸ capabilityë“¤
                HoverProvider = Some true  // Hover ì§€ì› í™œì„±í™”
            }
        }
    }

override this.TextDocumentHover(p: HoverParams) =
    async {
        let! result = Hover.handleHover p
        return result
    }
</code></pre>
<hr>
<h2 id="í…ŒìŠ¤íŠ¸-ì‘ì„±-2"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‘ì„±-2">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></h2>
<h3 id="í…ŒìŠ¤íŠ¸-í—¬í¼"><a class="header" href="#í…ŒìŠ¤íŠ¸-í—¬í¼">í…ŒìŠ¤íŠ¸ í—¬í¼</a></h3>
<pre><code class="language-fsharp">// HoverTests.fs
module LangLSP.Tests.HoverTests

open Expecto
open Ionide.LanguageServerProtocol.Types
open LangLSP.Server.Hover
open LangLSP.Server.DocumentSync

/// HoverParams ìƒì„± í—¬í¼
let makeHoverParams uri line char : HoverParams =
    {
        TextDocument = { Uri = uri }
        Position = { Line = uint32 line; Character = uint32 char }
        WorkDoneToken = None
    }

/// ë¬¸ì„œ ì„¤ì • í›„ hover ìˆ˜í–‰
let setupAndHover uri text line char =
    clearAll()  // ë¬¸ì„œ ì €ì¥ì†Œ ì´ˆê¸°í™”
    handleDidOpen (makeDidOpenParams uri text)
    handleHover (makeHoverParams uri line char) |&gt; Async.RunSynchronously
</code></pre>
<h3 id="í‚¤ì›Œë“œ-hover-í…ŒìŠ¤íŠ¸"><a class="header" href="#í‚¤ì›Œë“œ-hover-í…ŒìŠ¤íŠ¸">í‚¤ì›Œë“œ Hover í…ŒìŠ¤íŠ¸</a></h3>
<pre><code class="language-fsharp">[&lt;Tests&gt;]
let hoverTests = testList "Hover" [
    testList "Keyword hover" [
        testCase "hover over 'let' shows Korean explanation" &lt;| fun _ -&gt;
            let hover = setupAndHover "file:///test.fun" "let x = 42 in x" 0 0
            Expect.isSome hover "Should return hover"
            match hover.Value.Contents with
            | U3.C1 markup -&gt;
                Expect.stringContains markup.Value "let" "Should mention keyword"
                Expect.stringContains markup.Value "ë³€ìˆ˜" "Should have Korean explanation"
            | _ -&gt; failtest "Expected MarkupContent"

        testCase "hover over 'if' shows Korean explanation" &lt;| fun _ -&gt;
            let hover = setupAndHover "file:///test.fun" "if true then 1 else 0" 0 0
            Expect.isSome hover "Should return hover"
            match hover.Value.Contents with
            | U3.C1 markup -&gt;
                Expect.stringContains markup.Value "ì¡°ê±´" "Should explain conditionals"
            | _ -&gt; failtest "Expected MarkupContent"
    ]
]
</code></pre>
<h3 id="íƒ€ì…-hover-í…ŒìŠ¤íŠ¸"><a class="header" href="#íƒ€ì…-hover-í…ŒìŠ¤íŠ¸">íƒ€ì… Hover í…ŒìŠ¤íŠ¸</a></h3>
<pre><code class="language-fsharp">    testList "Type hover" [
        testCase "hover over variable shows inferred int type" &lt;| fun _ -&gt;
            let hover = setupAndHover "file:///test.fun" "let x = 42 in x" 0 14
            Expect.isSome hover "Should return hover for variable"
            match hover.Value.Contents with
            | U3.C1 markup -&gt;
                Expect.stringContains markup.Value "int" "Should show int type"
            | _ -&gt; failtest "Expected MarkupContent"

        testCase "hover over function shows signature" &lt;| fun _ -&gt;
            let hover = setupAndHover "file:///test.fun" "let f = fun x -&gt; x + 1 in f" 0 26
            Expect.isSome hover "Should return hover for function"
            match hover.Value.Contents with
            | U3.C1 markup -&gt;
                Expect.stringContains markup.Value "int -&gt; int" "Should show function signature"
            | _ -&gt; failtest "Expected MarkupContent"

        testCase "hover over polymorphic function shows generic type" &lt;| fun _ -&gt;
            let hover = setupAndHover "file:///test.fun" "let id = fun x -&gt; x in id" 0 23
            Expect.isSome hover "Should return hover"
            match hover.Value.Contents with
            | U3.C1 markup -&gt;
                Expect.stringContains markup.Value "'a" "Should show polymorphic type"
            | _ -&gt; failtest "Expected MarkupContent"
    ]
</code></pre>
<h3 id="edge-case-í…ŒìŠ¤íŠ¸"><a class="header" href="#edge-case-í…ŒìŠ¤íŠ¸">Edge Case í…ŒìŠ¤íŠ¸</a></h3>
<pre><code class="language-fsharp">    testList "Edge cases" [
        testCase "hover on parse error returns None" &lt;| fun _ -&gt;
            let hover = setupAndHover "file:///test.fun" "let x =" 0 4
            Expect.isNone hover "Should return None on parse error"

        testCase "hover outside code returns None" &lt;| fun _ -&gt;
            let hover = setupAndHover "file:///test.fun" "42" 5 0
            Expect.isNone hover "Should return None for out-of-bounds"

        testCase "hover returns markdown format" &lt;| fun _ -&gt;
            let hover = setupAndHover "file:///test.fun" "let x = 42 in x" 0 14
            Expect.isSome hover "Should return hover"
            match hover.Value.Contents with
            | U3.C1 markup -&gt;
                Expect.equal markup.Kind MarkupKind.Markdown "Should use Markdown"
            | _ -&gt; failtest "Expected MarkupContent"
    ]
] |&gt; testSequenced  // ê³µìœ  ìƒíƒœë¡œ ì¸í•´ ìˆœì°¨ ì‹¤í–‰
</code></pre>
<h3 id="í…ŒìŠ¤íŠ¸-ì‹¤í–‰-2"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‹¤í–‰-2">í…ŒìŠ¤íŠ¸ ì‹¤í–‰</a></h3>
<pre><code class="language-bash">dotnet test src/LangLSP.Tests

# ê²°ê³¼:
# [Hover/Keyword hover] hover over 'let' shows Korean explanation - Passed
# [Hover/Keyword hover] hover over 'if' shows Korean explanation - Passed
# [Hover/Type hover] hover over variable shows inferred int type - Passed
# [Hover/Type hover] hover over function shows signature - Passed
# [Hover/Type hover] hover over polymorphic function shows generic type - Passed
# [Hover/Edge cases] hover on parse error returns None - Passed
# ...
</code></pre>
<hr>
<h2 id="í”í•œ-ì‹¤ìˆ˜ì™€-í•´ê²°ì±…"><a class="header" href="#í”í•œ-ì‹¤ìˆ˜ì™€-í•´ê²°ì±…">í”í•œ ì‹¤ìˆ˜ì™€ í•´ê²°ì±…</a></h2>
<h3 id="1-í‚¤ì›Œë“œ-hoverê°€-ì‘ë™í•˜ì§€-ì•ŠìŒ"><a class="header" href="#1-í‚¤ì›Œë“œ-hoverê°€-ì‘ë™í•˜ì§€-ì•ŠìŒ">1. í‚¤ì›Œë“œ Hoverê°€ ì‘ë™í•˜ì§€ ì•ŠìŒ</a></h3>
<p><strong>ì¦ìƒ:</strong> <code>let</code>, <code>if</code> ìœ„ì— hoverí•´ë„ ì•„ë¬´ê²ƒë„ í‘œì‹œ ì•ˆ ëœë‹¤</p>
<p><strong>ì›ì¸:</strong> í‚¤ì›Œë“œ ì²´í¬ ì—†ì´ ASTë§Œ ì¡°íšŒ</p>
<p><strong>í•´ê²°:</strong> AST ì¡°íšŒ ì „ì— <code>getWordAtPosition</code>ìœ¼ë¡œ í‚¤ì›Œë“œ ì²´í¬</p>
<pre><code class="language-fsharp">// ì˜¬ë°”ë¥¸ ìˆœì„œ
match getWordAtPosition text pos with
| Some word when keywordExplanations.ContainsKey word -&gt;
    createKeywordHover word pos  // í‚¤ì›Œë“œ ë¨¼ì €!
| _ -&gt;
    // AST ì¡°íšŒ
</code></pre>
<h3 id="2-ë³µì¡í•œ-íŒŒì¼ì—ì„œ-hoverê°€-ì „í˜€-ì‘ë™í•˜ì§€-ì•ŠìŒ"><a class="header" href="#2-ë³µì¡í•œ-íŒŒì¼ì—ì„œ-hoverê°€-ì „í˜€-ì‘ë™í•˜ì§€-ì•ŠìŒ">2. ë³µì¡í•œ íŒŒì¼ì—ì„œ hoverê°€ ì „í˜€ ì‘ë™í•˜ì§€ ì•ŠìŒ</a></h3>
<p><strong>ì¦ìƒ:</strong> ê°„ë‹¨í•œ íŒŒì¼ì€ ë˜ì§€ë§Œ, í° íŒŒì¼ì—ì„œëŠ” ëª¨ë“  hoverê°€ None</p>
<p><strong>ì›ì¸:</strong> ì „ì²´ AST <code>TypeCheck.typecheck ast</code>ë¥¼ ê°€ë“œë¡œ ì‚¬ìš©í•˜ë©´, íŒŒì¼ì— íƒ€ì… ì—ëŸ¬ê°€ ìˆê±°ë‚˜ íƒ€ì… ì¶”ë¡ ì´ ë³µì¡í•œ ê²½ìš° ì „ì²´ hoverê°€ ì°¨ë‹¨ëœë‹¤</p>
<p><strong>í•´ê²°:</strong> ì „ì²´ typecheck ê°€ë“œë¥¼ ì œê±°í•˜ê³ , ê°œë³„ ë…¸ë“œë³„ë¡œ ë…ë¦½ì ìœ¼ë¡œ íƒ€ì… ì¶”ë¡ </p>
<h3 id="3-letletrec-ë°”ì¸ë”©-ì´ë¦„ì—ì„œ-hoverê°€-ì•ˆ-ëœë‹¤"><a class="header" href="#3-letletrec-ë°”ì¸ë”©-ì´ë¦„ì—ì„œ-hoverê°€-ì•ˆ-ëœë‹¤">3. Let/LetRec ë°”ì¸ë”© ì´ë¦„ì—ì„œ hoverê°€ ì•ˆ ëœë‹¤</a></h3>
<p><strong>ì¦ìƒ:</strong> <code>let count = 1 in count</code>ì—ì„œ ë’¤ì˜ <code>count</code>ëŠ” ë˜ì§€ë§Œ ì•ì˜ <code>count</code>ëŠ” ì•ˆ ëœë‹¤</p>
<p><strong>ì›ì¸:</strong> <code>findNodeAtPosition</code>ì´ ë°”ì¸ë”© ì´ë¦„ ìœ„ì¹˜ì—ì„œ <code>Let</code> ë…¸ë“œë¥¼ ë°˜í™˜í•˜ì§€ë§Œ, handlerê°€ <code>Let</code> ì¼€ì´ìŠ¤ë¥¼ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ</p>
<p><strong>í•´ê²°:</strong> <code>Let</code>ì€ <code>TypeCheck.typecheck value</code>, <code>LetRec</code>ì€ í•©ì„± í‘œí˜„ì‹ìœ¼ë¡œ í•¨ìˆ˜ íƒ€ì… ì¶”ë¡ </p>
<h3 id="4-ë³€ìˆ˜-íƒ€ì…ì´-í‘œì‹œë˜ì§€-ì•ŠìŒ"><a class="header" href="#4-ë³€ìˆ˜-íƒ€ì…ì´-í‘œì‹œë˜ì§€-ì•ŠìŒ">4. ë³€ìˆ˜ íƒ€ì…ì´ í‘œì‹œë˜ì§€ ì•ŠìŒ</a></h3>
<p><strong>ì¦ìƒ:</strong> <code>42</code> ìœ„ì—ì„œëŠ” <code>int</code> í‘œì‹œë˜ì§€ë§Œ, ë³€ìˆ˜ <code>x</code> ìœ„ì—ì„œëŠ” None</p>
<p><strong>ì›ì¸:</strong> ë³€ìˆ˜ë¥¼ ë‹¨ë…ìœ¼ë¡œ íƒ€ì… ì²´í¬í•˜ë©´ ë°”ì¸ë”© ì»¨í…ìŠ¤íŠ¸ê°€ ì—†ìŒ</p>
<p><strong>í•´ê²°:</strong> <code>findVarTypeInAst</code>ë¡œ ë°”ì¸ë”© ì‚¬ì´íŠ¸ì—ì„œ íƒ€ì… ì¶”ë¡ </p>
<h3 id="5-ì¢Œí‘œê°€-ì–´ê¸‹ë‚¨"><a class="header" href="#5-ì¢Œí‘œê°€-ì–´ê¸‹ë‚¨">5. ì¢Œí‘œê°€ ì–´ê¸‹ë‚¨</a></h3>
<p><strong>ì¦ìƒ:</strong> í´ë¦­í•œ ìœ„ì¹˜ì™€ ë‹¤ë¥¸ ë…¸ë“œì˜ ì •ë³´ê°€ í‘œì‹œëœë‹¤</p>
<p><strong>ì›ì¸:</strong> LSPì™€ íŒŒì„œì˜ ì¢Œí‘œê³„ í˜¼ë™</p>
<p><strong>í•´ê²°:</strong> FunLangì€ <code>LexBuffer.FromString</code>ì„ ì‚¬ìš©í•˜ë¯€ë¡œ LSPì™€ ë™ì¼í•˜ê²Œ 0-based. ë³€í™˜ ë¶ˆí•„ìš”.</p>
<h3 id="4-markupcontentê°€-ì œëŒ€ë¡œ-í‘œì‹œ-ì•ˆ-ëœë‹¤"><a class="header" href="#4-markupcontentê°€-ì œëŒ€ë¡œ-í‘œì‹œ-ì•ˆ-ëœë‹¤">4. MarkupContentê°€ ì œëŒ€ë¡œ í‘œì‹œ ì•ˆ ëœë‹¤</a></h3>
<p><strong>ì¦ìƒ:</strong> ì—ë””í„°ì—ì„œ raw Markdown í…ìŠ¤íŠ¸ê°€ ë³´ì¸ë‹¤</p>
<p><strong>ì›ì¸:</strong> <code>MarkupKind.PlainText</code> ì‚¬ìš© ë˜ëŠ” ì˜ëª»ëœ Union íƒ€ì…</p>
<p><strong>í•´ê²°:</strong></p>
<pre><code class="language-fsharp">// ì˜¬ë°”ë¥¸ ë°©ë²•
Contents = U3.C1 {
    Kind = MarkupKind.Markdown  // Markdown ëª…ì‹œ
    Value = "```funlang\nint\n```"  // ì½”ë“œ íœìŠ¤ë¡œ êµ¬ë¬¸ ê°•ì¡°
}
</code></pre>
<h3 id="5-ë‹¤í˜•-íƒ€ì…ì´-ì´ìƒí•˜ê²Œ-í‘œì‹œëœë‹¤"><a class="header" href="#5-ë‹¤í˜•-íƒ€ì…ì´-ì´ìƒí•˜ê²Œ-í‘œì‹œëœë‹¤">5. ë‹¤í˜• íƒ€ì…ì´ ì´ìƒí•˜ê²Œ í‘œì‹œëœë‹¤</a></h3>
<p><strong>ì¦ìƒ:</strong> <code>'a -&gt; 'a</code> ëŒ€ì‹  <code>TVar(1234) -&gt; TVar(1234)</code> í‘œì‹œ</p>
<p><strong>ì›ì¸:</strong> ë‚´ë¶€ íƒ€ì… í‘œí˜„ì„ ì§ì ‘ ì¶œë ¥</p>
<p><strong>í•´ê²°:</strong> <code>Type.formatTypeNormalized</code> ì‚¬ìš© - íƒ€ì… ë³€ìˆ˜ë¥¼ <code>'a</code>, <code>'b</code> ë“±ìœ¼ë¡œ ì •ê·œí™”</p>
<hr>
<h2 id="ì •ë¦¬"><a class="header" href="#ì •ë¦¬">ì •ë¦¬</a></h2>
<p>Hover êµ¬í˜„ì˜ í•µì‹¬ì€:</p>
<ol>
<li><strong>í‚¤ì›Œë“œ ìš°ì„  ì²´í¬</strong> - í‚¤ì›Œë“œëŠ” ASTì— ì—†ìœ¼ë¯€ë¡œ ë¨¼ì € í™•ì¸</li>
<li><strong>innermost ë…¸ë“œ ì°¾ê¸°</strong> - ì¤‘ì²©ëœ í‘œí˜„ì‹ì—ì„œ ê°€ì¥ êµ¬ì²´ì ì¸ ë…¸ë“œ ë°˜í™˜</li>
<li><strong>ë°”ì¸ë”© ì»¨í…ìŠ¤íŠ¸</strong> - ë³€ìˆ˜ íƒ€ì…ì€ ë°”ì¸ë”© ì‚¬ì´íŠ¸ì—ì„œ ì¶”ë¡ </li>
<li><strong>Markdown ì‚¬ìš©</strong> - ì½”ë“œ íœìŠ¤ë¡œ êµ¬ë¬¸ ê°•ì¡° ì œê³µ</li>
</ol>
<hr>
<h2 id="ë‹¤ìŒ-ë‹¨ê³„-5"><a class="header" href="#ë‹¤ìŒ-ë‹¨ê³„-5">ë‹¤ìŒ ë‹¨ê³„</a></h2>
<blockquote>
<p><a href="07-definition.html">07. Go to Definition êµ¬í˜„í•˜ê¸°</a></p>
</blockquote>
<p>Go to Definitionì€ Hoverì™€ ë¹„ìŠ·í•œ ìœ„ì¹˜ ì¡°íšŒ ë¡œì§ì„ ì‚¬ìš©í•œë‹¤. ë‹¤ë§Œ íƒ€ì… ëŒ€ì‹  <strong>ì •ì˜ ìœ„ì¹˜</strong>ë¥¼ ë°˜í™˜í•œë‹¤.</p>
<hr>
<h2 id="ì°¸ê³ -ìë£Œ-5"><a class="header" href="#ì°¸ê³ -ìë£Œ-5">ì°¸ê³  ìë£Œ</a></h2>
<ul>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocument_hover">LSP Specification - textDocument/hover</a></li>
<li><a href="https://github.com/kodu-ai/LangTutorial/blob/main/FunLang/Type.fs">FunLang Type ëª¨ë“ˆ</a></li>
<li><a href="https://github.com/ionide/LanguageServerProtocol">Ionide.LanguageServerProtocol</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="ìë™-ì™„ì„±completion-êµ¬í˜„í•˜ê¸°"><a class="header" href="#ìë™-ì™„ì„±completion-êµ¬í˜„í•˜ê¸°">ìë™ ì™„ì„±(Completion) êµ¬í˜„í•˜ê¸°</a></h1>
<p>ìë™ ì™„ì„±ì€ ì‚¬ìš©ìê°€ ì½”ë“œë¥¼ ì…ë ¥í•  ë•Œ í‚¤ì›Œë“œ, ë³€ìˆ˜, í•¨ìˆ˜ ë“±ì˜ í›„ë³´ë¥¼ ì œì•ˆí•˜ëŠ” LSPì˜ í•µì‹¬ ê¸°ëŠ¥ì´ë‹¤. ì½”ë“œ ì‘ì„± ì†ë„ë¥¼ ë†’ì´ê³  ì˜¤íƒ€ë¥¼ ì¤„ì´ë©°, ì‚¬ìš© ê°€ëŠ¥í•œ ì‹¬ë³¼ì„ ì‰½ê²Œ ë°œê²¬í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.</p>
<p>ì´ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” FunLang LSPì— Completion ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ë°°ìš´ë‹¤.</p>
<h2 id="ëª©ì°¨-6"><a class="header" href="#ëª©ì°¨-6">ëª©ì°¨</a></h2>
<ol>
<li><a href="#textdocumentcompletion-í”„ë¡œí† ì½œ">textDocument/completion í”„ë¡œí† ì½œ</a></li>
<li><a href="#êµ¬í˜„-ì „ëµ-1">êµ¬í˜„ ì „ëµ</a></li>
<li><a href="#í‚¤ì›Œë“œ-ì™„ì„±">í‚¤ì›Œë“œ ì™„ì„±</a></li>
<li><a href="#ìŠ¤ì½”í”„-ê¸°ë°˜-ì‹¬ë³¼-ì™„ì„±">ìŠ¤ì½”í”„ ê¸°ë°˜ ì‹¬ë³¼ ì™„ì„±</a></li>
<li><a href="#íƒ€ì…-ì •ë³´-í‘œì‹œ-1">íƒ€ì… ì •ë³´ í‘œì‹œ</a></li>
<li><a href="#ì„œë²„-í†µí•©-1">ì„œë²„ í†µí•©</a></li>
<li><a href="#í…ŒìŠ¤íŠ¸-ì‘ì„±-3">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></li>
<li><a href="#í”í•œ-ì‹¤ìˆ˜ì™€-í•´ê²°ì±…-1">í”í•œ ì‹¤ìˆ˜ì™€ í•´ê²°ì±…</a></li>
</ol>
<hr>
<h2 id="textdocumentcompletion-í”„ë¡œí† ì½œ"><a class="header" href="#textdocumentcompletion-í”„ë¡œí† ì½œ">textDocument/completion í”„ë¡œí† ì½œ</a></h2>
<h3 id="ìš”ì²­-êµ¬ì¡°-1"><a class="header" href="#ìš”ì²­-êµ¬ì¡°-1">ìš”ì²­ êµ¬ì¡°</a></h3>
<p>í´ë¼ì´ì–¸íŠ¸(ì—ë””í„°)ê°€ ìë™ ì™„ì„±ì„ ìš”ì²­í•  ë•Œ ì‚¬ìš©í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.</p>
<pre><code class="language-typescript">interface CompletionParams {
    textDocument: TextDocumentIdentifier  // ë¬¸ì„œ URI
    position: Position                     // ì»¤ì„œ ìœ„ì¹˜ (0-based)
    context?: CompletionContext           // íŠ¸ë¦¬ê±° ì •ë³´ (ì„ íƒ)
}

interface Position {
    line: number       // 0-based ì¤„ ë²ˆí˜¸
    character: number  // 0-based ë¬¸ì ìœ„ì¹˜
}

interface CompletionContext {
    triggerKind: CompletionTriggerKind  // ìˆ˜ë™(1) vs íŠ¸ë¦¬ê±° ë¬¸ì(2) vs ì¬íŠ¸ë¦¬ê±°(3)
    triggerCharacter?: string            // íŠ¸ë¦¬ê±° ë¬¸ì (ì˜ˆ: ".")
}
</code></pre>
<h3 id="ì‘ë‹µ-êµ¬ì¡°-1"><a class="header" href="#ì‘ë‹µ-êµ¬ì¡°-1">ì‘ë‹µ êµ¬ì¡°</a></h3>
<p>ì„œë²„ê°€ ë°˜í™˜í•˜ëŠ” ì™„ì„± í›„ë³´ ëª©ë¡ì´ë‹¤.</p>
<pre><code class="language-typescript">interface CompletionList {
    isIncomplete: boolean      // ì¶”ê°€ í›„ë³´ê°€ ìˆëŠ”ì§€ (ìŠ¤íŠ¸ë¦¬ë°ìš©)
    items: CompletionItem[]    // ì™„ì„± í›„ë³´ë“¤
}

interface CompletionItem {
    label: string                        // í‘œì‹œë  í…ìŠ¤íŠ¸
    kind?: CompletionItemKind           // ì•„ì´ì½˜ ì¢…ë¥˜ (Keyword, Variable, Function ë“±)
    detail?: string                      // ìš°ì¸¡ ì¶”ê°€ ì •ë³´ (ì˜ˆ: íƒ€ì…)
    documentation?: string | MarkupContent  // ìƒì„¸ ì„¤ëª…
    insertText?: string                  // ì‚½ì…ë  í…ìŠ¤íŠ¸ (ê¸°ë³¸ê°’: label)
    insertTextFormat?: InsertTextFormat  // PlainText(1) vs Snippet(2)
    // ... ê¸°íƒ€ í•„ë“œë“¤
}
</code></pre>
<h3 id="completionitemkind-ì—´ê±°í˜•"><a class="header" href="#completionitemkind-ì—´ê±°í˜•">CompletionItemKind ì—´ê±°í˜•</a></h3>
<p>ì™„ì„± í•­ëª©ì˜ ì¢…ë¥˜ë¥¼ ë‚˜íƒ€ë‚´ë©°, VS CodeëŠ” ê° ì¢…ë¥˜ë§ˆë‹¤ ë‹¤ë¥¸ ì•„ì´ì½˜ì„ í‘œì‹œí•œë‹¤.</p>
<pre><code class="language-fsharp">type CompletionItemKind =
    | Text = 1
    | Method = 2
    | Function = 3
    | Constructor = 4
    | Field = 5
    | Variable = 6
    | Class = 7
    | Interface = 8
    | Module = 9
    | Property = 10
    | Unit = 11
    | Value = 12
    | Enum = 13
    | Keyword = 14
    // ... ë” ë§ì€ ì¢…ë¥˜
</code></pre>
<h3 id="vs-codeì—ì„œì˜-í‘œì‹œ-2"><a class="header" href="#vs-codeì—ì„œì˜-í‘œì‹œ-2">VS Codeì—ì„œì˜ í‘œì‹œ</a></h3>
<pre><code>test.fun
â”€â”€â”€â”€â”€â”€â”€â”€
let x = 42 in lâ–ˆ

ì™„ì„± ëª©ë¡ íŒì—…:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [í‚¤ì›Œë“œ] let   keyword  â”‚  â† í‚¤ì›Œë“œ ì•„ì´ì½˜
â”‚ [í‚¤ì›Œë“œ] in    keyword  â”‚
â”‚ [ë³€ìˆ˜]   x     x: int   â”‚  â† ë³€ìˆ˜ ì•„ì´ì½˜, ìš°ì¸¡ì— íƒ€ì…
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>ì‚¬ìš©ìê°€ <code>l</code>ì„ ì…ë ¥í•˜ë©´:</p>
<ul>
<li><strong>í•„í„°ë§</strong>: í´ë¼ì´ì–¸íŠ¸ê°€ í¼ì§€ ë§¤ì¹­ìœ¼ë¡œ <code>let</code>, <code>in</code> ë“±ì„ í•„í„°ë§</li>
<li><strong>ì•„ì´ì½˜</strong>: <code>CompletionItemKind</code>ì— ë”°ë¼ ë‹¤ë¥¸ ì•„ì´ì½˜ í‘œì‹œ</li>
<li><strong>íƒ€ì… ì •ë³´</strong>: <code>detail</code> í•„ë“œì— íƒ€ì… í‘œì‹œ</li>
</ul>
<pre class="mermaid">sequenceDiagram
    participant C as Client
    participant S as Server
    C-&gt;&gt;S: textDocument/completion(uri, position)
    Note over S: í‚¤ì›Œë“œ + ìŠ¤ì½”í”„ ë‚´ ì‹¬ë³¼ ìˆ˜ì§‘
    S-&gt;&gt;C: CompletionList(isIncomplete, items[])
</pre>

<hr>
<h2 id="êµ¬í˜„-ì „ëµ-1"><a class="header" href="#êµ¬í˜„-ì „ëµ-1">êµ¬í˜„ ì „ëµ</a></h2>
<p>Completion ê¸°ëŠ¥ì€ ë‘ ê°€ì§€ ì†ŒìŠ¤ì—ì„œ ì™„ì„± í›„ë³´ë¥¼ ì œê³µí•œë‹¤:</p>
<ol>
<li><strong>í‚¤ì›Œë“œ ì™„ì„±</strong>: FunLangì˜ í‚¤ì›Œë“œ ëª©ë¡ (let, in, if, then, else ë“±)</li>
<li><strong>ìŠ¤ì½”í”„ ê¸°ë°˜ ì‹¬ë³¼ ì™„ì„±</strong>: í˜„ì¬ ì»¤ì„œ ìœ„ì¹˜ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ ë³€ìˆ˜/í•¨ìˆ˜</li>
</ol>
<h3 id="ì²˜ë¦¬-íë¦„-1"><a class="header" href="#ì²˜ë¦¬-íë¦„-1">ì²˜ë¦¬ íë¦„</a></h3>
<pre><code>CompletionParams ìˆ˜ì‹ 
    â†“
ë¬¸ì„œ í…ìŠ¤íŠ¸ ì¡°íšŒ
    â†“
AST íŒŒì‹± ì‹œë„
    â†“
    â”œâ”€ ì„±ê³µ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         â†“
    â”‚                   í‚¤ì›Œë“œ ì™„ì„± ìƒì„±
    â”‚                         â†“
    â”‚                   ìŠ¤ì½”í”„ ì‹¬ë³¼ ìˆ˜ì§‘
    â”‚                   (collectDefinitions)
    â”‚                         â†“
    â”‚                   ì»¤ì„œ ì´ì „ ì •ì˜ë§Œ í•„í„°ë§
    â”‚                         â†“
    â”‚                   íƒ€ì… ì •ë³´ ì¶”ê°€
    â”‚                   (findVarTypeInAst)
    â”‚                         â†“
    â”‚                   ì‹¬ë³¼ ì™„ì„± ìƒì„±
    â”‚                         â†“
    â”‚                   í‚¤ì›Œë“œ + ì‹¬ë³¼ ë³‘í•©
    â”‚                         â†“
    â””â”€ ì‹¤íŒ¨ â”€â”€â”€â”€â†’ í‚¤ì›Œë“œë§Œ ë°˜í™˜ (graceful degradation)
                              â†“
                   CompletionList ë°˜í™˜
</code></pre>
<h3 id="ê¸°ì¡´-ì¸í”„ë¼-ì¬ì‚¬ìš©"><a class="header" href="#ê¸°ì¡´-ì¸í”„ë¼-ì¬ì‚¬ìš©">ê¸°ì¡´ ì¸í”„ë¼ ì¬ì‚¬ìš©</a></h3>
<p>Phase 2ì—ì„œ êµ¬í˜„í•œ ëª¨ë“ˆë“¤ì„ ì ê·¹ í™œìš©í•œë‹¤:</p>
<ul>
<li>
<p><strong>Definition.collectDefinitions</strong>: ëª¨ë“  ë³€ìˆ˜/í•¨ìˆ˜ ì •ì˜ ìœ„ì¹˜ ìˆ˜ì§‘</p>
<ul>
<li>ì´ë¯¸ AST ì „ì²´ë¥¼ ìˆœíšŒí•˜ë©° ë°”ì¸ë”© ì‚¬ì´íŠ¸ë¥¼ ì°¾ìŒ</li>
<li>Completionì—ì„œëŠ” ìŠ¤ì½”í”„ í•„í„°ë§ë§Œ ì¶”ê°€í•˜ë©´ ë¨</li>
</ul>
</li>
<li>
<p><strong>Hover.findVarTypeInAst</strong>: ë³€ìˆ˜ì˜ íƒ€ì… ì •ë³´ ì¡°íšŒ</p>
<ul>
<li>ë°”ì¸ë”© ì‚¬ì´íŠ¸ë¥¼ ì°¾ì•„ ê°’ì˜ íƒ€ì…ì„ ì¶”ë¡ </li>
<li>Completionì˜ <code>detail</code> í•„ë“œì— íƒ€ì… í‘œì‹œ</li>
</ul>
</li>
</ul>
<h3 id="í´ë¼ì´ì–¸íŠ¸-í•„í„°ë§-ìœ„ì„"><a class="header" href="#í´ë¼ì´ì–¸íŠ¸-í•„í„°ë§-ìœ„ì„">í´ë¼ì´ì–¸íŠ¸ í•„í„°ë§ ìœ„ì„</a></h3>
<p><strong>ì¤‘ìš”í•œ ì„¤ê³„ ê²°ì •:</strong> ì„œë²„ëŠ” ëª¨ë“  í›„ë³´ë¥¼ ë°˜í™˜í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ê°€ í•„í„°ë§í•œë‹¤.</p>
<pre><code class="language-fsharp">// âŒ ì„œë²„ì—ì„œ prefix í•„í„°ë§ (ê¶Œì¥í•˜ì§€ ì•ŠìŒ)
let symbols = getSymbolsInScope ast pos
              |&gt; List.filter (fun (name, _) -&gt; name.StartsWith "l")

// âœ… ëª¨ë“  í›„ë³´ ë°˜í™˜, í´ë¼ì´ì–¸íŠ¸ê°€ í¼ì§€ ë§¤ì¹­
let symbols = getSymbolsInScope ast pos  // ëª¨ë“  ì‹¬ë³¼
</code></pre>
<p>ì™œëƒí•˜ë©´:</p>
<ul>
<li>VS CodeëŠ” í¼ì§€ ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš© (<code>l</code> â†’ <code>let</code>, <code>list</code>, <code>tail</code> ë“±)</li>
<li>ì‚¬ìš©ìê°€ íƒ€ì´í•‘í•  ë•Œë§ˆë‹¤ ì¬ìš”ì²­í•˜ë¯€ë¡œ í•„í„°ë§ì€ í´ë¼ì´ì–¸íŠ¸ê°€ ë” íš¨ìœ¨ì </li>
</ul>
<hr>
<h2 id="í‚¤ì›Œë“œ-ì™„ì„±"><a class="header" href="#í‚¤ì›Œë“œ-ì™„ì„±">í‚¤ì›Œë“œ ì™„ì„±</a></h2>
<h3 id="funlang-í‚¤ì›Œë“œ-ëª©ë¡"><a class="header" href="#funlang-í‚¤ì›Œë“œ-ëª©ë¡">FunLang í‚¤ì›Œë“œ ëª©ë¡</a></h3>
<p>FunLangì˜ ì˜ˆì•½ì–´ë¥¼ ì •ì  ë¦¬ìŠ¤íŠ¸ë¡œ ì •ì˜í•œë‹¤.</p>
<pre><code class="language-fsharp">// Completion.fs
module LangLSP.Server.Completion

open Ionide.LanguageServerProtocol.Types

/// FunLang keywords for completion
let funlangKeywords = [
    "let"; "in"; "if"; "then"; "else"; "match"; "with"
    "fun"; "rec"; "true"; "false"
]
</code></pre>
<p><strong>ì™œ ì •ì  ë¦¬ìŠ¤íŠ¸ì¸ê°€?</strong></p>
<ul>
<li>Parserì—ì„œ ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ë„ ìˆì§€ë§Œ, í‚¤ì›Œë“œëŠ” ê±°ì˜ ë³€í•˜ì§€ ì•ŠìŒ</li>
<li>ê°„ë‹¨í•˜ê³  ëª…í™•í•œ êµ¬í˜„</li>
<li>Phase 3 MVPì— ì¶©ë¶„</li>
</ul>
<h3 id="í‚¤ì›Œë“œ-completionitem-ìƒì„±"><a class="header" href="#í‚¤ì›Œë“œ-completionitem-ìƒì„±">í‚¤ì›Œë“œ CompletionItem ìƒì„±</a></h3>
<pre><code class="language-fsharp">/// Create completion items for keywords
let getKeywordCompletions () : CompletionItem list =
    funlangKeywords
    |&gt; List.map (fun kw -&gt;
        {
            Label = kw
            LabelDetails = None
            Kind = Some CompletionItemKind.Keyword
            Detail = Some "keyword"
            Documentation = None
            Deprecated = Some false
            Preselect = Some false
            SortText = None
            FilterText = None
            InsertText = Some kw
            InsertTextFormat = Some InsertTextFormat.PlainText
            InsertTextMode = None
            TextEdit = None
            TextEditText = None
            AdditionalTextEdits = None
            CommitCharacters = None
            Command = None
            Data = None
            Tags = None
        })
</code></pre>
<h3 id="ì£¼ìš”-í•„ë“œ-ì„¤ëª…"><a class="header" href="#ì£¼ìš”-í•„ë“œ-ì„¤ëª…">ì£¼ìš” í•„ë“œ ì„¤ëª…</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>í•„ë“œ</th><th>ê°’</th><th>ì„¤ëª…</th></tr>
</thead>
<tbody>
<tr><td><code>Label</code></td><td><code>"let"</code></td><td>ì™„ì„± ëª©ë¡ì— í‘œì‹œë  í…ìŠ¤íŠ¸</td></tr>
<tr><td><code>Kind</code></td><td><code>CompletionItemKind.Keyword</code></td><td>í‚¤ì›Œë“œ ì•„ì´ì½˜ í‘œì‹œ</td></tr>
<tr><td><code>Detail</code></td><td><code>"keyword"</code></td><td>ìš°ì¸¡ì— í‘œì‹œë  ì¶”ê°€ ì •ë³´</td></tr>
<tr><td><code>InsertText</code></td><td><code>"let"</code></td><td>ì„ íƒ ì‹œ ì‚½ì…ë  í…ìŠ¤íŠ¸ (ê¸°ë³¸ê°’: Label)</td></tr>
<tr><td><code>InsertTextFormat</code></td><td><code>PlainText</code></td><td>ì¼ë°˜ í…ìŠ¤íŠ¸ (Snippetì€ <code>$1</code>, <code>${2:name}</code> ê°™ì€ í”Œë ˆì´ìŠ¤í™€ë”)</td></tr>
</tbody>
</table>
</div>
<p><strong>ìƒëµ ê°€ëŠ¥í•œ í•„ë“œ:</strong></p>
<ul>
<li><code>Documentation</code>: í‚¤ì›Œë“œ ì„¤ëª…ì€ Hoverì—ì„œ ì œê³µ</li>
<li><code>SortText</code>: ê¸°ë³¸ ì•ŒíŒŒë²³ ì •ë ¬ ì‚¬ìš©</li>
<li><code>FilterText</code>: Labelê³¼ ë™ì¼í•˜ê²Œ ì‚¬ìš©ë¨</li>
</ul>
<hr>
<h2 id="ìŠ¤ì½”í”„-ê¸°ë°˜-ì‹¬ë³¼-ì™„ì„±"><a class="header" href="#ìŠ¤ì½”í”„-ê¸°ë°˜-ì‹¬ë³¼-ì™„ì„±">ìŠ¤ì½”í”„ ê¸°ë°˜ ì‹¬ë³¼ ì™„ì„±</a></h2>
<h3 id="definitioncollectdefinitions-ì¬ì‚¬ìš©"><a class="header" href="#definitioncollectdefinitions-ì¬ì‚¬ìš©">Definition.collectDefinitions ì¬ì‚¬ìš©</a></h3>
<p>Phase 2ì˜ Go to Definitionì—ì„œ êµ¬í˜„í•œ í•¨ìˆ˜ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•œë‹¤.</p>
<pre><code class="language-fsharp">// Definition.fsì—ì„œ ì´ë¯¸ êµ¬í˜„ë¨
let collectDefinitions (ast: Expr) : (string * Span) list
</code></pre>
<p>ì´ í•¨ìˆ˜ëŠ”:</p>
<ul>
<li>ASTë¥¼ ì¬ê·€ì ìœ¼ë¡œ ìˆœíšŒ</li>
<li><code>Let</code>, <code>LetRec</code>, <code>Lambda</code>, <code>Match</code> ë“±ì˜ ë°”ì¸ë”© ì‚¬ì´íŠ¸ ìˆ˜ì§‘</li>
<li><code>(ë³€ìˆ˜ëª…, Span)</code> ìŒì˜ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜</li>
</ul>
<h3 id="ìŠ¤ì½”í”„-í•„í„°ë§"><a class="header" href="#ìŠ¤ì½”í”„-í•„í„°ë§">ìŠ¤ì½”í”„ í•„í„°ë§</a></h3>
<p><strong>í•µì‹¬:</strong> ì»¤ì„œ ìœ„ì¹˜ <strong>ì´ì „</strong>ì— ì •ì˜ëœ ì‹¬ë³¼ë§Œ í¬í•¨í•´ì•¼ í•œë‹¤.</p>
<pre><code class="language-fsharp">/// Get symbol completions from current scope
/// Filters to symbols defined before cursor position
let getSymbolCompletions (ast: Expr) (pos: Position) : CompletionItem list =
    let definitions = Definition.collectDefinitions ast

    // Filter to symbols defined before cursor position (scope filtering)
    let inScope =
        definitions
        |&gt; List.filter (fun (_, span) -&gt;
            // ì»¤ì„œë³´ë‹¤ ì•ì— ì •ì˜ëœ ê²ƒë§Œ
            span.StartLine &lt; int pos.Line ||
            (span.StartLine = int pos.Line &amp;&amp; span.StartColumn &lt; int pos.Character))
        // ì„€ë„ì‰ ì²˜ë¦¬: ì¤‘ë³µ ì´ë¦„ì€ ë§ˆì§€ë§‰ ì •ì˜ë§Œ ìœ ì§€
        |&gt; List.rev
        |&gt; List.distinctBy fst
        |&gt; List.rev
</code></pre>
<h3 id="ì„€ë„ì‰-ì²˜ë¦¬"><a class="header" href="#ì„€ë„ì‰-ì²˜ë¦¬">ì„€ë„ì‰ ì²˜ë¦¬</a></h3>
<p>ê°™ì€ ì´ë¦„ì´ ì—¬ëŸ¬ ë²ˆ ì •ì˜ë˜ë©´ ë§ˆì§€ë§‰ ì •ì˜ê°€ ìœ íš¨í•˜ë‹¤.</p>
<pre><code class="language-fsharp">// ì˜ˆì‹œ ì½”ë“œ
let x = 1 in
let x = 2 in
let x = 3 in
x + â–ˆ   // ì—¬ê¸°ì„œ xëŠ” 3ì„ ì˜ë¯¸
</code></pre>
<p><code>collectDefinitions</code>ëŠ” ì„¸ ê°œì˜ <code>("x", span)</code> í•­ëª©ì„ ë°˜í™˜í•œë‹¤.
<code>List.distinctBy fst</code>ë¡œ ì¤‘ë³µì„ ì œê±°í•˜ë©´ <strong>ë§ˆì§€ë§‰ <code>x</code>ë§Œ ë‚¨ëŠ”ë‹¤</strong>.</p>
<pre><code class="language-fsharp">// ì„€ë„ì‰ ì²˜ë¦¬ ë‹¨ê³„ë³„ ì„¤ëª…
definitions = [("x", span1); ("x", span2); ("x", span3)]
  |&gt; List.rev                 // [("x", span3); ("x", span2); ("x", span1)]
  |&gt; List.distinctBy fst      // [("x", span3)]  â† ì²« ë²ˆì§¸ xë§Œ ë‚¨ìŒ (rev í›„ë¼ ì‹¤ì œë¡œëŠ” ë§ˆì§€ë§‰)
  |&gt; List.rev                 // [("x", span3)]
</code></pre>
<hr>
<h2 id="íƒ€ì…-ì •ë³´-í‘œì‹œ-1"><a class="header" href="#íƒ€ì…-ì •ë³´-í‘œì‹œ-1">íƒ€ì… ì •ë³´ í‘œì‹œ</a></h2>
<h3 id="hoverfindvartypeinast-ì¬ì‚¬ìš©"><a class="header" href="#hoverfindvartypeinast-ì¬ì‚¬ìš©">Hover.findVarTypeInAst ì¬ì‚¬ìš©</a></h3>
<p>Phase 2ì˜ Hoverì—ì„œ êµ¬í˜„í•œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤.</p>
<pre><code class="language-fsharp">// Hover.fsì—ì„œ ì´ë¯¸ êµ¬í˜„ë¨
let findVarTypeInAst (varName: string) (ast: Expr) : Type.Type option
</code></pre>
<p>ì´ í•¨ìˆ˜ëŠ”:</p>
<ul>
<li>ASTë¥¼ ìˆœíšŒí•˜ë©° ë³€ìˆ˜ì˜ ë°”ì¸ë”© ì‚¬ì´íŠ¸ ì°¾ê¸°</li>
<li>ë°”ì¸ë”©ëœ ê°’ì˜ íƒ€ì… ì¶”ë¡ </li>
<li>íƒ€ì… ì–´ë…¸í…Œì´ì…˜ì´ ìˆìœ¼ë©´ ê·¸ê²ƒ ì‚¬ìš©</li>
</ul>
<h3 id="íƒ€ì…-ì •ë³´ê°€-í¬í•¨ëœ-completionitem-ìƒì„±"><a class="header" href="#íƒ€ì…-ì •ë³´ê°€-í¬í•¨ëœ-completionitem-ìƒì„±">íƒ€ì… ì •ë³´ê°€ í¬í•¨ëœ CompletionItem ìƒì„±</a></h3>
<pre><code class="language-fsharp">// Create completion items with type information
inScope
|&gt; List.map (fun (name, span) -&gt;
    // Try to get type for this symbol
    let typeInfo = Hover.findVarTypeInAst name ast

    let detail =
        match typeInfo with
        | Some ty -&gt; Some (sprintf "%s: %s" name (Type.formatTypeNormalized ty))
        | None -&gt; Some name

    {
        Label = name
        LabelDetails = None
        Kind = Some CompletionItemKind.Variable
        Detail = detail
        Documentation = None
        Deprecated = Some false
        Preselect = Some false
        SortText = None
        FilterText = None
        InsertText = Some name
        InsertTextFormat = Some InsertTextFormat.PlainText
        InsertTextMode = None
        TextEdit = None
        TextEditText = None
        AdditionalTextEdits = None
        CommitCharacters = None
        Command = None
        Data = None
        Tags = None
    })
</code></pre>
<h3 id="detail-í•„ë“œ-í˜•ì‹"><a class="header" href="#detail-í•„ë“œ-í˜•ì‹">Detail í•„ë“œ í˜•ì‹</a></h3>
<pre><code>VS Code ì™„ì„± ëª©ë¡:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ë³€ìˆ˜] x     x: int        â”‚  â† detail: "x: int"
â”‚ [ë³€ìˆ˜] double  double: int -&gt; int â”‚
â”‚ [ë³€ìˆ˜] id    id: 'a -&gt; 'a  â”‚  â† ë‹¤í˜• íƒ€ì…
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>Type.formatTypeNormalizedì˜ ì—­í• :</strong></p>
<ul>
<li><code>TInt</code> â†’ <code>"int"</code></li>
<li><code>TFunc(TInt, TInt)</code> â†’ <code>"int -&gt; int"</code></li>
<li><code>TVar(1000)</code> â†’ <code>"'a"</code> (íƒ€ì… ë³€ìˆ˜ ì •ê·œí™”)</li>
<li><code>TTuple([TInt; TBool])</code> â†’ <code>"int * bool"</code></li>
</ul>
<h3 id="variable-vs-function-êµ¬ë¶„"><a class="header" href="#variable-vs-function-êµ¬ë¶„">Variable vs Function êµ¬ë¶„</a></h3>
<p>Phase 3ì—ì„œëŠ” ëª¨ë“  ì‹¬ë³¼ì„ <code>CompletionItemKind.Variable</code>ë¡œ í‘œì‹œí•œë‹¤.</p>
<pre><code class="language-fsharp">Kind = Some CompletionItemKind.Variable  // í•¨ìˆ˜ë„ Variableë¡œ í‘œì‹œ
</code></pre>
<p><strong>ì™œ?</strong></p>
<ul>
<li>FunLangì—ì„œ í•¨ìˆ˜ë„ ì¼ê¸‰ ê°’(first-class value)</li>
<li>íƒ€ì…ì´ <code>TArrow</code>ì¸ì§€ í™•ì¸í•˜ë©´ Functionìœ¼ë¡œ êµ¬ë¶„ ê°€ëŠ¥í•˜ì§€ë§Œ, Phase 3ì€ ë‹¨ìˆœí•˜ê²Œ ìœ ì§€</li>
<li>Phase 4ì—ì„œ íƒ€ì… ê¸°ë°˜ êµ¬ë¶„ ì¶”ê°€ ê°€ëŠ¥</li>
</ul>
<hr>
<h2 id="ì„œë²„-í†µí•©-1"><a class="header" href="#ì„œë²„-í†µí•©-1">ì„œë²„ í†µí•©</a></h2>
<h3 id="handlecompletion-ë©”ì¸-í•¨ìˆ˜"><a class="header" href="#handlecompletion-ë©”ì¸-í•¨ìˆ˜">handleCompletion ë©”ì¸ í•¨ìˆ˜</a></h3>
<p>ì „ì²´ ë¡œì§ì„ ì¡°í•©í•œ í•¸ë“¤ëŸ¬ì´ë‹¤.</p>
<pre><code class="language-fsharp">/// Handle textDocument/completion request
let handleCompletion (p: CompletionParams) : Async&lt;CompletionList option&gt; =
    async {
        let uri = p.TextDocument.Uri
        let pos = p.Position

        match getDocument uri with
        | None -&gt; return None
        | Some text -&gt;
            try
                let lexbuf = FSharp.Text.Lexing.LexBuffer&lt;char&gt;.FromString(text)
                let ast = Parser.start Lexer.tokenize lexbuf

                let keywords = getKeywordCompletions()
                let symbols = getSymbolCompletions ast pos

                return Some {
                    IsIncomplete = false
                    Items = (keywords @ symbols) |&gt; Array.ofList
                    ItemDefaults = None
                }
            with _ -&gt;
                // On parse error, return only keywords (graceful degradation)
                return Some {
                    IsIncomplete = false
                    Items = getKeywordCompletions() |&gt; Array.ofList
                    ItemDefaults = None
                }
    }
</code></pre>
<h3 id="ì£¼ìš”-ì„¤ê³„-ê²°ì •"><a class="header" href="#ì£¼ìš”-ì„¤ê³„-ê²°ì •">ì£¼ìš” ì„¤ê³„ ê²°ì •</a></h3>
<p><strong>1. Graceful Degradation (ìš°ì•„í•œ ì„±ëŠ¥ ì €í•˜)</strong></p>
<p>íŒŒì‹± ì—ëŸ¬ê°€ ë°œìƒí•´ë„ í‚¤ì›Œë“œëŠ” ì œê³µí•œë‹¤.</p>
<pre><code class="language-fsharp">with _ -&gt;
    // AST ì—†ì–´ë„ í‚¤ì›Œë“œëŠ” ì‚¬ìš© ê°€ëŠ¥
    return Some {
        IsIncomplete = false
        Items = getKeywordCompletions() |&gt; Array.ofList
        ItemDefaults = None
    }
</code></pre>
<p><strong>ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤:</strong></p>
<pre><code class="language-fsharp">let x = 1 iâ–ˆ    // ì‚¬ìš©ìê°€ 'in'ì„ íƒ€ì´í•‘ ì¤‘ (ì•„ì§ ë¶ˆì™„ì „)
</code></pre>
<ul>
<li>íŒŒì‹± ì‹¤íŒ¨ (ë¶ˆì™„ì „í•œ êµ¬ë¬¸)</li>
<li>í•˜ì§€ë§Œ <code>in</code> í‚¤ì›Œë“œëŠ” ì—¬ì „íˆ ì œì•ˆë¨</li>
<li>ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ</li>
</ul>
<p><strong>2. IsIncomplete = false</strong></p>
<p>Phase 3ì—ì„œëŠ” ëª¨ë“  í›„ë³´ë¥¼ í•œ ë²ˆì— ë°˜í™˜í•œë‹¤.</p>
<pre><code class="language-fsharp">IsIncomplete = false  // ì¶”ê°€ í›„ë³´ ì—†ìŒ
</code></pre>
<p><code>IsIncomplete = true</code>ëŠ” ì–¸ì œ ì‚¬ìš©?</p>
<ul>
<li>ì‹¬ë³¼ í…Œì´ë¸”ì´ ë§¤ìš° í° ê²½ìš° (ìˆ˜ì²œ ê°œ ì´ìƒ)</li>
<li>ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹ìœ¼ë¡œ ì ì§„ì  ë¡œë”©</li>
<li>FunLangì€ ë‹¨ì¼ íŒŒì¼ì´ë¼ í•„ìš” ì—†ìŒ</li>
</ul>
<p><strong>3. íŠ¸ë¦¬ê±° ë¬¸ì ì—†ìŒ</strong></p>
<p>Phase 3ì—ì„œëŠ” ì‚¬ìš©ìê°€ ëª…ì‹œì ìœ¼ë¡œ ì™„ì„±ì„ í˜¸ì¶œí•œë‹¤ (Ctrl+Space).</p>
<pre><code class="language-fsharp">// Server.fs
CompletionProvider = Some {
    ResolveProvider = Some false
    TriggerCharacters = None  // Phase 3: íŠ¸ë¦¬ê±° ë¬¸ì ì—†ìŒ
    AllCommitCharacters = None
    WorkDoneProgress = None
}
</code></pre>
<p>íŠ¸ë¦¬ê±° ë¬¸ì (<code>.</code>, <code>::</code> ë“±)ëŠ” Phase 4ì—ì„œ ì¶”ê°€ ê°€ëŠ¥.</p>
<h3 id="serverfs-ë“±ë¡-1"><a class="header" href="#serverfs-ë“±ë¡-1">Server.fs ë“±ë¡</a></h3>
<pre><code class="language-fsharp">// Server.fs
module LangLSP.Server.Server

open Ionide.LanguageServerProtocol.Server
open Ionide.LanguageServerProtocol.Types

type FunLangLspServer() =
    inherit LspServer()

    override this.Initialize(p: InitializeParams) =
        async {
            return {
                Capabilities = {
                    TextDocumentSync = Some {
                        OpenClose = Some true
                        Change = Some TextDocumentSyncKind.Full
                        WillSave = None
                        WillSaveWaitUntil = None
                        Save = None
                    }
                    DefinitionProvider = Some (U2.C1 true)
                    HoverProvider = Some (U2.C1 true)
                    CompletionProvider = Some {
                        ResolveProvider = Some false
                        TriggerCharacters = None
                        AllCommitCharacters = None
                        WorkDoneProgress = None
                    }
                    // ... ë‹¤ë¥¸ capabilities
                }
            }
        }

    override this.TextDocumentCompletion(p: CompletionParams) =
        async {
            let! result = Completion.handleCompletion p
            return result
        }
</code></pre>
<hr>
<h2 id="í…ŒìŠ¤íŠ¸-ì‘ì„±-3"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‘ì„±-3">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></h2>
<h3 id="í…ŒìŠ¤íŠ¸-í—¬í¼-í•¨ìˆ˜-1"><a class="header" href="#í…ŒìŠ¤íŠ¸-í—¬í¼-í•¨ìˆ˜-1">í…ŒìŠ¤íŠ¸ í—¬í¼ í•¨ìˆ˜</a></h3>
<pre><code class="language-fsharp">// CompletionTests.fs
module LangLSP.Tests.CompletionTests

open Expecto
open Ionide.LanguageServerProtocol.Types
open LangLSP.Server.Completion
open LangLSP.Server.DocumentSync

/// CompletionParams ìƒì„± í—¬í¼
let makeCompletionParams uri line char : CompletionParams =
    {
        TextDocument = { Uri = uri }
        Position = { Line = uint32 line; Character = uint32 char }
        Context = None  // íŠ¸ë¦¬ê±° ì»¨í…ìŠ¤íŠ¸ ì—†ìŒ
        WorkDoneToken = None
        PartialResultToken = None
    }

/// ë¬¸ì„œ ì„¤ì • í›„ completion ìˆ˜í–‰
let setupAndComplete uri text line char =
    clearAll()  // ë¬¸ì„œ ì €ì¥ì†Œ ì´ˆê¸°í™”
    handleDidOpen (makeDidOpenParams uri text)
    handleCompletion (makeCompletionParams uri line char) |&gt; Async.RunSynchronously

/// CompletionListì—ì„œ label ì¶”ì¶œ
let getCompletionLabels (result: CompletionList option) : string list =
    result
    |&gt; Option.map (fun list -&gt; list.Items |&gt; Array.map (fun item -&gt; item.Label) |&gt; Array.toList)
    |&gt; Option.defaultValue []
</code></pre>
<h3 id="í‚¤ì›Œë“œ-ì™„ì„±-í…ŒìŠ¤íŠ¸"><a class="header" href="#í‚¤ì›Œë“œ-ì™„ì„±-í…ŒìŠ¤íŠ¸">í‚¤ì›Œë“œ ì™„ì„± í…ŒìŠ¤íŠ¸</a></h3>
<pre><code class="language-fsharp">[&lt;Tests&gt;]
let completionTests = testList "Completion" [
    testList "Keyword completion" [
        testCase "includes all FunLang keywords" &lt;| fun _ -&gt;
            let result = setupAndComplete "file:///test.fun" "" 0 0
            let labels = getCompletionLabels result

            Expect.contains labels "let" "Should include 'let'"
            Expect.contains labels "in" "Should include 'in'"
            Expect.contains labels "if" "Should include 'if'"
            Expect.contains labels "fun" "Should include 'fun'"
            Expect.contains labels "match" "Should include 'match'"

        testCase "keywords have Keyword kind" &lt;| fun _ -&gt;
            let result = setupAndComplete "file:///test.fun" "" 0 0
            match result with
            | Some list -&gt;
                let letItem = list.Items |&gt; Array.find (fun item -&gt; item.Label = "let")
                Expect.equal letItem.Kind (Some CompletionItemKind.Keyword) "Should be Keyword kind"
            | None -&gt; failtest "Expected completion result"

        testCase "keywords returned on parse error" &lt;| fun _ -&gt;
            // ë¶ˆì™„ì „í•œ ì½”ë“œì—ì„œë„ í‚¤ì›Œë“œëŠ” ì œê³µë¨
            let result = setupAndComplete "file:///test.fun" "let x =" 0 7
            let labels = getCompletionLabels result
            Expect.contains labels "let" "Should include keywords even on parse error"
    ]
]
</code></pre>
<h3 id="ì‹¬ë³¼-ì™„ì„±-í…ŒìŠ¤íŠ¸"><a class="header" href="#ì‹¬ë³¼-ì™„ì„±-í…ŒìŠ¤íŠ¸">ì‹¬ë³¼ ì™„ì„± í…ŒìŠ¤íŠ¸</a></h3>
<pre><code class="language-fsharp">    testList "Symbol completion" [
        testCase "includes variable in scope" &lt;| fun _ -&gt;
            let text = "let x = 42 in x"
            let result = setupAndComplete "file:///test.fun" text 0 14
            let labels = getCompletionLabels result
            Expect.contains labels "x" "Should include variable x"

        testCase "includes function in scope" &lt;| fun _ -&gt;
            let text = "let double = fun x -&gt; x * 2 in double 5"
            let result = setupAndComplete "file:///test.fun" text 0 31
            let labels = getCompletionLabels result
            Expect.contains labels "double" "Should include function double"

        testCase "symbols have Variable kind" &lt;| fun _ -&gt;
            let text = "let x = 42 in x"
            let result = setupAndComplete "file:///test.fun" text 0 14
            match result with
            | Some list -&gt;
                let xItem = list.Items |&gt; Array.tryFind (fun item -&gt; item.Label = "x")
                match xItem with
                | Some item -&gt;
                    Expect.equal item.Kind (Some CompletionItemKind.Variable) "Should be Variable kind"
                | None -&gt; failtest "Expected x in completion items"
            | None -&gt; failtest "Expected completion result"
    ]
</code></pre>
<h3 id="ìŠ¤ì½”í”„-í•„í„°ë§-í…ŒìŠ¤íŠ¸"><a class="header" href="#ìŠ¤ì½”í”„-í•„í„°ë§-í…ŒìŠ¤íŠ¸">ìŠ¤ì½”í”„ í•„í„°ë§ í…ŒìŠ¤íŠ¸</a></h3>
<pre><code class="language-fsharp">    testList "Scope filtering" [
        testCase "excludes variable defined after cursor" &lt;| fun _ -&gt;
            let text = "let x = (let y = 1 in y) in x"
            // ì»¤ì„œê°€ let y ì „ (ê´„í˜¸ ë‹¤ìŒ)
            let result = setupAndComplete "file:///test.fun" text 0 9
            let labels = getCompletionLabels result
            Expect.isFalse (labels |&gt; List.contains "y") "Should not include y (not in scope yet)"

        testCase "includes variable defined before cursor" &lt;| fun _ -&gt;
            let text = "let x = 42 in let y = x + 1 in y"
            // ì»¤ì„œê°€ y ì •ì˜ ë‚´ë¶€ (x + 1 ë¶€ë¶„)
            let result = setupAndComplete "file:///test.fun" text 0 24
            let labels = getCompletionLabels result
            Expect.contains labels "x" "Should include x (defined before)"

        testCase "shadowing: uses most recent definition" &lt;| fun _ -&gt;
            let text = "let x = 1 in let x = 2 in x"
            let result = setupAndComplete "file:///test.fun" text 0 26
            let labels = getCompletionLabels result
            // xëŠ” í•œ ë²ˆë§Œ ë‚˜íƒ€ë‚˜ì•¼ í•¨ (ì„€ë„ì‰)
            let xCount = labels |&gt; List.filter ((=) "x") |&gt; List.length
            Expect.equal xCount 1 "Should have only one x in completion"
    ]
</code></pre>
<h3 id="íƒ€ì…-ì •ë³´-í…ŒìŠ¤íŠ¸"><a class="header" href="#íƒ€ì…-ì •ë³´-í…ŒìŠ¤íŠ¸">íƒ€ì… ì •ë³´ í…ŒìŠ¤íŠ¸</a></h3>
<pre><code class="language-fsharp">    testList "Type information" [
        testCase "shows type for integer variable" &lt;| fun _ -&gt;
            let text = "let x = 42 in x"
            let result = setupAndComplete "file:///test.fun" text 0 14
            match result with
            | Some list -&gt;
                let xItem = list.Items |&gt; Array.tryFind (fun item -&gt; item.Label = "x")
                match xItem with
                | Some item -&gt;
                    match item.Detail with
                    | Some detail -&gt;
                        Expect.stringContains detail "int" "Should show int type"
                    | None -&gt; failtest "Expected detail with type"
                | None -&gt; failtest "Expected x in completion items"
            | None -&gt; failtest "Expected completion result"

        testCase "shows type for function" &lt;| fun _ -&gt;
            let text = "let double = fun x -&gt; x * 2 in double 5"
            let result = setupAndComplete "file:///test.fun" text 0 31
            match result with
            | Some list -&gt;
                let doubleItem = list.Items |&gt; Array.tryFind (fun item -&gt; item.Label = "double")
                match doubleItem with
                | Some item -&gt;
                    match item.Detail with
                    | Some detail -&gt;
                        Expect.stringContains detail "int -&gt; int" "Should show function type"
                    | None -&gt; failtest "Expected detail with type"
                | None -&gt; failtest "Expected double in completion items"
            | None -&gt; failtest "Expected completion result"

        testCase "shows polymorphic type" &lt;| fun _ -&gt;
            let text = "let id = fun x -&gt; x in id"
            let result = setupAndComplete "file:///test.fun" text 0 23
            match result with
            | Some list -&gt;
                let idItem = list.Items |&gt; Array.tryFind (fun item -&gt; item.Label = "id")
                match idItem with
                | Some item -&gt;
                    match item.Detail with
                    | Some detail -&gt;
                        Expect.stringContains detail "'a" "Should show polymorphic type"
                    | None -&gt; failtest "Expected detail with type"
                | None -&gt; failtest "Expected id in completion items"
            | None -&gt; failtest "Expected completion result"
    ]
] |&gt; testSequenced  // ê³µìœ  ìƒíƒœë¡œ ì¸í•´ ìˆœì°¨ ì‹¤í–‰
</code></pre>
<h3 id="í…ŒìŠ¤íŠ¸-ì‹¤í–‰-3"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‹¤í–‰-3">í…ŒìŠ¤íŠ¸ ì‹¤í–‰</a></h3>
<pre><code class="language-bash">dotnet test src/LangLSP.Tests

# ê²°ê³¼:
# [Completion/Keyword completion] includes all FunLang keywords - Passed
# [Completion/Keyword completion] keywords have Keyword kind - Passed
# [Completion/Keyword completion] keywords returned on parse error - Passed
# [Completion/Symbol completion] includes variable in scope - Passed
# [Completion/Symbol completion] includes function in scope - Passed
# [Completion/Symbol completion] symbols have Variable kind - Passed
# [Completion/Scope filtering] excludes variable defined after cursor - Passed
# [Completion/Scope filtering] includes variable defined before cursor - Passed
# [Completion/Scope filtering] shadowing: uses most recent definition - Passed
# [Completion/Type information] shows type for integer variable - Passed
# [Completion/Type information] shows type for function - Passed
# [Completion/Type information] shows polymorphic type - Passed
</code></pre>
<hr>
<h2 id="í”í•œ-ì‹¤ìˆ˜ì™€-í•´ê²°ì±…-1"><a class="header" href="#í”í•œ-ì‹¤ìˆ˜ì™€-í•´ê²°ì±…-1">í”í•œ ì‹¤ìˆ˜ì™€ í•´ê²°ì±…</a></h2>
<h3 id="1-completionlist-vs-completionitem-í˜¼ë™"><a class="header" href="#1-completionlist-vs-completionitem-í˜¼ë™">1. CompletionList vs CompletionItem[] í˜¼ë™</a></h3>
<p><strong>ì¦ìƒ:</strong> ì™„ì„± ëª©ë¡ì´ VS Codeì— í‘œì‹œë˜ì§€ ì•ŠìŒ</p>
<p><strong>ì›ì¸:</strong> LSP ìŠ¤í™ì€ ë‘ ê°€ì§€ ë°˜í™˜ íƒ€ì…ì„ í—ˆìš©í•˜ì§€ë§Œ, IonideëŠ” <code>CompletionList option</code> ì‚¬ìš©</p>
<pre><code class="language-fsharp">// âŒ ì˜ëª»ëœ ë°©ë²• (ë°°ì—´ ë°˜í™˜)
let handleCompletion (p: CompletionParams) : Async&lt;CompletionItem[] option&gt; =
    async {
        let items = getKeywordCompletions() |&gt; Array.ofList
        return Some items  // íƒ€ì… ë¶ˆì¼ì¹˜!
    }

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²• (CompletionList ë°˜í™˜)
let handleCompletion (p: CompletionParams) : Async&lt;CompletionList option&gt; =
    async {
        return Some {
            IsIncomplete = false
            Items = getKeywordCompletions() |&gt; Array.ofList
            ItemDefaults = None
        }
    }
</code></pre>
<h3 id="2-0-based-vs-1-based-ì¢Œí‘œ-í˜¼ë™"><a class="header" href="#2-0-based-vs-1-based-ì¢Œí‘œ-í˜¼ë™">2. 0-based vs 1-based ì¢Œí‘œ í˜¼ë™</a></h3>
<p><strong>ì¦ìƒ:</strong> ì™„ì„± ëª©ë¡ì— ìŠ¤ì½”í”„ ì™¸ ë³€ìˆ˜ê°€ í¬í•¨ë˜ê±°ë‚˜ ìŠ¤ì½”í”„ ë‚´ ë³€ìˆ˜ê°€ ëˆ„ë½ë¨</p>
<p><strong>ì›ì¸:</strong> FsLexYacc ë¬¸ì„œëŠ” 1-basedë¼ê³  í•˜ì§€ë§Œ <code>LexBuffer.FromString</code>ì€ 0-based!</p>
<pre><code class="language-fsharp">// âŒ ì˜ëª»ëœ ë°©ë²• (1-basedë¡œ ê°€ì •)
span.StartLine &lt; int pos.Line - 1  // ë¶ˆí•„ìš”í•œ -1

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²• (0-based ì§ì ‘ ì‚¬ìš©)
span.StartLine &lt; int pos.Line  // LSPì™€ FunLang ëª¨ë‘ 0-based
</code></pre>
<p><strong>ê²€ì¦ ë°©ë²•:</strong></p>
<pre><code class="language-fsharp">// ì²« ì¤„, ì²« ë¬¸ìëŠ” (0, 0)
let text = "let x = 42"
let pos = { Line = 0u; Character = 0u }  // ì²« ìœ„ì¹˜
</code></pre>
<h3 id="3-ìŠ¤ì½”í”„-ì™¸-ì‹¬ë³¼-í¬í•¨"><a class="header" href="#3-ìŠ¤ì½”í”„-ì™¸-ì‹¬ë³¼-í¬í•¨">3. ìŠ¤ì½”í”„ ì™¸ ì‹¬ë³¼ í¬í•¨</a></h3>
<p><strong>ì¦ìƒ:</strong> ì•„ì§ ì •ì˜ë˜ì§€ ì•Šì€ ë³€ìˆ˜ê°€ ì™„ì„± ëª©ë¡ì— ë‚˜íƒ€ë‚¨</p>
<p><strong>ì›ì¸:</strong> ìŠ¤ì½”í”„ í•„í„°ë§ ëˆ„ë½</p>
<pre><code class="language-fsharp">// âŒ ì˜ëª»ëœ ë°©ë²• (ëª¨ë“  ì‹¬ë³¼ ë°˜í™˜)
let getSymbolCompletions (ast: Expr) (pos: Position) =
    Definition.collectDefinitions ast  // ìœ„ì¹˜ í•„í„°ë§ ì—†ìŒ
    |&gt; List.map createCompletionItem

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²• (ì»¤ì„œ ì´ì „ ì •ì˜ë§Œ)
let getSymbolCompletions (ast: Expr) (pos: Position) =
    Definition.collectDefinitions ast
    |&gt; List.filter (fun (_, span) -&gt;
        span.StartLine &lt; int pos.Line ||
        (span.StartLine = int pos.Line &amp;&amp; span.StartColumn &lt; int pos.Character))
    |&gt; List.map createCompletionItem
</code></pre>
<h3 id="4-íƒ€ì…-ì •ë³´-ëˆ„ë½"><a class="header" href="#4-íƒ€ì…-ì •ë³´-ëˆ„ë½">4. íƒ€ì… ì •ë³´ ëˆ„ë½</a></h3>
<p><strong>ì¦ìƒ:</strong> ì™„ì„± í•­ëª©ì— íƒ€ì…ì´ í‘œì‹œë˜ì§€ ì•ŠìŒ</p>
<p><strong>ì›ì¸:</strong> <code>findVarTypeInAst</code> í˜¸ì¶œ ëˆ„ë½</p>
<pre><code class="language-fsharp">// âŒ ì˜ëª»ëœ ë°©ë²• (íƒ€ì… ì •ë³´ ì—†ìŒ)
let detail = Some name  // ì´ë¦„ë§Œ í‘œì‹œ

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²• (íƒ€ì… ì •ë³´ ì¶”ê°€)
let typeInfo = Hover.findVarTypeInAst name ast
let detail =
    match typeInfo with
    | Some ty -&gt; Some (sprintf "%s: %s" name (Type.formatTypeNormalized ty))
    | None -&gt; Some name
</code></pre>
<p><strong>ì£¼ì˜:</strong> íƒ€ì… ì¶”ë¡  ì‹¤íŒ¨ëŠ” ì •ìƒì ì¸ ìƒí™©ì´ë‹¤ (ëŒë‹¤ ë§¤ê°œë³€ìˆ˜ ë“±). Noneì„ ë°˜í™˜í•´ë„ ë¬¸ì œì—†ë‹¤.</p>
<h3 id="5-íŠ¸ë¦¬ê±°-ë¬¸ì-ì„¤ì •-ë¬¸ì œ"><a class="header" href="#5-íŠ¸ë¦¬ê±°-ë¬¸ì-ì„¤ì •-ë¬¸ì œ">5. íŠ¸ë¦¬ê±° ë¬¸ì ì„¤ì • ë¬¸ì œ</a></h3>
<p><strong>ì¦ìƒ:</strong> ìë™ ì™„ì„±ì´ <code>.</code> ì…ë ¥ ì‹œ ì‘ë™í•˜ì§€ ì•Šê±°ë‚˜ ë„ˆë¬´ ìì£¼ íŠ¸ë¦¬ê±°ë¨</p>
<p><strong>ì›ì¸:</strong> Phase 3ì€ íŠ¸ë¦¬ê±° ë¬¸ìë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŒ</p>
<pre><code class="language-fsharp">// âŒ Phase 3ì—ì„œ íŠ¸ë¦¬ê±° ë¬¸ì ì¶”ê°€ (ê¶Œì¥í•˜ì§€ ì•ŠìŒ)
CompletionProvider = Some {
    ResolveProvider = Some false
    TriggerCharacters = Some [| "." |]  // ì¶”ê°€ í•„í„°ë§ ë¡œì§ í•„ìš”
    // ...
}

// âœ… Phase 3ì—ì„œëŠ” ìˆ˜ë™ í˜¸ì¶œë§Œ
CompletionProvider = Some {
    ResolveProvider = Some false
    TriggerCharacters = None  // ëª…ì‹œì ìœ¼ë¡œ None
    // ...
}
</code></pre>
<p>íŠ¸ë¦¬ê±° ë¬¸ìëŠ” ì»¨í…ìŠ¤íŠ¸ì— ë”°ë¥¸ í•„í„°ë§ì´ í•„ìš”í•˜ë‹¤:</p>
<ul>
<li><code>.</code> ì…ë ¥ í›„ â†’ ë ˆì½”ë“œ/ëª¨ë“ˆ ë©¤ë²„ë§Œ í‘œì‹œ</li>
<li><code>::</code> ì…ë ¥ í›„ â†’ ë¦¬ìŠ¤íŠ¸ ê´€ë ¨ ì‹¬ë³¼ë§Œ í‘œì‹œ</li>
</ul>
<p>Phase 4ì—ì„œ ì¶”ê°€ ê°€ëŠ¥.</p>
<h3 id="6-ì„€ë„ì‰-ì²˜ë¦¬-ëˆ„ë½"><a class="header" href="#6-ì„€ë„ì‰-ì²˜ë¦¬-ëˆ„ë½">6. ì„€ë„ì‰ ì²˜ë¦¬ ëˆ„ë½</a></h3>
<p><strong>ì¦ìƒ:</strong> ê°™ì€ ë³€ìˆ˜ ì´ë¦„ì´ ì—¬ëŸ¬ ë²ˆ ì™„ì„± ëª©ë¡ì— ë‚˜íƒ€ë‚¨</p>
<p><strong>ì›ì¸:</strong> <code>List.distinctBy</code> ëˆ„ë½</p>
<pre><code class="language-fsharp">// âŒ ì˜ëª»ëœ ë°©ë²• (ì¤‘ë³µ í¬í•¨)
definitions
|&gt; List.filter (fun (_, span) -&gt; (* ìŠ¤ì½”í”„ ì²´í¬ *))
|&gt; List.map createCompletionItem

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²• (ì¤‘ë³µ ì œê±°)
definitions
|&gt; List.filter (fun (_, span) -&gt; (* ìŠ¤ì½”í”„ ì²´í¬ *))
|&gt; List.rev
|&gt; List.distinctBy fst  // ë§ˆì§€ë§‰ ì •ì˜ë§Œ ìœ ì§€
|&gt; List.rev
|&gt; List.map createCompletionItem
</code></pre>
<h3 id="7-íŒŒì‹±-ì—ëŸ¬-ì‹œ-ë¹ˆ-ëª©ë¡-ë°˜í™˜"><a class="header" href="#7-íŒŒì‹±-ì—ëŸ¬-ì‹œ-ë¹ˆ-ëª©ë¡-ë°˜í™˜">7. íŒŒì‹± ì—ëŸ¬ ì‹œ ë¹ˆ ëª©ë¡ ë°˜í™˜</a></h3>
<p><strong>ì¦ìƒ:</strong> ë¶ˆì™„ì „í•œ ì½”ë“œ ì…ë ¥ ì‹œ ì•„ë¬´ ì™„ì„±ë„ í‘œì‹œë˜ì§€ ì•ŠìŒ</p>
<p><strong>ì›ì¸:</strong> ì˜ˆì™¸ ì²˜ë¦¬ì—ì„œ None ë°˜í™˜</p>
<pre><code class="language-fsharp">// âŒ ì˜ëª»ëœ ë°©ë²• (íŒŒì‹± ì‹¤íŒ¨ ì‹œ ë¹ˆ ê²°ê³¼)
try
    let ast = Parser.start Lexer.tokenize lexbuf
    // ...
with _ -&gt;
    return None  // ì•„ë¬´ê²ƒë„ ì•ˆ ë³´ì„!

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²• (í‚¤ì›Œë“œë¼ë„ ì œê³µ)
try
    let ast = Parser.start Lexer.tokenize lexbuf
    // ...
with _ -&gt;
    // Graceful degradation: í‚¤ì›Œë“œëŠ” í•­ìƒ ìœ íš¨
    return Some {
        IsIncomplete = false
        Items = getKeywordCompletions() |&gt; Array.ofList
        ItemDefaults = None
    }
</code></pre>
<hr>
<h2 id="ì •ë¦¬-1"><a class="header" href="#ì •ë¦¬-1">ì •ë¦¬</a></h2>
<p>Completion êµ¬í˜„ì˜ í•µì‹¬ í¬ì¸íŠ¸:</p>
<ol>
<li><strong>ë‘ ê°€ì§€ ì†ŒìŠ¤</strong>: í‚¤ì›Œë“œ (ì •ì  ë¦¬ìŠ¤íŠ¸) + ì‹¬ë³¼ (ASTì—ì„œ ìˆ˜ì§‘)</li>
<li><strong>ê¸°ì¡´ ì¸í”„ë¼ ì¬ì‚¬ìš©</strong>:
<ul>
<li><code>Definition.collectDefinitions</code>ë¡œ ì‹¬ë³¼ ìˆ˜ì§‘</li>
<li><code>Hover.findVarTypeInAst</code>ë¡œ íƒ€ì… ì •ë³´ ì¶”ê°€</li>
</ul>
</li>
<li><strong>ìŠ¤ì½”í”„ í•„í„°ë§</strong>: ì»¤ì„œ ì´ì „ì— ì •ì˜ëœ ì‹¬ë³¼ë§Œ í¬í•¨</li>
<li><strong>ì„€ë„ì‰ ì²˜ë¦¬</strong>: <code>List.distinctBy</code>ë¡œ ì¤‘ë³µ ì œê±°</li>
<li><strong>Graceful Degradation</strong>: íŒŒì‹± ì‹¤íŒ¨ ì‹œ í‚¤ì›Œë“œë§Œ ë°˜í™˜</li>
<li><strong>í´ë¼ì´ì–¸íŠ¸ í•„í„°ë§</strong>: ì„œë²„ëŠ” ëª¨ë“  í›„ë³´ ë°˜í™˜, í´ë¼ì´ì–¸íŠ¸ê°€ í¼ì§€ ë§¤ì¹­</li>
</ol>
<hr>
<h2 id="ë‹¤ìŒ-ë‹¨ê³„-6"><a class="header" href="#ë‹¤ìŒ-ë‹¨ê³„-6">ë‹¤ìŒ ë‹¨ê³„</a></h2>
<p>Completion êµ¬í˜„ìœ¼ë¡œ Phase 3ì´ ì™„ë£Œëœë‹¤!</p>
<p>Phase 4ì—ì„œëŠ”:</p>
<ul>
<li><strong>Find References</strong>: ì‹¬ë³¼ì´ ì‚¬ìš©ëœ ëª¨ë“  ìœ„ì¹˜ ì°¾ê¸°</li>
<li><strong>Rename</strong>: ì‹¬ë³¼ ì´ë¦„ì„ í”„ë¡œì íŠ¸ ì „ì²´ì—ì„œ ì¼ê´„ ë³€ê²½</li>
<li><strong>Code Actions</strong>: Quick Fix ì œì•ˆ (ì˜ˆ: íƒ€ì… ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€)</li>
</ul>
<p>ê³ ê¸‰ Completion ê¸°ëŠ¥:</p>
<ul>
<li><strong>íŠ¸ë¦¬ê±° ë¬¸ì</strong>: <code>.</code>, <code>::</code> ì…ë ¥ ì‹œ ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ì™„ì„±</li>
<li><strong>CompletionItem/resolve</strong>: ì§€ì—° ë¡œë”©ìœ¼ë¡œ ìƒì„¸ ì •ë³´ ì œê³µ</li>
<li><strong>Snippet ì§€ì›</strong>: <code>fun $1 -&gt; $0</code> ê°™ì€ í”Œë ˆì´ìŠ¤í™€ë”</li>
</ul>
<hr>
<h2 id="ì°¸ê³ -ìë£Œ-6"><a class="header" href="#ì°¸ê³ -ìë£Œ-6">ì°¸ê³  ìë£Œ</a></h2>
<ul>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocument_completion">LSP Specification - textDocument/completion</a></li>
<li><a href="https://github.com/ionide/LanguageServerProtocol">Ionide.LanguageServerProtocol - CompletionParams/CompletionList</a></li>
<li><a href="https://github.com/ionide/FsAutoComplete/blob/main/test/FsAutoComplete.Tests.Lsp/CompletionTests.fs">FsAutoComplete - CompletionTests.fs</a></li>
<li><a href="https://thunderseethe.dev/posts/lsp-base/">Making an LSP for great good - Completion</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="go-to-definition-êµ¬í˜„í•˜ê¸°"><a class="header" href="#go-to-definition-êµ¬í˜„í•˜ê¸°">Go to Definition êµ¬í˜„í•˜ê¸°</a></h1>
<p>ì´ ë¬¸ì„œëŠ” LSP ì„œë²„ì—ì„œ <strong>Go to Definition</strong> ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•œë‹¤. ë³€ìˆ˜ë‚˜ í•¨ìˆ˜ë¥¼ í´ë¦­í•˜ê³  â€œGo to Definitionâ€œì„ ì‹¤í–‰í•˜ë©´ í•´ë‹¹ ì‹¬ë³¼ì´ ì •ì˜ëœ ìœ„ì¹˜ë¡œ ì´ë™í•œë‹¤. ì´ ê¸°ëŠ¥ì€ ì½”ë“œ ë„¤ë¹„ê²Œì´ì…˜ì˜ í•µì‹¬ìœ¼ë¡œ, ëŒ€ê·œëª¨ ì½”ë“œë² ì´ìŠ¤ì—ì„œ íŠ¹íˆ ìœ ìš©í•˜ë‹¤.</p>
<h2 id="ëª©ì°¨-7"><a class="header" href="#ëª©ì°¨-7">ëª©ì°¨</a></h2>
<ol>
<li><a href="#go-to-definitionì´ë€">Go to Definitionì´ë€</a></li>
<li><a href="#lsp-í”„ë¡œí† ì½œ">LSP í”„ë¡œí† ì½œ</a></li>
<li><a href="#ì‹¬ë³¼-í…Œì´ë¸”">ì‹¬ë³¼ í…Œì´ë¸”</a></li>
<li><a href="#funlangì˜-ë°”ì¸ë”©-ìœ„ì¹˜">FunLangì˜ ë°”ì¸ë”© ìœ„ì¹˜</a></li>
<li><a href="#ì •ì˜-ìˆ˜ì§‘-êµ¬í˜„">ì •ì˜ ìˆ˜ì§‘ êµ¬í˜„</a></li>
<li><a href="#ë³€ìˆ˜-ì„€ë„ì‰-ì²˜ë¦¬">ë³€ìˆ˜ ì„€ë„ì‰ ì²˜ë¦¬</a></li>
<li><a href="#ì‹ë³„ì-ìœ„ì¹˜-ì •í™•íˆ-ì°¾ê¸°">ì‹ë³„ì ìœ„ì¹˜ ì •í™•íˆ ì°¾ê¸°</a></li>
<li><a href="#í•¸ë“¤ëŸ¬-êµ¬í˜„">í•¸ë“¤ëŸ¬ êµ¬í˜„</a></li>
<li><a href="#serverfs-í†µí•©">Server.fs í†µí•©</a></li>
<li><a href="#í…ŒìŠ¤íŠ¸-ì‘ì„±-4">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></li>
<li><a href="#ì‹±ê¸€-íŒŒì¼-vs-ë©€í‹°-íŒŒì¼">ì‹±ê¸€ íŒŒì¼ vs ë©€í‹° íŒŒì¼</a></li>
</ol>
<hr>
<h2 id="go-to-definitionì´ë€"><a class="header" href="#go-to-definitionì´ë€">Go to Definitionì´ë€</a></h2>
<p><strong>Go to Definition</strong>ì€ ë³€ìˆ˜ë‚˜ í•¨ìˆ˜ ì´ë¦„ ìœ„ì—ì„œ íŠ¸ë¦¬ê±°í•˜ë©´ í•´ë‹¹ ì‹¬ë³¼ì´ <strong>ì²˜ìŒ ì •ì˜ëœ ìœ„ì¹˜</strong>ë¡œ ì´ë™í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤.</p>
<h3 id="vs-codeì—ì„œì˜-ì‚¬ìš©"><a class="header" href="#vs-codeì—ì„œì˜-ì‚¬ìš©">VS Codeì—ì„œì˜ ì‚¬ìš©</a></h3>
<pre><code>test.fun
â”€â”€â”€â”€â”€â”€â”€â”€
1 | let add = fun x -&gt; fun y -&gt; x + y in
2 | let result = add 1 2 in
        ^^^
        [F12] ë˜ëŠ” [Ctrl+í´ë¦­]
        â†’ 1ë²ˆ ë¼ì¸ì˜ "add" ì •ì˜ë¡œ ì´ë™
</code></pre>
<p><strong>íŠ¸ë¦¬ê±° ë°©ë²•:</strong></p>
<ul>
<li><code>F12</code> í‚¤</li>
<li><code>Ctrl+í´ë¦­</code> (Windows/Linux) ë˜ëŠ” <code>Cmd+í´ë¦­</code> (Mac)</li>
<li>ìš°í´ë¦­ â†’ â€œGo to Definitionâ€</li>
</ul>
<h3 id="í•µì‹¬-ë™ì‘"><a class="header" href="#í•µì‹¬-ë™ì‘">í•µì‹¬ ë™ì‘</a></h3>
<ol>
<li>ì‚¬ìš©ìê°€ ì»¤ì„œë¥¼ ë³€ìˆ˜ ìœ„ì— ë†“ìŒ</li>
<li>í´ë¼ì´ì–¸íŠ¸ê°€ <code>textDocument/definition</code> ìš”ì²­ ì „ì†¡</li>
<li>ì„œë²„ê°€ í•´ë‹¹ ë³€ìˆ˜ì˜ <strong>ì •ì˜ ìœ„ì¹˜</strong> ë°˜í™˜</li>
<li>í´ë¼ì´ì–¸íŠ¸ê°€ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì»¤ì„œ ì´ë™</li>
</ol>
<pre class="mermaid">sequenceDiagram
    participant C as Client
    participant S as Server
    C-&gt;&gt;S: textDocument/definition(uri, position)
    Note over S: ì‹¬ë³¼ í…Œì´ë¸”ì—ì„œ ë°”ì¸ë”© ìœ„ì¹˜ ì¡°íšŒ
    S-&gt;&gt;C: Location(uri, range)
    Note over C: ì •ì˜ ìœ„ì¹˜ë¡œ ì´ë™
</pre>

<hr>
<h2 id="lsp-í”„ë¡œí† ì½œ"><a class="header" href="#lsp-í”„ë¡œí† ì½œ">LSP í”„ë¡œí† ì½œ</a></h2>
<h3 id="textdocumentdefinition-ìš”ì²­"><a class="header" href="#textdocumentdefinition-ìš”ì²­">textDocument/definition ìš”ì²­</a></h3>
<pre><code class="language-typescript">interface DefinitionParams {
    textDocument: TextDocumentIdentifier  // { uri: "file:///test.fun" }
    position: Position                     // { line: 1, character: 13 }
}
</code></pre>
<p><strong>ìš”ì²­ ì˜ˆì‹œ:</strong></p>
<pre><code class="language-json">{
    "jsonrpc": "2.0",
    "id": 5,
    "method": "textDocument/definition",
    "params": {
        "textDocument": { "uri": "file:///test.fun" },
        "position": { "line": 1, "character": 13 }
    }
}
</code></pre>
<h3 id="ì‘ë‹µ-í˜•ì‹"><a class="header" href="#ì‘ë‹µ-í˜•ì‹">ì‘ë‹µ í˜•ì‹</a></h3>
<p>LSPëŠ” ì„¸ ê°€ì§€ ì‘ë‹µ í˜•ì‹ì„ ì§€ì›í•œë‹¤:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>í˜•ì‹</th><th>ì–¸ì œ ì‚¬ìš©</th><th>ì˜ˆì‹œ</th></tr>
</thead>
<tbody>
<tr><td><code>Location</code></td><td>ì •ì˜ê°€ í•˜ë‚˜ì¼ ë•Œ</td><td>ì¼ë°˜ì ì¸ ë³€ìˆ˜/í•¨ìˆ˜</td></tr>
<tr><td><code>Location[]</code></td><td>ì •ì˜ê°€ ì—¬ëŸ¬ ê°œì¼ ë•Œ</td><td>ì˜¤ë²„ë¡œë”©, ì—¬ëŸ¬ íŒŒì¼</td></tr>
<tr><td><code>LocationLink[]</code></td><td>ì¶”ê°€ ì»¨í…ìŠ¤íŠ¸ í•„ìš”í•  ë•Œ</td><td>ì •ì˜ ë²”ìœ„ ê°•ì¡°</td></tr>
</tbody>
</table>
</div>
<p>FunLangì€ <strong>ì‹±ê¸€ íŒŒì¼ + ë‹¨ì¼ ì •ì˜</strong>ì´ë¯€ë¡œ <code>Location</code>ë§Œ ì‚¬ìš©í•œë‹¤.</p>
<h3 id="location-êµ¬ì¡°"><a class="header" href="#location-êµ¬ì¡°">Location êµ¬ì¡°</a></h3>
<pre><code class="language-typescript">interface Location {
    uri: string   // íŒŒì¼ ê²½ë¡œ (ì˜ˆ: "file:///test.fun")
    range: Range  // ì •ì˜ ìœ„ì¹˜ { start: {line, character}, end: {line, character} }
}
</code></pre>
<p><strong>ì‘ë‹µ ì˜ˆì‹œ:</strong></p>
<pre><code class="language-json">{
    "jsonrpc": "2.0",
    "id": 5,
    "result": {
        "uri": "file:///test.fun",
        "range": {
            "start": { "line": 0, "character": 4 },
            "end": { "line": 0, "character": 7 }
        }
    }
}
</code></pre>
<hr>
<h2 id="ì‹¬ë³¼-í…Œì´ë¸”"><a class="header" href="#ì‹¬ë³¼-í…Œì´ë¸”">ì‹¬ë³¼ í…Œì´ë¸”</a></h2>
<p>Go to Definitionì„ êµ¬í˜„í•˜ë ¤ë©´ <strong>â€œì–´ë–¤ ë³€ìˆ˜ê°€ ì–´ë””ì„œ ì •ì˜ë˜ì—ˆëŠ”ì§€â€</strong> ì•Œì•„ì•¼ í•œë‹¤. ì´ë¥¼ ìœ„í•´ **ì‹¬ë³¼ í…Œì´ë¸”(Symbol Table)**ì„ êµ¬ì¶•í•œë‹¤.</p>
<h3 id="ê°œë…"><a class="header" href="#ê°œë…">ê°œë…</a></h3>
<p>ì‹¬ë³¼ í…Œì´ë¸”ì€ ë³€ìˆ˜/í•¨ìˆ˜ ì´ë¦„ì„ ì •ì˜ ìœ„ì¹˜ì— ë§¤í•‘í•˜ëŠ” ìë£Œêµ¬ì¡°ì´ë‹¤:</p>
<pre><code>| ì´ë¦„   | ì •ì˜ ìœ„ì¹˜ (Span)       |
|--------|----------------------|
| add    | (0, 4) - (0, 7)     |
| x      | (0, 15) - (0, 16)   |
| y      | (0, 24) - (0, 25)   |
| result | (1, 4) - (1, 10)    |
</code></pre>
<h3 id="êµ¬í˜„-ë°©ì‹"><a class="header" href="#êµ¬í˜„-ë°©ì‹">êµ¬í˜„ ë°©ì‹</a></h3>
<p>FunLang LSPì—ì„œëŠ” ASTë¥¼ ìˆœíšŒí•˜ë©° ëª¨ë“  ë°”ì¸ë”© ìœ„ì¹˜ë¥¼ ìˆ˜ì§‘í•œë‹¤:</p>
<pre><code class="language-fsharp">// (ë³€ìˆ˜ëª…, Span) ìŒì˜ ë¦¬ìŠ¤íŠ¸
let collectDefinitions (ast: Expr) : (string * Span) list
</code></pre>
<p><strong>ì™œ ë¦¬ìŠ¤íŠ¸ì¸ê°€?</strong></p>
<ul>
<li>ê°™ì€ ì´ë¦„ì˜ ë³€ìˆ˜ê°€ ì—¬ëŸ¬ ë²ˆ ì •ì˜ë  ìˆ˜ ìˆìŒ (ì„€ë„ì‰)</li>
<li>Dictionaryë³´ë‹¤ ë¦¬ìŠ¤íŠ¸ê°€ ì„€ë„ì‰ ì²˜ë¦¬ì— ìœ ë¦¬</li>
</ul>
<hr>
<h2 id="funlangì˜-ë°”ì¸ë”©-ìœ„ì¹˜"><a class="header" href="#funlangì˜-ë°”ì¸ë”©-ìœ„ì¹˜">FunLangì˜ ë°”ì¸ë”© ìœ„ì¹˜</a></h2>
<p>FunLangì—ì„œ ë³€ìˆ˜ê°€ <strong>ì •ì˜</strong>ë˜ëŠ” ê³³ì„ ëª¨ë‘ íŒŒì•…í•´ì•¼ í•œë‹¤.</p>
<h3 id="1-let-ë°”ì¸ë”©"><a class="header" href="#1-let-ë°”ì¸ë”©">1. let ë°”ì¸ë”©</a></h3>
<pre><code class="language-funlang">let x = 42 in x + 1
    ^
    ì •ì˜ ìœ„ì¹˜
</code></pre>
<pre><code class="language-fsharp">| Let(name, value, body, span) -&gt;
    // nameì´ ì •ì˜ë¨, spanì´ ì •ì˜ ìœ„ì¹˜
    defs.Add(name, span)
</code></pre>
<h3 id="2-let-rec-ë°”ì¸ë”©-ì¬ê·€-í•¨ìˆ˜"><a class="header" href="#2-let-rec-ë°”ì¸ë”©-ì¬ê·€-í•¨ìˆ˜">2. let rec ë°”ì¸ë”© (ì¬ê·€ í•¨ìˆ˜)</a></h3>
<pre><code class="language-funlang">let rec fact n = if n = 0 then 1 else n * fact (n - 1) in fact 5
        ^^^^
        ì •ì˜ ìœ„ì¹˜ (í•¨ìˆ˜ëª…)
             ^
             ì •ì˜ ìœ„ì¹˜ (íŒŒë¼ë¯¸í„°)
</code></pre>
<p><code>let rec</code>ì€ <strong>ë‘ ê°€ì§€</strong> ë°”ì¸ë”©ì„ ìƒì„±í•œë‹¤:</p>
<ol>
<li>í•¨ìˆ˜ ì´ë¦„ (<code>fact</code>)</li>
<li>íŒŒë¼ë¯¸í„° (<code>n</code>)</li>
</ol>
<pre><code class="language-fsharp">| LetRec(name, param, fnBody, inExpr, span) -&gt;
    defs.Add(name, span)   // í•¨ìˆ˜ëª…
    defs.Add(param, span)  // íŒŒë¼ë¯¸í„°
</code></pre>
<h3 id="3-ëŒë‹¤-íŒŒë¼ë¯¸í„°"><a class="header" href="#3-ëŒë‹¤-íŒŒë¼ë¯¸í„°">3. ëŒë‹¤ íŒŒë¼ë¯¸í„°</a></h3>
<pre><code class="language-funlang">fun x -&gt; x + 1
    ^
    ì •ì˜ ìœ„ì¹˜
</code></pre>
<pre><code class="language-fsharp">| Lambda(param, body, span) -&gt;
    defs.Add(param, span)

| LambdaAnnot(param, _, body, span) -&gt;
    defs.Add(param, span)
</code></pre>
<h3 id="4-íŒ¨í„´-ë§¤ì¹­"><a class="header" href="#4-íŒ¨í„´-ë§¤ì¹­">4. íŒ¨í„´ ë§¤ì¹­</a></h3>
<pre><code class="language-funlang">match xs with
| h::t -&gt; h + length t
  ^ ^
  ì •ì˜ ìœ„ì¹˜ (h, t)

let (x, y) = (1, 2) in x + y
    ^  ^
    ì •ì˜ ìœ„ì¹˜ (x, y)
</code></pre>
<p>íŒ¨í„´ì—ì„œ ë°”ì¸ë”©ë˜ëŠ” ë³€ìˆ˜ë“¤:</p>
<pre><code class="language-fsharp">let rec collectPatternBindings pattern =
    match pattern with
    | VarPat(name, span) -&gt;
        defs.Add(name, span)
    | TuplePat(pats, _) -&gt;
        pats |&gt; List.iter collectPatternBindings
    | ConsPat(head, tail, _) -&gt;
        collectPatternBindings head
        collectPatternBindings tail
    | WildcardPat _ | EmptyListPat _ | ConstPat _ -&gt;
        ()  // ë°”ì¸ë”© ì—†ìŒ
</code></pre>
<hr>
<h2 id="ì •ì˜-ìˆ˜ì§‘-êµ¬í˜„"><a class="header" href="#ì •ì˜-ìˆ˜ì§‘-êµ¬í˜„">ì •ì˜ ìˆ˜ì§‘ êµ¬í˜„</a></h2>
<p>ì‹¤ì œ êµ¬í˜„ì€ <code>Definition.fs</code>ì— ìˆë‹¤.</p>
<h3 id="collectdefinitions-í•¨ìˆ˜"><a class="header" href="#collectdefinitions-í•¨ìˆ˜">collectDefinitions í•¨ìˆ˜</a></h3>
<pre><code class="language-fsharp">// Definition.fs
module LangLSP.Server.Definition

open Ast

/// Collect all variable/function definitions while traversing AST
/// Returns list of (name, span) pairs for all binding sites
let collectDefinitions (ast: Expr) : (string * Span) list =
    let defs = ResizeArray&lt;string * Span&gt;()

    let rec traverse expr =
        match expr with
        | Let(name, value, body, span) -&gt;
            defs.Add(name, span)
            traverse value
            traverse body

        | LetRec(name, param, fnBody, inExpr, span) -&gt;
            defs.Add(name, span)
            defs.Add(param, span)
            traverse fnBody
            traverse inExpr

        | Lambda(param, body, span) -&gt;
            defs.Add(param, span)
            traverse body

        | LambdaAnnot(param, _, body, span) -&gt;
            defs.Add(param, span)
            traverse body

        | LetPat(pattern, value, body, _) -&gt;
            collectPatternBindings pattern
            traverse value
            traverse body

        | Match(scrutinee, clauses, _) -&gt;
            traverse scrutinee
            for (pattern, clauseBody) in clauses do
                collectPatternBindings pattern
                traverse clauseBody

        // ì´í•­ ì—°ì‚°ì: ì–‘ìª½ ëª¨ë‘ ìˆœíšŒ
        | Add(l, r, _) | Subtract(l, r, _) | Multiply(l, r, _) | Divide(l, r, _)
        | Equal(l, r, _) | NotEqual(l, r, _) | LessThan(l, r, _) | GreaterThan(l, r, _)
        | LessEqual(l, r, _) | GreaterEqual(l, r, _) | And(l, r, _) | Or(l, r, _)
        | Cons(l, r, _) | App(l, r, _) -&gt;
            traverse l
            traverse r

        // ë‹¨í•­ ì—°ì‚°ì
        | Negate(e, _) | Annot(e, _, _) -&gt;
            traverse e

        // ì»¬ë ‰ì…˜
        | Tuple(exprs, _) | List(exprs, _) -&gt;
            exprs |&gt; List.iter traverse

        // ì¡°ê±´ë¬¸
        | If(cond, thenExpr, elseExpr, _) -&gt;
            traverse cond
            traverse thenExpr
            traverse elseExpr

        // ë¦¬í”„ ë…¸ë“œ: ë°”ì¸ë”© ì—†ìŒ
        | Number _ | Bool _ | String _ | Var _ | EmptyList _ -&gt; ()

    and collectPatternBindings pattern =
        match pattern with
        | VarPat(name, span) -&gt; defs.Add(name, span)
        | TuplePat(pats, _) -&gt; pats |&gt; List.iter collectPatternBindings
        | ConsPat(head, tail, _) -&gt;
            collectPatternBindings head
            collectPatternBindings tail
        | WildcardPat _ | EmptyListPat _ | ConstPat _ -&gt; ()

    traverse ast
    defs |&gt; Seq.toList
</code></pre>
<h3 id="ì£¼ìš”-í¬ì¸íŠ¸"><a class="header" href="#ì£¼ìš”-í¬ì¸íŠ¸">ì£¼ìš” í¬ì¸íŠ¸</a></h3>
<ol>
<li><strong>ResizeArray ì‚¬ìš©</strong>: F#ì˜ mutable ë¦¬ìŠ¤íŠ¸, íš¨ìœ¨ì ì¸ ì¶”ê°€ ì—°ì‚°</li>
<li><strong>ì¬ê·€ ìˆœíšŒ</strong>: ëª¨ë“  í•˜ìœ„ í‘œí˜„ì‹ê¹Œì§€ íƒìƒ‰</li>
<li><strong>íŒ¨í„´ ì²˜ë¦¬</strong>: <code>collectPatternBindings</code>ë¡œ íŒ¨í„´ ë‚´ ë°”ì¸ë”© ìˆ˜ì§‘</li>
<li><strong>Span í™œìš©</strong>: FunLang ASTì˜ ëª¨ë“  ë…¸ë“œëŠ” ì†ŒìŠ¤ ìœ„ì¹˜(Span)ë¥¼ ê°€ì§</li>
</ol>
<hr>
<h2 id="ë³€ìˆ˜-ì„€ë„ì‰-ì²˜ë¦¬"><a class="header" href="#ë³€ìˆ˜-ì„€ë„ì‰-ì²˜ë¦¬">ë³€ìˆ˜ ì„€ë„ì‰ ì²˜ë¦¬</a></h2>
<p>ê°™ì€ ì´ë¦„ì˜ ë³€ìˆ˜ê°€ ì—¬ëŸ¬ ë²ˆ ì •ì˜ë  ìˆ˜ ìˆë‹¤.</p>
<h3 id="ë¬¸ì œ-ìƒí™©"><a class="header" href="#ë¬¸ì œ-ìƒí™©">ë¬¸ì œ ìƒí™©</a></h3>
<pre><code class="language-funlang">let x = 1 in
  let x = 2 in
    x
    ^
    ì—¬ê¸°ì„œ xëŠ” ì–´ëŠ ì •ì˜ë¥¼ ê°€ë¦¬í‚¬ê¹Œìš”?
</code></pre>
<p><strong>ì •ë‹µ:</strong> ê°€ì¥ ê°€ê¹Œìš´(ë‚´ë¶€) ì •ì˜ì¸ <code>let x = 2</code>ì´ë‹¤.</p>
<h3 id="ìŠ¤ì½”í”„-ê·œì¹™"><a class="header" href="#ìŠ¤ì½”í”„-ê·œì¹™">ìŠ¤ì½”í”„ ê·œì¹™</a></h3>
<p>FunLangì€ **ë ‰ì‹œì»¬ ìŠ¤ì½”í•‘(Lexical Scoping)**ì„ ì‚¬ìš©í•œë‹¤:</p>
<ul>
<li>ë³€ìˆ˜ ì‚¬ìš© ìœ„ì¹˜ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ ë°”ê¹¥ìª½ ì •ì˜ë¥¼ ì°¸ì¡°</li>
<li>ë‚´ë¶€ ì •ì˜ê°€ ì™¸ë¶€ ì •ì˜ë¥¼ â€œê°€ë¦¼(shadow)â€</li>
</ul>
<h3 id="êµ¬í˜„-ì „ëµ-2"><a class="header" href="#êµ¬í˜„-ì „ëµ-2">êµ¬í˜„ ì „ëµ</a></h3>
<pre><code class="language-fsharp">/// Find definition span for a variable reference
/// For shadowing: returns the definition that appears last before usage position
let findDefinitionForVar (varName: string) (ast: Expr) (usagePos: Position) : Span option =
    let defs = collectDefinitions ast
                |&gt; List.filter (fun (name, _) -&gt; name = varName)

    // ì‚¬ìš© ìœ„ì¹˜ ì´ì „ì— ì •ì˜ëœ ê²ƒ ì¤‘ ê°€ì¥ ë‚˜ì¤‘ì— ë‚˜ì˜¨ ê²ƒ ì„ íƒ
    let usageLine = int usagePos.Line
    let usageCol = int usagePos.Character

    defs
    |&gt; List.filter (fun (_, span) -&gt;
        // ì •ì˜ ìœ„ì¹˜ê°€ ì‚¬ìš© ìœ„ì¹˜ ì´ì „ì¸ ê²ƒë§Œ
        span.StartLine &lt; usageLine ||
        (span.StartLine = usageLine &amp;&amp; span.StartColumn &lt;= usageCol))
    |&gt; List.sortByDescending (fun (_, span) -&gt; span.StartLine, span.StartColumn)
    |&gt; List.tryHead
    |&gt; Option.map snd
</code></pre>
<h3 id="ì•Œê³ ë¦¬ì¦˜-ì„¤ëª…"><a class="header" href="#ì•Œê³ ë¦¬ì¦˜-ì„¤ëª…">ì•Œê³ ë¦¬ì¦˜ ì„¤ëª…</a></h3>
<ol>
<li><strong>ì´ë¦„ìœ¼ë¡œ í•„í„°ë§</strong>: ê°™ì€ ì´ë¦„ì˜ ì •ì˜ë§Œ ì„ íƒ</li>
<li><strong>ìœ„ì¹˜ ì¡°ê±´</strong>: ì‚¬ìš© ìœ„ì¹˜ <strong>ì´ì „</strong>ì— ì •ì˜ëœ ê²ƒë§Œ ì„ íƒ</li>
<li><strong>ê°€ì¥ ë‚˜ì¤‘ ê²ƒ ì„ íƒ</strong>: <code>sortByDescending</code>ìœ¼ë¡œ ê°€ì¥ ê°€ê¹Œìš´ ì •ì˜ ì„ íƒ</li>
</ol>
<h3 id="ì˜ˆì‹œ"><a class="header" href="#ì˜ˆì‹œ">ì˜ˆì‹œ</a></h3>
<pre><code class="language-funlang">let x = 1 in      (* ì •ì˜ 1: line 0, col 4 *)
  let x = 2 in    (* ì •ì˜ 2: line 1, col 6 *)
    x             (* ì‚¬ìš©: line 2, col 4 *)
</code></pre>
<p>ì‚¬ìš© ìœ„ì¹˜ (line 2, col 4)ì—ì„œ:</p>
<ol>
<li><code>x</code> ì •ì˜ ëª©ë¡: [(x, 0:4), (x, 1:6)]</li>
<li>ì‚¬ìš© ìœ„ì¹˜ ì´ì „ ì •ì˜: ë‘˜ ë‹¤ í•´ë‹¹</li>
<li>ê°€ì¥ ë‚˜ì¤‘ ì •ì˜: (x, 1:6) ì„ íƒ</li>
</ol>
<hr>
<h2 id="ì‹ë³„ì-ìœ„ì¹˜-ì •í™•íˆ-ì°¾ê¸°"><a class="header" href="#ì‹ë³„ì-ìœ„ì¹˜-ì •í™•íˆ-ì°¾ê¸°">ì‹ë³„ì ìœ„ì¹˜ ì •í™•íˆ ì°¾ê¸°</a></h2>
<p><code>collectDefinitions</code>ê°€ ìˆ˜ì§‘í•˜ëŠ” Spanì€ ì „ì²´ í‘œí˜„ì‹ì˜ ë²”ìœ„ì´ë‹¤ (ì˜ˆ: <code>let x = 42 in x + 1</code> ì „ì²´). Go to Definitionì—ì„œëŠ” <strong>ì‹ë³„ì ì´ë¦„ì˜ ì •í™•í•œ ìœ„ì¹˜</strong>ë§Œ ë°˜í™˜í•´ì•¼ í•œë‹¤.</p>
<h3 id="findidentifierrange-í•¨ìˆ˜"><a class="header" href="#findidentifierrange-í•¨ìˆ˜">findIdentifierRange í•¨ìˆ˜</a></h3>
<pre><code class="language-fsharp">/// Find the exact range of an identifier name in source text near a span
let findIdentifierRange (text: string) (name: string) (span: Span) : Range =
    let lines = text.Split('\n')
    if span.StartLine &lt; lines.Length then
        let line = lines.[span.StartLine]
        let idx = line.IndexOf(name, span.StartColumn)
        if idx &gt;= 0 then
            { Start = { Line = uint32 span.StartLine; Character = uint32 idx }
              End = { Line = uint32 span.StartLine; Character = uint32 (idx + name.Length) } }
        else
            spanToLspRange span
    else
        spanToLspRange span
</code></pre>
<p><strong>í•µì‹¬ ë¡œì§:</strong></p>
<ol>
<li>Spanì˜ ì‹œì‘ ë¼ì¸ì—ì„œ í•´ë‹¹ ì´ë¦„ì„ ê²€ìƒ‰</li>
<li><code>IndexOf(name, span.StartColumn)</code>ë¡œ Span ì‹œì‘ ìœ„ì¹˜ ì´í›„ì—ì„œ ì´ë¦„ ì°¾ê¸°</li>
<li>ì°¾ìœ¼ë©´ ì´ë¦„ì˜ ì •í™•í•œ ì‹œì‘/ë ìœ„ì¹˜ ë°˜í™˜</li>
<li>ëª» ì°¾ìœ¼ë©´ fallbackìœ¼ë¡œ ì „ì²´ Span ì‚¬ìš©</li>
</ol>
<p>ì´ í•¨ìˆ˜ëŠ” Diagnosticsì˜ ë¯¸ì‚¬ìš© ë³€ìˆ˜ ë²”ìœ„ì—ì„œë„ ì¬ì‚¬ìš©ëœë‹¤.</p>
<hr>
<h2 id="í•¸ë“¤ëŸ¬-êµ¬í˜„"><a class="header" href="#í•¸ë“¤ëŸ¬-êµ¬í˜„">í•¸ë“¤ëŸ¬ êµ¬í˜„</a></h2>
<h3 id="handledefinition-í•¨ìˆ˜"><a class="header" href="#handledefinition-í•¨ìˆ˜">handleDefinition í•¨ìˆ˜</a></h3>
<pre><code class="language-fsharp">// Definition.fs
open Ionide.LanguageServerProtocol.Types
open LangLSP.Server.AstLookup
open LangLSP.Server.DocumentSync
open LangLSP.Server.Protocol

/// Handle textDocument/definition request
/// Returns Definition.C1 for single location (single-file scope)
let handleDefinition (p: DefinitionParams) : Async&lt;Definition option&gt; =
    async {
        let uri = p.TextDocument.Uri
        let pos = p.Position

        match getDocument uri with
        | None -&gt; return None
        | Some text -&gt;
            try
                // 1. íŒŒì‹±
                let lexbuf = FSharp.Text.Lexing.LexBuffer&lt;char&gt;.FromString(text)
                let ast = Parser.start Lexer.tokenize lexbuf

                // 2. ì»¤ì„œ ìœ„ì¹˜ì˜ ë…¸ë“œ ì°¾ê¸°
                match findNodeAtPosition pos ast with
                | None -&gt; return None
                | Some node -&gt;
                    match node with
                    | Var(name, _) -&gt;
                        // 3. í•´ë‹¹ ë³€ìˆ˜ì˜ ì •ì˜ ì°¾ê¸°
                        match findDefinitionForVar name ast pos with
                        | None -&gt; return None
                        | Some defSpan -&gt;
                            // 4. Location ë°˜í™˜ (ì‹ë³„ì ì´ë¦„ ìœ„ì¹˜ë§Œ ì •í™•íˆ íƒ€ê²ŸíŒ…)
                            let location : Location = {
                                Uri = uri
                                Range = findIdentifierRange text name defSpan
                            }
                            return Some (U2.C1 location)
                    | _ -&gt;
                        // ë³€ìˆ˜ ì°¸ì¡°ê°€ ì•„ë‹˜ (ìˆ«ì, ì—°ì‚°ì ë“±)
                        return None
            with _ -&gt;
                // íŒŒì‹± ì‹¤íŒ¨
                return None
    }
</code></pre>
<h3 id="ë™ì‘-íë¦„"><a class="header" href="#ë™ì‘-íë¦„">ë™ì‘ íë¦„</a></h3>
<pre><code>ì‚¬ìš©ì F12 í‚¤
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. getDocumentë¡œ ì†ŒìŠ¤ í…ìŠ¤íŠ¸ íšë“   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Parserë¡œ AST ìƒì„±                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. findNodeAtPositionìœ¼ë¡œ           â”‚
â”‚    ì»¤ì„œ ìœ„ì¹˜ì˜ AST ë…¸ë“œ ì°¾ê¸°        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Var ë…¸ë“œì¸ ê²½ìš°                  â”‚
â”‚    findDefinitionForVarë¡œ ì •ì˜ ê²€ìƒ‰ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Location ë°˜í™˜ (URI + Range)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="astlookupfindnodeatposition-í™œìš©"><a class="header" href="#astlookupfindnodeatposition-í™œìš©">AstLookup.findNodeAtPosition í™œìš©</a></h3>
<p>ì´ì „ íŠœí† ë¦¬ì–¼(Hover)ì—ì„œ êµ¬í˜„í•œ <code>findNodeAtPosition</code>ì„ ì¬ì‚¬ìš©í•œë‹¤:</p>
<pre><code class="language-fsharp">// AstLookup.fs
/// Find the innermost AST node containing the given LSP position
let rec findNodeAtPosition (lspPos: Position) (expr: Expr) : Expr option
</code></pre>
<p>ì´ í•¨ìˆ˜ëŠ” ì»¤ì„œ ìœ„ì¹˜ì— í•´ë‹¹í•˜ëŠ” <strong>ê°€ì¥ êµ¬ì²´ì ì¸</strong> AST ë…¸ë“œë¥¼ ë°˜í™˜í•œë‹¤.</p>
<hr>
<h2 id="serverfs-í†µí•©"><a class="header" href="#serverfs-í†µí•©">Server.fs í†µí•©</a></h2>
<h3 id="ì„œë²„-ê¸°ëŠ¥-ë“±ë¡"><a class="header" href="#ì„œë²„-ê¸°ëŠ¥-ë“±ë¡">ì„œë²„ ê¸°ëŠ¥ ë“±ë¡</a></h3>
<pre><code class="language-fsharp">// Server.fs
let serverCapabilities : ServerCapabilities =
    { ServerCapabilities.Default with
        TextDocumentSync = ...
        HoverProvider = Some (U2.C1 true)
        DefinitionProvider = Some (U2.C1 true)  // ì¶”ê°€!
    }
</code></pre>
<h3 id="í•¸ë“¤ëŸ¬-ë“±ë¡"><a class="header" href="#í•¸ë“¤ëŸ¬-ë“±ë¡">í•¸ë“¤ëŸ¬ ë“±ë¡</a></h3>
<pre><code class="language-fsharp">module Handlers =
    /// Handle textDocument/definition request
    let textDocumentDefinition (p: DefinitionParams) : Async&lt;Definition option&gt; =
        handleDefinition p
</code></pre>
<h3 id="ì „ì²´-ì—°ê²°"><a class="header" href="#ì „ì²´-ì—°ê²°">ì „ì²´ ì—°ê²°</a></h3>
<p>í´ë¼ì´ì–¸íŠ¸ê°€ <code>initialize</code> ìš”ì²­ì„ ë³´ë‚´ë©´:</p>
<ol>
<li>ì„œë²„ê°€ <code>DefinitionProvider = true</code> ì‘ë‹µ</li>
<li>í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ì œ Definition ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥</li>
</ol>
<p>í´ë¼ì´ì–¸íŠ¸ê°€ <code>textDocument/definition</code> ìš”ì²­ì„ ë³´ë‚´ë©´:</p>
<ol>
<li>ì„œë²„ê°€ <code>Handlers.textDocumentDefinition</code> í˜¸ì¶œ</li>
<li>Definition.fsì˜ <code>handleDefinition</code> ì‹¤í–‰</li>
<li><code>Location</code> ë˜ëŠ” <code>null</code> ë°˜í™˜</li>
</ol>
<hr>
<h2 id="í…ŒìŠ¤íŠ¸-ì‘ì„±-4"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‘ì„±-4">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></h2>
<h3 id="ê¸°ë³¸-í…ŒìŠ¤íŠ¸-êµ¬ì¡°"><a class="header" href="#ê¸°ë³¸-í…ŒìŠ¤íŠ¸-êµ¬ì¡°">ê¸°ë³¸ í…ŒìŠ¤íŠ¸ êµ¬ì¡°</a></h3>
<pre><code class="language-fsharp">// DefinitionTests.fs
module LangLSP.Tests.DefinitionTests

open Expecto
open Ionide.LanguageServerProtocol.Types
open LangLSP.Server.Definition
open LangLSP.Server.DocumentSync

let makeDefinitionParams uri line char : DefinitionParams =
    {
        TextDocument = { Uri = uri }
        Position = { Line = uint32 line; Character = uint32 char }
        WorkDoneToken = None
        PartialResultToken = None
    }
</code></pre>
<h3 id="í…ŒìŠ¤íŠ¸-ì¼€ì´ìŠ¤ë“¤"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì¼€ì´ìŠ¤ë“¤">í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë“¤</a></h3>
<pre><code class="language-fsharp">[&lt;Tests&gt;]
let definitionTests =
    testSequenced &lt;| testList "Definition" [

        testCase "let binding: variable usage finds definition" &lt;| fun _ -&gt;
            clearAll()
            let uri = "file:///test-def-let.fun"
            let text = "let x = 42 in x"
            handleDidOpen { TextDocument = { Uri = uri; LanguageId = "funlang"; Version = 1; Text = text } }

            // x ì‚¬ìš© ìœ„ì¹˜ (column 14)ì—ì„œ definition ìš”ì²­
            let result = handleDefinition (makeDefinitionParams uri 0 14) |&gt; Async.RunSynchronously
            Expect.isSome result "Should find definition"

        testCase "shadowed variable: finds inner definition" &lt;| fun _ -&gt;
            clearAll()
            let uri = "file:///test-def-shadow.fun"
            let text = "let x = 1 in let x = 2 in x"
            handleDidOpen { TextDocument = { Uri = uri; LanguageId = "funlang"; Version = 1; Text = text } }

            // ë§ˆì§€ë§‰ x (column 26)ì—ì„œ definition ìš”ì²­
            let result = handleDefinition (makeDefinitionParams uri 0 26) |&gt; Async.RunSynchronously
            Expect.isSome result "Should find inner definition"

        testCase "let rec: function name finds definition" &lt;| fun _ -&gt;
            clearAll()
            let uri = "file:///test-def-letrec.fun"
            let text = "let rec f n = f (n - 1) in f 5"
            handleDidOpen { TextDocument = { Uri = uri; LanguageId = "funlang"; Version = 1; Text = text } }

            // ì¬ê·€ í˜¸ì¶œ f (column 14)ì—ì„œ definition ìš”ì²­
            let result = handleDefinition (makeDefinitionParams uri 0 14) |&gt; Async.RunSynchronously
            Expect.isSome result "Should find let rec definition"

        testCase "lambda parameter: finds parameter binding" &lt;| fun _ -&gt;
            clearAll()
            let uri = "file:///test-def-lambda.fun"
            let text = "fun x -&gt; x + 1"
            handleDidOpen { TextDocument = { Uri = uri; LanguageId = "funlang"; Version = 1; Text = text } }

            // ëŒë‹¤ ë³¸ë¬¸ì˜ x (column 9)ì—ì„œ definition ìš”ì²­
            let result = handleDefinition (makeDefinitionParams uri 0 9) |&gt; Async.RunSynchronously
            Expect.isSome result "Should find lambda parameter"
    ]
</code></pre>
<h3 id="í…ŒìŠ¤íŠ¸-ìš”ì "><a class="header" href="#í…ŒìŠ¤íŠ¸-ìš”ì ">í…ŒìŠ¤íŠ¸ ìš”ì </a></h3>
<ol>
<li><strong>testSequenced ì‚¬ìš©</strong>: DocumentSync ìƒíƒœ ê³µìœ ë¡œ ì¸í•œ ê°„ì„­ ë°©ì§€</li>
<li><strong>clearAll() í˜¸ì¶œ</strong>: ê° í…ŒìŠ¤íŠ¸ ì‹œì‘ ì‹œ ìƒíƒœ ì´ˆê¸°í™”</li>
<li><strong>ì •í™•í•œ ìœ„ì¹˜ ì§€ì •</strong>: ë³€ìˆ˜ ì‚¬ìš© ìœ„ì¹˜ì˜ column ì •í™•íˆ ê³„ì‚°</li>
<li><strong>ë‹¤ì–‘í•œ ë°”ì¸ë”© í˜•íƒœ</strong>: let, let rec, lambda, ì„€ë„ì‰ ëª¨ë‘ í…ŒìŠ¤íŠ¸</li>
</ol>
<h3 id="í…ŒìŠ¤íŠ¸-ì‹¤í–‰-4"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‹¤í–‰-4">í…ŒìŠ¤íŠ¸ ì‹¤í–‰</a></h3>
<pre><code class="language-bash">dotnet run --project src/LangLSP.Tests

# ì¶œë ¥:
# [Definition] let binding: variable usage finds definition - Passed
# [Definition] shadowed variable: finds inner definition - Passed
# [Definition] let rec: function name finds definition - Passed
# [Definition] lambda parameter: finds parameter binding - Passed
</code></pre>
<hr>
<h2 id="ì‹±ê¸€-íŒŒì¼-vs-ë©€í‹°-íŒŒì¼"><a class="header" href="#ì‹±ê¸€-íŒŒì¼-vs-ë©€í‹°-íŒŒì¼">ì‹±ê¸€ íŒŒì¼ vs ë©€í‹° íŒŒì¼</a></h2>
<h3 id="funlangì˜-í˜„ì¬-ë²”ìœ„"><a class="header" href="#funlangì˜-í˜„ì¬-ë²”ìœ„">FunLangì˜ í˜„ì¬ ë²”ìœ„</a></h3>
<p>FunLangì€ <strong>ì‹±ê¸€ íŒŒì¼</strong>ë§Œ ì§€ì›í•œë‹¤ (ëª¨ë“ˆ ì‹œìŠ¤í…œ ì—†ìŒ).</p>
<p>ë”°ë¼ì„œ:</p>
<ul>
<li>ì •ì˜ëŠ” í•­ìƒ <strong>ê°™ì€ íŒŒì¼</strong>ì— ìˆìŒ</li>
<li><code>Location.Uri</code>ëŠ” í•­ìƒ ìš”ì²­ì˜ <code>textDocument.uri</code>ì™€ ë™ì¼</li>
<li><code>U2.C1 Location</code> (ë‹¨ì¼ ìœ„ì¹˜) ë°˜í™˜ìœ¼ë¡œ ì¶©ë¶„</li>
</ul>
<h3 id="ë©€í‹°-íŒŒì¼-ì§€ì›-ì‹œ-ê³ ë ¤ì‚¬í•­"><a class="header" href="#ë©€í‹°-íŒŒì¼-ì§€ì›-ì‹œ-ê³ ë ¤ì‚¬í•­">ë©€í‹° íŒŒì¼ ì§€ì› ì‹œ ê³ ë ¤ì‚¬í•­</a></h3>
<p>ë©€í‹° íŒŒì¼ì„ ì§€ì›í•˜ë ¤ë©´:</p>
<ol>
<li>
<p><strong>ëª¨ë“ˆ ì‹œìŠ¤í…œ í•„ìš”</strong></p>
<pre><code class="language-funlang">import List from "list.fun"

List.map (fun x -&gt; x + 1) [1, 2, 3]
</code></pre>
</li>
<li>
<p><strong>í¬ë¡œìŠ¤ íŒŒì¼ ì‹¬ë³¼ í…Œì´ë¸”</strong></p>
<pre><code class="language-fsharp">type DefinitionMap = Map&lt;string * string, Span&gt;
// (URI, ë³€ìˆ˜ëª…) â†’ ì •ì˜ ìœ„ì¹˜
</code></pre>
</li>
<li>
<p><strong>ì—¬ëŸ¬ ì •ì˜ ë°˜í™˜ ê°€ëŠ¥</strong></p>
<pre><code class="language-fsharp">// ê°™ì€ ì´ë¦„ì˜ í•¨ìˆ˜ê°€ ì—¬ëŸ¬ ëª¨ë“ˆì— ìˆì„ ìˆ˜ ìˆìŒ
return Some (U2.C2 [| location1; location2 |])
</code></pre>
</li>
<li>
<p><strong>import ì¶”ì </strong></p>
<pre><code class="language-fsharp">// ê° íŒŒì¼ì˜ import ë¬¸ ë¶„ì„
// importëœ ëª¨ë“ˆì˜ ì‹¬ë³¼ í…Œì´ë¸” ë¡œë“œ
</code></pre>
</li>
</ol>
<h3 id="í˜„ì¬-êµ¬í˜„ì˜-í•œê³„"><a class="header" href="#í˜„ì¬-êµ¬í˜„ì˜-í•œê³„">í˜„ì¬ êµ¬í˜„ì˜ í•œê³„</a></h3>
<pre><code class="language-fsharp">// í•­ìƒ ê°™ì€ íŒŒì¼ì˜ Location ë°˜í™˜
let location : Location = {
    Uri = uri  // ìš”ì²­ê³¼ ë™ì¼í•œ URI
    Range = findIdentifierRange text name defSpan
}
return Some (U2.C1 location)  // ë‹¨ì¼ ìœ„ì¹˜ë§Œ ì§€ì›
</code></pre>
<hr>
<h2 id="í”í•œ-ì‹¤ìˆ˜"><a class="header" href="#í”í•œ-ì‹¤ìˆ˜">í”í•œ ì‹¤ìˆ˜</a></h2>
<h3 id="1-ì„€ë„ì‰-ë¬´ì‹œ"><a class="header" href="#1-ì„€ë„ì‰-ë¬´ì‹œ">1. ì„€ë„ì‰ ë¬´ì‹œ</a></h3>
<p><strong>ì˜ëª»ëœ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">// í•­ìƒ ì²« ë²ˆì§¸ ì •ì˜ë§Œ ë°˜í™˜
defs |&gt; List.tryHead
</code></pre>
<p><strong>ì˜¬ë°”ë¥¸ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">// ì‚¬ìš© ìœ„ì¹˜ ì´ì „ ì •ì˜ ì¤‘ ê°€ì¥ ê°€ê¹Œìš´ ê²ƒ
defs
|&gt; List.filter (fun (_, span) -&gt; span.StartLine &lt;= usageLine)
|&gt; List.sortByDescending (...)
|&gt; List.tryHead
</code></pre>
<h3 id="2-íŒ¨í„´-ë°”ì¸ë”©-ëˆ„ë½"><a class="header" href="#2-íŒ¨í„´-ë°”ì¸ë”©-ëˆ„ë½">2. íŒ¨í„´ ë°”ì¸ë”© ëˆ„ë½</a></h3>
<p><strong>ì˜ëª»ëœ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">| Match(scrutinee, clauses, _) -&gt;
    traverse scrutinee
    for (_, clauseBody) in clauses do
        traverse clauseBody  // íŒ¨í„´ ë¬´ì‹œ!
</code></pre>
<p><strong>ì˜¬ë°”ë¥¸ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">| Match(scrutinee, clauses, _) -&gt;
    traverse scrutinee
    for (pattern, clauseBody) in clauses do
        collectPatternBindings pattern  // íŒ¨í„´ë„ ì²˜ë¦¬!
        traverse clauseBody
</code></pre>
<h3 id="3-let-rec-íŒŒë¼ë¯¸í„°-ëˆ„ë½"><a class="header" href="#3-let-rec-íŒŒë¼ë¯¸í„°-ëˆ„ë½">3. let rec íŒŒë¼ë¯¸í„° ëˆ„ë½</a></h3>
<p><strong>ì˜ëª»ëœ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">| LetRec(name, _, fnBody, inExpr, span) -&gt;
    defs.Add(name, span)  // í•¨ìˆ˜ëª…ë§Œ ì¶”ê°€
</code></pre>
<p><strong>ì˜¬ë°”ë¥¸ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">| LetRec(name, param, fnBody, inExpr, span) -&gt;
    defs.Add(name, span)   // í•¨ìˆ˜ëª…
    defs.Add(param, span)  // íŒŒë¼ë¯¸í„°ë„!
</code></pre>
<h3 id="4-var-ë…¸ë“œë§Œ-ì²˜ë¦¬í•˜ì§€-ì•ŠìŒ"><a class="header" href="#4-var-ë…¸ë“œë§Œ-ì²˜ë¦¬í•˜ì§€-ì•ŠìŒ">4. Var ë…¸ë“œë§Œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ</a></h3>
<p><strong>ì˜ëª»ëœ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">match node with
| _ -&gt;
    // ëª¨ë“  ë…¸ë“œì—ì„œ ì •ì˜ ì°¾ê¸° ì‹œë„
    findDefinitionForVar (getIdentifier node) ...
</code></pre>
<p><strong>ì˜¬ë°”ë¥¸ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">match node with
| Var(name, _) -&gt;
    // ë³€ìˆ˜ ì°¸ì¡°ì—ì„œë§Œ ì •ì˜ ì°¾ê¸°
    findDefinitionForVar name ...
| _ -&gt;
    // ìˆ«ì, ì—°ì‚°ì ë“±ì€ ì •ì˜ ì—†ìŒ
    return None
</code></pre>
<hr>
<h2 id="ì •ë¦¬-2"><a class="header" href="#ì •ë¦¬-2">ì •ë¦¬</a></h2>
<p>Go to Definition êµ¬í˜„ì˜ í•µì‹¬:</p>
<ol>
<li>
<p><strong>ë°”ì¸ë”© ìˆ˜ì§‘</strong> - AST ìˆœíšŒë¡œ ëª¨ë“  ì •ì˜ ìœ„ì¹˜ ìˆ˜ì§‘</p>
<ul>
<li>let, let rec, lambda, íŒ¨í„´ ëª¨ë‘ ì²˜ë¦¬</li>
</ul>
</li>
<li>
<p><strong>ìŠ¤ì½”í”„ í•´ê²°</strong> - ì„€ë„ì‰ ì‹œ ê°€ì¥ ê°€ê¹Œìš´ ì •ì˜ ì„ íƒ</p>
<ul>
<li>ìœ„ì¹˜ ê¸°ë°˜ í•„í„°ë§ + ì •ë ¬</li>
</ul>
</li>
<li>
<p><strong>ìœ„ì¹˜ ë³€í™˜</strong> - FunLang Span â†’ LSP Location</p>
<ul>
<li><code>findIdentifierRange</code>ë¡œ ì‹ë³„ì ì´ë¦„ ìœ„ì¹˜ë§Œ ì •í™•íˆ ë°˜í™˜</li>
</ul>
</li>
<li>
<p><strong>Var ë…¸ë“œë§Œ ì²˜ë¦¬</strong> - ë³€ìˆ˜ ì°¸ì¡°ì—ì„œë§Œ ë™ì‘</p>
<ul>
<li>ë‹¤ë¥¸ ë…¸ë“œëŠ” None ë°˜í™˜</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ë‹¤ìŒ-ë‹¨ê³„-7"><a class="header" href="#ë‹¤ìŒ-ë‹¨ê³„-7">ë‹¤ìŒ ë‹¨ê³„</a></h2>
<p>Go to Definitionì„ ì™„ì„±í–ˆë‹¤! ì´ ê¸°ëŠ¥ì€ ì½”ë“œ ë„¤ë¹„ê²Œì´ì…˜ì˜ í•µì‹¬ì´ë‹¤.</p>
<p>ë‹¤ìŒ Phaseì—ì„œ êµ¬í˜„í•  ê¸°ëŠ¥ë“¤:</p>
<ul>
<li><strong>Find References</strong>: ë³€ìˆ˜ì˜ ëª¨ë“  ì‚¬ìš©ì²˜ ì°¾ê¸°</li>
<li><strong>Rename</strong>: ë³€ìˆ˜ ì´ë¦„ ì¼ê´„ ë³€ê²½</li>
<li><strong>Code Actions</strong>: ìë™ ìˆ˜ì • ì œì•ˆ</li>
</ul>
<hr>
<h2 id="ì°¸ê³ -ìë£Œ-7"><a class="header" href="#ì°¸ê³ -ìë£Œ-7">ì°¸ê³  ìë£Œ</a></h2>
<ul>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocument_definition">LSP Specification - textDocument/definition</a></li>
<li><a href="https://tomassetti.me/go-to-definition-in-the-language-server-protocol/">Go To Definition in LSP - Strumenta</a></li>
<li><a href="https://github.com/kodu-ai/LangTutorial/blob/main/FunLang/Ast.fs">FunLang AST (Ast.fs)</a></li>
</ul>
<hr>
<p><strong>-&gt; ë‹¤ìŒ: Phase 3 - Find References êµ¬í˜„</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="find-references-êµ¬í˜„í•˜ê¸°"><a class="header" href="#find-references-êµ¬í˜„í•˜ê¸°">Find References êµ¬í˜„í•˜ê¸°</a></h1>
<p>ì´ ë¬¸ì„œëŠ” LSP ì„œë²„ì—ì„œ <strong>Find References</strong> ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•œë‹¤. ë³€ìˆ˜ë‚˜ í•¨ìˆ˜ë¥¼ ì„ íƒí•˜ê³  â€œFind Referencesâ€œë¥¼ ì‹¤í–‰í•˜ë©´ í•´ë‹¹ ì‹¬ë³¼ì´ ì‚¬ìš©ëœ ëª¨ë“  ìœ„ì¹˜ë¥¼ ì°¾ì•„ì¤€ë‹¤. ì´ ê¸°ëŠ¥ì€ ì½”ë“œ ë¦¬íŒ©í† ë§ê³¼ ì˜í–¥ ë¶„ì„(Impact Analysis)ì— í•„ìˆ˜ì ì´ë‹¤.</p>
<h2 id="ëª©ì°¨-8"><a class="header" href="#ëª©ì°¨-8">ëª©ì°¨</a></h2>
<ol>
<li><a href="#find-referencesë€">Find Referencesë€</a></li>
<li><a href="#lsp-í”„ë¡œí† ì½œ-1">LSP í”„ë¡œí† ì½œ</a></li>
<li><a href="#definitionê³¼ì˜-ê´€ê³„">Definitionê³¼ì˜ ê´€ê³„</a></li>
<li><a href="#ë ˆí¼ëŸ°ìŠ¤-ìˆ˜ì§‘-êµ¬í˜„">ë ˆí¼ëŸ°ìŠ¤ ìˆ˜ì§‘ êµ¬í˜„</a></li>
<li><a href="#ìŠ¤ì½”í”„-ì¸ì‹-ë ˆí¼ëŸ°ìŠ¤-ìˆ˜ì§‘">ìŠ¤ì½”í”„ ì¸ì‹ ë ˆí¼ëŸ°ìŠ¤ ìˆ˜ì§‘</a></li>
<li><a href="#ë³€ìˆ˜-ì„€ë„ì‰-ì²˜ë¦¬-1">ë³€ìˆ˜ ì„€ë„ì‰ ì²˜ë¦¬</a></li>
<li><a href="#í•¸ë“¤ëŸ¬-êµ¬í˜„-1">í•¸ë“¤ëŸ¬ êµ¬í˜„</a></li>
<li><a href="#serverfs-í†µí•©-1">Server.fs í†µí•©</a></li>
<li><a href="#í…ŒìŠ¤íŠ¸-ì‘ì„±-5">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></li>
<li><a href="#definition-vs-references-ë¹„êµ">Definition vs References ë¹„êµ</a></li>
</ol>
<hr>
<h2 id="find-referencesë€"><a class="header" href="#find-referencesë€">Find Referencesë€</a></h2>
<p><strong>Find References</strong>ëŠ” ì„ íƒí•œ ì‹¬ë³¼ì˜ ëª¨ë“  ì‚¬ìš©ì²˜ë¥¼ ì°¾ëŠ” ê¸°ëŠ¥ì´ë‹¤. Go to Definitionì´ â€œì •ì˜ ìœ„ì¹˜â€ í•˜ë‚˜ë¥¼ ì°¾ëŠ”ë‹¤ë©´, Find ReferencesëŠ” â€œì‚¬ìš© ìœ„ì¹˜â€ ì—¬ëŸ¬ ê°œë¥¼ ì°¾ëŠ”ë‹¤.</p>
<h3 id="vs-codeì—ì„œì˜-ì‚¬ìš©-1"><a class="header" href="#vs-codeì—ì„œì˜-ì‚¬ìš©-1">VS Codeì—ì„œì˜ ì‚¬ìš©</a></h3>
<pre><code>test.fun
â”€â”€â”€â”€â”€â”€â”€â”€
1 | let add = fun x -&gt; fun y -&gt; x + y in
2 | let result = add 1 2 in
3 | let result2 = add 3 4 in
        ^^^
        [Shift+F12] ë˜ëŠ” ìš°í´ë¦­ â†’ Find All References
        â†’ addê°€ ì‚¬ìš©ëœ ëª¨ë“  ìœ„ì¹˜ í‘œì‹œ (2ë²ˆ, 3ë²ˆ ë¼ì¸)
</code></pre>
<p><strong>íŠ¸ë¦¬ê±° ë°©ë²•:</strong></p>
<ul>
<li><code>Shift+F12</code> í‚¤</li>
<li>ìš°í´ë¦­ â†’ â€œFind All Referencesâ€</li>
<li>ì¢Œì¸¡ íŒ¨ë„ì— ê²°ê³¼ ëª©ë¡ í‘œì‹œ</li>
</ul>
<h3 id="í•µì‹¬-ë™ì‘-1"><a class="header" href="#í•µì‹¬-ë™ì‘-1">í•µì‹¬ ë™ì‘</a></h3>
<ol>
<li>ì‚¬ìš©ìê°€ ì»¤ì„œë¥¼ ì‹¬ë³¼ ìœ„ì— ë†“ìŒ</li>
<li>í´ë¼ì´ì–¸íŠ¸ê°€ <code>textDocument/references</code> ìš”ì²­ ì „ì†¡</li>
<li>ì„œë²„ê°€ í•´ë‹¹ ì‹¬ë³¼ì˜ <strong>ëª¨ë“  ì‚¬ìš© ìœ„ì¹˜</strong> ë°˜í™˜ (ë°°ì—´)</li>
<li>í´ë¼ì´ì–¸íŠ¸ê°€ ê²°ê³¼ íŒ¨ë„ì— ìœ„ì¹˜ ëª©ë¡ í‘œì‹œ</li>
</ol>
<pre class="mermaid">sequenceDiagram
    participant C as Client
    participant S as Server
    C-&gt;&gt;S: textDocument/references(uri, position, includeDeclaration)
    Note over S: ì •ì˜ + ëª¨ë“  ì‚¬ìš© ìœ„ì¹˜ ìˆ˜ì§‘
    S-&gt;&gt;C: Location[](ì •ì˜, ì°¸ì¡°1, ì°¸ì¡°2, ...)
    Note over C: ì°¸ì¡° ëª©ë¡ íŒ¨ë„ì— í‘œì‹œ
</pre>

<h3 id="í™œìš©-ì‚¬ë¡€"><a class="header" href="#í™œìš©-ì‚¬ë¡€">í™œìš© ì‚¬ë¡€</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>ì‹œë‚˜ë¦¬ì˜¤</th><th>ì‚¬ìš© ì˜ˆì‹œ</th></tr>
</thead>
<tbody>
<tr><td><strong>ë¦¬íŒ©í† ë§ ì „ ì˜í–¥ ë¶„ì„</strong></td><td>í•¨ìˆ˜ëª…ì„ ë°”ê¾¸ê¸° ì „ì— ì‚¬ìš©ì²˜ í™•ì¸</td></tr>
<tr><td><strong>ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì½”ë“œ ì°¾ê¸°</strong></td><td>ë ˆí¼ëŸ°ìŠ¤ê°€ 0ê°œë©´ ë¯¸ì‚¬ìš© í•¨ìˆ˜</td></tr>
<tr><td><strong>ì˜ì¡´ì„± íŒŒì•…</strong></td><td>íŠ¹ì • ë³€ìˆ˜ê°€ ì–´ë””ì„œ ì‚¬ìš©ë˜ëŠ”ì§€ ì¶”ì </td></tr>
<tr><td><strong>ë²„ê·¸ ì¶”ì </strong></td><td>ì˜ëª»ëœ ê°’ì´ ì–´ë””ë¡œ ì „íŒŒë˜ëŠ”ì§€ í™•ì¸</td></tr>
</tbody>
</table>
</div>
<hr>
<h2 id="lsp-í”„ë¡œí† ì½œ-1"><a class="header" href="#lsp-í”„ë¡œí† ì½œ-1">LSP í”„ë¡œí† ì½œ</a></h2>
<h3 id="textdocumentreferences-ìš”ì²­"><a class="header" href="#textdocumentreferences-ìš”ì²­">textDocument/references ìš”ì²­</a></h3>
<pre><code class="language-typescript">interface ReferenceParams {
    textDocument: TextDocumentIdentifier  // { uri: "file:///test.fun" }
    position: Position                     // { line: 0, character: 4 }
    context: ReferenceContext             // { includeDeclaration: true }
}

interface ReferenceContext {
    includeDeclaration: boolean  // ì •ì˜ ìœ„ì¹˜ë„ ê²°ê³¼ì— í¬í•¨í• ì§€ ì—¬ë¶€
}
</code></pre>
<p><strong>ìš”ì²­ ì˜ˆì‹œ:</strong></p>
<pre><code class="language-json">{
    "jsonrpc": "2.0",
    "id": 7,
    "method": "textDocument/references",
    "params": {
        "textDocument": { "uri": "file:///test.fun" },
        "position": { "line": 0, "character": 4 },
        "context": { "includeDeclaration": true }
    }
}
</code></pre>
<h3 id="includedeclarationì˜-ì˜ë¯¸"><a class="header" href="#includedeclarationì˜-ì˜ë¯¸">includeDeclarationì˜ ì˜ë¯¸</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>ê°’</th><th>ë™ì‘</th><th>ì˜ˆì‹œ</th></tr>
</thead>
<tbody>
<tr><td><code>true</code></td><td>ì •ì˜ + ì‚¬ìš©ì²˜ ëª¨ë‘ ë°˜í™˜</td><td><code>let x = 1</code> í¬í•¨</td></tr>
<tr><td><code>false</code></td><td>ì‚¬ìš©ì²˜ë§Œ ë°˜í™˜</td><td><code>x + 1</code>ë§Œ í¬í•¨, ì •ì˜ëŠ” ì œì™¸</td></tr>
</tbody>
</table>
</div>
<p>ëŒ€ë¶€ë¶„ì˜ ê²½ìš° <code>true</code>ê°€ ìœ ìš©í•˜ë‹¤ (ì „ì²´ ì˜í–¥ ë²”ìœ„ íŒŒì•…).</p>
<h3 id="ì‘ë‹µ-í˜•ì‹-1"><a class="header" href="#ì‘ë‹µ-í˜•ì‹-1">ì‘ë‹µ í˜•ì‹</a></h3>
<pre><code class="language-typescript">// Location ë°°ì—´ ë°˜í™˜
type ReferenceResponse = Location[] | null

interface Location {
    uri: string
    range: Range
}
</code></pre>
<p><strong>ì‘ë‹µ ì˜ˆì‹œ:</strong></p>
<pre><code class="language-json">{
    "jsonrpc": "2.0",
    "id": 7,
    "result": [
        {
            "uri": "file:///test.fun",
            "range": {
                "start": { "line": 0, "character": 4 },
                "end": { "line": 0, "character": 7 }
            }
        },
        {
            "uri": "file:///test.fun",
            "range": {
                "start": { "line": 1, "character": 13 },
                "end": { "line": 1, "character": 16 }
            }
        }
    ]
}
</code></pre>
<h3 id="definitionê³¼ì˜-ì°¨ì´ì "><a class="header" href="#definitionê³¼ì˜-ì°¨ì´ì ">Definitionê³¼ì˜ ì°¨ì´ì </a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>ê¸°ëŠ¥</th><th>Definition</th><th>References</th></tr>
</thead>
<tbody>
<tr><td>ë°˜í™˜ê°’</td><td><code>Location</code> (ë‹¨ì¼)</td><td><code>Location[]</code> (ë°°ì—´)</td></tr>
<tr><td>ì˜ë¯¸</td><td>ì‹¬ë³¼ì´ <strong>ì •ì˜ëœ</strong> ê³³</td><td>ì‹¬ë³¼ì´ <strong>ì‚¬ìš©ëœ</strong> ê³³</td></tr>
<tr><td>ê°œìˆ˜</td><td>ìµœëŒ€ 1ê°œ</td><td>0ê°œ ì´ìƒ ì—¬ëŸ¬ ê°œ</td></tr>
<tr><td>í¬í•¨ ë²”ìœ„</td><td>ì •ì˜ ìœ„ì¹˜ë§Œ</td><td>ì •ì˜ ìœ„ì¹˜ëŠ” contextì— ë”°ë¼ ì„ íƒì </td></tr>
</tbody>
</table>
</div>
<hr>
<h2 id="definitionê³¼ì˜-ê´€ê³„"><a class="header" href="#definitionê³¼ì˜-ê´€ê³„">Definitionê³¼ì˜ ê´€ê³„</a></h2>
<p>Find ReferencesëŠ” Go to Definitionì˜ <strong>ì—­ë°©í–¥</strong> ë™ì‘ì´ë‹¤.</p>
<h3 id="ìƒí˜¸-ê´€ê³„"><a class="header" href="#ìƒí˜¸-ê´€ê³„">ìƒí˜¸ ê´€ê³„</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  let add = fun x -&gt; fun y -&gt; x + y in   â”‚  â† ì •ì˜ ìœ„ì¹˜ (Definition)
â”‚      ^^^                                 â”‚
â”‚       â”‚                                  â”‚
â”‚       â”‚ Go to Definition (F12)           â”‚
â”‚       â”‚                                  â”‚
â”‚  let result = add 1 2 in                 â”‚  â† ì‚¬ìš© ìœ„ì¹˜ 1 (Reference)
â”‚               ^^^                        â”‚
â”‚                â”‚                         â”‚
â”‚                â†‘                         â”‚
â”‚  let result2 = add 3 4 in                â”‚  â† ì‚¬ìš© ìœ„ì¹˜ 2 (Reference)
â”‚                ^^^                       â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                   Find References (Shift+F12)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="definitionê³¼-referencesì˜-ë°ì´í„°-íë¦„"><a class="header" href="#definitionê³¼-referencesì˜-ë°ì´í„°-íë¦„">Definitionê³¼ Referencesì˜ ë°ì´í„° íë¦„</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì •ì˜ ì°¾ê¸° (Go to Definition)              â”‚
â”‚    ì»¤ì„œ ìœ„ì¹˜ â†’ ì •ì˜ ìœ„ì¹˜ (1ê°œ)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ë ˆí¼ëŸ°ìŠ¤ ì°¾ê¸° (Find References)            â”‚
â”‚    ì»¤ì„œ ìœ„ì¹˜ â†’ ì •ì˜ í™•ì¸ â†’ ì‚¬ìš© ìœ„ì¹˜ (Nê°œ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>Find References êµ¬í˜„ ì‹œ <strong>Definition ëª¨ë“ˆì„ ì¬ì‚¬ìš©</strong>í•œë‹¤:</p>
<ol>
<li>ì»¤ì„œ ìœ„ì¹˜ì—ì„œ ì‹¬ë³¼ì˜ ì •ì˜ë¥¼ ë¨¼ì € ì°¾ìŒ (<code>findDefinitionForVar</code>)</li>
<li>ê·¸ ì •ì˜ë¥¼ ì°¸ì¡°í•˜ëŠ” ëª¨ë“  Var ë…¸ë“œë¥¼ ìˆ˜ì§‘</li>
<li>ì„€ë„ì‰ì„ ê³ ë ¤í•˜ì—¬ ì˜¬ë°”ë¥¸ ë ˆí¼ëŸ°ìŠ¤ë§Œ í•„í„°ë§</li>
</ol>
<hr>
<h2 id="ë ˆí¼ëŸ°ìŠ¤-ìˆ˜ì§‘-êµ¬í˜„"><a class="header" href="#ë ˆí¼ëŸ°ìŠ¤-ìˆ˜ì§‘-êµ¬í˜„">ë ˆí¼ëŸ°ìŠ¤ ìˆ˜ì§‘ êµ¬í˜„</a></h2>
<h3 id="collectreferences-í•¨ìˆ˜-ê¸°ë³¸-ë²„ì „"><a class="header" href="#collectreferences-í•¨ìˆ˜-ê¸°ë³¸-ë²„ì „">collectReferences í•¨ìˆ˜ (ê¸°ë³¸ ë²„ì „)</a></h3>
<p>ë¨¼ì € <strong>ì„€ë„ì‰ ë¯¸ê³ ë ¤</strong> ë²„ì „ì„ êµ¬í˜„í•œë‹¤. ë‹¨ìˆœíˆ ì´ë¦„ì´ ì¼ì¹˜í•˜ëŠ” ëª¨ë“  Var ë…¸ë“œë¥¼ ìˆ˜ì§‘í•œë‹¤.</p>
<pre><code class="language-fsharp">// References.fs
module LangLSP.Server.References

open Ast

/// Collect all variable references (Var nodes) matching a symbol name
/// Traverses entire AST and returns list of spans for all Var nodes with matching name
let collectReferences (varName: string) (ast: Expr) : Span list =
    let refs = ResizeArray&lt;Span&gt;()

    let rec traverse expr =
        match expr with
        | Var(name, span) when name = varName -&gt;
            // ì´ë¦„ì´ ì¼ì¹˜í•˜ëŠ” ë³€ìˆ˜ ì‚¬ìš© ë°œê²¬
            refs.Add(span)

        | Let(_, value, body, _) -&gt;
            traverse value
            traverse body

        | LetRec(_, _, fnBody, inExpr, _) -&gt;
            traverse fnBody
            traverse inExpr

        | Lambda(_, body, _) -&gt;
            traverse body

        | LambdaAnnot(_, _, body, _) -&gt;
            traverse body

        | LetPat(_, value, body, _) -&gt;
            traverse value
            traverse body

        | Match(scrutinee, clauses, _) -&gt;
            traverse scrutinee
            for (_, clauseBody) in clauses do
                traverse clauseBody

        | App(fn, arg, _) -&gt;
            traverse fn
            traverse arg

        | If(cond, thenExpr, elseExpr, _) -&gt;
            traverse cond
            traverse thenExpr
            traverse elseExpr

        | Add(l, r, _) | Subtract(l, r, _) | Multiply(l, r, _) | Divide(l, r, _)
        | Equal(l, r, _) | NotEqual(l, r, _) | LessThan(l, r, _) | GreaterThan(l, r, _)
        | LessEqual(l, r, _) | GreaterEqual(l, r, _) | And(l, r, _) | Or(l, r, _)
        | Cons(l, r, _) -&gt;
            traverse l
            traverse r

        | Negate(e, _) | Annot(e, _, _) -&gt;
            traverse e

        | Tuple(exprs, _) | List(exprs, _) -&gt;
            exprs |&gt; List.iter traverse

        | Number _ | Bool _ | String _ | EmptyList _ | Var _ -&gt; ()

    traverse ast
    refs |&gt; Seq.toList
</code></pre>
<h3 id="ë™ì‘-ì›ë¦¬"><a class="header" href="#ë™ì‘-ì›ë¦¬">ë™ì‘ ì›ë¦¬</a></h3>
<ol>
<li><strong>ResizeArray ì‚¬ìš©</strong>: íš¨ìœ¨ì ì¸ appendë¥¼ ìœ„í•´ mutable ë¦¬ìŠ¤íŠ¸ ì‚¬ìš©</li>
<li><strong>ì¬ê·€ ìˆœíšŒ</strong>: ëª¨ë“  í•˜ìœ„ í‘œí˜„ì‹ íƒìƒ‰</li>
<li><strong>Var ë…¸ë“œ ë§¤ì¹­</strong>: <code>Var(name, span) when name = varName</code> íŒ¨í„´ìœ¼ë¡œ ì´ë¦„ ì¼ì¹˜ ê²€ì‚¬</li>
<li><strong>Span ìˆ˜ì§‘</strong>: ì¼ì¹˜í•˜ëŠ” Var ë…¸ë“œì˜ ìœ„ì¹˜ ì •ë³´ ì €ì¥</li>
</ol>
<h3 id="ì˜ˆì‹œ-1"><a class="header" href="#ì˜ˆì‹œ-1">ì˜ˆì‹œ</a></h3>
<pre><code class="language-funlang">let x = 1 in
  let y = x + 2 in
    x + y
</code></pre>
<p><code>collectReferences "x" ast</code> í˜¸ì¶œ ì‹œ:</p>
<ul>
<li>ê²°ê³¼: <code>[Span(1, 10, 1, 11), Span(2, 4, 2, 5)]</code></li>
<li>2ë²ˆ ë¼ì¸ì˜ <code>x + 2</code>ì™€ 3ë²ˆ ë¼ì¸ì˜ <code>x + y</code>ì—ì„œ ë°œê²¬</li>
</ul>
<hr>
<h2 id="ìŠ¤ì½”í”„-ì¸ì‹-ë ˆí¼ëŸ°ìŠ¤-ìˆ˜ì§‘"><a class="header" href="#ìŠ¤ì½”í”„-ì¸ì‹-ë ˆí¼ëŸ°ìŠ¤-ìˆ˜ì§‘">ìŠ¤ì½”í”„ ì¸ì‹ ë ˆí¼ëŸ°ìŠ¤ ìˆ˜ì§‘</a></h2>
<h3 id="ì„€ë„ì‰-ë¬¸ì œ"><a class="header" href="#ì„€ë„ì‰-ë¬¸ì œ">ì„€ë„ì‰ ë¬¸ì œ</a></h3>
<p>ê¸°ë³¸ <code>collectReferences</code>ëŠ” <strong>ì´ë¦„ë§Œ</strong> ì²´í¬í•˜ë¯€ë¡œ ì„€ë„ì‰ ì²˜ë¦¬ê°€ ì•ˆ ëœë‹¤.</p>
<pre><code class="language-funlang">let x = 1 in           (* ì •ì˜ A *)
  let x = 2 in         (* ì •ì˜ B - Aë¥¼ shadow *)
    x + 1              (* ì´ xëŠ” Bë¥¼ ì°¸ì¡° *)
</code></pre>
<p>ì‚¬ìš©ìê°€ ì •ì˜ Aì—ì„œ â€œFind Referencesâ€œë¥¼ ì‹¤í–‰í•˜ë©´:</p>
<ul>
<li><strong>ì›í•˜ëŠ” ê²°ê³¼</strong>: ë¹ˆ ë°°ì—´ (ì •ì˜ AëŠ” shadowedë˜ì–´ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ)</li>
<li><strong>ê¸°ë³¸ êµ¬í˜„ ê²°ê³¼</strong>: 3ë²ˆ ë¼ì¸ì˜ <code>x</code> í¬í•¨ (ì˜ëª»ë¨!)</li>
</ul>
<h3 id="collectreferencesforbinding-í•¨ìˆ˜"><a class="header" href="#collectreferencesforbinding-í•¨ìˆ˜">collectReferencesForBinding í•¨ìˆ˜</a></h3>
<p><strong>íŠ¹ì • ì •ì˜</strong>ë¥¼ ì°¸ì¡°í•˜ëŠ” Var ë…¸ë“œë§Œ ì°¾ëŠ” í•¨ìˆ˜ì´ë‹¤.</p>
<pre><code class="language-fsharp">// References.fs
open LangLSP.Server.Definition

/// Collect references to a SPECIFIC binding (shadowing-aware)
/// Only returns Var nodes that resolve to the definition at defSpan
let collectReferencesForBinding (varName: string) (defSpan: Span) (ast: Expr) : Span list =
    // 1. ì´ë¦„ì´ ì¼ì¹˜í•˜ëŠ” ëª¨ë“  Var ë…¸ë“œ ì°¾ê¸°
    let allRefs = collectReferences varName ast

    // 2. ê° Var ë…¸ë“œê°€ ìš°ë¦¬ì˜ ì •ì˜ë¥¼ ì°¸ì¡°í•˜ëŠ”ì§€ í™•ì¸
    allRefs
    |&gt; List.filter (fun refSpan -&gt;
        // Var ë…¸ë“œì˜ ìœ„ì¹˜ë¡œ Position ìƒì„±
        let pos : Position = {
            Line = uint32 refSpan.StartLine
            Character = uint32 refSpan.StartColumn
        }
        // ì´ Var ë…¸ë“œê°€ ì‹¤ì œë¡œ ìš°ë¦¬ì˜ ì •ì˜ë¥¼ ì°¸ì¡°í•˜ëŠ”ì§€ í™•ì¸
        match findDefinitionForVar varName ast pos with
        | Some foundDefSpan -&gt;
            // ì°¾ì€ ì •ì˜ê°€ ìš°ë¦¬ê°€ ì°¾ëŠ” ì •ì˜ì™€ ê°™ì€ì§€ ë¹„êµ
            foundDefSpan.StartLine = defSpan.StartLine &amp;&amp;
            foundDefSpan.StartColumn = defSpan.StartColumn
        | None -&gt; false
    )
</code></pre>
<h3 id="ì•Œê³ ë¦¬ì¦˜-ì„¤ëª…-1"><a class="header" href="#ì•Œê³ ë¦¬ì¦˜-ì„¤ëª…-1">ì•Œê³ ë¦¬ì¦˜ ì„¤ëª…</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. collectReferencesë¡œ í›„ë³´ ìˆ˜ì§‘            â”‚
â”‚    "x"ë¼ëŠ” ì´ë¦„ì˜ ëª¨ë“  Var ë…¸ë“œ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ê° Var ë…¸ë“œë§ˆë‹¤ ì •ì˜ ê²€ìƒ‰                 â”‚
â”‚    findDefinitionForVar í˜¸ì¶œ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ì •ì˜ ìœ„ì¹˜ ë¹„êµ                            â”‚
â”‚    ì°¾ì€ ì •ì˜ == íƒ€ê²Ÿ ì •ì˜?                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ì¼ì¹˜í•˜ëŠ” ê²ƒë§Œ ë°˜í™˜                        â”‚
â”‚    í•„í„°ë§ëœ Span ë¦¬ìŠ¤íŠ¸                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="ì™œ-definition-ëª¨ë“ˆì„-ì¬ì‚¬ìš©í•˜ëŠ”ê°€"><a class="header" href="#ì™œ-definition-ëª¨ë“ˆì„-ì¬ì‚¬ìš©í•˜ëŠ”ê°€">ì™œ Definition ëª¨ë“ˆì„ ì¬ì‚¬ìš©í•˜ëŠ”ê°€?</a></h3>
<p><code>findDefinitionForVar</code>ëŠ” <strong>ì„€ë„ì‰ í•´ê²° ë¡œì§</strong>ì„ ì´ë¯¸ êµ¬í˜„í–ˆë‹¤:</p>
<ul>
<li>ì‚¬ìš© ìœ„ì¹˜ ì´ì „ì˜ ì •ì˜ë§Œ ê³ ë ¤</li>
<li>ê°€ì¥ ê°€ê¹Œìš´ (ë‚´ë¶€) ì •ì˜ ì„ íƒ</li>
<li>ë ‰ì‹œì»¬ ìŠ¤ì½”í•‘ ê·œì¹™ ì ìš©</li>
</ul>
<p>Find ReferencesëŠ” ì´ ë¡œì§ì„ <strong>ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œ</strong>í•˜ì—¬ ê° Var ë…¸ë“œê°€ ì˜¬ë°”ë¥¸ ì •ì˜ë¥¼ ì°¸ì¡°í•˜ëŠ”ì§€ ê²€ì¦í•œë‹¤.</p>
<hr>
<h2 id="ë³€ìˆ˜-ì„€ë„ì‰-ì²˜ë¦¬-1"><a class="header" href="#ë³€ìˆ˜-ì„€ë„ì‰-ì²˜ë¦¬-1">ë³€ìˆ˜ ì„€ë„ì‰ ì²˜ë¦¬</a></h2>
<h3 id="êµ¬ì²´ì -ì˜ˆì‹œ"><a class="header" href="#êµ¬ì²´ì -ì˜ˆì‹œ">êµ¬ì²´ì  ì˜ˆì‹œ</a></h3>
<pre><code class="language-funlang">let x = 1 in           (* ì •ì˜ A: (0, 4) *)
  let x = 2 in         (* ì •ì˜ B: (1, 6) *)
    x                  (* ì‚¬ìš© 1: (2, 4) *)
  in x                 (* ì‚¬ìš© 2: (3, 5) *)
</code></pre>
<p><strong>ì •ì˜ Aì—ì„œ â€œFind Referencesâ€ ì‹¤í–‰:</strong></p>
<ol>
<li>
<p><code>collectReferences "x"</code> í˜¸ì¶œ:</p>
<ul>
<li>ê²°ê³¼: <code>[Span(2,4), Span(3,5)]</code> (ì‚¬ìš© 1, ì‚¬ìš© 2)</li>
</ul>
</li>
<li>
<p>ì‚¬ìš© 1 ê²€ì¦ (<code>Span(2,4)</code>):</p>
<ul>
<li><code>findDefinitionForVar "x" ast (2,4)</code> í˜¸ì¶œ</li>
<li>ê²°ê³¼: <code>Span(1,6)</code> (ì •ì˜ B)</li>
<li><code>(1,6) != (0,4)</code> â†’ <strong>í•„í„° ì•„ì›ƒ</strong></li>
</ul>
</li>
<li>
<p>ì‚¬ìš© 2 ê²€ì¦ (<code>Span(3,5)</code>):</p>
<ul>
<li><code>findDefinitionForVar "x" ast (3,5)</code> í˜¸ì¶œ</li>
<li>ê²°ê³¼: <code>Span(0,4)</code> (ì •ì˜ A)</li>
<li><code>(0,4) == (0,4)</code> â†’ <strong>í¬í•¨</strong></li>
</ul>
</li>
<li>
<p>ìµœì¢… ê²°ê³¼: <code>[Span(3,5)]</code> (ì‚¬ìš© 2ë§Œ í•´ë‹¹)</p>
</li>
</ol>
<p><strong>ì •ì˜ Bì—ì„œ â€œFind Referencesâ€ ì‹¤í–‰:</strong></p>
<ol>
<li>
<p><code>collectReferences "x"</code> í˜¸ì¶œ:</p>
<ul>
<li>ê²°ê³¼: <code>[Span(2,4), Span(3,5)]</code></li>
</ul>
</li>
<li>
<p>ì‚¬ìš© 1 ê²€ì¦:</p>
<ul>
<li>ì •ì˜: <code>Span(1,6)</code> (ì •ì˜ B)</li>
<li><code>(1,6) == (1,6)</code> â†’ <strong>í¬í•¨</strong></li>
</ul>
</li>
<li>
<p>ì‚¬ìš© 2 ê²€ì¦:</p>
<ul>
<li>ì •ì˜: <code>Span(0,4)</code> (ì •ì˜ A)</li>
<li><code>(0,4) != (1,6)</code> â†’ <strong>í•„í„° ì•„ì›ƒ</strong></li>
</ul>
</li>
<li>
<p>ìµœì¢… ê²°ê³¼: <code>[Span(2,4)]</code> (ì‚¬ìš© 1ë§Œ í•´ë‹¹)</p>
</li>
</ol>
<h3 id="ë³µì¡í•œ-ì¤‘ì²©-ì˜ˆì‹œ"><a class="header" href="#ë³µì¡í•œ-ì¤‘ì²©-ì˜ˆì‹œ">ë³µì¡í•œ ì¤‘ì²© ì˜ˆì‹œ</a></h3>
<pre><code class="language-funlang">let x = 1 in                    (* ì •ì˜ A: (0, 4) *)
  (let x = 2 in x) +            (* ì •ì˜ B: (1, 7), ì‚¬ìš© 1: (1, 17) *)
  (let x = 3 in x) +            (* ì •ì˜ C: (2, 7), ì‚¬ìš© 2: (2, 17) *)
  x                             (* ì‚¬ìš© 3: (3, 2) *)
</code></pre>
<p><strong>ì •ì˜ Aì—ì„œ Find References:</strong></p>
<ul>
<li>ì‚¬ìš© 1: Bë¥¼ ì°¸ì¡° â†’ ì œì™¸</li>
<li>ì‚¬ìš© 2: Cë¥¼ ì°¸ì¡° â†’ ì œì™¸</li>
<li>ì‚¬ìš© 3: Aë¥¼ ì°¸ì¡° â†’ <strong>í¬í•¨</strong></li>
<li>ê²°ê³¼: <code>[Span(3,2)]</code></li>
</ul>
<p><strong>ì •ì˜ Bì—ì„œ Find References:</strong></p>
<ul>
<li>ì‚¬ìš© 1: Bë¥¼ ì°¸ì¡° â†’ <strong>í¬í•¨</strong></li>
<li>ì‚¬ìš© 2: Cë¥¼ ì°¸ì¡° â†’ ì œì™¸</li>
<li>ì‚¬ìš© 3: Aë¥¼ ì°¸ì¡° â†’ ì œì™¸</li>
<li>ê²°ê³¼: <code>[Span(1,17)]</code></li>
</ul>
<hr>
<h2 id="í•¸ë“¤ëŸ¬-êµ¬í˜„-1"><a class="header" href="#í•¸ë“¤ëŸ¬-êµ¬í˜„-1">í•¸ë“¤ëŸ¬ êµ¬í˜„</a></h2>
<h3 id="handlereferences-í•¨ìˆ˜"><a class="header" href="#handlereferences-í•¨ìˆ˜">handleReferences í•¨ìˆ˜</a></h3>
<pre><code class="language-fsharp">// References.fs
open Ionide.LanguageServerProtocol.Types
open LangLSP.Server.AstLookup
open LangLSP.Server.DocumentSync
open LangLSP.Server.Protocol

/// Handle textDocument/references request
/// Returns all locations where a symbol is referenced
let handleReferences (p: ReferenceParams) : Async&lt;Location[] option&gt; =
    async {
        let uri = p.TextDocument.Uri
        let pos = p.Position

        match getDocument uri with
        | None -&gt; return None
        | Some text -&gt;
            try
                // 1. íŒŒì‹±
                let lexbuf = FSharp.Text.Lexing.LexBuffer&lt;char&gt;.FromString(text)
                let ast = Parser.start Lexer.tokenize lexbuf

                // 2. ì»¤ì„œ ìœ„ì¹˜ì˜ ë…¸ë“œ ì°¾ê¸°
                match findNodeAtPosition pos ast with
                | None -&gt; return None
                | Some node -&gt;
                    // 3. ë…¸ë“œì—ì„œ ì‹¬ë³¼ ì´ë¦„ê³¼ ì •ì˜ ìœ„ì¹˜ ì¶”ì¶œ
                    let identOpt, defSpanOpt =
                        match node with
                        | Var(name, _) -&gt;
                            // ë³€ìˆ˜ ì‚¬ìš©ì²˜ - ì •ì˜ ì°¾ê¸°
                            let def = findDefinitionForVar name ast pos
                            (Some name, def)
                        | Let(name, _, _, span) -&gt;
                            // Let ë°”ì¸ë”© ìì²´
                            (Some name, Some span)
                        | Lambda(param, _, span) -&gt;
                            // ëŒë‹¤ íŒŒë¼ë¯¸í„°
                            (Some param, Some span)
                        | LambdaAnnot(param, _, _, span) -&gt;
                            // íƒ€ì… ì–´ë…¸í…Œì´ì…˜ì´ ìˆëŠ” ëŒë‹¤
                            (Some param, Some span)
                        | LetRec(name, _, _, _, span) -&gt;
                            // ì¬ê·€ í•¨ìˆ˜
                            (Some name, Some span)
                        | _ -&gt;
                            // ë ˆí¼ëŸ°ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ë…¸ë“œ
                            (None, None)

                    match identOpt, defSpanOpt with
                    | Some varName, Some defSpan -&gt;
                        // 4. ì„€ë„ì‰ ì¸ì‹ ë ˆí¼ëŸ°ìŠ¤ ìˆ˜ì§‘
                        let refSpans = collectReferencesForBinding varName defSpan ast

                        // 5. includeDeclaration ì²˜ë¦¬
                        let allSpans =
                            if p.Context.IncludeDeclaration then
                                defSpan :: refSpans
                            else
                                refSpans

                        // 6. Location[] ë³€í™˜
                        let locations =
                            allSpans
                            |&gt; List.map (fun span -&gt;
                                {
                                    Uri = uri
                                    Range = spanToLspRange span
                                })
                            |&gt; Array.ofList

                        return Some locations

                    | Some varName, None -&gt;
                        // ì •ì˜ë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš° (ë“œë¬¼ì§€ë§Œ ê°€ëŠ¥)
                        // ì„€ë„ì‰ ë¬´ì‹œí•˜ê³  ì´ë¦„ë§Œìœ¼ë¡œ ìˆ˜ì§‘
                        let refSpans = collectReferences varName ast

                        let locations =
                            refSpans
                            |&gt; List.map (fun span -&gt;
                                {
                                    Uri = uri
                                    Range = spanToLspRange span
                                })
                            |&gt; Array.ofList

                        return Some locations

                    | _ -&gt;
                        // ì‹¬ë³¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ
                        return None

            with _ -&gt;
                // íŒŒì‹± ì‹¤íŒ¨
                return None
    }
</code></pre>
<h3 id="ë™ì‘-íë¦„-1"><a class="header" href="#ë™ì‘-íë¦„-1">ë™ì‘ íë¦„</a></h3>
<pre><code>ì‚¬ìš©ì Shift+F12 í‚¤
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. getDocumentë¡œ ì†ŒìŠ¤ í…ìŠ¤íŠ¸ íšë“   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Parserë¡œ AST ìƒì„±                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. findNodeAtPosition               â”‚
â”‚    ì»¤ì„œ ìœ„ì¹˜ì˜ AST ë…¸ë“œ ì°¾ê¸°        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ë…¸ë“œ íƒ€ì…ì— ë”°ë¼ ì²˜ë¦¬            â”‚
â”‚    - Var: ì •ì˜ ì°¾ê¸°                 â”‚
â”‚    - Let/Lambda: ì§ì ‘ ì •ì˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. collectReferencesForBinding      â”‚
â”‚    ì„€ë„ì‰ ì¸ì‹ ë ˆí¼ëŸ°ìŠ¤ ìˆ˜ì§‘        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. includeDeclaration ì²˜ë¦¬          â”‚
â”‚    ì •ì˜ ìœ„ì¹˜ í¬í•¨ ì—¬ë¶€ ê²°ì •         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Location[] ë°˜í™˜                  â”‚
â”‚    URI + Range ë°°ì—´                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="ë…¸ë“œ-íƒ€ì…ë³„-ì²˜ë¦¬"><a class="header" href="#ë…¸ë“œ-íƒ€ì…ë³„-ì²˜ë¦¬">ë…¸ë“œ íƒ€ì…ë³„ ì²˜ë¦¬</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>ë…¸ë“œ íƒ€ì…</th><th>ì˜ë¯¸</th><th>ì •ì˜ ìœ„ì¹˜ ì¶”ì¶œ</th></tr>
</thead>
<tbody>
<tr><td><code>Var(name, span)</code></td><td>ë³€ìˆ˜ ì‚¬ìš©</td><td><code>findDefinitionForVar</code> í˜¸ì¶œ</td></tr>
<tr><td><code>Let(name, _, _, span)</code></td><td>let ë°”ì¸ë”©</td><td><code>span</code> ì§ì ‘ ì‚¬ìš©</td></tr>
<tr><td><code>Lambda(param, _, span)</code></td><td>ëŒë‹¤ íŒŒë¼ë¯¸í„°</td><td><code>span</code> ì§ì ‘ ì‚¬ìš©</td></tr>
<tr><td><code>LambdaAnnot(param, _, _, span)</code></td><td>íƒ€ì… ì–´ë…¸í…Œì´ì…˜ ëŒë‹¤</td><td><code>span</code> ì§ì ‘ ì‚¬ìš©</td></tr>
<tr><td><code>LetRec(name, _, _, _, span)</code></td><td>ì¬ê·€ í•¨ìˆ˜</td><td><code>span</code> ì§ì ‘ ì‚¬ìš©</td></tr>
<tr><td>ê¸°íƒ€</td><td>ì—°ì‚°ì, ë¦¬í„°ëŸ´ ë“±</td><td>None (ë ˆí¼ëŸ°ìŠ¤ ì—†ìŒ)</td></tr>
</tbody>
</table>
</div>
<h3 id="includedeclaration-ì²˜ë¦¬"><a class="header" href="#includedeclaration-ì²˜ë¦¬">includeDeclaration ì²˜ë¦¬</a></h3>
<pre><code class="language-fsharp">let allSpans =
    if p.Context.IncludeDeclaration then
        defSpan :: refSpans  // ì •ì˜ ìœ„ì¹˜ë¥¼ ë¦¬ìŠ¤íŠ¸ ì•ì— ì¶”ê°€
    else
        refSpans             // ì‚¬ìš©ì²˜ë§Œ
</code></pre>
<p><strong>VS Code ë™ì‘:</strong></p>
<ul>
<li>ì¼ë°˜ì ìœ¼ë¡œ <code>includeDeclaration: true</code>ë¡œ ìš”ì²­</li>
<li>ê²°ê³¼ íŒ¨ë„ì—ì„œ ì •ì˜ ìœ„ì¹˜ê°€ ì²« ë²ˆì§¸ í•­ëª©ìœ¼ë¡œ í‘œì‹œë¨</li>
</ul>
<hr>
<h2 id="serverfs-í†µí•©-1"><a class="header" href="#serverfs-í†µí•©-1">Server.fs í†µí•©</a></h2>
<h3 id="ì„œë²„-ê¸°ëŠ¥-ë“±ë¡-1"><a class="header" href="#ì„œë²„-ê¸°ëŠ¥-ë“±ë¡-1">ì„œë²„ ê¸°ëŠ¥ ë“±ë¡</a></h3>
<pre><code class="language-fsharp">// Server.fs
let serverCapabilities : ServerCapabilities =
    { ServerCapabilities.Default with
        TextDocumentSync = ...
        HoverProvider = Some (U2.C1 true)
        DefinitionProvider = Some (U2.C1 true)
        ReferencesProvider = Some (U2.C1 true)  // ì¶”ê°€!
    }
</code></pre>
<h3 id="í•¸ë“¤ëŸ¬-ë“±ë¡-1"><a class="header" href="#í•¸ë“¤ëŸ¬-ë“±ë¡-1">í•¸ë“¤ëŸ¬ ë“±ë¡</a></h3>
<pre><code class="language-fsharp">// Server.fs
module Handlers =
    /// Handle textDocument/references request
    let textDocumentReferences (p: ReferenceParams) : Async&lt;Location[] option&gt; =
        handleReferences p
</code></pre>
<h3 id="ì „ì²´-ì—°ê²°-1"><a class="header" href="#ì „ì²´-ì—°ê²°-1">ì „ì²´ ì—°ê²°</a></h3>
<p>í´ë¼ì´ì–¸íŠ¸ê°€ <code>initialize</code> ìš”ì²­ì„ ë³´ë‚´ë©´:</p>
<ol>
<li>ì„œë²„ê°€ <code>ReferencesProvider = true</code> ì‘ë‹µ</li>
<li>í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ì œ References ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥</li>
</ol>
<p>í´ë¼ì´ì–¸íŠ¸ê°€ <code>textDocument/references</code> ìš”ì²­ì„ ë³´ë‚´ë©´:</p>
<ol>
<li>ì„œë²„ê°€ <code>Handlers.textDocumentReferences</code> í˜¸ì¶œ</li>
<li>References.fsì˜ <code>handleReferences</code> ì‹¤í–‰</li>
<li><code>Location[]</code> ë˜ëŠ” <code>null</code> ë°˜í™˜</li>
</ol>
<hr>
<h2 id="í…ŒìŠ¤íŠ¸-ì‘ì„±-5"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‘ì„±-5">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></h2>
<h3 id="ê¸°ë³¸-í…ŒìŠ¤íŠ¸-êµ¬ì¡°-1"><a class="header" href="#ê¸°ë³¸-í…ŒìŠ¤íŠ¸-êµ¬ì¡°-1">ê¸°ë³¸ í…ŒìŠ¤íŠ¸ êµ¬ì¡°</a></h3>
<pre><code class="language-fsharp">// ReferencesTests.fs
module LangLSP.Tests.ReferencesTests

open Expecto
open Ionide.LanguageServerProtocol.Types
open LangLSP.Server.References
open LangLSP.Server.DocumentSync

let makeReferenceParams uri line char includeDecl : ReferenceParams =
    {
        TextDocument = { Uri = uri }
        Position = { Line = uint32 line; Character = uint32 char }
        Context = { IncludeDeclaration = includeDecl }
    }
</code></pre>
<h3 id="í•µì‹¬-í…ŒìŠ¤íŠ¸-ì¼€ì´ìŠ¤ë“¤"><a class="header" href="#í•µì‹¬-í…ŒìŠ¤íŠ¸-ì¼€ì´ìŠ¤ë“¤">í•µì‹¬ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë“¤</a></h3>
<pre><code class="language-fsharp">[&lt;Tests&gt;]
let referencesTests =
    testSequenced &lt;| testList "References" [

        testCase "let binding: finds all uses" &lt;| fun _ -&gt;
            clearAll()
            let uri = "file:///test-ref-let.fun"
            let text = "let x = 1 in x + x"
            handleDidOpen { TextDocument = { Uri = uri; LanguageId = "funlang"; Version = 1; Text = text } }

            // x ì •ì˜ ìœ„ì¹˜ (col 4)ì—ì„œ references ìš”ì²­
            let result = handleReferences (makeReferenceParams uri 0 4 false) |&gt; Async.RunSynchronously
            Expect.isSome result "Should find references"
            let locations = result.Value
            Expect.equal locations.Length 2 "Should find 2 references"

        testCase "includeDeclaration: includes definition" &lt;| fun _ -&gt;
            clearAll()
            let uri = "file:///test-ref-incldecl.fun"
            let text = "let x = 1 in x + x"
            handleDidOpen { TextDocument = { Uri = uri; LanguageId = "funlang"; Version = 1; Text = text } }

            // includeDeclaration = true
            let result = handleReferences (makeReferenceParams uri 0 4 true) |&gt; Async.RunSynchronously
            Expect.isSome result "Should find references"
            let locations = result.Value
            Expect.equal locations.Length 3 "Should find 2 refs + 1 definition"

        testCase "shadowed variable: only finds inner scope uses" &lt;| fun _ -&gt;
            clearAll()
            let uri = "file:///test-ref-shadow.fun"
            let text = "let x = 1 in let x = 2 in x"
            handleDidOpen { TextDocument = { Uri = uri; LanguageId = "funlang"; Version = 1; Text = text } }

            // ì™¸ë¶€ x (col 4)ì—ì„œ references ìš”ì²­
            let result = handleReferences (makeReferenceParams uri 0 4 false) |&gt; Async.RunSynchronously
            Expect.isSome result "Should find references"
            let locations = result.Value
            Expect.equal locations.Length 0 "Outer x is shadowed, no uses"

        testCase "shadowed variable: inner definition has uses" &lt;| fun _ -&gt;
            clearAll()
            let uri = "file:///test-ref-shadow2.fun"
            let text = "let x = 1 in let x = 2 in x"
            handleDidOpen { TextDocument = { Uri = uri; LanguageId = "funlang"; Version = 1; Text = text } }

            // ë‚´ë¶€ x (col 21)ì—ì„œ references ìš”ì²­
            let result = handleReferences (makeReferenceParams uri 0 21 false) |&gt; Async.RunSynchronously
            Expect.isSome result "Should find references"
            let locations = result.Value
            Expect.equal locations.Length 1 "Inner x is used once"

        testCase "lambda parameter: finds all uses in body" &lt;| fun _ -&gt;
            clearAll()
            let uri = "file:///test-ref-lambda.fun"
            let text = "fun x -&gt; x + x"
            handleDidOpen { TextDocument = { Uri = uri; LanguageId = "funlang"; Version = 1; Text = text } }

            // x íŒŒë¼ë¯¸í„° (col 4)ì—ì„œ references ìš”ì²­
            let result = handleReferences (makeReferenceParams uri 0 4 false) |&gt; Async.RunSynchronously
            Expect.isSome result "Should find references"
            let locations = result.Value
            Expect.equal locations.Length 2 "Parameter x used twice"

        testCase "let rec: finds recursive calls" &lt;| fun _ -&gt;
            clearAll()
            let uri = "file:///test-ref-letrec.fun"
            let text = "let rec f n = if n = 0 then 1 else n * f (n - 1) in f 5"
            handleDidOpen { TextDocument = { Uri = uri; LanguageId = "funlang"; Version = 1; Text = text } }

            // f ì •ì˜ (col 8)ì—ì„œ references ìš”ì²­
            let result = handleReferences (makeReferenceParams uri 0 8 false) |&gt; Async.RunSynchronously
            Expect.isSome result "Should find references"
            let locations = result.Value
            Expect.equal locations.Length 2 "f used in recursive call + final use"

        testCase "unused variable: zero references" &lt;| fun _ -&gt;
            clearAll()
            let uri = "file:///test-ref-unused.fun"
            let text = "let x = 1 in 42"
            handleDidOpen { TextDocument = { Uri = uri; LanguageId = "funlang"; Version = 1; Text = text } }

            // x ì •ì˜ì—ì„œ references ìš”ì²­
            let result = handleReferences (makeReferenceParams uri 0 4 false) |&gt; Async.RunSynchronously
            Expect.isSome result "Should return empty array"
            let locations = result.Value
            Expect.equal locations.Length 0 "No references to unused variable"
    ]
</code></pre>
<h3 id="í…ŒìŠ¤íŠ¸-ìš”ì -1"><a class="header" href="#í…ŒìŠ¤íŠ¸-ìš”ì -1">í…ŒìŠ¤íŠ¸ ìš”ì </a></h3>
<ol>
<li><strong>testSequenced</strong>: ê³µìœ  DocumentSync ìƒíƒœë¡œ ì¸í•œ ê°„ì„­ ë°©ì§€</li>
<li><strong>clearAll()</strong>: ê° í…ŒìŠ¤íŠ¸ ì „ì— ë¬¸ì„œ ì €ì¥ì†Œ ì´ˆê¸°í™”</li>
<li><strong>includeDeclaration í…ŒìŠ¤íŠ¸</strong>: true/false ë™ì‘ ì°¨ì´ ê²€ì¦</li>
<li><strong>ì„€ë„ì‰ í…ŒìŠ¤íŠ¸</strong>: ì™¸ë¶€/ë‚´ë¶€ ì •ì˜ ê°ê°ì˜ ë ˆí¼ëŸ°ìŠ¤ ì •í™•ë„ í™•ì¸</li>
<li><strong>ë¯¸ì‚¬ìš© ë³€ìˆ˜ í…ŒìŠ¤íŠ¸</strong>: ë ˆí¼ëŸ°ìŠ¤ 0ê°œ ì¼€ì´ìŠ¤ ê²€ì¦</li>
</ol>
<h3 id="í…ŒìŠ¤íŠ¸-ì‹¤í–‰-5"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‹¤í–‰-5">í…ŒìŠ¤íŠ¸ ì‹¤í–‰</a></h3>
<pre><code class="language-bash">dotnet run --project src/LangLSP.Tests

# ì¶œë ¥:
# [References] let binding: finds all uses - Passed
# [References] includeDeclaration: includes definition - Passed
# [References] shadowed variable: only finds inner scope uses - Passed
# [References] shadowed variable: inner definition has uses - Passed
# [References] lambda parameter: finds all uses in body - Passed
# [References] let rec: finds recursive calls - Passed
# [References] unused variable: zero references - Passed
</code></pre>
<hr>
<h2 id="definition-vs-references-ë¹„êµ"><a class="header" href="#definition-vs-references-ë¹„êµ">Definition vs References ë¹„êµ</a></h2>
<h3 id="ê¸°ëŠ¥-ë¹„êµ-í‘œ"><a class="header" href="#ê¸°ëŠ¥-ë¹„êµ-í‘œ">ê¸°ëŠ¥ ë¹„êµ í‘œ</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>ì¸¡ë©´</th><th>Go to Definition</th><th>Find References</th></tr>
</thead>
<tbody>
<tr><td><strong>LSP ë©”ì„œë“œ</strong></td><td><code>textDocument/definition</code></td><td><code>textDocument/references</code></td></tr>
<tr><td><strong>ë°˜í™˜ íƒ€ì…</strong></td><td><code>Location</code> (ë‹¨ì¼)</td><td><code>Location[]</code> (ë°°ì—´)</td></tr>
<tr><td><strong>ì˜ë¯¸</strong></td><td>â€œì–´ë””ì„œ ì •ì˜ë˜ì—ˆë‚˜?â€</td><td>â€œì–´ë””ì„œ ì‚¬ìš©ë˜ë‚˜?â€</td></tr>
<tr><td><strong>ê°œìˆ˜</strong></td><td>ìµœëŒ€ 1ê°œ</td><td>0ê°œ ì´ìƒ</td></tr>
<tr><td><strong>ë°©í–¥</strong></td><td>ì‚¬ìš©ì²˜ â†’ ì •ì˜</td><td>ì •ì˜ â†’ ì‚¬ìš©ì²˜</td></tr>
<tr><td><strong>íŠ¸ë¦¬ê±°</strong></td><td>F12, Ctrl+í´ë¦­</td><td>Shift+F12</td></tr>
<tr><td><strong>includeDeclaration</strong></td><td>ì—†ìŒ</td><td><code>context.includeDeclaration</code></td></tr>
</tbody>
</table>
</div>
<h3 id="êµ¬í˜„-ë³µì¡ë„-ë¹„êµ"><a class="header" href="#êµ¬í˜„-ë³µì¡ë„-ë¹„êµ">êµ¬í˜„ ë³µì¡ë„ ë¹„êµ</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Go to Definition                            â”‚
â”‚ - ë‚œì´ë„: ì¤‘                                 â”‚
â”‚ - í•µì‹¬: collectDefinitions + ì„€ë„ì‰ í•´ê²°    â”‚
â”‚ - ë°˜í™˜: ë‹¨ì¼ Location                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Find References                             â”‚
â”‚ - ë‚œì´ë„: ì¤‘ìƒ                               â”‚
â”‚ - í•µì‹¬: collectReferences + Definition ì¬ì‚¬ìš©â”‚
â”‚ - ë°˜í™˜: Location ë°°ì—´                        â”‚
â”‚ - ì¶”ê°€ ê³ ë ¤: includeDeclaration             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="ì½”ë“œ-ì¬ì‚¬ìš©"><a class="header" href="#ì½”ë“œ-ì¬ì‚¬ìš©">ì½”ë“œ ì¬ì‚¬ìš©</a></h3>
<p>Find ReferencesëŠ” Definition ëª¨ë“ˆì„ <strong>í•„ìˆ˜ì ìœ¼ë¡œ</strong> ì¬ì‚¬ìš©í•œë‹¤:</p>
<pre><code class="language-fsharp">// References.fsì—ì„œ Definition í•¨ìˆ˜ ì‚¬ìš©
open LangLSP.Server.Definition

// 1. ê° Var ë…¸ë“œê°€ ì–´ëŠ ì •ì˜ë¥¼ ì°¸ì¡°í•˜ëŠ”ì§€ í™•ì¸
match findDefinitionForVar varName ast pos with
| Some foundDefSpan -&gt; ...

// 2. ì •ì˜ ìœ„ì¹˜ ë¹„êµë¡œ ì„€ë„ì‰ ì²˜ë¦¬
foundDefSpan.StartLine = defSpan.StartLine &amp;&amp;
foundDefSpan.StartColumn = defSpan.StartColumn
</code></pre>
<p><strong>ì™œ ì¬ì‚¬ìš©ì´ ì¤‘ìš”í•œê°€?</strong></p>
<ul>
<li>ì„€ë„ì‰ ë¡œì§ ì¤‘ë³µ ë°©ì§€</li>
<li>ì •ì˜ ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜ ì¼ê´€ì„± ë³´ì¥</li>
<li>ìœ ì§€ë³´ìˆ˜ ìš©ì´ (Definition ë¡œì§ ë³€ê²½ ì‹œ Referencesë„ ìë™ ë°˜ì˜)</li>
</ul>
<h3 id="ì‚¬ìš©ì-ì›Œí¬í”Œë¡œìš°"><a class="header" href="#ì‚¬ìš©ì-ì›Œí¬í”Œë¡œìš°">ì‚¬ìš©ì ì›Œí¬í”Œë¡œìš°</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ë³€ìˆ˜ ìœ„ì—ì„œ Ctrl+í´ë¦­ (Go to Definition) â”‚
â”‚    â†’ ì •ì˜ ìœ„ì¹˜ë¡œ ì´ë™                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ì •ì˜ ìœ„ì¹˜ì—ì„œ Shift+F12 (Find References)â”‚
â”‚    â†’ ëª¨ë“  ì‚¬ìš©ì²˜ í™•ì¸                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ê²°ê³¼ ëª©ë¡ì—ì„œ í•­ëª© í´ë¦­                   â”‚
â”‚    â†’ í•´ë‹¹ ì‚¬ìš©ì²˜ë¡œ ì´ë™                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr>
<h2 id="í”í•œ-ì‹¤ìˆ˜-1"><a class="header" href="#í”í•œ-ì‹¤ìˆ˜-1">í”í•œ ì‹¤ìˆ˜</a></h2>
<h3 id="1-ì„€ë„ì‰-ë¬´ì‹œ-1"><a class="header" href="#1-ì„€ë„ì‰-ë¬´ì‹œ-1">1. ì„€ë„ì‰ ë¬´ì‹œ</a></h3>
<p><strong>ì˜ëª»ëœ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">// ì´ë¦„ë§Œ ì²´í¬
let refs = collectReferences varName ast
return refs  // ì„€ë„ì‰ ê³ ë ¤ ì•ˆ í•¨!
</code></pre>
<p><strong>ì˜¬ë°”ë¥¸ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">// ì •ì˜ë¥¼ ë¨¼ì € ì°¾ê³ , í•´ë‹¹ ì •ì˜ë¥¼ ì°¸ì¡°í•˜ëŠ” ê²ƒë§Œ í•„í„°ë§
let refSpans = collectReferencesForBinding varName defSpan ast
</code></pre>
<h3 id="2-includedeclaration-ë¬´ì‹œ"><a class="header" href="#2-includedeclaration-ë¬´ì‹œ">2. includeDeclaration ë¬´ì‹œ</a></h3>
<p><strong>ì˜ëª»ëœ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">// í•­ìƒ ì •ì˜ í¬í•¨
let allSpans = defSpan :: refSpans
</code></pre>
<p><strong>ì˜¬ë°”ë¥¸ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">// contextì— ë”°ë¼ ì¡°ê±´ë¶€ í¬í•¨
let allSpans =
    if p.Context.IncludeDeclaration then
        defSpan :: refSpans
    else
        refSpans
</code></pre>
<h3 id="3-var-ë…¸ë“œë§Œ-ì²˜ë¦¬í•˜ì§€-ì•ŠìŒ"><a class="header" href="#3-var-ë…¸ë“œë§Œ-ì²˜ë¦¬í•˜ì§€-ì•ŠìŒ">3. Var ë…¸ë“œë§Œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ</a></h3>
<p><strong>ì˜ëª»ëœ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">let rec traverse expr =
    match expr with
    | Number(_, span) -&gt;
        refs.Add(span)  // ìˆ«ìë„ ë ˆí¼ëŸ°ìŠ¤ë¡œ ìˆ˜ì§‘?!
</code></pre>
<p><strong>ì˜¬ë°”ë¥¸ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">let rec traverse expr =
    match expr with
    | Var(name, span) when name = varName -&gt;
        refs.Add(span)  // Var ë…¸ë“œë§Œ!
    | Number _ -&gt; ()    // ë¦¬í„°ëŸ´ì€ ë ˆí¼ëŸ°ìŠ¤ ì•„ë‹˜
</code></pre>
<h3 id="4-ì •ì˜-ìœ„ì¹˜ë¥¼-varë¡œ-ì°©ê°"><a class="header" href="#4-ì •ì˜-ìœ„ì¹˜ë¥¼-varë¡œ-ì°©ê°">4. ì •ì˜ ìœ„ì¹˜ë¥¼ Varë¡œ ì°©ê°</a></h3>
<p><strong>ë¬¸ì œ ìƒí™©:</strong></p>
<pre><code class="language-funlang">let x = 1 in x
    ^        ^
    ì •ì˜     ì‚¬ìš©
</code></pre>
<p><code>collectReferences</code>ëŠ” <strong>ì‚¬ìš©ì²˜ë§Œ</strong> ì°¾ì•„ì•¼ í•˜ë¯€ë¡œ:</p>
<ul>
<li>ì •ì˜ ìœ„ì¹˜ì˜ <code>x</code>ëŠ” <code>Let(name, ...)</code> ë…¸ë“œì˜ ì¼ë¶€</li>
<li><code>Var(name, span)</code> ë…¸ë“œëŠ” ì‚¬ìš©ì²˜ì—ì„œë§Œ ë“±ì¥</li>
</ul>
<p><strong>ê²€ì¦:</strong></p>
<pre><code class="language-fsharp">// collectReferencesëŠ” Var ë…¸ë“œë§Œ ìˆ˜ì§‘
| Var(name, span) when name = varName -&gt;
    refs.Add(span)

// Let ë…¸ë“œëŠ” ìˆœíšŒë§Œ í•˜ê³  ìˆ˜ì§‘í•˜ì§€ ì•ŠìŒ
| Let(name, value, body, _) -&gt;
    traverse value   // valueì™€ bodyë§Œ ìˆœíšŒ
    traverse body
</code></pre>
<h3 id="5-ì¬ê·€-í•¨ìˆ˜ì˜-íŒŒë¼ë¯¸í„°-ëˆ„ë½"><a class="header" href="#5-ì¬ê·€-í•¨ìˆ˜ì˜-íŒŒë¼ë¯¸í„°-ëˆ„ë½">5. ì¬ê·€ í•¨ìˆ˜ì˜ íŒŒë¼ë¯¸í„° ëˆ„ë½</a></h3>
<p><strong>ì˜ëª»ëœ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">| LetRec(name, _, fnBody, inExpr, span) -&gt;
    // nameë§Œ ì²˜ë¦¬, param ë¬´ì‹œ
    if name = varName then refs.Add(span)
</code></pre>
<p><strong>ì˜¬ë°”ë¥¸ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">// let recì€ í•¨ìˆ˜ëª…ê³¼ íŒŒë¼ë¯¸í„° ëª¨ë‘ í™•ì¸ í•„ìš”
// í•˜ì§€ë§Œ collectReferencesëŠ” Varë§Œ ìˆ˜ì§‘í•˜ë¯€ë¡œ
// fnBodyì™€ inExpr ìˆœíšŒë§Œ í•˜ë©´ ìë™ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ì‚¬ìš©ì²˜ ìˆ˜ì§‘ë¨
| LetRec(_, _, fnBody, inExpr, _) -&gt;
    traverse fnBody
    traverse inExpr
</code></pre>
<hr>
<h2 id="ìµœì í™”-ê³ ë ¤ì‚¬í•­"><a class="header" href="#ìµœì í™”-ê³ ë ¤ì‚¬í•­">ìµœì í™” ê³ ë ¤ì‚¬í•­</a></h2>
<h3 id="ì„±ëŠ¥-ë¶„ì„"><a class="header" href="#ì„±ëŠ¥-ë¶„ì„">ì„±ëŠ¥ ë¶„ì„</a></h3>
<pre><code class="language-fsharp">// collectReferencesForBindingì˜ ë³µì¡ë„
O(N * M)
  N = ì „ì²´ Var ë…¸ë“œ ê°œìˆ˜
  M = ê° Varë§ˆë‹¤ findDefinitionForVar í˜¸ì¶œ (O(D), D = ì •ì˜ ê°œìˆ˜)
</code></pre>
<p><strong>ëŒ€ê·œëª¨ íŒŒì¼ì—ì„œì˜ ë¬¸ì œ:</strong></p>
<ul>
<li>íŒŒì¼ì´ í¬ë©´ Var ë…¸ë“œê°€ ë§ìŒ</li>
<li>ê° Varë§ˆë‹¤ ì •ì˜ ê²€ìƒ‰ ìˆ˜í–‰</li>
<li>ì„€ë„ì‰ì´ ë§ìœ¼ë©´ ì •ì˜ ë¹„êµ íšŸìˆ˜ ì¦ê°€</li>
</ul>
<h3 id="ìµœì í™”-ì „ëµ-ë¯¸ë˜-ê°œì„ "><a class="header" href="#ìµœì í™”-ì „ëµ-ë¯¸ë˜-ê°œì„ ">ìµœì í™” ì „ëµ (ë¯¸ë˜ ê°œì„ )</a></h3>
<ol>
<li>
<p><strong>ì •ì˜ ì¸ë±ìŠ¤ ìºì‹±</strong></p>
<pre><code class="language-fsharp">// íŒŒì¼ë³„ ì •ì˜ ë§µ ì €ì¥
type DefinitionIndex = Map&lt;string, Span list&gt;
let buildIndex ast : DefinitionIndex = ...
</code></pre>
</li>
<li>
<p><strong>ìŠ¤ì½”í”„ íŠ¸ë¦¬ êµ¬ì¶•</strong></p>
<pre><code class="language-fsharp">// ê° ì •ì˜ì˜ ìœ íš¨ ë²”ìœ„ ì‚¬ì „ ê³„ì‚°
type ScopeTree = {
    Name: string
    Span: Span
    ValidRange: Range
    Children: ScopeTree list
}
</code></pre>
</li>
<li>
<p><strong>ì¦ë¶„ ì—…ë°ì´íŠ¸</strong></p>
<pre><code class="language-fsharp">// ë¬¸ì„œ ë³€ê²½ ì‹œ ì˜í–¥ë°›ëŠ” ìŠ¤ì½”í”„ë§Œ ì¬ê³„ì‚°
let updateReferences (edit: TextEdit) (oldIndex: DefinitionIndex) : DefinitionIndex
</code></pre>
</li>
</ol>
<p><strong>í˜„ì¬ êµ¬í˜„ì€ ë‹¨ìˆœì„± ìš°ì„ :</strong></p>
<ul>
<li>FunLang íŒŒì¼ì€ ì¼ë°˜ì ìœ¼ë¡œ ì‘ìŒ (&lt; 1000 lines)</li>
<li>ì„±ëŠ¥ ë¬¸ì œ ì—†ìŒ</li>
<li>ì½”ë“œ ì´í•´ì™€ ìœ ì§€ë³´ìˆ˜ ìš©ì´</li>
</ul>
<hr>
<h2 id="ì •ë¦¬-3"><a class="header" href="#ì •ë¦¬-3">ì •ë¦¬</a></h2>
<p>Find References êµ¬í˜„ì˜ í•µì‹¬:</p>
<ol>
<li>
<p><strong>ë ˆí¼ëŸ°ìŠ¤ ìˆ˜ì§‘</strong> - AST ìˆœíšŒë¡œ ëª¨ë“  Var ë…¸ë“œ ìˆ˜ì§‘</p>
<ul>
<li><code>collectReferences</code>: ì´ë¦„ ì¼ì¹˜ë§Œ ì²´í¬ (ê¸°ë³¸)</li>
</ul>
</li>
<li>
<p><strong>ì„€ë„ì‰ ì²˜ë¦¬</strong> - Definition ëª¨ë“ˆ ì¬ì‚¬ìš©</p>
<ul>
<li><code>collectReferencesForBinding</code>: íŠ¹ì • ì •ì˜ì˜ ë ˆí¼ëŸ°ìŠ¤ë§Œ í•„í„°ë§</li>
<li>ê° Varê°€ ì˜¬ë°”ë¥¸ ì •ì˜ë¥¼ ì°¸ì¡°í•˜ëŠ”ì§€ ê²€ì¦</li>
</ul>
</li>
<li>
<p><strong>includeDeclaration</strong> - ì»¨í…ìŠ¤íŠ¸ì— ë”°ë¼ ì •ì˜ í¬í•¨</p>
<ul>
<li>true: ì •ì˜ + ì‚¬ìš©ì²˜ ëª¨ë‘</li>
<li>false: ì‚¬ìš©ì²˜ë§Œ</li>
</ul>
</li>
<li>
<p><strong>Location[] ë°˜í™˜</strong> - ë°°ì—´ë¡œ ì—¬ëŸ¬ ìœ„ì¹˜ ì „ë‹¬</p>
<ul>
<li>ê° ìœ„ì¹˜ëŠ” URI + Range</li>
</ul>
</li>
<li>
<p><strong>Definitionê³¼ì˜ ê´€ê³„</strong> - ì—­ë°©í–¥ ê²€ìƒ‰</p>
<ul>
<li>Definition: ì‚¬ìš©ì²˜ â†’ ì •ì˜</li>
<li>References: ì •ì˜ â†’ ì‚¬ìš©ì²˜ë“¤</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ë‹¤ìŒ-ë‹¨ê³„-8"><a class="header" href="#ë‹¤ìŒ-ë‹¨ê³„-8">ë‹¤ìŒ ë‹¨ê³„</a></h2>
<p>Find Referencesë¥¼ ì™„ì„±í–ˆë‹¤! ì´ì œ ì‚¬ìš©ìê°€ ì‹¬ë³¼ì˜ ì˜í–¥ ë²”ìœ„ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆë‹¤.</p>
<p>ë‹¤ìŒ Phaseì—ì„œ êµ¬í˜„í•  ê¸°ëŠ¥ë“¤:</p>
<ul>
<li><strong>Rename</strong>: Find References í™œìš©í•˜ì—¬ ëª¨ë“  ì‚¬ìš©ì²˜ ì¼ê´„ ë³€ê²½</li>
<li><strong>Code Actions</strong>: ë¯¸ì‚¬ìš© ë³€ìˆ˜ ì œê±° ë“± ìë™ ìˆ˜ì • ì œì•ˆ</li>
<li><strong>Document Symbols</strong>: íŒŒì¼ ë‚´ ëª¨ë“  ì‹¬ë³¼ ëª©ë¡</li>
</ul>
<hr>
<h2 id="ì°¸ê³ -ìë£Œ-8"><a class="header" href="#ì°¸ê³ -ìë£Œ-8">ì°¸ê³  ìë£Œ</a></h2>
<ul>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocument_references">LSP Specification - textDocument/references</a></li>
<li><a href="https://code.visualstudio.com/docs/editor/editingevolved#_reference-information">Find All References in VS Code</a></li>
<li><a href="https://langserver.org/implementing-find-references/">Implementing Find References - LSP Guide</a></li>
<li><a href="https://github.com/kodu-ai/LangTutorial/blob/main/FunLang/Ast.fs">FunLang AST (Ast.fs)</a></li>
</ul>
<hr>
<p><strong>-&gt; ë‹¤ìŒ: Rename êµ¬í˜„</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rename-symbol-êµ¬í˜„í•˜ê¸°"><a class="header" href="#rename-symbol-êµ¬í˜„í•˜ê¸°">Rename Symbol êµ¬í˜„í•˜ê¸°</a></h1>
<p>ì´ ë¬¸ì„œëŠ” LSP ì„œë²„ì—ì„œ <strong>Rename Symbol</strong> ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•œë‹¤. ë³€ìˆ˜ë‚˜ í•¨ìˆ˜ ì´ë¦„ì„ ë³€ê²½í•˜ë©´ í•´ë‹¹ ì‹¬ë³¼ì˜ ì •ì˜ì™€ ëª¨ë“  ì‚¬ìš©ì²˜ê°€ ë™ì‹œì— ì—…ë°ì´íŠ¸ëœë‹¤. ì´ ê¸°ëŠ¥ì€ ë¦¬íŒ©í† ë§ì˜ í•µì‹¬ìœ¼ë¡œ, ì•ˆì „í•˜ê²Œ ì½”ë“œë² ì´ìŠ¤ ì „ì²´ì˜ ì‹ë³„ì ì´ë¦„ì„ ë³€ê²½í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.</p>
<h2 id="ëª©ì°¨-9"><a class="header" href="#ëª©ì°¨-9">ëª©ì°¨</a></h2>
<ol>
<li><a href="#rename-symbolì´ë€">Rename Symbolì´ë€</a></li>
<li><a href="#lsp-í”„ë¡œí† ì½œ-2">LSP í”„ë¡œí† ì½œ</a></li>
<li><a href="#workspaceedit-ì´í•´í•˜ê¸°">WorkspaceEdit ì´í•´í•˜ê¸°</a></li>
<li><a href="#preparerename-êµ¬í˜„">prepareRename êµ¬í˜„</a></li>
<li><a href="#ë ˆí¼ëŸ°ìŠ¤-ìˆ˜ì§‘ê³¼-ì´ë¦„-ë³€ê²½">ë ˆí¼ëŸ°ìŠ¤ ìˆ˜ì§‘ê³¼ ì´ë¦„ ë³€ê²½</a></li>
<li><a href="#ë°”ì¸ë”©-ì‚¬ì´íŠ¸-ì´ë¦„-ìŠ¤íŒ¬-ê³„ì‚°">ë°”ì¸ë”© ì‚¬ì´íŠ¸ ì´ë¦„ ìŠ¤íŒ¬ ê³„ì‚°</a></li>
<li><a href="#handlerename-êµ¬í˜„">handleRename êµ¬í˜„</a></li>
<li><a href="#protocolfs-í—¬í¼-í•¨ìˆ˜">Protocol.fs í—¬í¼ í•¨ìˆ˜</a></li>
<li><a href="#serverfs-í†µí•©-2">Server.fs í†µí•©</a></li>
<li><a href="#í…ŒìŠ¤íŠ¸-ì‘ì„±-6">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></li>
<li><a href="#ì£¼ì˜ì‚¬í•­ê³¼-ì—£ì§€-ì¼€ì´ìŠ¤">ì£¼ì˜ì‚¬í•­ê³¼ ì—£ì§€ ì¼€ì´ìŠ¤</a></li>
</ol>
<hr>
<h2 id="rename-symbolì´ë€"><a class="header" href="#rename-symbolì´ë€">Rename Symbolì´ë€</a></h2>
<p><strong>Rename Symbol</strong>ì€ ë³€ìˆ˜, í•¨ìˆ˜, íŒŒë¼ë¯¸í„°ì˜ ì´ë¦„ì„ ë³€ê²½í•  ë•Œ í•´ë‹¹ ì‹¬ë³¼ì˜ <strong>ì •ì˜ì™€ ëª¨ë“  ì‚¬ìš©ì²˜</strong>ë¥¼ ë™ì‹œì— ì—…ë°ì´íŠ¸í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤.</p>
<h3 id="vs-codeì—ì„œì˜-ì‚¬ìš©-2"><a class="header" href="#vs-codeì—ì„œì˜-ì‚¬ìš©-2">VS Codeì—ì„œì˜ ì‚¬ìš©</a></h3>
<pre><code>test.fun
â”€â”€â”€â”€â”€â”€â”€â”€
1 | let add = fun x -&gt; fun y -&gt; x + y in
2 | let result = add 1 2 in
3 | result
    ^^^^^^
    [F2] ë˜ëŠ” ìš°í´ë¦­ â†’ "Rename Symbol"
    â†’ ìƒˆ ì´ë¦„ ì…ë ¥: "finalValue"
    â†’ ëª¨ë“  "result" ì‚¬ìš©ì²˜ê°€ "finalValue"ë¡œ ë³€ê²½ë¨
</code></pre>
<p><strong>íŠ¸ë¦¬ê±° ë°©ë²•:</strong></p>
<ul>
<li><code>F2</code> í‚¤</li>
<li>ìš°í´ë¦­ â†’ â€œRename Symbolâ€</li>
<li>ëª…ë ¹ íŒ”ë ˆíŠ¸ â†’ â€œRename Symbolâ€</li>
</ul>
<h3 id="í•µì‹¬-ë™ì‘-2"><a class="header" href="#í•µì‹¬-ë™ì‘-2">í•µì‹¬ ë™ì‘</a></h3>
<ol>
<li>ì‚¬ìš©ìê°€ ì»¤ì„œë¥¼ ë³€ìˆ˜ ìœ„ì— ë†“ê³  F2 ì…ë ¥</li>
<li>í´ë¼ì´ì–¸íŠ¸ê°€ <code>textDocument/prepareRename</code> ìš”ì²­ (ì˜µì…”ë„)</li>
<li>ì„œë²„ê°€ rename ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸, ë²”ìœ„ì™€ í˜„ì¬ ì´ë¦„ ë°˜í™˜</li>
<li>ì‚¬ìš©ìê°€ ìƒˆ ì´ë¦„ ì…ë ¥</li>
<li>í´ë¼ì´ì–¸íŠ¸ê°€ <code>textDocument/rename</code> ìš”ì²­ ì „ì†¡</li>
<li>ì„œë²„ê°€ <code>WorkspaceEdit</code> ë°˜í™˜ (ëª¨ë“  ë³€ê²½ì‚¬í•­)</li>
<li>í´ë¼ì´ì–¸íŠ¸ê°€ íŒŒì¼ ì—…ë°ì´íŠ¸ ì ìš©</li>
</ol>
<pre class="mermaid">sequenceDiagram
    participant C as Client
    participant S as Server
    C-&gt;&gt;S: textDocument/prepareRename(uri, position)
    S-&gt;&gt;C: {range, placeholder}
    Note over C: ì‚¬ìš©ìì—ê²Œ ìƒˆ ì´ë¦„ ì…ë ¥ ìš”ì²­
    C-&gt;&gt;S: textDocument/rename(uri, position, newName)
    Note over S: ëª¨ë“  ì°¸ì¡° ìœ„ì¹˜ ìˆ˜ì§‘ â†’ TextEdit ìƒì„±
    S-&gt;&gt;C: WorkspaceEdit(changes: {uri: TextEdit[]})
    Note over C: ëª¨ë“  ìœ„ì¹˜ ì¼ê´„ ë³€ê²½
</pre>

<hr>
<h2 id="lsp-í”„ë¡œí† ì½œ-2"><a class="header" href="#lsp-í”„ë¡œí† ì½œ-2">LSP í”„ë¡œí† ì½œ</a></h2>
<p>Renameì€ <strong>ë‘ ë‹¨ê³„</strong>ë¡œ êµ¬ì„±ëœë‹¤:</p>
<h3 id="1-textdocumentpreparerename-ì˜µì…”ë„"><a class="header" href="#1-textdocumentpreparerename-ì˜µì…”ë„">1. textDocument/prepareRename (ì˜µì…”ë„)</a></h3>
<p>Rename ì „ì— ê²€ì¦ ë‹¨ê³„ì´ë‹¤. ì´ ìš”ì²­ìœ¼ë¡œ ë‹¤ìŒì„ í™•ì¸í•œë‹¤:</p>
<ul>
<li>ì»¤ì„œ ìœ„ì¹˜ê°€ rename ê°€ëŠ¥í•œ ì‹¬ë³¼ì¸ê°€?</li>
<li>Renameí•  ë²”ìœ„ì™€ í˜„ì¬ ì´ë¦„ì€?</li>
</ul>
<pre><code class="language-typescript">interface TextDocumentPositionParams {
    textDocument: TextDocumentIdentifier  // { uri: "file:///test.fun" }
    position: Position                     // { line: 1, character: 13 }
}
</code></pre>
<p><strong>ìš”ì²­ ì˜ˆì‹œ:</strong></p>
<pre><code class="language-json">{
    "jsonrpc": "2.0",
    "id": 7,
    "method": "textDocument/prepareRename",
    "params": {
        "textDocument": { "uri": "file:///test.fun" },
        "position": { "line": 1, "character": 13 }
    }
}
</code></pre>
<p><strong>ì‘ë‹µ í˜•ì‹:</strong></p>
<p>PrepareRenameResultëŠ” ì„¸ ê°€ì§€ í˜•íƒœë¥¼ ì§€ì›í•œë‹¤:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>í˜•ì‹</th><th>ì‚¬ìš© ì‹œê¸°</th><th>êµ¬ì¡°</th></tr>
</thead>
<tbody>
<tr><td><code>Range</code></td><td>ê°„ë‹¨í•œ ë²”ìœ„ë§Œ ë°˜í™˜</td><td><code>{ start, end }</code></td></tr>
<tr><td><code>RangeWithPlaceholder</code></td><td>ë²”ìœ„ + í˜„ì¬ ì´ë¦„</td><td><code>{ range, placeholder }</code></td></tr>
<tr><td><code>DefaultBehavior</code></td><td>ë²”ìœ„ + ì´ë¦„ + ê°€ì´ë“œ</td><td><code>{ defaultBehavior: true }</code></td></tr>
</tbody>
</table>
</div>
<p>FunLangì€ <strong>RangeWithPlaceholder</strong>ë¥¼ ì‚¬ìš©í•œë‹¤ (ê°€ì¥ ì¼ë°˜ì ).</p>
<p><strong>ì‘ë‹µ ì˜ˆì‹œ:</strong></p>
<pre><code class="language-json">{
    "jsonrpc": "2.0",
    "id": 7,
    "result": {
        "range": {
            "start": { "line": 1, "character": 4 },
            "end": { "line": 1, "character": 10 }
        },
        "placeholder": "result"
    }
}
</code></pre>
<p><strong>ì—ëŸ¬ ì‘ë‹µ (rename ë¶ˆê°€):</strong></p>
<pre><code class="language-json">{
    "jsonrpc": "2.0",
    "id": 7,
    "error": {
        "code": -32600,
        "message": "Cannot rename this symbol"
    }
}
</code></pre>
<h3 id="2-textdocumentrename-í•„ìˆ˜"><a class="header" href="#2-textdocumentrename-í•„ìˆ˜">2. textDocument/rename (í•„ìˆ˜)</a></h3>
<p>ì‹¤ì œ rename ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.</p>
<pre><code class="language-typescript">interface RenameParams {
    textDocument: TextDocumentIdentifier
    position: Position
    newName: string  // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ìƒˆ ì´ë¦„
}
</code></pre>
<p><strong>ìš”ì²­ ì˜ˆì‹œ:</strong></p>
<pre><code class="language-json">{
    "jsonrpc": "2.0",
    "id": 8,
    "method": "textDocument/rename",
    "params": {
        "textDocument": { "uri": "file:///test.fun" },
        "position": { "line": 1, "character": 13 },
        "newName": "finalValue"
    }
}
</code></pre>
<p><strong>ì‘ë‹µ: WorkspaceEdit</strong></p>
<pre><code class="language-typescript">interface WorkspaceEdit {
    changes?: { [uri: string]: TextEdit[] }  // íŒŒì¼ë³„ í¸ì§‘ ëª©ë¡
    documentChanges?: (TextDocumentEdit | CreateFile | RenameFile | DeleteFile)[]
    changeAnnotations?: { [id: string]: ChangeAnnotation }
}

interface TextEdit {
    range: Range      // êµì²´í•  ë²”ìœ„
    newText: string   // ìƒˆ í…ìŠ¤íŠ¸
}
</code></pre>
<p><strong>ì‘ë‹µ ì˜ˆì‹œ:</strong></p>
<pre><code class="language-json">{
    "jsonrpc": "2.0",
    "id": 8,
    "result": {
        "changes": {
            "file:///test.fun": [
                {
                    "range": {
                        "start": { "line": 1, "character": 4 },
                        "end": { "line": 1, "character": 10 }
                    },
                    "newText": "finalValue"
                },
                {
                    "range": {
                        "start": { "line": 2, "character": 0 },
                        "end": { "line": 2, "character": 6 }
                    },
                    "newText": "finalValue"
                }
            ]
        }
    }
}
</code></pre>
<hr>
<h2 id="workspaceedit-ì´í•´í•˜ê¸°"><a class="header" href="#workspaceedit-ì´í•´í•˜ê¸°">WorkspaceEdit ì´í•´í•˜ê¸°</a></h2>
<p><code>WorkspaceEdit</code>ëŠ” í•˜ë‚˜ ì´ìƒì˜ íŒŒì¼ì— ì ìš©í•  <strong>í¸ì§‘ ì‘ì—…ë“¤ì˜ ì§‘í•©</strong>ì´ë‹¤.</p>
<h3 id="êµ¬ì¡°"><a class="header" href="#êµ¬ì¡°">êµ¬ì¡°</a></h3>
<pre><code class="language-fsharp">type WorkspaceEdit = {
    Changes: Map&lt;string, TextEdit[]&gt; option       // ê°„ë‹¨í•œ í˜•íƒœ: URI â†’ í¸ì§‘ ë°°ì—´
    DocumentChanges: DocumentChange[] option       // ê³ ê¸‰ í˜•íƒœ: ìˆœì„œ ë³´ì¥, íŒŒì¼ ìƒì„±/ì‚­ì œ í¬í•¨
    ChangeAnnotations: Map&lt;string, ChangeAnnotation&gt; option  // ë³€ê²½ ì„¤ëª… ë©”íƒ€ë°ì´í„°
}
</code></pre>
<p><strong>FunLangì€ <code>Changes</code>ë§Œ ì‚¬ìš©í•œë‹¤:</strong></p>
<ul>
<li>ì‹±ê¸€ íŒŒì¼ ì–¸ì–´ (ëª¨ë“ˆ ì‹œìŠ¤í…œ ì—†ìŒ)</li>
<li>í…ìŠ¤íŠ¸ í¸ì§‘ë§Œ í•„ìš” (íŒŒì¼ ìƒì„±/ì‚­ì œ ë¶ˆí•„ìš”)</li>
<li>ê°„ë‹¨í•˜ê³  ì¶©ë¶„í•¨</li>
</ul>
<h3 id="textedit-êµ¬ì¡°"><a class="header" href="#textedit-êµ¬ì¡°">TextEdit êµ¬ì¡°</a></h3>
<p>ê° TextEditëŠ” <strong>ë²”ìœ„ + ìƒˆ í…ìŠ¤íŠ¸</strong>ì´ë‹¤:</p>
<pre><code class="language-fsharp">type TextEdit = {
    Range: Range      // êµì²´í•  ì†ŒìŠ¤ ìœ„ì¹˜
    NewText: string   // ìƒˆ í…ìŠ¤íŠ¸ (renameì˜ ê²½ìš° ìƒˆ ì´ë¦„)
}
</code></pre>
<h3 id="ì˜ˆì‹œ-3ê°œ-ìœ„ì¹˜-rename"><a class="header" href="#ì˜ˆì‹œ-3ê°œ-ìœ„ì¹˜-rename">ì˜ˆì‹œ: 3ê°œ ìœ„ì¹˜ rename</a></h3>
<pre><code class="language-funlang">let x = 1 in x + x
</code></pre>
<p><code>x</code>ë¥¼ <code>y</code>ë¡œ renameí•˜ë©´:</p>
<pre><code class="language-fsharp">let edits = [|
    { Range = (0:4)-(0:5); NewText = "y" }  // ì •ì˜
    { Range = (0:13)-(0:14); NewText = "y" }  // ì²« ë²ˆì§¸ ì‚¬ìš©
    { Range = (0:17)-(0:18); NewText = "y" }  // ë‘ ë²ˆì§¸ ì‚¬ìš©
|]

let workspaceEdit = {
    Changes = Some (Map.ofList [ ("file:///test.fun", edits) ])
    DocumentChanges = None
    ChangeAnnotations = None
}
</code></pre>
<p>VS CodeëŠ” ì´ <code>WorkspaceEdit</code>ë¥¼ ë°›ì•„ì„œ:</p>
<ol>
<li>ê° <code>TextEdit</code>ì˜ <code>Range</code> ìœ„ì¹˜ì˜ í…ìŠ¤íŠ¸ë¥¼ ì°¾ìŒ</li>
<li>í•´ë‹¹ ë²”ìœ„ë¥¼ <code>NewText</code>ë¡œ êµì²´</li>
<li>íŒŒì¼ ì €ì¥ ë˜ëŠ” ë³€ê²½ì‚¬í•­ í‘œì‹œ</li>
</ol>
<hr>
<h2 id="preparerename-êµ¬í˜„"><a class="header" href="#preparerename-êµ¬í˜„">prepareRename êµ¬í˜„</a></h2>
<p><code>prepareRename</code>ì€ rename ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ê²€ì¦í•˜ê³ , ì •í™•í•œ ë²”ìœ„ë¥¼ ë°˜í™˜í•œë‹¤.</p>
<h3 id="ì™œ-í•„ìš”í•œê°€-1"><a class="header" href="#ì™œ-í•„ìš”í•œê°€-1">ì™œ í•„ìš”í•œê°€?</a></h3>
<ol>
<li><strong>ì¡°ê¸° ì‹¤íŒ¨</strong>: ì‚¬ìš©ìê°€ ì´ë¦„ì„ ì…ë ¥í•˜ê¸° ì „ì— ë¶ˆê°€ëŠ¥í•œ ê²½ìš° ì•Œë¦¼</li>
<li><strong>ì •í™•í•œ ë²”ìœ„</strong>: ì „ì²´ í‘œí˜„ì‹ spanì´ ì•„ë‹Œ <strong>ì´ë¦„ë§Œ</strong>ì˜ ì •í™•í•œ ìœ„ì¹˜</li>
<li><strong>í˜„ì¬ ì´ë¦„ ì œê³µ</strong>: VS Codeê°€ ì…ë ¥ì°½ì— ë¯¸ë¦¬ ì±„ì›Œì¤Œ</li>
</ol>
<h3 id="rename-ê°€ëŠ¥í•œ-ì‹¬ë³¼"><a class="header" href="#rename-ê°€ëŠ¥í•œ-ì‹¬ë³¼">Rename ê°€ëŠ¥í•œ ì‹¬ë³¼</a></h3>
<p>FunLangì—ì„œ rename ê°€ëŠ¥í•œ ê²ƒ:</p>
<ul>
<li><code>Var</code> - ë³€ìˆ˜ ì°¸ì¡°</li>
<li><code>Let</code> - let ë°”ì¸ë”©</li>
<li><code>LetRec</code> - ì¬ê·€ í•¨ìˆ˜ ë°”ì¸ë”©</li>
<li><code>Lambda</code> - ëŒë‹¤ íŒŒë¼ë¯¸í„°</li>
<li><code>LambdaAnnot</code> - íƒ€ì… ì£¼ì„ ëŒë‹¤ íŒŒë¼ë¯¸í„°</li>
</ul>
<p>Rename <strong>ë¶ˆê°€ëŠ¥</strong>í•œ ê²ƒ:</p>
<ul>
<li>ìˆ«ì, ë¬¸ìì—´, ë¶ˆë¦¬ì–¸ ë¦¬í„°ëŸ´</li>
<li>í‚¤ì›Œë“œ (<code>let</code>, <code>in</code>, <code>if</code> ë“±)</li>
<li>ì—°ì‚°ì (<code>+</code>, <code>-</code>, <code>*</code> ë“±)</li>
</ul>
<h3 id="findnameinsource-í—¬í¼-í•¨ìˆ˜"><a class="header" href="#findnameinsource-í—¬í¼-í•¨ìˆ˜">findNameInSource í—¬í¼ í•¨ìˆ˜</a></h3>
<p>Let/LetRec/Lambdaì˜ spanì€ <strong>ì „ì²´ í‘œí˜„ì‹</strong>ì„ ì»¤ë²„í•œë‹¤:</p>
<pre><code class="language-funlang">let result = 42 in result
^^^^^^^^^^^^^^
ì „ì²´ Let í‘œí˜„ì‹ span (0:0)-(0:15)

    ^^^^^^
    ì´ë¦„ë§Œì˜ spanì´ í•„ìš”: (0:4)-(0:10)
</code></pre>
<p><code>findNameInSource</code>ëŠ” ì†ŒìŠ¤ í…ìŠ¤íŠ¸ì—ì„œ ì •í™•í•œ ì´ë¦„ ìœ„ì¹˜ë¥¼ ì°¾ëŠ”ë‹¤:</p>
<pre><code class="language-fsharp">// Rename.fs
/// Find the exact character range of an identifier name within source text
/// Given a definition span (which may cover whole expression), find just the name
/// Searches first ~15 chars after startCol for the identifier
let findNameInSource (text: string) (name: string) (startLine: int) (startCol: int) : Span option =
    let lines = text.Split('\n')
    if startLine &lt; lines.Length then
        let line = lines.[startLine]
        let searchEnd = min (startCol + 15) line.Length
        let searchArea = line.Substring(startCol, searchEnd - startCol)
        let idx = searchArea.IndexOf(name)
        if idx &gt;= 0 then
            let nameStart = startCol + idx
            Some {
                FileName = ""
                StartLine = startLine
                StartColumn = nameStart
                EndLine = startLine
                EndColumn = nameStart + name.Length - 1
            }
        else None
    else None
</code></pre>
<p><strong>ë™ì‘:</strong></p>
<ol>
<li>í•´ë‹¹ ë¼ì¸ ì¶”ì¶œ</li>
<li>startColë¶€í„° ~15ì ë²”ìœ„ ê²€ìƒ‰ (í‚¤ì›Œë“œ <code>let </code>, <code>fun </code> ë“± ê±´ë„ˆë›°ê¸°)</li>
<li>ì´ë¦„ ë¬¸ìì—´ ìœ„ì¹˜ ì°¾ê¸°</li>
<li>ì •í™•í•œ span ë°˜í™˜</li>
</ol>
<p><strong>ì˜ˆì‹œ:</strong></p>
<pre><code class="language-funlang">let result = 42
</code></pre>
<ul>
<li>ì…ë ¥: <code>name="result"</code>, <code>startLine=0</code>, <code>startCol=0</code></li>
<li><code>searchArea = "let result = 42"</code> (ìµœëŒ€ 15ì)</li>
<li><code>idx = searchArea.IndexOf("result") = 4</code></li>
<li><code>nameStart = 0 + 4 = 4</code></li>
<li>ë°˜í™˜: <code>Span(0, 4, 0, 10)</code> - â€œresultâ€œì˜ ì •í™•í•œ ìœ„ì¹˜</li>
</ul>
<h3 id="handlepreparerename-êµ¬í˜„"><a class="header" href="#handlepreparerename-êµ¬í˜„">handlePrepareRename êµ¬í˜„</a></h3>
<pre><code class="language-fsharp">// Rename.fs
open Ionide.LanguageServerProtocol.Types
open LangLSP.Server.AstLookup
open LangLSP.Server.DocumentSync
open LangLSP.Server.Protocol
open Ast

/// Handle textDocument/prepareRename request
/// Validates that cursor is on a renameable symbol and returns range + placeholder
let handlePrepareRename (p: TextDocumentPositionParams) : Async&lt;PrepareRenameResult option&gt; =
    async {
        match getDocument p.TextDocument.Uri with
        | None -&gt; return None
        | Some text -&gt;
            try
                let lexbuf = FSharp.Text.Lexing.LexBuffer&lt;char&gt;.FromString(text)
                let ast = Parser.start Lexer.tokenize lexbuf

                match findNodeAtPosition p.Position ast with
                | None -&gt; return None
                | Some node -&gt;
                    let result =
                        match node with
                        | Var(name, span) -&gt;
                            // Variable reference - renameable
                            Some (U3.C2 { Range = spanToLspRange span; Placeholder = name })

                        | Let(name, _, _, span) -&gt;
                            // Let binding - find tight range for name
                            match findNameInSource text name span.StartLine span.StartColumn with
                            | Some nameSpan -&gt;
                                Some (U3.C2 { Range = spanToLspRange nameSpan; Placeholder = name })
                            | None -&gt;
                                // Fallback to start position
                                let fallbackRange = {
                                    Start = { Line = uint32 span.StartLine; Character = uint32 span.StartColumn }
                                    End = { Line = uint32 span.StartLine; Character = uint32 (span.StartColumn + name.Length) }
                                }
                                Some (U3.C2 { Range = fallbackRange; Placeholder = name })

                        | LetRec(name, _, _, _, span) -&gt;
                            // Recursive function - find tight range
                            match findNameInSource text name span.StartLine span.StartColumn with
                            | Some nameSpan -&gt;
                                Some (U3.C2 { Range = spanToLspRange nameSpan; Placeholder = name })
                            | None -&gt;
                                let fallbackRange = {
                                    Start = { Line = uint32 span.StartLine; Character = uint32 span.StartColumn }
                                    End = { Line = uint32 span.StartLine; Character = uint32 (span.StartColumn + name.Length) }
                                }
                                Some (U3.C2 { Range = fallbackRange; Placeholder = name })

                        | Lambda(param, _, span) -&gt;
                            // Lambda parameter - find tight range
                            match findNameInSource text param span.StartLine span.StartColumn with
                            | Some nameSpan -&gt;
                                Some (U3.C2 { Range = spanToLspRange nameSpan; Placeholder = param })
                            | None -&gt;
                                let fallbackRange = {
                                    Start = { Line = uint32 span.StartLine; Character = uint32 span.StartColumn }
                                    End = { Line = uint32 span.StartLine; Character = uint32 (span.StartColumn + param.Length) }
                                }
                                Some (U3.C2 { Range = fallbackRange; Placeholder = param })

                        | LambdaAnnot(param, _, _, span) -&gt;
                            // Annotated lambda parameter - find tight range
                            match findNameInSource text param span.StartLine span.StartColumn with
                            | Some nameSpan -&gt;
                                Some (U3.C2 { Range = spanToLspRange nameSpan; Placeholder = param })
                            | None -&gt;
                                let fallbackRange = {
                                    Start = { Line = uint32 span.StartLine; Character = uint32 span.StartColumn }
                                    End = { Line = uint32 span.StartLine; Character = uint32 (span.StartColumn + param.Length) }
                                }
                                Some (U3.C2 { Range = fallbackRange; Placeholder = param })

                        | _ -&gt;
                            // Not a renameable symbol (numbers, keywords, operators)
                            None

                    return result

            with _ -&gt;
                return None
    }
</code></pre>
<p><strong>ë™ì‘ íë¦„:</strong></p>
<pre><code>TextDocumentPositionParams ìˆ˜ì‹ 
    â†“
ë¬¸ì„œ í…ìŠ¤íŠ¸ ì¡°íšŒ
    â†“
AST íŒŒì‹±
    â†“
findNodeAtPositionìœ¼ë¡œ ë…¸ë“œ ì°¾ê¸°
    â†“
    â”œâ”€ Var â†’ span ê·¸ëŒ€ë¡œ ì‚¬ìš© (ì´ë¯¸ ì •í™•í•¨)
    â”œâ”€ Let/LetRec/Lambda â†’ findNameInSourceë¡œ ì´ë¦„ë§Œ span ì¶”ì¶œ
    â””â”€ ê¸°íƒ€ â†’ None (rename ë¶ˆê°€)
    â†“
RangeWithPlaceholder ë°˜í™˜ (U3.C2)
</code></pre>
<p><strong>í•µì‹¬ í¬ì¸íŠ¸:</strong></p>
<ol>
<li><code>Var</code> ë…¸ë“œëŠ” ì´ë¯¸ ì •í™•í•œ ë²”ìœ„ë¥¼ ê°€ì§ â†’ ê·¸ëŒ€ë¡œ ì‚¬ìš©</li>
<li><code>Let</code>/<code>LetRec</code>/<code>Lambda</code>ëŠ” ì „ì²´ í‘œí˜„ì‹ span â†’ <code>findNameInSource</code>ë¡œ ì´ë¦„ë§Œ ì¶”ì¶œ</li>
<li>ëª¨ë“  ê²½ìš° fallback ì œê³µ (findNameInSource ì‹¤íŒ¨ ì‹œ)</li>
<li><code>U3.C2</code>ëŠ” Ionideì˜ union type (RangeWithPlaceholder)</li>
</ol>
<hr>
<h2 id="ë ˆí¼ëŸ°ìŠ¤-ìˆ˜ì§‘ê³¼-ì´ë¦„-ë³€ê²½"><a class="header" href="#ë ˆí¼ëŸ°ìŠ¤-ìˆ˜ì§‘ê³¼-ì´ë¦„-ë³€ê²½">ë ˆí¼ëŸ°ìŠ¤ ìˆ˜ì§‘ê³¼ ì´ë¦„ ë³€ê²½</a></h2>
<p>Renameì€ <strong>ì •ì˜ + ëª¨ë“  ë ˆí¼ëŸ°ìŠ¤</strong>ë¥¼ ë™ì‹œì— ë³€ê²½í•´ì•¼ í•œë‹¤.</p>
<h3 id="collectreferencesforbinding-ì„€ë„ì‰-ì¸ì‹"><a class="header" href="#collectreferencesforbinding-ì„€ë„ì‰-ì¸ì‹">collectReferencesForBinding (ì„€ë„ì‰ ì¸ì‹)</a></h3>
<p>ë‹¨ìˆœíˆ ì´ë¦„ì´ ê°™ì€ ëª¨ë“  <code>Var</code> ë…¸ë“œë¥¼ ì°¾ìœ¼ë©´ ì•ˆ ëœë‹¤:</p>
<pre><code class="language-funlang">let x = 1 in
  let x = 2 in
    x + 1
</code></pre>
<p>ë§ˆì§€ë§‰ <code>x</code>ëŠ” **ë‚´ë¶€ <code>let x = 2</code>**ë¥¼ ì°¸ì¡°í•œë‹¤. ì™¸ë¶€ <code>x</code>ë¥¼ renameí•˜ë©´ ë‚´ë¶€ <code>x</code>ëŠ” ë³€ê²½ë˜ë©´ ì•ˆ ëœë‹¤.</p>
<p><code>collectReferencesForBinding</code>ì€ <strong>íŠ¹ì • ì •ì˜ì— ì†í•˜ëŠ”</strong> ë ˆí¼ëŸ°ìŠ¤ë§Œ ìˆ˜ì§‘í•œë‹¤:</p>
<pre><code class="language-fsharp">// References.fs (ì´ì „ íŠœí† ë¦¬ì–¼ì—ì„œ êµ¬í˜„)
/// Collect references to a SPECIFIC binding (shadowing-aware)
/// Only returns Var nodes that resolve to the definition at defSpan
let collectReferencesForBinding (varName: string) (defSpan: Span) (ast: Expr) : Span list =
    // Find all Var nodes with matching name
    let allRefs = collectReferences varName ast

    // Filter to only those that resolve to our specific definition
    allRefs
    |&gt; List.filter (fun refSpan -&gt;
        // Create Position from the reference span
        let pos : Position = {
            Line = uint32 refSpan.StartLine
            Character = uint32 refSpan.StartColumn
        }
        // Check if this reference resolves to our target definition
        match findDefinitionForVar varName ast pos with
        | Some foundDefSpan -&gt;
            foundDefSpan.StartLine = defSpan.StartLine &amp;&amp;
            foundDefSpan.StartColumn = defSpan.StartColumn
        | None -&gt; false
    )
</code></pre>
<p><strong>ì•Œê³ ë¦¬ì¦˜:</strong></p>
<ol>
<li><code>collectReferences</code>ë¡œ ì´ë¦„ì´ ê°™ì€ ëª¨ë“  <code>Var</code> ë…¸ë“œ ì°¾ê¸°</li>
<li>ê° <code>Var</code>ì— ëŒ€í•´ <code>findDefinitionForVar</code> í˜¸ì¶œ</li>
<li>ë°˜í™˜ëœ ì •ì˜ spanì´ ìš°ë¦¬ì˜ íƒ€ê²Ÿ <code>defSpan</code>ê³¼ ì¼ì¹˜í•˜ëŠ” ê²ƒë§Œ í•„í„°ë§</li>
<li>ì„€ë„ì‰ìœ¼ë¡œ ì¸í•œ ë‹¤ë¥¸ ì •ì˜ì˜ ë ˆí¼ëŸ°ìŠ¤ëŠ” ì œì™¸ë¨</li>
</ol>
<h3 id="ì˜ˆì‹œ-2"><a class="header" href="#ì˜ˆì‹œ-2">ì˜ˆì‹œ</a></h3>
<pre><code class="language-funlang">let x = 1 in        (* defSpan1: (0, 4) *)
  let x = 2 in      (* defSpan2: (1, 6) *)
    x + x           (* ë‘ x ëª¨ë‘ defSpan2 ì°¸ì¡° *)
</code></pre>
<p><code>defSpan1</code>ì—ì„œ rename ìš”ì²­ ì‹œ:</p>
<ol>
<li><code>collectReferences "x"</code> â†’ 4ê°œ Var ë…¸ë“œ (ì •ì˜ 2ê°œëŠ” ì œì™¸, ì‚¬ìš© 2ê°œë§Œ)</li>
<li>ì‚¬ìš©ì²˜ 2ê°œì— ëŒ€í•´ <code>findDefinitionForVar</code>:
<ul>
<li>(2, 4)ì˜ x â†’ defSpan2 ë°˜í™˜ â†’ í•„í„°ë§ë¨</li>
<li>(2, 8)ì˜ x â†’ defSpan2 ë°˜í™˜ â†’ í•„í„°ë§ë¨</li>
</ul>
</li>
<li>ê²°ê³¼: ë¹ˆ ë°°ì—´ (ì™¸ë¶€ xëŠ” ì‚¬ìš©ë˜ì§€ ì•ŠìŒ)</li>
</ol>
<hr>
<h2 id="ë°”ì¸ë”©-ì‚¬ì´íŠ¸-ì´ë¦„-ìŠ¤íŒ¬-ê³„ì‚°"><a class="header" href="#ë°”ì¸ë”©-ì‚¬ì´íŠ¸-ì´ë¦„-ìŠ¤íŒ¬-ê³„ì‚°">ë°”ì¸ë”© ì‚¬ì´íŠ¸ ì´ë¦„ ìŠ¤íŒ¬ ê³„ì‚°</a></h2>
<p>ë ˆí¼ëŸ°ìŠ¤ëŠ” <code>Var</code> ë…¸ë“œì´ë¯€ë¡œ ì •í™•í•œ spanì„ ê°€ì§€ì§€ë§Œ, <strong>ì •ì˜ ì‚¬ì´íŠ¸</strong>ëŠ” ì „ì²´ í‘œí˜„ì‹ spanì„ ê°€ì§„ë‹¤.</p>
<p>Renameì˜ TextEditëŠ” <strong>ì´ë¦„ë§Œ</strong> êµì²´í•´ì•¼ í•˜ë¯€ë¡œ, ì •ì˜ ì‚¬ì´íŠ¸ì—ë„ <code>findNameInSource</code>ë¥¼ ì‚¬ìš©í•œë‹¤:</p>
<pre><code class="language-fsharp">// For definition site, get tight name-only span from source
let defNameSpan =
    match findNameInSource text varName defSpan.StartLine defSpan.StartColumn with
    | Some nameSpan -&gt; nameSpan
    | None -&gt;
        // Fallback: create span from definition position
        {
            FileName = ""
            StartLine = defSpan.StartLine
            StartColumn = defSpan.StartColumn
            EndLine = defSpan.StartLine
            EndColumn = defSpan.StartColumn + varName.Length - 1
        }
</code></pre>
<p><strong>ì˜ˆì‹œ:</strong></p>
<pre><code class="language-funlang">let result = 42 in result
</code></pre>
<ul>
<li><code>defSpan = (0, 0)-(0, 15)</code> (ì „ì²´ Let í‘œí˜„ì‹)</li>
<li><code>findNameInSource text "result" 0 0</code> â†’ <code>(0, 4)-(0, 10)</code></li>
<li><code>defNameSpan = (0, 4)-(0, 10)</code> â† ì´ê²ƒë§Œ TextEditì— í¬í•¨</li>
</ul>
<hr>
<h2 id="handlerename-êµ¬í˜„"><a class="header" href="#handlerename-êµ¬í˜„">handleRename êµ¬í˜„</a></h2>
<p>ì‹¤ì œ rename ë¡œì§ì´ë‹¤.</p>
<pre><code class="language-fsharp">// Rename.fs
/// Handle textDocument/rename request
/// Collects all references + definition and returns WorkspaceEdit
let handleRename (p: RenameParams) : Async&lt;WorkspaceEdit option&gt; =
    async {
        match getDocument p.TextDocument.Uri with
        | None -&gt; return None
        | Some text -&gt;
            try
                let lexbuf = FSharp.Text.Lexing.LexBuffer&lt;char&gt;.FromString(text)
                let ast = Parser.start Lexer.tokenize lexbuf

                match findNodeAtPosition p.Position ast with
                | None -&gt; return None
                | Some node -&gt;
                    // Determine variable name and definition span
                    let varNameOpt, defSpanOpt =
                        match node with
                        | Var(name, _) -&gt;
                            // Variable reference - find its definition
                            let def = findDefinitionForVar name ast p.Position
                            (Some name, def)

                        | Let(name, _, _, span) -&gt;
                            // Let binding site
                            (Some name, Some span)

                        | LetRec(name, _, _, _, span) -&gt;
                            // Recursive function binding
                            (Some name, Some span)

                        | Lambda(param, _, span) -&gt;
                            // Lambda parameter
                            (Some param, Some span)

                        | LambdaAnnot(param, _, _, span) -&gt;
                            // Annotated lambda parameter
                            (Some param, Some span)

                        | _ -&gt;
                            // Not a renameable symbol
                            (None, None)

                    match varNameOpt, defSpanOpt with
                    | Some varName, Some defSpan -&gt;
                        // Collect all scoped references
                        let references = collectReferencesForBinding varName defSpan ast

                        // For definition site, get tight name-only span from source
                        let defNameSpan =
                            match findNameInSource text varName defSpan.StartLine defSpan.StartColumn with
                            | Some nameSpan -&gt; nameSpan
                            | None -&gt;
                                // Fallback: create span from definition position
                                {
                                    FileName = ""
                                    StartLine = defSpan.StartLine
                                    StartColumn = defSpan.StartColumn
                                    EndLine = defSpan.StartLine
                                    EndColumn = defSpan.StartColumn + varName.Length - 1
                                }

                        // Combine definition name span + references
                        let allSpans = defNameSpan :: references

                        // Remove duplicates (may have overlapping spans)
                        let distinctSpans =
                            allSpans
                            |&gt; List.distinctBy (fun span -&gt;
                                (span.StartLine, span.StartColumn, span.EndLine, span.EndColumn))

                        // Create TextEdit for each span
                        let edits =
                            distinctSpans
                            |&gt; List.map (fun span -&gt; createTextEdit span p.NewName)
                            |&gt; Array.ofList

                        // Create WorkspaceEdit
                        let workspaceEdit = createWorkspaceEdit p.TextDocument.Uri edits

                        return Some workspaceEdit

                    | _ -&gt;
                        return None

            with _ -&gt;
                return None
    }
</code></pre>
<p><strong>ë™ì‘ íë¦„:</strong></p>
<pre><code>RenameParams ìˆ˜ì‹  (position + newName)
    â†“
ë¬¸ì„œ í…ìŠ¤íŠ¸ ì¡°íšŒ + AST íŒŒì‹±
    â†“
findNodeAtPositionìœ¼ë¡œ ì»¤ì„œ ìœ„ì¹˜ ë…¸ë“œ ì°¾ê¸°
    â†“
ë…¸ë“œ íƒ€ì…ë³„ ì²˜ë¦¬:
    â”œâ”€ Var â†’ findDefinitionForVarë¡œ ì •ì˜ ì°¾ê¸°
    â”œâ”€ Let/LetRec/Lambda â†’ spanì´ ê³§ ì •ì˜
    â””â”€ ê¸°íƒ€ â†’ None
    â†“
collectReferencesForBindingìœ¼ë¡œ ì„€ë„ì‰ ì¸ì‹ ë ˆí¼ëŸ°ìŠ¤ ìˆ˜ì§‘
    â†“
findNameInSourceë¡œ ì •ì˜ ì‚¬ì´íŠ¸ ì´ë¦„ë§Œ span ì¶”ì¶œ
    â†“
ì •ì˜ + ë ˆí¼ëŸ°ìŠ¤ span ê²°í•©
    â†“
distinctByë¡œ ì¤‘ë³µ ì œê±°
    â†“
ê° span â†’ TextEdit (range + newName)
    â†“
WorkspaceEdit ìƒì„± (URI â†’ TextEdit[])
    â†“
ë°˜í™˜
</code></pre>
<p><strong>í•µì‹¬ í¬ì¸íŠ¸:</strong></p>
<ol>
<li><strong>Var ë…¸ë“œì—ì„œ ì‹œì‘í•´ë„ ë™ì‘</strong>: <code>findDefinitionForVar</code>ë¡œ ì •ì˜ë¥¼ ë¨¼ì € ì°¾ìŒ</li>
<li><strong>ì„€ë„ì‰ ì²˜ë¦¬</strong>: <code>collectReferencesForBinding</code> ì‚¬ìš©</li>
<li><strong>ì •í™•í•œ ë²”ìœ„</strong>: <code>findNameInSource</code>ë¡œ ì´ë¦„ë§Œ êµì²´</li>
<li><strong>ì¤‘ë³µ ì œê±°</strong>: <code>distinctBy</code>ë¡œ ë™ì¼í•œ span ì œê±° (AST êµ¬ì¡°ìƒ ë°œìƒ ê°€ëŠ¥)</li>
</ol>
<hr>
<h2 id="protocolfs-í—¬í¼-í•¨ìˆ˜"><a class="header" href="#protocolfs-í—¬í¼-í•¨ìˆ˜">Protocol.fs í—¬í¼ í•¨ìˆ˜</a></h2>
<p><code>createTextEdit</code>ì™€ <code>createWorkspaceEdit</code>ëŠ” ë°˜ë³µ ì½”ë“œë¥¼ ì¤„ì´ê¸° ìœ„í•œ í—¬í¼ì´ë‹¤.</p>
<h3 id="createtextedit"><a class="header" href="#createtextedit">createTextEdit</a></h3>
<p>Spanê³¼ ìƒˆ í…ìŠ¤íŠ¸ë¡œ TextEdit ìƒì„±:</p>
<pre><code class="language-fsharp">// Protocol.fs
/// Create TextEdit from span and new text
let createTextEdit (span: Span) (newText: string) : TextEdit =
    {
        Range = spanToLspRange span
        NewText = newText
    }
</code></pre>
<p><strong>ì‚¬ìš©:</strong></p>
<pre><code class="language-fsharp">let edit = createTextEdit span "newName"
// { Range = (0:4)-(0:10); NewText = "newName" }
</code></pre>
<h3 id="createworkspaceedit"><a class="header" href="#createworkspaceedit">createWorkspaceEdit</a></h3>
<p>ë‹¨ì¼ íŒŒì¼ ë³€ê²½ì„ ìœ„í•œ WorkspaceEdit ìƒì„±:</p>
<pre><code class="language-fsharp">// Protocol.fs
/// Create WorkspaceEdit for single-file changes
let createWorkspaceEdit (uri: string) (edits: TextEdit[]) : WorkspaceEdit =
    {
        Changes = Some (Map.ofList [ (uri, edits) ])
        DocumentChanges = None
        ChangeAnnotations = None
    }
</code></pre>
<p><strong>ì‚¬ìš©:</strong></p>
<pre><code class="language-fsharp">let edits = [|
    createTextEdit span1 "newName"
    createTextEdit span2 "newName"
    createTextEdit span3 "newName"
|]
let workspaceEdit = createWorkspaceEdit uri edits
</code></pre>
<p><strong>ì™œ í—¬í¼ê°€ í•„ìš”í•œê°€?</strong></p>
<ul>
<li>FunLangì€ ì‹±ê¸€ íŒŒì¼ì´ë¯€ë¡œ í•­ìƒ ë™ì¼í•œ êµ¬ì¡°</li>
<li>Renameê³¼ Find References ëª¨ë‘ ì‚¬ìš© (ì½”ë“œ ì¬ì‚¬ìš©)</li>
<li>LSP íƒ€ì…ì˜ ë³µì¡í•œ êµ¬ì¡°ë¥¼ ìˆ¨ê¹€</li>
</ul>
<hr>
<h2 id="serverfs-í†µí•©-2"><a class="header" href="#serverfs-í†µí•©-2">Server.fs í†µí•©</a></h2>
<h3 id="ì„œë²„-ê¸°ëŠ¥-ë“±ë¡-2"><a class="header" href="#ì„œë²„-ê¸°ëŠ¥-ë“±ë¡-2">ì„œë²„ ê¸°ëŠ¥ ë“±ë¡</a></h3>
<pre><code class="language-fsharp">// Server.fs
let serverCapabilities : ServerCapabilities =
    { ServerCapabilities.Default with
        TextDocumentSync = ...
        HoverProvider = Some (U2.C1 true)
        DefinitionProvider = Some (U2.C1 true)
        ReferencesProvider = Some (U2.C1 true)
        RenameProvider = Some (U3.C3 {           // ì¶”ê°€!
            PrepareProvider = Some true           // prepareRename ì§€ì›
            WorkDoneProgress = None
        })
    }
</code></pre>
<p><strong>RenameOptions êµ¬ì¡°:</strong></p>
<pre><code class="language-fsharp">type RenameOptions = {
    PrepareProvider: bool option    // prepareRename ì§€ì› ì—¬ë¶€
    WorkDoneProgress: bool option   // ì§„í–‰ ìƒí™© ë³´ê³  ì§€ì›
}
</code></pre>
<p><code>PrepareProvider = Some true</code>ë¡œ ì„¤ì •í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ëŠ” <code>prepareRename</code> ìš”ì²­ì„ ë¨¼ì € ë³´ë‚¸ë‹¤.</p>
<h3 id="í•¸ë“¤ëŸ¬-ë“±ë¡-2"><a class="header" href="#í•¸ë“¤ëŸ¬-ë“±ë¡-2">í•¸ë“¤ëŸ¬ ë“±ë¡</a></h3>
<pre><code class="language-fsharp">// Server.fs
module Handlers =
    /// Handle textDocument/prepareRename request
    let textDocumentPrepareRename (p: TextDocumentPositionParams) : Async&lt;PrepareRenameResult option&gt; =
        handlePrepareRename p

    /// Handle textDocument/rename request
    let textDocumentRename (p: RenameParams) : Async&lt;WorkspaceEdit option&gt; =
        handleRename p
</code></pre>
<h3 id="ì „ì²´-ì—°ê²°-2"><a class="header" href="#ì „ì²´-ì—°ê²°-2">ì „ì²´ ì—°ê²°</a></h3>
<ol>
<li>
<p><strong>ì´ˆê¸°í™” ì‹œ:</strong></p>
<ul>
<li>í´ë¼ì´ì–¸íŠ¸ â†’ <code>initialize</code> ìš”ì²­</li>
<li>ì„œë²„ â†’ <code>RenameProvider = { PrepareProvider = true }</code> ì‘ë‹µ</li>
<li>í´ë¼ì´ì–¸íŠ¸ëŠ” Rename ê¸°ëŠ¥ í™œì„±í™”</li>
</ul>
</li>
<li>
<p><strong>ì‚¬ìš©ìê°€ F2ë¥¼ ëˆ„ë¥´ë©´:</strong></p>
<ul>
<li>í´ë¼ì´ì–¸íŠ¸ â†’ <code>textDocument/prepareRename</code> ìš”ì²­</li>
<li>ì„œë²„ â†’ ë²”ìœ„ + í˜„ì¬ ì´ë¦„ ë°˜í™˜ (ë˜ëŠ” ì—ëŸ¬)</li>
<li>í´ë¼ì´ì–¸íŠ¸ â†’ ì…ë ¥ì°½ í‘œì‹œ, í˜„ì¬ ì´ë¦„ ë¯¸ë¦¬ ì±„ì›€</li>
</ul>
</li>
<li>
<p><strong>ì‚¬ìš©ìê°€ ìƒˆ ì´ë¦„ ì…ë ¥ í›„ Enter:</strong></p>
<ul>
<li>í´ë¼ì´ì–¸íŠ¸ â†’ <code>textDocument/rename</code> ìš”ì²­ (newName í¬í•¨)</li>
<li>ì„œë²„ â†’ <code>WorkspaceEdit</code> ë°˜í™˜</li>
<li>í´ë¼ì´ì–¸íŠ¸ â†’ ëª¨ë“  TextEdit ì ìš©</li>
</ul>
</li>
</ol>
<hr>
<h2 id="í…ŒìŠ¤íŠ¸-ì‘ì„±-6"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‘ì„±-6">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></h2>
<h3 id="ê¸°ë³¸-í…ŒìŠ¤íŠ¸-êµ¬ì¡°-2"><a class="header" href="#ê¸°ë³¸-í…ŒìŠ¤íŠ¸-êµ¬ì¡°-2">ê¸°ë³¸ í…ŒìŠ¤íŠ¸ êµ¬ì¡°</a></h3>
<pre><code class="language-fsharp">// RenameTests.fs
module LangLSP.Tests.RenameTests

open Expecto
open Ionide.LanguageServerProtocol.Types
open LangLSP.Server.Rename
open LangLSP.Server.DocumentSync

/// Create RenameParams for testing
let makeRenameParams uri line char newName : RenameParams =
    {
        TextDocument = { Uri = uri }
        Position = { Line = uint32 line; Character = uint32 char }
        NewName = newName
        WorkDoneToken = None
    }

/// Create TextDocumentPositionParams for prepareRename
let makePrepareRenameParams uri line char : TextDocumentPositionParams =
    {
        TextDocument = { Uri = uri }
        Position = { Line = uint32 line; Character = uint32 char }
    }
</code></pre>
<h3 id="í—¬í¼-í•¨ìˆ˜ë“¤"><a class="header" href="#í—¬í¼-í•¨ìˆ˜ë“¤">í—¬í¼ í•¨ìˆ˜ë“¤</a></h3>
<pre><code class="language-fsharp">/// Helper: setup document and perform rename
let setupAndRename uri text line char newName =
    clearAll()
    handleDidOpen (makeDidOpenParams uri text)
    handleRename (makeRenameParams uri line char newName) |&gt; Async.RunSynchronously

/// Helper: setup document and prepare rename
let setupAndPrepareRename uri text line char =
    clearAll()
    handleDidOpen (makeDidOpenParams uri text)
    handlePrepareRename (makePrepareRenameParams uri line char) |&gt; Async.RunSynchronously

/// Extract edits count from WorkspaceEdit
let countEdits (workspaceEdit: WorkspaceEdit option) : int =
    match workspaceEdit with
    | Some edit -&gt;
        match edit.Changes with
        | Some changes -&gt;
            changes.Values
            |&gt; Seq.map Array.length
            |&gt; Seq.sum
        | None -&gt; 0
    | None -&gt; 0
</code></pre>
<p><strong>ì™œ <code>countEdits</code>ê°€ ìœ ìš”í•œê°€?</strong></p>
<ul>
<li>WorkspaceEdit êµ¬ì¡°ê°€ ë³µì¡í•¨ (ì¤‘ì²©ëœ option)</li>
<li>í…ŒìŠ¤íŠ¸ì—ì„œëŠ” â€œëª‡ ê°œ ë³€ê²½ë˜ì—ˆë‚˜?â€œë§Œ í™•ì¸í•˜ë©´ ì¶©ë¶„</li>
<li>ì •í™•í•œ Rangeê¹Œì§€ ê²€ì¦í•˜ë©´ í…ŒìŠ¤íŠ¸ê°€ brittleí•´ì§</li>
</ul>
<h3 id="í…ŒìŠ¤íŠ¸-ì¼€ì´ìŠ¤ë“¤-1"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì¼€ì´ìŠ¤ë“¤-1">í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë“¤</a></h3>
<pre><code class="language-fsharp">[&lt;Tests&gt;]
let renameTests =
    testSequenced &lt;| testList "Rename" [
        testList "Variable rename (RENAME-01)" [
            test "renames all variable occurrences" {
                // "let x = 1 in x + x"
                //      ^ position (0, 4) - at definition
                let result = setupAndRename "file:///test.fun" "let x = 1 in x + x" 0 4 "newX"
                Expect.isSome result "Should return WorkspaceEdit"
                // Should rename definition + 2 usages = 3 edits
                let editCount = countEdits result
                Expect.equal editCount 3 "Should have 3 edits (def + 2 usages)"
            }

            test "renames from usage position" {
                // "let x = 1 in x + x"
                //              ^ position (0, 13) - at usage
                let result = setupAndRename "file:///test.fun" "let x = 1 in x + x" 0 13 "y"
                Expect.isSome result "Should return WorkspaceEdit"
                let editCount = countEdits result
                Expect.equal editCount 3 "Should rename all occurrences from usage position"
            }
        ]

        testList "Function rename (RENAME-02)" [
            test "renames function and all calls" {
                // "let f = fun x -&gt; x in f 1"
                //      ^ position (0, 4) - function definition
                let result = setupAndRename "file:///test.fun" "let f = fun x -&gt; x in f 1" 0 4 "g"
                Expect.isSome result "Should return WorkspaceEdit"
                let editCount = countEdits result
                Expect.isGreaterThanOrEqual editCount 2 "Should rename function and calls"
            }

            test "renames recursive function" {
                // "let rec fact n = if n = 0 then 1 else n * fact (n - 1) in fact 5"
                //         ^ position around (0, 8) - function name
                let code = "let rec fact n = if n = 0 then 1 else n * fact (n - 1) in fact 5"
                let result = setupAndRename "file:///test.fun" code 0 8 "factorial"
                Expect.isSome result "Should return WorkspaceEdit"
                let editCount = countEdits result
                Expect.isGreaterThanOrEqual editCount 2 "Should rename all function occurrences"
            }
        ]

        testList "Prepare rename (RENAME-03)" [
            test "validates rename on variable" {
                let result = setupAndPrepareRename "file:///test.fun" "let x = 42 in x" 0 4
                Expect.isSome result "Should allow rename on variable"
                match result with
                | Some (U3.C2 rangeWithPlaceholder) -&gt;
                    Expect.equal rangeWithPlaceholder.Placeholder "x" "Placeholder should be variable name"
                | _ -&gt; failtest "Expected RangeWithPlaceholder"
            }

            test "rejects rename on number literal" {
                let result = setupAndPrepareRename "file:///test.fun" "42" 0 0
                Expect.isNone result "Should reject rename on number literal"
            }

            test "validates rename on lambda parameter" {
                let result = setupAndPrepareRename "file:///test.fun" "fun x -&gt; x" 0 4
                Expect.isSome result "Should allow rename on lambda parameter"
            }
        ]

        testList "Edge cases" [
            test "handles shadowing correctly" {
                // "let x = 1 in let x = 2 in x"
                //                   ^ position (0, 17) - inner x definition
                let result = setupAndRename "file:///test.fun" "let x = 1 in let x = 2 in x" 0 17 "y"
                Expect.isSome result "Should handle shadowed variable"
                // Should only rename inner x occurrences
                let editCount = countEdits result
                Expect.equal editCount 2 "Should rename inner x (def + usage)"
            }

            test "returns None for parse error" {
                let text = "let x ="  // Incomplete/invalid
                let result = setupAndRename "file:///test.fun" text 0 0 "newName"
                Expect.isNone result "Parse error should return None"
            }
        ]
    ]
</code></pre>
<h3 id="í…ŒìŠ¤íŠ¸-ì‹¤í–‰-6"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‹¤í–‰-6">í…ŒìŠ¤íŠ¸ ì‹¤í–‰</a></h3>
<pre><code class="language-bash">dotnet run --project src/LangLSP.Tests

# ì¶œë ¥:
# [Rename] Variable rename - renames all variable occurrences - Passed
# [Rename] Variable rename - renames from usage position - Passed
# [Rename] Function rename - renames function and all calls - Passed
# [Rename] Prepare rename - validates rename on variable - Passed
# [Rename] Edge cases - handles shadowing correctly - Passed
</code></pre>
<hr>
<h2 id="ì£¼ì˜ì‚¬í•­ê³¼-ì—£ì§€-ì¼€ì´ìŠ¤"><a class="header" href="#ì£¼ì˜ì‚¬í•­ê³¼-ì—£ì§€-ì¼€ì´ìŠ¤">ì£¼ì˜ì‚¬í•­ê³¼ ì—£ì§€ ì¼€ì´ìŠ¤</a></h2>
<h3 id="1-ì„€ë„ì‰-ì²˜ë¦¬-í•„ìˆ˜"><a class="header" href="#1-ì„€ë„ì‰-ì²˜ë¦¬-í•„ìˆ˜">1. ì„€ë„ì‰ ì²˜ë¦¬ í•„ìˆ˜</a></h3>
<p><strong>ì˜ëª»ëœ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">// ì´ë¦„ë§Œ ë³´ê³  ëª¨ë“  Var ìˆ˜ì§‘
let allRefs = collectReferences varName ast
let allSpans = defNameSpan :: allRefs  // ì˜ëª»ë¨!
</code></pre>
<pre><code class="language-funlang">let x = 1 in
  let x = 2 in
    x
</code></pre>
<p>ì™¸ë¶€ <code>x</code>ë¥¼ renameí•˜ë©´ ë‚´ë¶€ <code>x</code>ê¹Œì§€ ë³€ê²½ë¨ â†’ <strong>ë²„ê·¸!</strong></p>
<p><strong>ì˜¬ë°”ë¥¸ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">// íŠ¹ì • ì •ì˜ì— ì†í•˜ëŠ” ë ˆí¼ëŸ°ìŠ¤ë§Œ
let references = collectReferencesForBinding varName defSpan ast
</code></pre>
<h3 id="2-ì •ì˜-ì‚¬ì´íŠ¸-ì´ë¦„ë§Œ-êµì²´"><a class="header" href="#2-ì •ì˜-ì‚¬ì´íŠ¸-ì´ë¦„ë§Œ-êµì²´">2. ì •ì˜ ì‚¬ì´íŠ¸ ì´ë¦„ë§Œ êµì²´</a></h3>
<p><strong>ì˜ëª»ëœ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">// ì „ì²´ Let í‘œí˜„ì‹ span ì‚¬ìš©
let allSpans = defSpan :: references  // ì˜ëª»ë¨!
</code></pre>
<pre><code class="language-funlang">let result = 42 in result
^^^^^^^^^^^^^^
ì „ì²´ spanì„ êµì²´í•˜ë©´ "= 42 in result"ê¹Œì§€ ì‚­ì œë¨!
</code></pre>
<p><strong>ì˜¬ë°”ë¥¸ êµ¬í˜„:</strong></p>
<pre><code class="language-fsharp">// findNameInSourceë¡œ ì´ë¦„ë§Œ ì¶”ì¶œ
let defNameSpan = findNameInSource text varName defSpan.StartLine defSpan.StartColumn
</code></pre>
<h3 id="3-ì¤‘ë³µ-ì œê±°"><a class="header" href="#3-ì¤‘ë³µ-ì œê±°">3. ì¤‘ë³µ ì œê±°</a></h3>
<p><code>Let(name, ...)</code>ì™€ <code>Var(name, ...)</code>ê°€ ASTì— ë™ì‹œì— ì¡´ì¬í•  ìˆ˜ ìˆë‹¤.</p>
<p><strong>ì˜ˆì‹œ:</strong></p>
<pre><code class="language-funlang">let rec f n = f (n - 1)
</code></pre>
<ul>
<li><code>LetRec("f", ...)</code> ë…¸ë“œ</li>
<li>ë³¸ë¬¸ì— <code>Var("f", ...)</code> ë…¸ë“œ (ì¬ê·€ í˜¸ì¶œ)</li>
</ul>
<p>ë‘˜ ë‹¤ ìˆ˜ì§‘í•˜ë©´ ì¤‘ë³µ ê°€ëŠ¥ â†’ <code>distinctBy</code>ë¡œ ì œê±°:</p>
<pre><code class="language-fsharp">let distinctSpans =
    allSpans
    |&gt; List.distinctBy (fun span -&gt;
        (span.StartLine, span.StartColumn, span.EndLine, span.EndColumn))
</code></pre>
<h3 id="4-preparerename-ì‹¤íŒ¨-ì²˜ë¦¬"><a class="header" href="#4-preparerename-ì‹¤íŒ¨-ì²˜ë¦¬">4. prepareRename ì‹¤íŒ¨ ì²˜ë¦¬</a></h3>
<p><strong>ì‹œë‚˜ë¦¬ì˜¤:</strong></p>
<ul>
<li>ì‚¬ìš©ìê°€ í‚¤ì›Œë“œ ìœ„ì—ì„œ F2 ì…ë ¥</li>
<li>ë˜ëŠ” ìˆ«ì ë¦¬í„°ëŸ´ ìœ„ì—ì„œ rename ì‹œë„</li>
</ul>
<p><strong>ì˜¬ë°”ë¥¸ ì‘ë‹µ:</strong></p>
<pre><code class="language-fsharp">| _ -&gt;
    // Not a renameable symbol
    return None
</code></pre>
<p>VS CodeëŠ” <code>None</code>ì„ ë°›ìœ¼ë©´ â€œCannot rename this symbolâ€ ë©”ì‹œì§€ í‘œì‹œ</p>
<h3 id="5-var-ë…¸ë“œì—ì„œ-ì‹œì‘-ì‹œ-ì •ì˜-ì°¾ê¸°"><a class="header" href="#5-var-ë…¸ë“œì—ì„œ-ì‹œì‘-ì‹œ-ì •ì˜-ì°¾ê¸°">5. Var ë…¸ë“œì—ì„œ ì‹œì‘ ì‹œ ì •ì˜ ì°¾ê¸°</a></h3>
<p><strong>ì‹œë‚˜ë¦¬ì˜¤:</strong></p>
<pre><code class="language-funlang">let x = 1 in x
             ^
             ì—¬ê¸°ì„œ F2
</code></pre>
<p>Var ë…¸ë“œëŠ” <strong>ì‚¬ìš©ì²˜</strong>ì´ì§€ ì •ì˜ê°€ ì•„ë‹ˆë‹¤. ë¨¼ì € ì •ì˜ë¥¼ ì°¾ì•„ì•¼ í•œë‹¤:</p>
<pre><code class="language-fsharp">| Var(name, _) -&gt;
    // Variable reference - find its definition
    let def = findDefinitionForVar name ast p.Position
    (Some name, def)
</code></pre>
<p>ì´ë ‡ê²Œ í•´ì•¼ ì •ì˜ + ëª¨ë“  ì‚¬ìš©ì²˜ë¥¼ í•¨ê»˜ renameí•  ìˆ˜ ìˆë‹¤.</p>
<h3 id="6-íŒŒì‹±-ì—ëŸ¬-ì²˜ë¦¬"><a class="header" href="#6-íŒŒì‹±-ì—ëŸ¬-ì²˜ë¦¬">6. íŒŒì‹± ì—ëŸ¬ ì²˜ë¦¬</a></h3>
<p><strong>ì‹œë‚˜ë¦¬ì˜¤:</strong></p>
<pre><code class="language-funlang">let x =
</code></pre>
<p>ë¶ˆì™„ì „í•œ ì½”ë“œì—ì„œ rename ì‹œë„</p>
<p><strong>ì˜¬ë°”ë¥¸ ì²˜ë¦¬:</strong></p>
<pre><code class="language-fsharp">try
    let ast = Parser.start Lexer.tokenize lexbuf
    ...
with _ -&gt;
    return None
</code></pre>
<p>VS CodeëŠ” <code>None</code>ì„ ë°›ìœ¼ë©´ ì¡°ìš©íˆ ì‹¤íŒ¨ (ì—ëŸ¬ ë©”ì‹œì§€ ì—†ì´)</p>
<hr>
<h2 id="ì •ë¦¬-4"><a class="header" href="#ì •ë¦¬-4">ì •ë¦¬</a></h2>
<p>Rename Symbol êµ¬í˜„ì˜ í•µì‹¬:</p>
<ol>
<li>
<p><strong>prepareRename</strong> - ì¡°ê¸° ê²€ì¦</p>
<ul>
<li>Rename ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸</li>
<li>ì •í™•í•œ ë²”ìœ„ ë°˜í™˜ (findNameInSource)</li>
<li>í˜„ì¬ ì´ë¦„ ì œê³µ (placeholder)</li>
</ul>
</li>
<li>
<p><strong>ì„€ë„ì‰ ì¸ì‹ ë ˆí¼ëŸ°ìŠ¤ ìˆ˜ì§‘</strong></p>
<ul>
<li><code>collectReferencesForBinding</code> ì‚¬ìš©</li>
<li>ê° Varê°€ ì–´ë–¤ ì •ì˜ë¥¼ ì°¸ì¡°í•˜ëŠ”ì§€ í™•ì¸</li>
<li>íƒ€ê²Ÿ ì •ì˜ì™€ ì¼ì¹˜í•˜ëŠ” ê²ƒë§Œ ìˆ˜ì§‘</li>
</ul>
</li>
<li>
<p><strong>ì •ì˜ ì‚¬ì´íŠ¸ ì´ë¦„ ì¶”ì¶œ</strong></p>
<ul>
<li>Let/LetRec/Lambda spanì€ ì „ì²´ í‘œí˜„ì‹</li>
<li><code>findNameInSource</code>ë¡œ ì´ë¦„ë§Œ span ì¶”ì¶œ</li>
<li>Fallbackìœ¼ë¡œ startCol + name.Length ì‚¬ìš©</li>
</ul>
</li>
<li>
<p><strong>WorkspaceEdit ìƒì„±</strong></p>
<ul>
<li>ì •ì˜ + ë ˆí¼ëŸ°ìŠ¤ span ê²°í•©</li>
<li>ì¤‘ë³µ ì œê±° (<code>distinctBy</code>)</li>
<li>ê° span â†’ TextEdit</li>
<li>ë‹¨ì¼ íŒŒì¼ WorkspaceEdit ë°˜í™˜</li>
</ul>
</li>
<li>
<p><strong>ì—£ì§€ ì¼€ì´ìŠ¤ ì²˜ë¦¬</strong></p>
<ul>
<li>Varì—ì„œ ì‹œì‘ â†’ ì •ì˜ ë¨¼ì € ì°¾ê¸°</li>
<li>ì„€ë„ì‰ ì •í™•íˆ ì²˜ë¦¬</li>
<li>íŒŒì‹± ì—ëŸ¬ â†’ None ë°˜í™˜</li>
<li>Rename ë¶ˆê°€ëŠ¥í•œ ë…¸ë“œ â†’ None ë°˜í™˜</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ë‹¤ìŒ-ë‹¨ê³„-9"><a class="header" href="#ë‹¤ìŒ-ë‹¨ê³„-9">ë‹¤ìŒ ë‹¨ê³„</a></h2>
<p>Rename Symbolì„ ì™„ì„±í–ˆë‹¤! ì´ì œ ì‚¬ìš©ìëŠ” ì•ˆì „í•˜ê²Œ ì‹ë³„ì ì´ë¦„ì„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.</p>
<p>ë‹¤ìŒ Phaseì—ì„œ êµ¬í˜„í•  ê¸°ëŠ¥ë“¤:</p>
<ul>
<li><strong>Code Actions</strong>: ìë™ ìˆ˜ì • ì œì•ˆ (ë¯¸ì‚¬ìš© ë³€ìˆ˜ ì œê±°, íƒ€ì… ì£¼ì„ ì¶”ê°€ ë“±)</li>
<li><strong>Folding Ranges</strong>: ì½”ë“œ ì ‘ê¸°</li>
<li><strong>Document Symbols</strong>: ì•„ì›ƒë¼ì¸ ë·°</li>
</ul>
<hr>
<h2 id="ì°¸ê³ -ìë£Œ-9"><a class="header" href="#ì°¸ê³ -ìë£Œ-9">ì°¸ê³  ìë£Œ</a></h2>
<ul>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocument_rename">LSP Specification - textDocument/rename</a></li>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocument_prepareRename">LSP Specification - textDocument/prepareRename</a></li>
<li><a href="https://langserver.org/renaming/">Rename Symbol in LSP - Language Server Tutorial</a></li>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#workspaceEdit">WorkspaceEdit - LSP</a></li>
</ul>
<hr>
<p><strong>-&gt; ë‹¤ìŒ: Phase 4 - Code Actions êµ¬í˜„</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="code-actions-êµ¬í˜„í•˜ê¸°"><a class="header" href="#code-actions-êµ¬í˜„í•˜ê¸°">Code Actions êµ¬í˜„í•˜ê¸°</a></h1>
<p>ì½”ë“œ ì—ë””í„°ì—ì„œ ì „êµ¬ ì•„ì´ì½˜(ğŸ’¡)ì„ ë³¸ ì ì´ ìˆëŠ”ê°€? ë¬¸ì œê°€ ìˆëŠ” ì½”ë“œì— ì»¤ì„œë¥¼ ë†“ìœ¼ë©´ ë‚˜íƒ€ë‚˜ëŠ” â€œë¹ ë¥¸ ìˆ˜ì •(Quick Fix)â€ ë©”ë‰´ê°€ ë°”ë¡œ Code Actionsì´ë‹¤.</p>
<p>ì´ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” FunLang LSPì— Code Actions ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì—¬, ì‚¬ìš©ìê°€ ì§„ë‹¨(Diagnostics)ì— ëŒ€í•œ ìë™ ìˆ˜ì •ì„ ë°›ì„ ìˆ˜ ìˆë„ë¡ ë§Œë“ ë‹¤.</p>
<h2 id="ëª©ì°¨-10"><a class="header" href="#ëª©ì°¨-10">ëª©ì°¨</a></h2>
<ol>
<li><a href="#code-actionsì´ë€">Code Actionsì´ë€</a></li>
<li><a href="#lsp-í”„ë¡œí† ì½œ-3">LSP í”„ë¡œí† ì½œ</a></li>
<li><a href="#diagnosticsì™€ì˜-ê´€ê³„">Diagnosticsì™€ì˜ ê´€ê³„</a></li>
<li><a href="#ë¯¸ì‚¬ìš©-ë³€ìˆ˜-ê°ì§€-êµ¬í˜„">ë¯¸ì‚¬ìš© ë³€ìˆ˜ ê°ì§€ êµ¬í˜„</a></li>
<li><a href="#quickfix-codeaction-ìƒì„±">QuickFix CodeAction ìƒì„±</a></li>
<li><a href="#handlecodeaction-êµ¬í˜„">handleCodeAction êµ¬í˜„</a></li>
<li><a href="#serverfs-í†µí•©-3">Server.fs í†µí•©</a></li>
<li><a href="#í…ŒìŠ¤íŠ¸-ì‘ì„±-7">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></li>
<li><a href="#í™•ì¥-ê°€ëŠ¥ì„±">í™•ì¥ ê°€ëŠ¥ì„±</a></li>
<li><a href="#ì£¼ì˜ì‚¬í•­">ì£¼ì˜ì‚¬í•­</a></li>
</ol>
<hr>
<h2 id="code-actionsì´ë€"><a class="header" href="#code-actionsì´ë€">Code Actionsì´ë€</a></h2>
<p><strong>Code Actions</strong>ëŠ” LSPì—ì„œ ì œê³µí•˜ëŠ” â€œì½”ë“œ ìˆ˜ì • ì œì•ˆâ€ ê¸°ëŠ¥ì´ë‹¤.</p>
<h3 id="ì‚¬ìš©-ì‚¬ë¡€"><a class="header" href="#ì‚¬ìš©-ì‚¬ë¡€">ì‚¬ìš© ì‚¬ë¡€</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>ìƒí™©</th><th>Code Action</th></tr>
</thead>
<tbody>
<tr><td>ë¯¸ì‚¬ìš© ë³€ìˆ˜ <code>x</code></td><td>â€œPrefix â€˜xâ€™ with underscoreâ€ â†’ <code>_x</code>ë¡œ ë³€ê²½</td></tr>
<tr><td>Import ëˆ„ë½</td><td>â€œAdd missing importâ€ â†’ <code>import</code> ë¬¸ ì¶”ê°€</td></tr>
<tr><td>Typo ê°ì§€</td><td>â€œDid you mean â€˜calculateâ€™?â€ â†’ ì˜¤íƒ€ ìˆ˜ì •</td></tr>
<tr><td>íƒ€ì… ì˜¤ë¥˜</td><td>â€œConvert to expected typeâ€ â†’ íƒ€ì… ë³€í™˜ ì¶”ê°€</td></tr>
</tbody>
</table>
</div>
<h3 id="vs-codeì—ì„œì˜-í‘œì‹œ-3"><a class="header" href="#vs-codeì—ì„œì˜-í‘œì‹œ-3">VS Codeì—ì„œì˜ í‘œì‹œ</a></h3>
<pre><code>test.fun
â”€â”€â”€â”€â”€â”€â”€â”€
1 | let x = 1 in
    ~~~~~ Warning: Unused variable 'x'
    ğŸ’¡ Prefix 'x' with underscore
</code></pre>
<p>ì‚¬ìš©ìê°€:</p>
<ol>
<li>ë…¸ë€ ë°‘ì¤„ì— ì»¤ì„œë¥¼ ë†“ìœ¼ë©´</li>
<li>ì „êµ¬ ì•„ì´ì½˜(ğŸ’¡) í‘œì‹œ</li>
<li>í´ë¦­í•˜ë©´ Code Action ëª©ë¡ í‘œì‹œ</li>
<li>ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ì½”ë“œ ìˆ˜ì •</li>
</ol>
<pre class="mermaid">sequenceDiagram
    participant C as Client
    participant S as Server
    S--&gt;&gt;C: textDocument/publishDiagnostics(diagnostics[])
    Note over C: ğŸ’¡ í‘œì‹œ
    C-&gt;&gt;S: textDocument/codeAction(uri, range, diagnostics[])
    Note over S: ì§„ë‹¨ ë¶„ì„ â†’ ìˆ˜ì • ì œì•ˆ ìƒì„±
    S-&gt;&gt;C: CodeAction[](title, edit, kind)
    Note over C: ì‚¬ìš©ìê°€ ì•¡ì…˜ ì„ íƒ â†’ WorkspaceEdit ì ìš©
</pre>

<h3 id="code-actionì˜-ì¢…ë¥˜"><a class="header" href="#code-actionì˜-ì¢…ë¥˜">Code Actionì˜ ì¢…ë¥˜</a></h3>
<p>LSP ìŠ¤í™ì—ì„œ ì •ì˜í•œ <code>CodeActionKind</code>:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Kind</th><th>ìš©ë„</th></tr>
</thead>
<tbody>
<tr><td><code>quickfix</code></td><td>ì§„ë‹¨(diagnostic)ì— ëŒ€í•œ ë¹ ë¥¸ ìˆ˜ì •</td></tr>
<tr><td><code>refactor</code></td><td>ë¦¬íŒ©í† ë§ (í•¨ìˆ˜ ì¶”ì¶œ, ë³€ìˆ˜ ì¸ë¼ì¸ ë“±)</td></tr>
<tr><td><code>refactor.extract</code></td><td>ì½”ë“œ ì¶”ì¶œ (í•¨ìˆ˜, ë³€ìˆ˜)</td></tr>
<tr><td><code>refactor.inline</code></td><td>ì¸ë¼ì¸ ì¹˜í™˜</td></tr>
<tr><td><code>refactor.rewrite</code></td><td>ì½”ë“œ ì¬ì‘ì„±</td></tr>
<tr><td><code>source</code></td><td>ì†ŒìŠ¤ ë ˆë²¨ ì•¡ì…˜ (íŒŒì¼ ì •ë¦¬, import ì •ë ¬)</td></tr>
<tr><td><code>source.organizeImports</code></td><td>Import ì •ë¦¬</td></tr>
</tbody>
</table>
</div>
<p>ìš°ë¦¬ëŠ” <code>quickfix</code>ë¥¼ ì¤‘ì ì ìœ¼ë¡œ êµ¬í˜„í•œë‹¤.</p>
<hr>
<h2 id="lsp-í”„ë¡œí† ì½œ-3"><a class="header" href="#lsp-í”„ë¡œí† ì½œ-3">LSP í”„ë¡œí† ì½œ</a></h2>
<h3 id="textdocumentcodeaction-ìš”ì²­"><a class="header" href="#textdocumentcodeaction-ìš”ì²­">textDocument/codeAction ìš”ì²­</a></h3>
<p>í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— Code Actionsë¥¼ ìš”ì²­í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.</p>
<pre><code class="language-typescript">interface CodeActionParams {
    textDocument: TextDocumentIdentifier  // ë¬¸ì„œ URI
    range: Range                          // ì„ íƒ ì˜ì—­ (ë˜ëŠ” ì»¤ì„œ ìœ„ì¹˜)
    context: CodeActionContext            // ì»¨í…ìŠ¤íŠ¸ (ì§„ë‹¨ ì •ë³´ í¬í•¨)
}

interface CodeActionContext {
    diagnostics: Diagnostic[]             // ì´ ìœ„ì¹˜ì˜ ëª¨ë“  ì§„ë‹¨
    only?: CodeActionKind[]               // ìš”ì²­ëœ ì•¡ì…˜ ì¢…ë¥˜ í•„í„°
    triggerKind?: CodeActionTriggerKind   // íŠ¸ë¦¬ê±° ë°©ì‹
}
</code></pre>
<p><strong>í•µì‹¬ í¬ì¸íŠ¸:</strong></p>
<ul>
<li><strong>context.diagnostics</strong>: í´ë¼ì´ì–¸íŠ¸ê°€ í•´ë‹¹ ìœ„ì¹˜ì˜ ì§„ë‹¨ì„ í•¨ê»˜ ì „ì†¡</li>
<li>ì„œë²„ëŠ” ì´ ì§„ë‹¨ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì ì ˆí•œ ìˆ˜ì • ì œì•ˆ</li>
</ul>
<h3 id="codeaction-ì‘ë‹µ"><a class="header" href="#codeaction-ì‘ë‹µ">CodeAction ì‘ë‹µ</a></h3>
<p>ì„œë²„ê°€ ë°˜í™˜í•˜ëŠ” ì•¡ì…˜ ëª©ë¡ì´ë‹¤.</p>
<pre><code class="language-typescript">interface CodeAction {
    title: string                     // ì‚¬ìš©ìì—ê²Œ í‘œì‹œí•  ì œëª©
    kind?: CodeActionKind             // ì•¡ì…˜ ì¢…ë¥˜
    diagnostics?: Diagnostic[]        // ì´ ì•¡ì…˜ì´ í•´ê²°í•˜ëŠ” ì§„ë‹¨
    isPreferred?: boolean             // ê¸°ë³¸ ì„ íƒ ì—¬ë¶€
    disabled?: { reason: string }     // ë¹„í™œì„±í™” ì‚¬ìœ 
    edit?: WorkspaceEdit              // ìˆ˜í–‰í•  í¸ì§‘ ì‘ì—…
    command?: Command                 // ì‹¤í–‰í•  ëª…ë ¹ (edit ëŒ€ì‹  ì‚¬ìš© ê°€ëŠ¥)
}
</code></pre>
<h3 id="workspaceedit-êµ¬ì¡°"><a class="header" href="#workspaceedit-êµ¬ì¡°">WorkspaceEdit êµ¬ì¡°</a></h3>
<p>ì½”ë“œ ìˆ˜ì •ì„ í‘œí˜„í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.</p>
<pre><code class="language-typescript">interface WorkspaceEdit {
    changes?: { [uri: string]: TextEdit[] }  // URIë³„ í¸ì§‘ ëª©ë¡
    documentChanges?: TextDocumentEdit[]     // ë¬¸ì„œ ë³€ê²½ (ìˆœì„œ ë³´ì¥)
}

interface TextEdit {
    range: Range      // ìˆ˜ì •í•  ë²”ìœ„
    newText: string   // ìƒˆ í…ìŠ¤íŠ¸
}
</code></pre>
<p><strong>ì˜ˆì‹œ: ë³€ìˆ˜ëª… ë³€ê²½</strong></p>
<pre><code class="language-fsharp">// 'x'ë¥¼ '_x'ë¡œ ë³€ê²½í•˜ëŠ” WorkspaceEdit
{
    changes = Map [
        ("file:///test.fun", [|
            {
                Range = { Start = { Line = 0u; Character = 4u }
                          End = { Line = 0u; Character = 5u } }
                NewText = "_x"
            }
        |])
    ]
}
</code></pre>
<hr>
<h2 id="diagnosticsì™€ì˜-ê´€ê³„"><a class="header" href="#diagnosticsì™€ì˜-ê´€ê³„">Diagnosticsì™€ì˜ ê´€ê³„</a></h2>
<p>Code ActionsëŠ” <strong>Diagnosticsì™€ ê¸´ë°€íˆ ì—°ê²°</strong>ë˜ì–´ ìˆë‹¤.</p>
<h3 id="ì „ì²´-íë¦„"><a class="header" href="#ì „ì²´-íë¦„">ì „ì²´ íë¦„</a></h3>
<pre><code>1. ì‚¬ìš©ìê°€ ì½”ë“œ ì…ë ¥
   â†“
2. textDocument/didChange ì•Œë¦¼
   â†“
3. ì„œë²„ê°€ ì½”ë“œ ë¶„ì„
   â†“
4. textDocument/publishDiagnostics ë°œí–‰
   â†“ (ì—ë””í„°ì— ë…¸ë€/ë¹¨ê°„ ë°‘ì¤„ í‘œì‹œ)
5. ì‚¬ìš©ìê°€ ì§„ë‹¨ ìœ„ì¹˜ì— ì»¤ì„œ ë†“ìŒ
   â†“
6. ì—ë””í„°ê°€ textDocument/codeAction ìš”ì²­
   â†“ (context.diagnosticsì— ì§„ë‹¨ í¬í•¨)
7. ì„œë²„ê°€ ì§„ë‹¨ë³„ ìˆ˜ì • ì œì•ˆ ë°˜í™˜
   â†“
8. ì‚¬ìš©ìê°€ ì•¡ì…˜ ì„ íƒ
   â†“
9. ì—ë””í„°ê°€ workspace/applyEdit ìš”ì²­
   â†“
10. ì„œë²„ê°€ í¸ì§‘ ì ìš© í™•ì¸
</code></pre>
<h3 id="ì§„ë‹¨-ì½”ë“œdiagnostic-code-í™œìš©"><a class="header" href="#ì§„ë‹¨-ì½”ë“œdiagnostic-code-í™œìš©">ì§„ë‹¨ ì½”ë“œ(Diagnostic Code) í™œìš©</a></h3>
<p>Diagnosticsì— <code>code</code> í•„ë“œë¥¼ ì„¤ì •í•˜ë©´, Code Actionsì—ì„œ ì§„ë‹¨ ì¢…ë¥˜ë¥¼ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.</p>
<pre><code class="language-fsharp">// Diagnostics.fs - ë¯¸ì‚¬ìš© ë³€ìˆ˜ ì§„ë‹¨ ìƒì„±
{
    Range = findIdentifierRange source name span  // ì‹ë³„ì ì´ë¦„ ìœ„ì¹˜ë§Œ ì •í™•íˆ íƒ€ê²ŸíŒ…
    Severity = Some DiagnosticSeverity.Warning
    Code = Some (U2.C2 "unused-variable")  // ì§„ë‹¨ ì½”ë“œ ì„¤ì •
    Source = Some "funlang"
    Message = sprintf "Unused variable '%s'" name
    Tags = Some [| DiagnosticTag.Unnecessary |]
    RelatedInformation = None
    Data = None
}
</code></pre>
<pre><code class="language-fsharp">// CodeActions.fs - ì§„ë‹¨ ì½”ë“œë¡œ ì•¡ì…˜ ë¶„ê¸°
match diag.Code with
| Some (U2.C2 "unused-variable") -&gt;
    // ë¯¸ì‚¬ìš© ë³€ìˆ˜ â†’ underscore prefix ì•¡ì…˜
    createPrefixUnderscoreAction diag uri
| Some (U2.C2 "type-mismatch") -&gt;
    // íƒ€ì… ë¶ˆì¼ì¹˜ â†’ íƒ€ì… ì •ë³´ ì•¡ì…˜
    createTypeInfoAction diag
| _ -&gt;
    // ê¸°íƒ€ ì§„ë‹¨ â†’ ì¼ë°˜ ì•¡ì…˜ ë˜ëŠ” ìŠ¤í‚µ
    None
</code></pre>
<hr>
<h2 id="ë¯¸ì‚¬ìš©-ë³€ìˆ˜-ê°ì§€-êµ¬í˜„"><a class="header" href="#ë¯¸ì‚¬ìš©-ë³€ìˆ˜-ê°ì§€-êµ¬í˜„">ë¯¸ì‚¬ìš© ë³€ìˆ˜ ê°ì§€ êµ¬í˜„</a></h2>
<p>Code Actionsë¥¼ ì œê³µí•˜ë ¤ë©´, ë¨¼ì € <strong>ë¯¸ì‚¬ìš© ë³€ìˆ˜ë¥¼ ê°ì§€</strong>í•˜ëŠ” ì§„ë‹¨ì´ í•„ìš”í•˜ë‹¤.</p>
<h3 id="findunusedvariables-í•¨ìˆ˜"><a class="header" href="#findunusedvariables-í•¨ìˆ˜">findUnusedVariables í•¨ìˆ˜</a></h3>
<pre><code class="language-fsharp">// Diagnostics.fs
module LangLSP.Server.Diagnostics

open LangLSP.Server.References
open LangLSP.Server.Definition  // findIdentifierRange ì‚¬ìš©

/// Find unused let-bound variables in the AST
/// Returns list of (name, span) for unused variables
let findUnusedVariables (ast: Ast.Expr) : (string * Ast.Span) list =
    let unusedVars = ResizeArray&lt;string * Ast.Span&gt;()

    let rec traverse expr =
        match expr with
        | Ast.Let(name, value, body, span) -&gt;
            // Skip variables prefixed with underscore (intentionally unused)
            if not (name.StartsWith("_")) then
                // Check if this variable is used in the body
                let references = collectReferences name body
                if List.isEmpty references then
                    unusedVars.Add(name, span)
            traverse value
            traverse body

        | Ast.LetRec(name, param, fnBody, inExpr, span) -&gt;
            // Check recursive function usage
            if not (name.StartsWith("_")) then
                let referencesInBody = collectReferences name fnBody
                let referencesInExpr = collectReferences name inExpr
                if List.isEmpty referencesInBody &amp;&amp; List.isEmpty referencesInExpr then
                    unusedVars.Add(name, span)
            // Check parameter usage
            if not (param.StartsWith("_")) then
                let paramRefs = collectReferences param fnBody
                if List.isEmpty paramRefs then
                    unusedVars.Add(param, span)
            traverse fnBody
            traverse inExpr

        | Ast.Lambda(param, body, span) -&gt;
            if not (param.StartsWith("_")) then
                let references = collectReferences param body
                if List.isEmpty references then
                    unusedVars.Add(param, span)
            traverse body

        | Ast.LambdaAnnot(param, _, body, span) -&gt;
            if not (param.StartsWith("_")) then
                let references = collectReferences param body
                if List.isEmpty references then
                    unusedVars.Add(param, span)
            traverse body

        // ê¸°íƒ€ ë…¸ë“œ ìˆœíšŒ ìƒëµ (ì „ì²´ ì½”ë“œëŠ” Diagnostics.fs ì°¸ì¡°)
        | _ -&gt; ()

    traverse ast
    unusedVars |&gt; Seq.toList
</code></pre>
<p><strong>í•µì‹¬ ë¡œì§:</strong></p>
<ol>
<li><strong>AST ìˆœíšŒ</strong>: ëª¨ë“  binding(Let, LetRec, Lambda) ë…¸ë“œ ë°©ë¬¸</li>
<li><strong>References í™•ì¸</strong>: <code>collectReferences</code> í•¨ìˆ˜ë¡œ ë³€ìˆ˜ ì‚¬ìš©ì²˜ ê²€ìƒ‰</li>
<li><strong>Underscore ì˜ˆì™¸</strong>: <code>_x</code> í˜•íƒœëŠ” ì˜ë„ì ìœ¼ë¡œ ë¯¸ì‚¬ìš©ì´ë¯€ë¡œ ìŠ¤í‚µ</li>
<li><strong>Span ìˆ˜ì§‘</strong>: ë¯¸ì‚¬ìš© ë³€ìˆ˜ì˜ ìœ„ì¹˜ ì €ì¥</li>
</ol>
<h3 id="analyze-í•¨ìˆ˜-í™•ì¥"><a class="header" href="#analyze-í•¨ìˆ˜-í™•ì¥">analyze í•¨ìˆ˜ í™•ì¥</a></h3>
<p>ê¸°ì¡´ <code>analyze</code> í•¨ìˆ˜ì— ë¯¸ì‚¬ìš© ë³€ìˆ˜ ê²€ì‚¬ë¥¼ ì¶”ê°€í•œë‹¤.</p>
<pre><code class="language-fsharp">/// Analyze document and return all diagnostics
/// Returns list of diagnostics (empty if no errors)
let analyze (uri: string) (source: string) : Diagnostic list =
    match parseFunLang source uri with
    | Error parseDiag -&gt;
        // Parse error - stop here, don't try to typecheck
        [parseDiag]
    | Ok ast -&gt;
        // Parse succeeded, now typecheck
        let typeDiags =
            match typecheckAst ast with
            | Ok _ -&gt; []
            | Error typeDiag -&gt; [typeDiag]

        // Check for unused variables
        let unusedVars = findUnusedVariables ast
        let unusedDiags =
            unusedVars
            |&gt; List.map (fun (name, span) -&gt;
                {
                    Range = findIdentifierRange source name span
                    Severity = Some DiagnosticSeverity.Warning
                    Code = Some (U2.C2 "unused-variable")
                    CodeDescription = None
                    Source = Some "funlang"
                    Message = sprintf "Unused variable '%s'" name
                    Tags = Some [| DiagnosticTag.Unnecessary |]
                    RelatedInformation = None
                    Data = None
                })

        // Combine type errors and unused variable warnings
        typeDiags @ unusedDiags
</code></pre>
<p><strong>DiagnosticTag.Unnecessaryì˜ íš¨ê³¼:</strong></p>
<ul>
<li>VS Codeì—ì„œ ë¯¸ì‚¬ìš© ë³€ìˆ˜ë¥¼ <strong>íë¦¬ê²Œ(faded)</strong> í‘œì‹œ</li>
<li>ë…¸ë€ ë°‘ì¤„ë¡œ ê²½ê³  í‘œì‹œ</li>
<li>ì „êµ¬ ì•„ì´ì½˜(ğŸ’¡) í‘œì‹œ</li>
</ul>
<hr>
<h2 id="quickfix-codeaction-ìƒì„±"><a class="header" href="#quickfix-codeaction-ìƒì„±">QuickFix CodeAction ìƒì„±</a></h2>
<p>ë¯¸ì‚¬ìš© ë³€ìˆ˜ ì§„ë‹¨ì— ëŒ€í•œ ìë™ ìˆ˜ì • ì•¡ì…˜ì„ ìƒì„±í•œë‹¤.</p>
<h3 id="createprefixunderscoreaction-í•¨ìˆ˜"><a class="header" href="#createprefixunderscoreaction-í•¨ìˆ˜">createPrefixUnderscoreAction í•¨ìˆ˜</a></h3>
<pre><code class="language-fsharp">// CodeActions.fs
module LangLSP.Server.CodeActions

open Ionide.LanguageServerProtocol.Types
open LangLSP.Server.Protocol

/// Create "Prefix with underscore" quickfix action for unused variables
let createPrefixUnderscoreAction (diagnostic: Diagnostic) (uri: string) : CodeAction =
    // Extract variable name from message "Unused variable 'x'"
    let message = diagnostic.Message
    let varName =
        if message.Contains("'") then
            let startIdx = message.IndexOf("'") + 1
            let endIdx = message.LastIndexOf("'")
            if endIdx &gt; startIdx then
                message.Substring(startIdx, endIdx - startIdx)
            else
                "variable"
        else
            "variable"

    let newName = "_" + varName
    let edit = {
        Range = diagnostic.Range
        NewText = newName
    }

    let workspaceEdit = createWorkspaceEdit uri [| edit |]

    {
        Title = sprintf "Prefix '%s' with underscore" varName
        Kind = Some "quickfix"
        Diagnostics = Some [| diagnostic |]
        Edit = Some workspaceEdit
        Command = None
        IsPreferred = Some true
        Disabled = None
        Data = None
    }
</code></pre>
<p><strong>êµ¬í˜„ ì„¸ë¶€ì‚¬í•­:</strong></p>
<ol>
<li><strong>ë³€ìˆ˜ëª… ì¶”ì¶œ</strong>: ì§„ë‹¨ ë©”ì‹œì§€ â€œUnused variable â€˜xâ€™â€œì—ì„œ â€˜xâ€™ íŒŒì‹±</li>
<li><strong>ìƒˆ ì´ë¦„ ìƒì„±</strong>: <code>_x</code> í˜•íƒœë¡œ ë³€ê²½</li>
<li><strong>TextEdit ìƒì„±</strong>: ì§„ë‹¨ Rangeë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ëª…ë§Œ êµì²´</li>
<li><strong>WorkspaceEdit ìƒì„±</strong>: <code>createWorkspaceEdit</code> í—¬í¼ ì‚¬ìš©</li>
<li><strong>IsPreferred = true</strong>: VS Codeì—ì„œ ê¸°ë³¸ ì„ íƒìœ¼ë¡œ í‘œì‹œ</li>
</ol>
<h3 id="createworkspaceedit-í—¬í¼"><a class="header" href="#createworkspaceedit-í—¬í¼">createWorkspaceEdit í—¬í¼</a></h3>
<pre><code class="language-fsharp">// Protocol.fs
/// Create WorkspaceEdit from URI and list of TextEdits
let createWorkspaceEdit (uri: string) (edits: TextEdit[]) : WorkspaceEdit =
    {
        Changes = Some (Map [ (uri, edits) ])
        DocumentChanges = None
        ChangeAnnotations = None
    }
</code></pre>
<p><strong>ê°„ë‹¨í•œ í—¬í¼ë¡œ ì½”ë“œ ê°€ë…ì„± í–¥ìƒ.</strong></p>
<h3 id="createtypeinfoaction-í•¨ìˆ˜"><a class="header" href="#createtypeinfoaction-í•¨ìˆ˜">createTypeInfoAction í•¨ìˆ˜</a></h3>
<p>íƒ€ì… ì˜¤ë¥˜ì— ëŒ€í•œ <strong>ì •ë³´ì„± ì•¡ì…˜</strong>(í¸ì§‘ ì—†ìŒ)ë„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.</p>
<pre><code class="language-fsharp">/// Create informational action showing expected type for type errors
let createTypeInfoAction (diagnostic: Diagnostic) : CodeAction =
    // Extract expected type from diagnostic message if present
    // Example: "Type mismatch: expected Int, got Bool"
    let message = diagnostic.Message
    let typeInfo =
        if message.Contains("expected") then
            let startIdx = message.IndexOf("expected")
            message.Substring(startIdx)
        else
            "Type mismatch - see diagnostic message"

    {
        Title = sprintf "Info: %s" typeInfo
        Kind = Some "quickfix"
        Diagnostics = Some [| diagnostic |]
        Edit = None  // Informational only, no automatic fix
        Command = None
        IsPreferred = None
        Disabled = None
        Data = None
    }
</code></pre>
<p><strong>Edit = None</strong>: ì½”ë“œ ë³€ê²½ ì—†ì´ ì •ë³´ë§Œ ì œê³µí•˜ëŠ” ì•¡ì…˜.</p>
<hr>
<h2 id="handlecodeaction-êµ¬í˜„"><a class="header" href="#handlecodeaction-êµ¬í˜„">handleCodeAction êµ¬í˜„</a></h2>
<p><code>textDocument/codeAction</code> ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” í•¸ë“¤ëŸ¬ì´ë‹¤.</p>
<h3 id="ì „ì²´-êµ¬í˜„"><a class="header" href="#ì „ì²´-êµ¬í˜„">ì „ì²´ êµ¬í˜„</a></h3>
<pre><code class="language-fsharp">/// Handle textDocument/codeAction request
/// Returns code actions (quickfixes) for diagnostics at cursor position
let handleCodeAction (p: CodeActionParams) : Async&lt;CodeAction[] option&gt; =
    async {
        let uri = p.TextDocument.Uri
        let diagnostics = p.Context.Diagnostics

        if Array.isEmpty diagnostics then
            return None
        else
            let actions = ResizeArray&lt;CodeAction&gt;()

            for diag in diagnostics do
                // Check diagnostic code/message to determine action type
                match diag.Code with
                | Some (U2.C2 "unused-variable") -&gt;
                    // ACTION-01: Prefix with underscore
                    let action = createPrefixUnderscoreAction diag uri
                    actions.Add(action)

                | _ -&gt;
                    // Check if it's a type error (severity Error)
                    if diag.Severity = Some DiagnosticSeverity.Error then
                        // ACTION-02: Informational type hint
                        let action = createTypeInfoAction diag
                        actions.Add(action)

            if actions.Count &gt; 0 then
                return Some (actions.ToArray())
            else
                return None
    }
</code></pre>
<p><strong>ì²˜ë¦¬ íë¦„:</strong></p>
<ol>
<li><strong>ì§„ë‹¨ í™•ì¸</strong>: <code>context.diagnostics</code>ê°€ ë¹„ì–´ìˆìœ¼ë©´ None ë°˜í™˜</li>
<li><strong>ì§„ë‹¨ë³„ ì•¡ì…˜ ìƒì„±</strong>:
<ul>
<li>ì§„ë‹¨ ì½”ë“œê°€ <code>"unused-variable"</code> â†’ Prefix ì•¡ì…˜</li>
<li>íƒ€ì… ì—ëŸ¬ â†’ Type info ì•¡ì…˜</li>
</ul>
</li>
<li><strong>ì•¡ì…˜ ë°°ì—´ ë°˜í™˜</strong>: ì—¬ëŸ¬ ì§„ë‹¨ì— ëŒ€í•œ ì•¡ì…˜ ëª¨ë‘ ë°˜í™˜</li>
</ol>
<h3 id="u2-íƒ€ì…-ì²˜ë¦¬"><a class="header" href="#u2-íƒ€ì…-ì²˜ë¦¬">U2 íƒ€ì… ì²˜ë¦¬</a></h3>
<p>Ionide LSP ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” <code>Code</code> í•„ë“œë¥¼ <code>U2&lt;int, string&gt;</code> íƒ€ì…ìœ¼ë¡œ ì •ì˜í•œë‹¤.</p>
<pre><code class="language-fsharp">// Ionide íƒ€ì… ì •ì˜
type Diagnostic = {
    Code: U2&lt;int, string&gt; option
    // ...
}
</code></pre>
<p><strong>íŒ¨í„´ ë§¤ì¹­:</strong></p>
<ul>
<li><code>U2.C1 n</code>: int ê°’ (ì˜ˆ: <code>123</code>)</li>
<li><code>U2.C2 s</code>: string ê°’ (ì˜ˆ: <code>"unused-variable"</code>)</li>
</ul>
<p>ìš°ë¦¬ëŠ” string ì½”ë“œë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ <code>U2.C2</code> ì¼€ì´ìŠ¤ë¥¼ ë§¤ì¹­í•œë‹¤.</p>
<hr>
<h2 id="serverfs-í†µí•©-3"><a class="header" href="#serverfs-í†µí•©-3">Server.fs í†µí•©</a></h2>
<p>LSP ì„œë²„ì— Code Actions í•¸ë“¤ëŸ¬ë¥¼ ë“±ë¡í•œë‹¤.</p>
<h3 id="ì„œë²„-ì´ˆê¸°í™”-ì‹œ-capability-ì„ ì–¸"><a class="header" href="#ì„œë²„-ì´ˆê¸°í™”-ì‹œ-capability-ì„ ì–¸">ì„œë²„ ì´ˆê¸°í™” ì‹œ Capability ì„ ì–¸</a></h3>
<pre><code class="language-fsharp">// Server.fs - initialize í•¨ìˆ˜
let initialize (p: InitializeParams) : Async&lt;InitializeResult&gt; =
    async {
        Log.Information("Client initialized: {ClientInfo}", p.ClientInfo)

        let result: InitializeResult = {
            Capabilities = {
                // ê¸°ì¡´ capabilities
                TextDocumentSync = Some textDocSync
                HoverProvider = Some (U2.C1 true)
                DefinitionProvider = Some (U2.C1 true)
                CompletionProvider = Some completionOptions
                ReferencesProvider = Some (U2.C1 true)
                RenameProvider = Some (U2.C2 renameOptions)

                // Code Actions ì¶”ê°€
                CodeActionProvider = Some (U2.C2 {
                    CodeActionKinds = Some [| "quickfix" |]
                    ResolveProvider = Some false
                })

                // ê¸°íƒ€ capabilities
                // ...
            }
            ServerInfo = Some serverInfo
        }
        return result
    }
</code></pre>
<p><strong>CodeActionProvider ì„¤ì •:</strong></p>
<ul>
<li><strong>CodeActionKinds</strong>: ì§€ì›í•˜ëŠ” ì•¡ì…˜ ì¢…ë¥˜ ì„ ì–¸ (<code>["quickfix"]</code>)</li>
<li><strong>ResolveProvider = false</strong>: ëª¨ë“  ì •ë³´ë¥¼ ì¦‰ì‹œ ë°˜í™˜ (resolve ë‹¨ê³„ ì—†ìŒ)</li>
</ul>
<h3 id="ìš”ì²­-í•¸ë“¤ëŸ¬-ë“±ë¡"><a class="header" href="#ìš”ì²­-í•¸ë“¤ëŸ¬-ë“±ë¡">ìš”ì²­ í•¸ë“¤ëŸ¬ ë“±ë¡</a></h3>
<pre><code class="language-fsharp">// Server.fs - main í•¨ìˆ˜
[&lt;EntryPoint&gt;]
let main argv =
    // Serilog ì„¤ì • ë° LSP ì„œë²„ ìƒì„± (ìƒëµ)

    // í•¸ë“¤ëŸ¬ ë“±ë¡
    server.RegisterHandler(
        "textDocument/codeAction",
        Func&lt;CodeActionParams, CancellationToken, Task&lt;CodeAction[] option&gt;&gt;(fun p ct -&gt;
            CodeActions.handleCodeAction p |&gt; Async.StartAsTask
        ),
        jsonOptions
    )

    // ì„œë²„ ì‹œì‘
    server.StartAsync().Wait()
    0
</code></pre>
<p><strong>ì¤‘ìš”:</strong> <code>CodeAction[] option</code> ë°˜í™˜ íƒ€ì… ìœ ì§€ (Noneì´ë©´ ì•¡ì…˜ ì—†ìŒ).</p>
<hr>
<h2 id="í…ŒìŠ¤íŠ¸-ì‘ì„±-7"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‘ì„±-7">í…ŒìŠ¤íŠ¸ ì‘ì„±</a></h2>
<p>Expectoë¥¼ ì‚¬ìš©í•˜ì—¬ Code Actions ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•œë‹¤.</p>
<h3 id="ê¸°ë³¸-í…ŒìŠ¤íŠ¸-êµ¬ì¡°-3"><a class="header" href="#ê¸°ë³¸-í…ŒìŠ¤íŠ¸-êµ¬ì¡°-3">ê¸°ë³¸ í…ŒìŠ¤íŠ¸ êµ¬ì¡°</a></h3>
<pre><code class="language-fsharp">// CodeActionsTests.fs
module LangLSP.Tests.CodeActionsTests

open Expecto
open Ionide.LanguageServerProtocol.Types
open LangLSP.Server.CodeActions
open LangLSP.Server.Diagnostics
open LangLSP.Server.DocumentSync

[&lt;Tests&gt;]
let codeActionsTests =
    testList "CodeActions" [
        // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë“¤
    ]
</code></pre>
<h3 id="test-case-1-ë¯¸ì‚¬ìš©-ë³€ìˆ˜-ì•¡ì…˜"><a class="header" href="#test-case-1-ë¯¸ì‚¬ìš©-ë³€ìˆ˜-ì•¡ì…˜">Test Case 1: ë¯¸ì‚¬ìš© ë³€ìˆ˜ ì•¡ì…˜</a></h3>
<pre><code class="language-fsharp">testCase "unused variable returns prefix underscore action" &lt;| fun _ -&gt;
    let uri = "file:///test.fun"
    let source = "let x = 1 in 2"  // 'x' is unused

    // Create diagnostic (normally from Diagnostics module)
    let diagnostic = {
        Range = { Start = { Line = 0u; Character = 4u }
                  End = { Line = 0u; Character = 5u } }
        Severity = Some DiagnosticSeverity.Warning
        Code = Some (U2.C2 "unused-variable")
        Source = Some "funlang"
        Message = "Unused variable 'x'"
        Tags = Some [| DiagnosticTag.Unnecessary |]
        CodeDescription = None
        RelatedInformation = None
        Data = None
    }

    let params = {
        TextDocument = { Uri = uri }
        Range = diagnostic.Range
        Context = {
            Diagnostics = [| diagnostic |]
            Only = None
            TriggerKind = None
        }
    }

    let result = handleCodeAction params |&gt; Async.RunSynchronously

    match result with
    | None -&gt;
        failtest "Expected code action, got None"
    | Some actions -&gt;
        Expect.equal actions.Length 1 "Should have 1 action"
        let action = actions.[0]
        Expect.equal action.Kind (Some "quickfix") "Should be quickfix"
        Expect.stringContains action.Title "underscore" "Title should mention underscore"
        Expect.isSome action.Edit "Should have edit"

        match action.Edit with
        | Some edit -&gt;
            match edit.Changes with
            | Some changes -&gt;
                let edits = changes.[uri]
                Expect.equal edits.Length 1 "Should have 1 edit"
                Expect.equal edits.[0].NewText "_x" "Should prefix with underscore"
            | None -&gt; failtest "Expected changes in edit"
        | None -&gt; failtest "Expected edit"
</code></pre>
<h3 id="test-case-2-ì§„ë‹¨-ì—†ìœ¼ë©´-ì•¡ì…˜-ì—†ìŒ"><a class="header" href="#test-case-2-ì§„ë‹¨-ì—†ìœ¼ë©´-ì•¡ì…˜-ì—†ìŒ">Test Case 2: ì§„ë‹¨ ì—†ìœ¼ë©´ ì•¡ì…˜ ì—†ìŒ</a></h3>
<pre><code class="language-fsharp">testCase "no diagnostics returns None" &lt;| fun _ -&gt;
    let uri = "file:///test.fun"
    let params = {
        TextDocument = { Uri = uri }
        Range = { Start = { Line = 0u; Character = 0u }
                  End = { Line = 0u; Character = 1u } }
        Context = {
            Diagnostics = [||]  // Empty
            Only = None
            TriggerKind = None
        }
    }

    let result = handleCodeAction params |&gt; Async.RunSynchronously

    Expect.isNone result "No diagnostics should return None"
</code></pre>
<h3 id="test-case-3-íƒ€ì…-ì˜¤ë¥˜-ì •ë³´-ì•¡ì…˜"><a class="header" href="#test-case-3-íƒ€ì…-ì˜¤ë¥˜-ì •ë³´-ì•¡ì…˜">Test Case 3: íƒ€ì… ì˜¤ë¥˜ ì •ë³´ ì•¡ì…˜</a></h3>
<pre><code class="language-fsharp">testCase "type error returns info action" &lt;| fun _ -&gt;
    let uri = "file:///test.fun"
    let diagnostic = {
        Range = { Start = { Line = 0u; Character = 4u }
                  End = { Line = 0u; Character = 8u } }
        Severity = Some DiagnosticSeverity.Error
        Code = None
        Source = Some "funlang"
        Message = "Type mismatch: expected Int, got Bool"
        Tags = None
        CodeDescription = None
        RelatedInformation = None
        Data = None
    }

    let params = {
        TextDocument = { Uri = uri }
        Range = diagnostic.Range
        Context = {
            Diagnostics = [| diagnostic |]
            Only = None
            TriggerKind = None
        }
    }

    let result = handleCodeAction params |&gt; Async.RunSynchronously

    match result with
    | None -&gt;
        failtest "Expected code action, got None"
    | Some actions -&gt;
        Expect.isNonEmpty actions "Should have actions"
        let action = actions.[0]
        Expect.equal action.Kind (Some "quickfix") "Should be quickfix"
        Expect.stringContains action.Title "expected" "Should show expected type"
        Expect.isNone action.Edit "Info action should not have edit"
</code></pre>
<h3 id="í†µí•©-í…ŒìŠ¤íŠ¸-diagnostics--codeactions-íë¦„"><a class="header" href="#í†µí•©-í…ŒìŠ¤íŠ¸-diagnostics--codeactions-íë¦„">í†µí•© í…ŒìŠ¤íŠ¸: Diagnostics â†’ CodeActions íë¦„</a></h3>
<pre><code class="language-fsharp">testCase "full flow: analyze produces diagnostic, code action fixes it" &lt;| fun _ -&gt;
    let uri = "file:///test.fun"
    let source = "let unused = 42 in 100"

    // 1. Analyze to get diagnostics
    let diagnostics = Diagnostics.analyze uri source
    Expect.isNonEmpty diagnostics "Should have unused variable diagnostic"

    let unusedDiag = diagnostics |&gt; List.find (fun d -&gt;
        d.Code = Some (U2.C2 "unused-variable"))

    // 2. Request code actions for that diagnostic
    let params = {
        TextDocument = { Uri = uri }
        Range = unusedDiag.Range
        Context = {
            Diagnostics = [| unusedDiag |]
            Only = None
            TriggerKind = None
        }
    }

    let result = handleCodeAction params |&gt; Async.RunSynchronously

    // 3. Verify action exists and is correct
    match result with
    | Some actions -&gt;
        Expect.isNonEmpty actions "Should have code action"
        let action = actions.[0]
        Expect.equal action.Title "Prefix 'unused' with underscore" "Correct title"

        match action.Edit with
        | Some edit -&gt;
            match edit.Changes with
            | Some changes -&gt;
                let edits = changes.[uri]
                Expect.equal edits.[0].NewText "_unused" "Should fix variable name"
            | None -&gt; failtest "Expected changes"
        | None -&gt; failtest "Expected edit"
    | None -&gt;
        failtest "Expected code action"
</code></pre>
<h3 id="í…ŒìŠ¤íŠ¸-ì‹¤í–‰-7"><a class="header" href="#í…ŒìŠ¤íŠ¸-ì‹¤í–‰-7">í…ŒìŠ¤íŠ¸ ì‹¤í–‰</a></h3>
<pre><code class="language-bash">dotnet run --project src/LangLSP.Tests

# ì¶œë ¥:
# [CodeActions] unused variable returns prefix underscore action - Passed
# [CodeActions] no diagnostics returns None - Passed
# [CodeActions] type error returns info action - Passed
# [CodeActions] full flow: analyze produces diagnostic, code action fixes it - Passed
</code></pre>
<hr>
<h2 id="í™•ì¥-ê°€ëŠ¥ì„±"><a class="header" href="#í™•ì¥-ê°€ëŠ¥ì„±">í™•ì¥ ê°€ëŠ¥ì„±</a></h2>
<p>Code Actions ì‹œìŠ¤í…œì€ ë§¤ìš° í™•ì¥ ê°€ëŠ¥í•˜ë‹¤. ë‹¤ìŒê³¼ ê°™ì€ ì•¡ì…˜ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤:</p>
<h3 id="1-refactoring-actions"><a class="header" href="#1-refactoring-actions">1. Refactoring Actions</a></h3>
<pre><code class="language-fsharp">/// Extract expression to variable
let createExtractVariableAction (range: Range) (uri: string) : CodeAction =
    {
        Title = "Extract to variable"
        Kind = Some "refactor.extract"
        Diagnostics = None
        Edit = Some (createExtractionEdit range uri)
        Command = None
        IsPreferred = None
        Disabled = None
        Data = None
    }
</code></pre>
<h3 id="2-importmodule-actions"><a class="header" href="#2-importmodule-actions">2. Import/Module Actions</a></h3>
<pre><code class="language-fsharp">/// Add missing module import
let createAddImportAction (moduleName: string) (uri: string) : CodeAction =
    {
        Title = sprintf "Import module '%s'" moduleName
        Kind = Some "quickfix"
        Diagnostics = None
        Edit = Some (createImportEdit moduleName uri)
        Command = None
        IsPreferred = Some true
        Disabled = None
        Data = None
    }
</code></pre>
<h3 id="3-type-annotation-actions"><a class="header" href="#3-type-annotation-actions">3. Type Annotation Actions</a></h3>
<pre><code class="language-fsharp">/// Add explicit type annotation
let createAddTypeAnnotationAction (varName: string) (inferredType: string) (range: Range) (uri: string) : CodeAction =
    let newText = sprintf "%s : %s" varName inferredType
    {
        Title = sprintf "Add type annotation ': %s'" inferredType
        Kind = Some "refactor.rewrite"
        Diagnostics = None
        Edit = Some (createWorkspaceEdit uri [| { Range = range; NewText = newText } |])
        Command = None
        IsPreferred = None
        Disabled = None
        Data = None
    }
</code></pre>
<h3 id="4-source-level-actions"><a class="header" href="#4-source-level-actions">4. Source-level Actions</a></h3>
<pre><code class="language-fsharp">/// Organize imports/declarations
let createOrganizeImportsAction (uri: string) : CodeAction =
    {
        Title = "Organize imports"
        Kind = Some "source.organizeImports"
        Diagnostics = None
        Edit = None
        Command = Some {
            Title = "Organize"
            Command = "funlang.organizeImports"
            Arguments = Some [| uri |]
        }
        IsPreferred = None
        Disabled = None
        Data = None
    }
</code></pre>
<h3 id="5-command-based-actions"><a class="header" href="#5-command-based-actions">5. Command-based Actions</a></h3>
<p>Edit ëŒ€ì‹  Commandë¥¼ ì‚¬ìš©í•˜ë©´ ë³µì¡í•œ ë‹¤ë‹¨ê³„ ì‘ì—…ì´ ê°€ëŠ¥í•˜ë‹¤.</p>
<pre><code class="language-fsharp">/// Run auto-formatter
let createFormatAction (uri: string) : CodeAction =
    {
        Title = "Format document"
        Kind = Some "source"
        Diagnostics = None
        Edit = None
        Command = Some {
            Title = "Format"
            Command = "funlang.formatDocument"
            Arguments = Some [| uri |]
        }
        IsPreferred = None
        Disabled = None
        Data = None
    }
</code></pre>
<hr>
<h2 id="ì£¼ì˜ì‚¬í•­"><a class="header" href="#ì£¼ì˜ì‚¬í•­">ì£¼ì˜ì‚¬í•­</a></h2>
<h3 id="1-range-ì •í™•ì„±"><a class="header" href="#1-range-ì •í™•ì„±">1. Range ì •í™•ì„±</a></h3>
<p><strong>ë¬¸ì œ:</strong> TextEditì˜ Rangeê°€ ë¶€ì •í™•í•˜ë©´ ì˜ëª»ëœ ìœ„ì¹˜ë¥¼ ìˆ˜ì •í•œë‹¤. AST Spanì€ ì „ì²´ í‘œí˜„ì‹ ë²”ìœ„(ì˜ˆ: <code>let x = 42 in x + 1</code> ì „ì²´)ì´ë¯€ë¡œ, ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë©´ íŒŒì¼ ì „ì²´ì— ë…¸ë€ ë°‘ì¤„ì´ ê·¸ì–´ì§ˆ ìˆ˜ ìˆë‹¤.</p>
<pre><code class="language-fsharp">// âŒ ì˜ëª»ëœ ì˜ˆ: ì „ì²´ Let í‘œí˜„ì‹ ë²”ìœ„ ì‚¬ìš©
Range = spanToLspRange span  // "let x = 1 in x" ì „ì²´ì— ë°‘ì¤„!

// âœ… ì˜¬ë°”ë¥¸ ì˜ˆ: ì‹ë³„ì ì´ë¦„ë§Œ ì •í™•íˆ íƒ€ê²ŸíŒ…
Range = findIdentifierRange source name span  // ë³€ìˆ˜ëª… "x"ë§Œ ë°‘ì¤„
</code></pre>
<p><strong>í•´ê²°:</strong> <code>Definition.findIdentifierRange</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ Span ë‚´ì—ì„œ ì‹ë³„ì ì´ë¦„ì˜ ì •í™•í•œ ìœ„ì¹˜ë¥¼ ì°¾ëŠ”ë‹¤. Diagnosticsì—ì„œ ì •í™•í•œ Rangeë¥¼ ì„¤ì •í•˜ë©´, CodeActionsì˜ TextEditë„ ìë™ìœ¼ë¡œ ì •í™•í•´ì§„ë‹¤.</p>
<h3 id="2-workspaceedit-vs-command"><a class="header" href="#2-workspaceedit-vs-command">2. WorkspaceEdit vs Command</a></h3>
<p><strong>WorkspaceEdit</strong>: ë‹¨ìˆœ í…ìŠ¤íŠ¸ êµì²´ì— ì í•©</p>
<pre><code class="language-fsharp">{ Edit = Some workspaceEdit; Command = None }
</code></pre>
<p><strong>Command</strong>: ë³µì¡í•œ ë¡œì§ í•„ìš” ì‹œ ì‚¬ìš©</p>
<pre><code class="language-fsharp">{ Edit = None; Command = Some { Command = "funlang.customAction"; Arguments = ... } }
</code></pre>
<p><strong>ì£¼ì˜:</strong> Command ì‚¬ìš© ì‹œ í´ë¼ì´ì–¸íŠ¸ê°€ í•´ë‹¹ ëª…ë ¹ì„ ë“±ë¡í•´ì•¼ í•œë‹¤.</p>
<h3 id="3-ispreferred-ì‚¬ìš©"><a class="header" href="#3-ispreferred-ì‚¬ìš©">3. IsPreferred ì‚¬ìš©</a></h3>
<pre><code class="language-fsharp">{
    Title = "Prefix with underscore"
    IsPreferred = Some true  // VS Codeì—ì„œ ê¸°ë³¸ ì„ íƒ
    // ...
}
</code></pre>
<p>ì—¬ëŸ¬ ì•¡ì…˜ì´ ìˆì„ ë•Œ, ê°€ì¥ ê¶Œì¥ë˜ëŠ” ì•¡ì…˜ì—ë§Œ <code>IsPreferred = true</code> ì„¤ì •.</p>
<h3 id="4-multiple-diagnostics"><a class="header" href="#4-multiple-diagnostics">4. Multiple Diagnostics</a></h3>
<p>ê°™ì€ ìœ„ì¹˜ì— ì—¬ëŸ¬ ì§„ë‹¨ì´ ìˆì„ ìˆ˜ ìˆë‹¤.</p>
<pre><code class="language-fsharp">let handleCodeAction (p: CodeActionParams) : Async&lt;CodeAction[] option&gt; =
    async {
        let actions = ResizeArray&lt;CodeAction&gt;()

        for diag in p.Context.Diagnostics do
            // ê° ì§„ë‹¨ë³„ë¡œ ì•¡ì…˜ ìƒì„±
            match diag.Code with
            | Some code -&gt; actions.Add(createActionForCode code diag p.TextDocument.Uri)
            | None -&gt; ()

        if actions.Count &gt; 0 then
            return Some (actions.ToArray())
        else
            return None
    }
</code></pre>
<h3 id="5-ì§„ë‹¨-ì½”ë“œ-ì¼ê´€ì„±"><a class="header" href="#5-ì§„ë‹¨-ì½”ë“œ-ì¼ê´€ì„±">5. ì§„ë‹¨ ì½”ë“œ ì¼ê´€ì„±</a></h3>
<p>Diagnosticsì™€ CodeActionsì—ì„œ ê°™ì€ ì½”ë“œë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.</p>
<pre><code class="language-fsharp">// Diagnostics.fs
Code = Some (U2.C2 "unused-variable")

// CodeActions.fs
match diag.Code with
| Some (U2.C2 "unused-variable") -&gt; // ê°™ì€ ë¬¸ìì—´!
</code></pre>
<p><strong>ê¶Œì¥:</strong> ì½”ë“œ ìƒìˆ˜ë¥¼ ê³µìœ  ëª¨ë“ˆì— ì •ì˜</p>
<pre><code class="language-fsharp">// DiagnosticCodes.fs
module LangLSP.Server.DiagnosticCodes

[&lt;Literal&gt;]
let UnusedVariable = "unused-variable"

[&lt;Literal&gt;]
let TypeMismatch = "type-mismatch"
</code></pre>
<h3 id="6-async-ì²˜ë¦¬"><a class="header" href="#6-async-ì²˜ë¦¬">6. Async ì²˜ë¦¬</a></h3>
<pre><code class="language-fsharp">let handleCodeAction (p: CodeActionParams) : Async&lt;CodeAction[] option&gt; =
    async {
        // ë¹„ë™ê¸° ì‘ì—… (ì˜ˆ: íŒŒì¼ ì½ê¸°, AST íŒŒì‹±)
        // ...
    }
</code></pre>
<p>í˜„ì¬ëŠ” ë™ê¸°ì ì´ì§€ë§Œ, ë¯¸ë˜ í™•ì¥ì„±ì„ ìœ„í•´ Async ìœ ì§€.</p>
<h3 id="7-none-vs-some-"><a class="header" href="#7-none-vs-some-">7. None vs Some [||]</a></h3>
<pre><code class="language-fsharp">// âœ… ì•¡ì…˜ ì—†ìŒ
return None

// âŒ ë¹ˆ ë°°ì—´ ë°˜í™˜ (ë¹„íš¨ìœ¨ì , ì¼ë¶€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë¬¸ì œ ê°€ëŠ¥)
return Some [||]
</code></pre>
<p>LSP ìŠ¤í™ì—ì„œëŠ” ì•¡ì…˜ì´ ì—†ìœ¼ë©´ <code>null</code> (F#ì—ì„œ None) ë°˜í™˜ ê¶Œì¥.</p>
<hr>
<h2 id="ë‹¤ìŒ-ë‹¨ê³„-10"><a class="header" href="#ë‹¤ìŒ-ë‹¨ê³„-10">ë‹¤ìŒ ë‹¨ê³„</a></h2>
<p>Code Actions êµ¬í˜„ì´ ì™„ë£Œë˜ì—ˆë‹¤! ì´ì œ ì‚¬ìš©ìëŠ”:</p>
<ol>
<li><strong>ìë™ ìˆ˜ì •</strong>: ë¯¸ì‚¬ìš© ë³€ìˆ˜ë¥¼ í´ë¦­ í•œ ë²ˆìœ¼ë¡œ ìˆ˜ì •</li>
<li><strong>íƒ€ì… íŒíŠ¸</strong>: íƒ€ì… ì˜¤ë¥˜ì— ëŒ€í•œ ìƒì„¸ ì •ë³´ í™•ì¸</li>
<li><strong>ìƒì‚°ì„± í–¥ìƒ</strong>: ë°˜ë³µì ì¸ ìˆ˜ì • ì‘ì—… ìë™í™”</li>
</ol>
<h3 id="phase-4-ì™„ë£Œ"><a class="header" href="#phase-4-ì™„ë£Œ">Phase 4 ì™„ë£Œ!</a></h3>
<p><strong>êµ¬í˜„í•œ ê³ ê¸‰ ê¸°ëŠ¥:</strong></p>
<ul>
<li>âœ… Find References (ì°¸ì¡° ì°¾ê¸°)</li>
<li>âœ… Rename (ì´ë¦„ ë³€ê²½)</li>
<li>âœ… Code Actions (ì½”ë“œ ìˆ˜ì •)</li>
<li>âœ… Unused Variable Detection (ë¯¸ì‚¬ìš© ë³€ìˆ˜ ê°ì§€)</li>
<li>âœ… DiagnosticTag.Unnecessary (íë¦¼ ì²˜ë¦¬)</li>
</ul>
<h3 id="ì¶”ê°€-ê°œì„ -ì•„ì´ë””ì–´"><a class="header" href="#ì¶”ê°€-ê°œì„ -ì•„ì´ë””ì–´">ì¶”ê°€ ê°œì„  ì•„ì´ë””ì–´</a></h3>
<ol>
<li>
<p><strong>ë” ë§ì€ QuickFix</strong>:</p>
<ul>
<li>íƒ€ì… ë¶ˆì¼ì¹˜ â†’ íƒ€ì… ìºìŠ¤íŒ… ì¶”ê°€</li>
<li>ë¯¸ì •ì˜ ë³€ìˆ˜ â†’ let ë°”ì¸ë”© ì œì•ˆ</li>
<li>Import ëˆ„ë½ â†’ ìë™ import ì¶”ê°€</li>
</ul>
</li>
<li>
<p><strong>Refactoring Actions</strong>:</p>
<ul>
<li>Extract Function (í•¨ìˆ˜ ì¶”ì¶œ)</li>
<li>Inline Variable (ë³€ìˆ˜ ì¸ë¼ì¸)</li>
<li>Rename All Occurrences (ëª¨ë“  ì‚¬ìš©ì²˜ ì´ë¦„ ë³€ê²½)</li>
</ul>
</li>
<li>
<p><strong>Source Actions</strong>:</p>
<ul>
<li>Format Document (ë¬¸ì„œ í¬ë§·íŒ…)</li>
<li>Remove Unused Imports (ë¯¸ì‚¬ìš© import ì œê±°)</li>
<li>Sort Definitions (ì •ì˜ ì •ë ¬)</li>
</ul>
</li>
<li>
<p><strong>CodeAction Resolve</strong>:</p>
<ul>
<li>ë³µì¡í•œ ì•¡ì…˜ì€ ë‘ ë‹¨ê³„ë¡œ ì²˜ë¦¬ (ëª©ë¡ â†’ resolve â†’ edit)</li>
<li>ì„±ëŠ¥ ìµœì í™” (ë§ì€ ì•¡ì…˜ì´ ìˆì„ ë•Œ)</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ì°¸ê³ -ìë£Œ-10"><a class="header" href="#ì°¸ê³ -ìë£Œ-10">ì°¸ê³  ìë£Œ</a></h2>
<ul>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocument_codeAction">LSP Specification - Code Action</a></li>
<li><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#workspaceEdit">LSP Specification - Workspace Edit</a></li>
<li><a href="https://code.visualstudio.com/api/language-extensions/programmatic-language-features#provide-code-actions">VS Code Code Actions Guide</a></li>
<li><a href="https://github.com/ionide/LanguageServerProtocol/blob/main/src/LanguageServerProtocol/Types.fs">Ionide.LanguageServerProtocol Types</a></li>
</ul>
<hr>
<p><strong>â†’ ë‹¤ìŒ: Phase 5 - Documentation</strong> - í”„ë¡œì íŠ¸ ë¬¸ì„œí™” ë° ë°°í¬</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="vs-code-extension-íŒ¨í‚¤ì§•"><a class="header" href="#vs-code-extension-íŒ¨í‚¤ì§•">VS Code Extension íŒ¨í‚¤ì§•</a></h1>
<p>ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ëŠ” ì™„ì „í•œ Language Serverë¥¼ ë§Œë“¤ì–´ì™”ë‹¤. ì§„ë‹¨(Diagnostics), í˜¸ë²„(Hover), ìë™ ì™„ì„±(Completion), ì •ì˜ë¡œ ì´ë™(Go to Definition), ì°¸ì¡° ì°¾ê¸°(Find References), ì´ë¦„ ë°”ê¾¸ê¸°(Rename), ê·¸ë¦¬ê³  ì½”ë“œ ì•¡ì…˜(Code Actions)ê¹Œì§€ ëª¨ë‘ êµ¬í˜„í–ˆë‹¤.</p>
<p>ì´ì œ ë§ˆì§€ë§‰ ë‹¨ê³„ì´ë‹¤. ì´ ê°•ë ¥í•œ Language Serverë¥¼ ëˆ„êµ¬ë‚˜ ì„¤ì¹˜í•  ìˆ˜ ìˆëŠ” VS Code Extensionìœ¼ë¡œ íŒ¨í‚¤ì§•í•˜ëŠ” ë°©ë²•ì„ ë°°ìš´ë‹¤. ì´ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” TextMate ë¬¸ë²•ì„ ì‚¬ìš©í•œ êµ¬ë¬¸ ê°•ì¡°(Syntax Highlighting), ì–¸ì–´ ì„¤ì •(Language Configuration), ì½”ë“œ ìŠ¤ë‹ˆí«(Code Snippets), ê·¸ë¦¬ê³  VSIX íŒ¨í‚¤ì§•ì„ ë‹¤ë£¬ë‹¤.</p>
<h2 id="ëª©ì°¨-11"><a class="header" href="#ëª©ì°¨-11">ëª©ì°¨</a></h2>
<ol>
<li><a href="#vs-code-extension-êµ¬ì¡°">VS Code Extension êµ¬ì¡°</a></li>
<li><a href="#textmate-grammar">TextMate Grammar</a></li>
<li><a href="#language-configuration">Language Configuration</a></li>
<li><a href="#ì½”ë“œ-ìŠ¤ë‹ˆí«">ì½”ë“œ ìŠ¤ë‹ˆí«</a></li>
<li><a href="#packagejson-contributes-ì„¤ì •">package.json Contributes ì„¤ì •</a></li>
<li><a href="#extension-ì§„ì…ì -extensionts">Extension ì§„ì…ì  (extension.ts)</a></li>
<li><a href="#vsix-íŒ¨í‚¤ì§•">VSIX íŒ¨í‚¤ì§•</a></li>
<li><a href="#ë¡œì»¬-ì„¤ì¹˜-ë°-í…ŒìŠ¤íŠ¸">ë¡œì»¬ ì„¤ì¹˜ ë° í…ŒìŠ¤íŠ¸</a></li>
<li><a href="#ì •ë¦¬-5">ì •ë¦¬</a></li>
</ol>
<hr>
<h2 id="vs-code-extension-êµ¬ì¡°"><a class="header" href="#vs-code-extension-êµ¬ì¡°">VS Code Extension êµ¬ì¡°</a></h2>
<p>VS Code Extensionì€ í¬ê²Œ ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤:</p>
<ol>
<li><strong>ì„ ì–¸ì (Declarative)</strong>: JSON íŒŒì¼ë¡œ ì •ì˜ (ë¬¸ë²•, ìŠ¤ë‹ˆí«, ì–¸ì–´ ì„¤ì •)</li>
<li><strong>ëª…ë ¹ì (Imperative)</strong>: TypeScript ì½”ë“œë¡œ êµ¬í˜„ (LSP í´ë¼ì´ì–¸íŠ¸ ì‹œì‘)</li>
</ol>
<h3 id="extensionì˜-êµ¬ì¡°"><a class="header" href="#extensionì˜-êµ¬ì¡°">Extensionì˜ êµ¬ì¡°</a></h3>
<p>ìš°ë¦¬ FunLang Extensionì˜ ë””ë ‰í† ë¦¬ êµ¬ì¡°ì´ë‹¤:</p>
<pre><code>client/
â”œâ”€â”€ package.json                    # í™•ì¥ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ (ë©”íƒ€ë°ì´í„° + contributes)
â”œâ”€â”€ language-configuration.json     # ì–¸ì–´ ì„¤ì • (ì£¼ì„, ê´„í˜¸ ë§¤ì¹­ ë“±)
â”œâ”€â”€ src/extension.ts                # LSP í´ë¼ì´ì–¸íŠ¸ ì§„ì…ì  (TypeScript)
â”œâ”€â”€ out/extension.js                # ì»´íŒŒì¼ëœ JavaScript
â”œâ”€â”€ syntaxes/                       # ë¬¸ë²• ì •ì˜ (TextMate)
â”‚   â””â”€â”€ funlang.tmLanguage.json
â”œâ”€â”€ snippets/                       # ì½”ë“œ ìŠ¤ë‹ˆí«
â”‚   â””â”€â”€ funlang.json
â”œâ”€â”€ images/                         # í™•ì¥ ì•„ì´ì½˜
â”‚   â””â”€â”€ funlang-icon.png
â””â”€â”€ server/                         # íŒ¨í‚¤ì§• ì‹œ LSP ì„œë²„ ë°”ì´ë„ˆë¦¬
    â””â”€â”€ LangLSP.Server
</code></pre>
<h3 id="extension-ë¡œë”©-ê³¼ì •"><a class="header" href="#extension-ë¡œë”©-ê³¼ì •">Extension ë¡œë”© ê³¼ì •</a></h3>
<p>VS Codeê°€ Extensionì„ ë¡œë“œí•˜ëŠ” ê³¼ì •ì´ë‹¤:</p>
<ol>
<li><strong><code>package.json</code> ì½ê¸°</strong>: <code>engines.vscode</code> ë²„ì „ ì²´í¬, <code>contributes</code> ë“±ë¡</li>
<li><strong>ì„ ì–¸ì  ê¸°ëŠ¥ í™œì„±í™”</strong>: ë¬¸ë²•, ìŠ¤ë‹ˆí«, ì–¸ì–´ ì„¤ì • ì¦‰ì‹œ ì ìš©</li>
<li><strong>Activation Event ëŒ€ê¸°</strong>: <code>activationEvents</code>ì— ì •ì˜ëœ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ</li>
<li><strong><code>main</code> ì§„ì…ì  ì‹¤í–‰</strong>: <code>extension.ts</code>ì˜ <code>activate()</code> í•¨ìˆ˜ í˜¸ì¶œ</li>
<li><strong>ëª…ë ¹ì  ê¸°ëŠ¥ ì‹œì‘</strong>: LSP í´ë¼ì´ì–¸íŠ¸ ì‹œì‘, ì„œë²„ í”„ë¡œì„¸ìŠ¤ ìƒì„±</li>
</ol>
<pre class="mermaid">sequenceDiagram
    participant V as VS Code
    participant E as Extension
    participant S as LangLSP Server
    V-&gt;&gt;E: activate()
    E-&gt;&gt;S: í”„ë¡œì„¸ìŠ¤ ì‹œì‘ (stdin/stdout)
    E-&gt;&gt;S: initialize(processId, capabilities)
    S-&gt;&gt;E: InitializeResult(serverCapabilities)
    E-&gt;&gt;S: initialized()
    Note over V,S: LSP ì„¸ì…˜ í™œì„±í™”
    V-&gt;&gt;E: deactivate()
    E-&gt;&gt;S: shutdown()
    S-&gt;&gt;E: shutdown response
    E-&gt;&gt;S: exit()
</pre>

<p>VS Code 1.74+ì—ì„œëŠ” <code>activationEvents</code>ë¥¼ ë¹ˆ ë°°ì—´(<code>[]</code>)ë¡œ ë‘ë©´, <code>contributes.languages</code>ì— ë“±ë¡ëœ ì–¸ì–´ì˜ íŒŒì¼ì„ ì—´ ë•Œ ìë™ìœ¼ë¡œ í™œì„±í™”ëœë‹¤.</p>
<h3 id="packagejsonì˜-í•µì‹¬-í•„ë“œ"><a class="header" href="#packagejsonì˜-í•µì‹¬-í•„ë“œ">package.jsonì˜ í•µì‹¬ í•„ë“œ</a></h3>
<pre><code class="language-json">{
  "name": "funlang",              // Extension ID (ì†Œë¬¸ì, í•˜ì´í”ˆ)
  "displayName": "FunLang",       // ì‚¬ìš©ìì—ê²Œ í‘œì‹œë˜ëŠ” ì´ë¦„
  "publisher": "funlang",         // ê²Œì‹œì ID (ë§ˆì¼“í”Œë ˆì´ìŠ¤ í•„ìš”)
  "version": "0.1.0",             // ì‹œë§¨í‹± ë²„ì „
  "engines": {
    "vscode": "^1.74.0"           // ìµœì†Œ VS Code ë²„ì „
  },
  "activationEvents": [],         // ë¹ˆ ë°°ì—´ = ìë™ í™œì„±í™”
  "main": "./out/extension.js",   // ì§„ì…ì  (ì»´íŒŒì¼ëœ JS)
  "contributes": { /* ... */ }    // ì„ ì–¸ì  ê¸°ì—¬ ì‚¬í•­
}
</code></pre>
<p><strong><code>contributes</code> í•„ë“œ</strong>ê°€ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤. ì—¬ê¸°ì— ì–¸ì–´, ë¬¸ë²•, ìŠ¤ë‹ˆí« ë“±ì„ ë“±ë¡í•œë‹¤.</p>
<hr>
<h2 id="textmate-grammar"><a class="header" href="#textmate-grammar">TextMate Grammar</a></h2>
<p><strong>TextMate Grammar</strong>ëŠ” ì •ê·œì‹ ê¸°ë°˜ í† í°í™” ì‹œìŠ¤í…œìœ¼ë¡œ, êµ¬ë¬¸ ê°•ì¡°(Syntax Highlighting)ë¥¼ ì œê³µí•œë‹¤. VS CodeëŠ” TextMate ë¬¸ë²•ì„ ì‚¬ìš©í•˜ì—¬ ì½”ë“œë¥¼ ìƒ‰ìƒìœ¼ë¡œ êµ¬ë¶„í•œë‹¤.</p>
<h3 id="textmate-ë¬¸ë²•ì˜-êµ¬ì¡°"><a class="header" href="#textmate-ë¬¸ë²•ì˜-êµ¬ì¡°">TextMate ë¬¸ë²•ì˜ êµ¬ì¡°</a></h3>
<p>TextMate ë¬¸ë²• íŒŒì¼(<code>funlang.tmLanguage.json</code>)ì€ ë‹¤ìŒ êµ¬ì¡°ë¥¼ ê°€ì§„ë‹¤:</p>
<pre><code class="language-json">{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "FunLang",
  "scopeName": "source.funlang",
  "patterns": [
    { "include": "#comments" },
    { "include": "#strings" },
    { "include": "#keywords" }
  ],
  "repository": {
    "comments": { /* ì£¼ì„ ê·œì¹™ */ },
    "strings": { /* ë¬¸ìì—´ ê·œì¹™ */ },
    "keywords": { /* í‚¤ì›Œë“œ ê·œì¹™ */ }
  }
}
</code></pre>
<ul>
<li><strong><code>scopeName</code></strong>: ì´ ë¬¸ë²•ì˜ ê³ ìœ  ì‹ë³„ì (ì˜ˆ: <code>source.funlang</code>)</li>
<li><strong><code>patterns</code></strong>: ìµœìƒìœ„ í† í° ë§¤ì¹­ ê·œì¹™ ë°°ì—´ (ìˆœì„œëŒ€ë¡œ ì‹œë„)</li>
<li><strong><code>repository</code></strong>: ì¬ì‚¬ìš© ê°€ëŠ¥í•œ íŒ¨í„´ ì •ì˜ (ì´ë¦„ìœ¼ë¡œ ì°¸ì¡°)</li>
</ul>
<h3 id="funlang-í† í°-ì¹´í…Œê³ ë¦¬"><a class="header" href="#funlang-í† í°-ì¹´í…Œê³ ë¦¬">FunLang í† í° ì¹´í…Œê³ ë¦¬</a></h3>
<p>FunLang êµ¬ë¬¸ì„ ë‹¤ìŒ ì¹´í…Œê³ ë¦¬ë¡œ ë‚˜ëˆˆë‹¤:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>ì¹´í…Œê³ ë¦¬</th><th>ì˜ˆì‹œ</th><th>Scope ì´ë¦„</th></tr>
</thead>
<tbody>
<tr><td>ì£¼ì„</td><td><code>// line</code>, <code>(* block *)</code></td><td><code>comment.line</code>, <code>comment.block</code></td></tr>
<tr><td>ë¬¸ìì—´</td><td><code>"hello\n"</code></td><td><code>string.quoted.double</code></td></tr>
<tr><td>ìƒìˆ˜</td><td><code>42</code>, <code>true</code>, <code>false</code></td><td><code>constant.numeric</code>, <code>constant.language.boolean</code></td></tr>
<tr><td>í‚¤ì›Œë“œ</td><td><code>if</code>, <code>let</code>, <code>match</code></td><td><code>keyword.control</code></td></tr>
<tr><td>íƒ€ì…</td><td><code>int</code>, <code>bool</code>, <code>'a</code></td><td><code>support.type</code>, <code>variable.parameter.type</code></td></tr>
<tr><td>ì—°ì‚°ì</td><td><code>-&gt;</code>, <code>::</code>, <code>+</code></td><td><code>keyword.operator.*</code></td></tr>
<tr><td>ì™€ì¼ë“œì¹´ë“œ</td><td><code>_</code></td><td><code>variable.language.wildcard</code></td></tr>
</tbody>
</table>
</div>
<h3 id="ì£¼ì„-íŒ¨í„´"><a class="header" href="#ì£¼ì„-íŒ¨í„´">ì£¼ì„ íŒ¨í„´</a></h3>
<p>FunLangì€ ë‘ ê°€ì§€ ì£¼ì„ì„ ì§€ì›í•œë‹¤:</p>
<pre><code class="language-json">"comments": {
  "patterns": [
    {
      "name": "comment.line.double-slash.funlang",
      "match": "//.*$"
    },
    {
      "name": "comment.block.funlang",
      "begin": "\\(\\*",
      "end": "\\*\\)",
      "patterns": [
        { "include": "#block-comment-nested" }
      ]
    }
  ]
}
</code></pre>
<p><strong>ì¤‘ì²© ë¸”ë¡ ì£¼ì„ ì²˜ë¦¬</strong>:</p>
<p>FunLangì€ <code>(* (* nested *) *)</code>ì™€ ê°™ì´ ì¤‘ì²©ëœ ë¸”ë¡ ì£¼ì„ì„ ì§€ì›í•œë‹¤. ì´ë¥¼ ìœ„í•´ ìê¸° ì°¸ì¡° íŒ¨í„´ì„ ì‚¬ìš©í•œë‹¤:</p>
<pre><code class="language-json">"block-comment-nested": {
  "name": "comment.block.nested.funlang",
  "begin": "\\(\\*",
  "end": "\\*\\)",
  "patterns": [
    { "include": "#block-comment-nested" }  // ìê¸° ìì‹  ì°¸ì¡°
  ]
}
</code></pre>
<p><strong>ì£¼ì˜</strong>: <code>(*</code>ì™€ <code>*)</code>ëŠ” ì •ê·œì‹ ë©”íƒ€ ë¬¸ìì´ë¯€ë¡œ <code>\\(\\*</code>, <code>\\*\\)</code>ë¡œ ì´ìŠ¤ì¼€ì´í”„í•´ì•¼ í•œë‹¤.</p>
<h3 id="ë¬¸ìì—´-íŒ¨í„´"><a class="header" href="#ë¬¸ìì—´-íŒ¨í„´">ë¬¸ìì—´ íŒ¨í„´</a></h3>
<p>ë¬¸ìì—´ì€ ì´ìŠ¤ì¼€ì´í”„ ì‹œí€€ìŠ¤ë¥¼ ì§€ì›í•œë‹¤:</p>
<pre><code class="language-json">"strings": {
  "name": "string.quoted.double.funlang",
  "begin": "\"",
  "end": "\"",
  "patterns": [
    {
      "name": "constant.character.escape.funlang",
      "match": "\\\\[nrt\\\\\"']"
    }
  ]
}
</code></pre>
<p><code>\n</code>, <code>\r</code>, <code>\t</code>, <code>\\</code>, <code>\"</code>, <code>\'</code>ë¥¼ ì´ìŠ¤ì¼€ì´í”„ë¡œ ì¸ì‹í•œë‹¤.</p>
<h3 id="ìƒìˆ˜-íŒ¨í„´"><a class="header" href="#ìƒìˆ˜-íŒ¨í„´">ìƒìˆ˜ íŒ¨í„´</a></h3>
<p>ìˆ«ìì™€ ë¶ˆë¦° ìƒìˆ˜ë¥¼ ë§¤ì¹­í•œë‹¤:</p>
<pre><code class="language-json">"constants": {
  "patterns": [
    {
      "name": "constant.numeric.integer.funlang",
      "match": "\\b[0-9]+\\b"
    },
    {
      "name": "constant.language.boolean.funlang",
      "match": "\\b(true|false)\\b"
    }
  ]
}
</code></pre>
<p><code>\b</code>ëŠ” **ë‹¨ì–´ ê²½ê³„(word boundary)**ì´ë‹¤. <code>42</code>ëŠ” ë§¤ì¹­í•˜ì§€ë§Œ <code>x42</code>ëŠ” ë§¤ì¹­í•˜ì§€ ì•ŠëŠ”ë‹¤.</p>
<h3 id="í‚¤ì›Œë“œ-íŒ¨í„´"><a class="header" href="#í‚¤ì›Œë“œ-íŒ¨í„´">í‚¤ì›Œë“œ íŒ¨í„´</a></h3>
<p>FunLangì˜ ì˜ˆì•½ì–´ì´ë‹¤:</p>
<pre><code class="language-json">"keywords": {
  "name": "keyword.control.funlang",
  "match": "\\b(if|then|else|match|with|let|in|fun|rec)\\b"
}
</code></pre>
<p><strong>í•¨ì •: ë‹¨ì–´ ê²½ê³„ ì—†ì´ ë§¤ì¹­í•˜ë©´ ë¬¸ì œ ë°œìƒ</strong></p>
<pre><code class="language-json">// ì˜ëª»ëœ ì˜ˆ
"match": "(let|if)"   // "letter"ì—ì„œ "let" ë§¤ì¹­, "lift"ì—ì„œ "if" ë§¤ì¹­

// ì˜¬ë°”ë¥¸ ì˜ˆ
"match": "\\b(let|if)\\b"   // "let", "if"ë§Œ ë§¤ì¹­, "letter"ëŠ” ë§¤ì¹­ ì•ˆ ë¨
</code></pre>
<h3 id="íƒ€ì…-íŒ¨í„´"><a class="header" href="#íƒ€ì…-íŒ¨í„´">íƒ€ì… íŒ¨í„´</a></h3>
<p>íƒ€ì… í‚¤ì›Œë“œì™€ íƒ€ì… ë³€ìˆ˜ë¥¼ êµ¬ë¶„í•œë‹¤:</p>
<pre><code class="language-json">"types": {
  "patterns": [
    {
      "name": "support.type.funlang",
      "match": "\\b(int|bool|string|list)\\b"
    },
    {
      "name": "variable.parameter.type.funlang",
      "match": "'[a-zA-Z][a-zA-Z0-9_]*"
    }
  ]
}
</code></pre>
<ul>
<li><code>int</code>, <code>bool</code>, <code>string</code>, <code>list</code>: ë‚´ì¥ íƒ€ì… (íŒŒë€ìƒ‰)</li>
<li><code>'a</code>, <code>'result</code>: íƒ€ì… ë³€ìˆ˜ (ë…¹ìƒ‰)</li>
</ul>
<h3 id="ì—°ì‚°ì-íŒ¨í„´"><a class="header" href="#ì—°ì‚°ì-íŒ¨í„´">ì—°ì‚°ì íŒ¨í„´</a></h3>
<p><strong>ì¤‘ìš”: ë‹¤ì¤‘ ë¬¸ì ì—°ì‚°ìë¥¼ ë¨¼ì € ë§¤ì¹­í•´ì•¼ í•œë‹¤.</strong></p>
<pre><code class="language-json">"operators": {
  "patterns": [
    { "name": "keyword.operator.arrow.funlang", "match": "-&gt;" },
    { "name": "keyword.operator.cons.funlang", "match": "::" },
    { "name": "keyword.operator.comparison.funlang", "match": "&lt;&gt;|&lt;=|&gt;=|&lt;|&gt;" },
    { "name": "keyword.operator.logical.funlang", "match": "&amp;&amp;|\\|\\|" },
    { "name": "keyword.operator.arithmetic.funlang", "match": "[+\\-*/]" },
    { "name": "keyword.operator.assignment.funlang", "match": "=" },
    { "name": "keyword.operator.pipe.funlang", "match": "\\|" }
  ]
}
</code></pre>
<p><strong>í•¨ì •: ì˜ëª»ëœ ìˆœì„œë¡œ ë§¤ì¹­í•˜ë©´ ë¶„í•  ë°œìƒ</strong></p>
<pre><code>// ì˜ëª»ëœ ìˆœì„œ
patterns: ["-", "-&gt;"]

ì½”ë“œ: "x -&gt; y"
ê²°ê³¼: "-" ë§¤ì¹­, "&gt;" ë¯¸ë§¤ì¹­ â†’ ìƒ‰ìƒ ê¹¨ì§

// ì˜¬ë°”ë¥¸ ìˆœì„œ
patterns: ["-&gt;", "-"]

ì½”ë“œ: "x -&gt; y"
ê²°ê³¼: "-&gt;" ì „ì²´ ë§¤ì¹­ â†’ ì •ìƒ ìƒ‰ìƒ
</code></pre>
<p>TextMateëŠ” <code>patterns</code> ë°°ì—´ì„ ìˆœì„œëŒ€ë¡œ ì‹œë„í•˜ë¯€ë¡œ, <strong>ê¸´ íŒ¨í„´ì„ ë¨¼ì € ë°°ì¹˜</strong>í•´ì•¼ í•œë‹¤.</p>
<h3 id="ì™€ì¼ë“œì¹´ë“œ-íŒ¨í„´"><a class="header" href="#ì™€ì¼ë“œì¹´ë“œ-íŒ¨í„´">ì™€ì¼ë“œì¹´ë“œ íŒ¨í„´</a></h3>
<p><code>_</code>ëŠ” íŠ¹ë³„í•œ ì‹ë³„ìì´ë‹¤:</p>
<pre><code class="language-json">"identifiers": {
  "patterns": [
    {
      "name": "variable.language.wildcard.funlang",
      "match": "\\b_\\b"
    }
  ]
}
</code></pre>
<p>ì´ íŒ¨í„´ì€ <code>_</code> ë‹¨ë…ì¼ ë•Œë§Œ ë§¤ì¹­í•˜ê³ , <code>_x</code>ë‚˜ <code>x_</code>ëŠ” ë§¤ì¹­í•˜ì§€ ì•ŠëŠ”ë‹¤.</p>
<h3 id="ì™„ì „í•œ-funlangtmlanguagejson"><a class="header" href="#ì™„ì „í•œ-funlangtmlanguagejson">ì™„ì „í•œ funlang.tmLanguage.json</a></h3>
<pre><code class="language-json">{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "FunLang",
  "scopeName": "source.funlang",
  "patterns": [
    { "include": "#comments" },
    { "include": "#strings" },
    { "include": "#constants" },
    { "include": "#keywords" },
    { "include": "#types" },
    { "include": "#operators" },
    { "include": "#identifiers" }
  ],
  "repository": {
    "comments": {
      "patterns": [
        {
          "name": "comment.line.double-slash.funlang",
          "match": "//.*$"
        },
        {
          "name": "comment.block.funlang",
          "begin": "\\(\\*",
          "end": "\\*\\)",
          "patterns": [
            { "include": "#block-comment-nested" }
          ]
        }
      ]
    },
    "block-comment-nested": {
      "name": "comment.block.nested.funlang",
      "begin": "\\(\\*",
      "end": "\\*\\)",
      "patterns": [
        { "include": "#block-comment-nested" }
      ]
    },
    "strings": {
      "name": "string.quoted.double.funlang",
      "begin": "\"",
      "end": "\"",
      "patterns": [
        {
          "name": "constant.character.escape.funlang",
          "match": "\\\\[nrt\\\\\"']"
        }
      ]
    },
    "constants": {
      "patterns": [
        {
          "name": "constant.numeric.integer.funlang",
          "match": "\\b[0-9]+\\b"
        },
        {
          "name": "constant.language.boolean.funlang",
          "match": "\\b(true|false)\\b"
        }
      ]
    },
    "keywords": {
      "name": "keyword.control.funlang",
      "match": "\\b(if|then|else|match|with|let|in|fun|rec)\\b"
    },
    "types": {
      "patterns": [
        {
          "name": "support.type.funlang",
          "match": "\\b(int|bool|string|list)\\b"
        },
        {
          "name": "variable.parameter.type.funlang",
          "match": "'[a-zA-Z][a-zA-Z0-9_]*"
        }
      ]
    },
    "operators": {
      "patterns": [
        { "name": "keyword.operator.arrow.funlang", "match": "-&gt;" },
        { "name": "keyword.operator.cons.funlang", "match": "::" },
        { "name": "keyword.operator.comparison.funlang", "match": "&lt;&gt;|&lt;=|&gt;=|&lt;|&gt;" },
        { "name": "keyword.operator.logical.funlang", "match": "&amp;&amp;|\\|\\|" },
        { "name": "keyword.operator.arithmetic.funlang", "match": "[+\\-*/]" },
        { "name": "keyword.operator.assignment.funlang", "match": "=" },
        { "name": "keyword.operator.pipe.funlang", "match": "\\|" }
      ]
    },
    "identifiers": {
      "patterns": [
        {
          "name": "variable.language.wildcard.funlang",
          "match": "\\b_\\b"
        }
      ]
    }
  }
}
</code></pre>
<h3 id="textmate-ë¬¸ë²•-í…ŒìŠ¤íŠ¸í•˜ê¸°"><a class="header" href="#textmate-ë¬¸ë²•-í…ŒìŠ¤íŠ¸í•˜ê¸°">TextMate ë¬¸ë²• í…ŒìŠ¤íŠ¸í•˜ê¸°</a></h3>
<p>VS Codeì—ì„œ ë¬¸ë²•ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´:</p>
<ol>
<li><code>.fun</code> íŒŒì¼ ì—´ê¸°</li>
<li>ëª…ë ¹ íŒ”ë ˆíŠ¸ (Ctrl+Shift+P)</li>
<li>â€œDeveloper: Inspect Editor Tokens and Scopesâ€ ì‹¤í–‰</li>
<li>ì»¤ì„œë¥¼ í† í° ìœ„ì— ë†“ìœ¼ë©´ Scope ì´ë¦„ í‘œì‹œ</li>
</ol>
<p>ì˜ˆì‹œ:</p>
<pre><code>Token: -&gt;
Scopes: source.funlang keyword.operator.arrow.funlang
</code></pre>
<hr>
<h2 id="language-configuration"><a class="header" href="#language-configuration">Language Configuration</a></h2>
<p><strong>Language Configuration</strong>ì€ VS Codeì˜ í¸ì§‘ ê²½í—˜ì„ ì œì–´í•˜ëŠ” JSON íŒŒì¼ì´ë‹¤. ì£¼ì„ í† ê¸€, ê´„í˜¸ ë§¤ì¹­, ìë™ ë‹«ê¸°, ë“¤ì—¬ì“°ê¸° ê·œì¹™ì„ ì •ì˜í•œë‹¤.</p>
<h3 id="language-configurationjsonì˜-êµ¬ì¡°"><a class="header" href="#language-configurationjsonì˜-êµ¬ì¡°">language-configuration.jsonì˜ êµ¬ì¡°</a></h3>
<pre><code class="language-json">{
  "comments": { /* ì£¼ì„ í† ê¸€ */ },
  "brackets": [ /* ê´„í˜¸ ë§¤ì¹­ */ ],
  "autoClosingPairs": [ /* ìë™ ë‹«ê¸° */ ],
  "surroundingPairs": [ /* ì„ íƒ ì˜ì—­ ê°ì‹¸ê¸° */ ],
  "onEnterRules": [ /* Enter í‚¤ ë™ì‘ */ ],
  "indentationRules": { /* ë“¤ì—¬ì“°ê¸° ê·œì¹™ */ }
}
</code></pre>
<h3 id="ì£¼ì„-í† ê¸€-comments"><a class="header" href="#ì£¼ì„-í† ê¸€-comments">ì£¼ì„ í† ê¸€ (comments)</a></h3>
<p>Ctrl+/ (ë¼ì¸ ì£¼ì„), Ctrl+Shift+A (ë¸”ë¡ ì£¼ì„)ì˜ ë™ì‘ì„ ì •ì˜í•œë‹¤:</p>
<pre><code class="language-json">"comments": {
  "lineComment": "//",
  "blockComment": ["(*", "*)"]
}
</code></pre>
<ul>
<li>Ctrl+/: ì„ íƒí•œ ì¤„ ì•ì— <code>//</code> ì¶”ê°€ ë˜ëŠ” ì œê±°</li>
<li>Ctrl+Shift+A: ì„ íƒ ì˜ì—­ì„ <code>(* ... *)</code> ë¡œ ê°ì‹¸ê±°ë‚˜ í•´ì œ</li>
</ul>
<h3 id="ê´„í˜¸-ë§¤ì¹­-brackets"><a class="header" href="#ê´„í˜¸-ë§¤ì¹­-brackets">ê´„í˜¸ ë§¤ì¹­ (brackets)</a></h3>
<p><strong>FunLangì€ ì¤‘ê´„í˜¸(<code>{}</code>)ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.</strong> ëŒ€ê´„í˜¸ì™€ ì†Œê´„í˜¸ë§Œ ì‚¬ìš©í•œë‹¤:</p>
<pre><code class="language-json">"brackets": [
  ["[", "]"],
  ["(", ")"]
]
</code></pre>
<p>ê´„í˜¸ ì¤‘ í•˜ë‚˜ì— ì»¤ì„œë¥¼ ë†“ìœ¼ë©´ ì§ì´ ê°•ì¡° í‘œì‹œëœë‹¤.</p>
<p><strong>ì£¼ì˜</strong>: ë§ì€ ì–¸ì–´ê°€ <code>{</code>, <code>}</code>ë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, FunLangì€ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì¶”ê°€í•˜ì§€ ì•ŠëŠ”ë‹¤.</p>
<h3 id="ìë™-ë‹«ê¸°-autoclosingpairs"><a class="header" href="#ìë™-ë‹«ê¸°-autoclosingpairs">ìë™ ë‹«ê¸° (autoClosingPairs)</a></h3>
<p>ì—¬ëŠ” ë¬¸ìë¥¼ ì…ë ¥í•˜ë©´ ë‹«ëŠ” ë¬¸ìê°€ ìë™ ì‚½ì…ëœë‹¤:</p>
<pre><code class="language-json">"autoClosingPairs": [
  { "open": "[", "close": "]" },
  { "open": "(", "close": ")" },
  { "open": "\"", "close": "\"", "notIn": ["string"] },
  { "open": "(*", "close": "*)", "notIn": ["string"] }
]
</code></pre>
<ul>
<li><code>[</code> ì…ë ¥ â†’ <code>[]</code> ì‚½ì…, ì»¤ì„œëŠ” <code>[|]</code> ìœ„ì¹˜</li>
<li><code>"</code> ì…ë ¥ â†’ <code>""</code> ì‚½ì…, ì»¤ì„œëŠ” <code>"|"</code> ìœ„ì¹˜</li>
<li><strong><code>notIn: ["string"]</code></strong>: ë¬¸ìì—´ ì•ˆì—ì„œëŠ” ìë™ ë‹«ê¸° ë¹„í™œì„±í™”</li>
</ul>
<p><strong>ë¸”ë¡ ì£¼ì„ ìë™ ë‹«ê¸°</strong>:</p>
<p><code>(*</code> ì…ë ¥ ì‹œ <code>*)</code> ìë™ ì‚½ì…ì€ í¸ë¦¬í•œ ê¸°ëŠ¥ì´ë‹¤. ì‚¬ìš©ìê°€ <code>(</code>ë¥¼ ì…ë ¥í•˜ë©´ <code>)</code>ê°€ ë¨¼ì € ì‚½ì…ë˜ê³ , <code>*</code>ë¥¼ ì…ë ¥í•˜ë©´ <code>*)</code>ê°€ ì™„ì„±ëœë‹¤.</p>
<h3 id="ì„ íƒ-ì˜ì—­-ê°ì‹¸ê¸°-surroundingpairs"><a class="header" href="#ì„ íƒ-ì˜ì—­-ê°ì‹¸ê¸°-surroundingpairs">ì„ íƒ ì˜ì—­ ê°ì‹¸ê¸° (surroundingPairs)</a></h3>
<p>í…ìŠ¤íŠ¸ ì„ íƒ í›„ ì—¬ëŠ” ë¬¸ìë¥¼ ì…ë ¥í•˜ë©´ ì„ íƒ ì˜ì—­ì„ ê°ì‹¼ë‹¤:</p>
<pre><code class="language-json">"surroundingPairs": [
  ["[", "]"],
  ["(", ")"],
  ["\"", "\""]
]
</code></pre>
<p>ì˜ˆì‹œ:</p>
<ol>
<li><code>hello</code> ì„ íƒ</li>
<li><code>"</code> ì…ë ¥</li>
<li>ê²°ê³¼: <code>"hello"</code></li>
</ol>
<h3 id="enter-í‚¤-ë™ì‘-onenterrules"><a class="header" href="#enter-í‚¤-ë™ì‘-onenterrules">Enter í‚¤ ë™ì‘ (onEnterRules)</a></h3>
<p>ì£¼ì„ì—ì„œ Enterë¥¼ ëˆ„ë¥´ë©´ ë‹¤ìŒ ì¤„ë„ ì£¼ì„ìœ¼ë¡œ ì‹œì‘í•œë‹¤:</p>
<pre><code class="language-json">"onEnterRules": [
  {
    "beforeText": "^\\s*\\/\\/.*$",
    "action": { "indent": "none", "appendText": "// " }
  }
]
</code></pre>
<p>ì˜ˆì‹œ:</p>
<pre><code class="language-funlang">// ì´ê²ƒì€ ì£¼ì„ì…ë‹ˆë‹¤&lt;Enter&gt;
// |â† ì»¤ì„œ ìœ„ì¹˜, "// " ìë™ ì‚½ì…
</code></pre>
<p><code>beforeText</code> ì •ê·œì‹: <code>^\\s*\\/\\/.*$</code></p>
<ul>
<li><code>^</code>: ì¤„ ì‹œì‘</li>
<li><code>\\s*</code>: ì„ íƒì  ê³µë°±</li>
<li><code>\\/\\/</code>: <code>//</code> (ì´ìŠ¤ì¼€ì´í”„)</li>
<li><code>.*$</code>: ë‚˜ë¨¸ì§€ í…ìŠ¤íŠ¸</li>
</ul>
<h3 id="ë“¤ì—¬ì“°ê¸°-ê·œì¹™-indentationrules"><a class="header" href="#ë“¤ì—¬ì“°ê¸°-ê·œì¹™-indentationrules">ë“¤ì—¬ì“°ê¸° ê·œì¹™ (indentationRules)</a></h3>
<p>íŠ¹ì • í‚¤ì›Œë“œ ë’¤ì—ì„œ ë“¤ì—¬ì“°ê¸°ë¥¼ ìë™ ì¡°ì •í•œë‹¤:</p>
<pre><code class="language-json">"indentationRules": {
  "increaseIndentPattern": "\\b(let|if|then|else|match|with|fun)\\b.*$",
  "decreaseIndentPattern": "^\\s*\\b(in|else|with)\\b"
}
</code></pre>
<p><strong><code>increaseIndentPattern</code></strong>: ì´ íŒ¨í„´ì— ë§¤ì¹­ë˜ëŠ” ì¤„ ë‹¤ìŒì— ë“¤ì—¬ì“°ê¸° ì¦ê°€</p>
<pre><code class="language-funlang">let x = 10 in
    |â† ìë™ ë“¤ì—¬ì“°ê¸°
</code></pre>
<p><strong><code>decreaseIndentPattern</code></strong>: ì´ íŒ¨í„´ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ì¤„ì€ ë“¤ì—¬ì“°ê¸° ê°ì†Œ</p>
<pre><code class="language-funlang">let x = 10
in  â† ë“¤ì—¬ì“°ê¸° ê°ì†Œ
x + 1
</code></pre>
<h3 id="ì™„ì „í•œ-language-configurationjson"><a class="header" href="#ì™„ì „í•œ-language-configurationjson">ì™„ì „í•œ language-configuration.json</a></h3>
<pre><code class="language-json">{
  "comments": {
    "lineComment": "//",
    "blockComment": ["(*", "*)"]
  },
  "brackets": [
    ["[", "]"],
    ["(", ")"]
  ],
  "autoClosingPairs": [
    { "open": "[", "close": "]" },
    { "open": "(", "close": ")" },
    { "open": "\"", "close": "\"", "notIn": ["string"] },
    { "open": "(*", "close": "*)", "notIn": ["string"] }
  ],
  "surroundingPairs": [
    ["[", "]"],
    ["(", ")"],
    ["\"", "\""]
  ],
  "autoCloseBefore": ";:.,=}])&gt;` \n\t",
  "onEnterRules": [
    {
      "beforeText": "^\\s*\\/\\/.*$",
      "action": { "indent": "none", "appendText": "// " }
    }
  ],
  "indentationRules": {
    "increaseIndentPattern": "\\b(let|if|then|else|match|with|fun)\\b.*$",
    "decreaseIndentPattern": "^\\s*\\b(in|else|with)\\b"
  }
}
</code></pre>
<p>ì´ ì„¤ì •ìœ¼ë¡œ FunLang í¸ì§‘ ê²½í—˜ì´ í¬ê²Œ í–¥ìƒëœë‹¤.</p>
<hr>
<h2 id="ì½”ë“œ-ìŠ¤ë‹ˆí«"><a class="header" href="#ì½”ë“œ-ìŠ¤ë‹ˆí«">ì½”ë“œ ìŠ¤ë‹ˆí«</a></h2>
<p><strong>Code Snippets</strong>ëŠ” ìì£¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œ íŒ¨í„´ì„ ë¹ ë¥´ê²Œ ì‚½ì…í•˜ëŠ” í…œí”Œë¦¿ì´ë‹¤.</p>
<h3 id="vs-code-ìŠ¤ë‹ˆí«-í˜•ì‹"><a class="header" href="#vs-code-ìŠ¤ë‹ˆí«-í˜•ì‹">VS Code ìŠ¤ë‹ˆí« í˜•ì‹</a></h3>
<pre><code class="language-json">{
  "Snippet Name": {
    "prefix": "trigger",
    "body": ["line 1", "line 2"],
    "description": "What this snippet does"
  }
}
</code></pre>
<ul>
<li><strong><code>prefix</code></strong>: íŠ¸ë¦¬ê±° ë‹¨ì–´ (ì‚¬ìš©ìê°€ ì…ë ¥í•˜ëŠ” ë¬¸ìì—´)</li>
<li><strong><code>body</code></strong>: ì‚½ì…í•  í…ìŠ¤íŠ¸ (ë°°ì—´, ê° ìš”ì†ŒëŠ” í•œ ì¤„)</li>
<li><strong><code>description</code></strong>: ìë™ ì™„ì„± ëª©ë¡ì— í‘œì‹œë˜ëŠ” ì„¤ëª…</li>
</ul>
<h3 id="tabstopê³¼-placeholder"><a class="header" href="#tabstopê³¼-placeholder">Tabstopê³¼ Placeholder</a></h3>
<p>ìŠ¤ë‹ˆí«ì€ <strong>tabstop</strong>ìœ¼ë¡œ ì»¤ì„œ ì´ë™ ì§€ì ì„ ì •ì˜í•œë‹¤:</p>
<ul>
<li><code>$1</code>, <code>$2</code>, <code>$3</code>: íƒ­ í‚¤ë¥¼ ëˆ„ë¥¼ ë•Œ ì»¤ì„œ ì´ë™ ìˆœì„œ</li>
<li><code>${1:placeholder}</code>: íƒ­ìŠ¤í†±ê³¼ ê¸°ë³¸ í…ìŠ¤íŠ¸</li>
<li><code>$0</code>: ìµœì¢… ì»¤ì„œ ìœ„ì¹˜</li>
</ul>
<p>ì˜ˆì‹œ:</p>
<pre><code class="language-json">"body": ["let ${1:name} = ${2:value} in", "${0}"]
</code></pre>
<p>ë™ì‘:</p>
<ol>
<li>ìŠ¤ë‹ˆí« ì‚½ì… â†’ <code>let |name| = value in</code> (ì»¤ì„œëŠ” <code>name</code> ìœ„ì¹˜, ì„ íƒë¨)</li>
<li>Tab â†’ <code>let x = |value| in</code> (ì»¤ì„œëŠ” <code>value</code> ìœ„ì¹˜)</li>
<li>Tab â†’ <code>let x = 10 in</code> ë‹¤ìŒ ì¤„ì— ì»¤ì„œ (<code>$0</code> ìœ„ì¹˜)</li>
</ol>
<h3 id="funlang-ìŠ¤ë‹ˆí«ë“¤"><a class="header" href="#funlang-ìŠ¤ë‹ˆí«ë“¤">FunLang ìŠ¤ë‹ˆí«ë“¤</a></h3>
<h4 id="1-let-binding"><a class="header" href="#1-let-binding">1. Let Binding</a></h4>
<pre><code class="language-json">"Let Binding": {
  "prefix": "let",
  "body": ["let ${1:name} = ${2:value} in", "${0}"],
  "description": "Let binding expression"
}
</code></pre>
<p>íŠ¸ë¦¬ê±°: <code>let</code> ì…ë ¥ í›„ ìë™ ì™„ì„± ì„ íƒ</p>
<p>ê²°ê³¼:</p>
<pre><code class="language-funlang">let |name| = value in

</code></pre>
<h4 id="2-recursive-function"><a class="header" href="#2-recursive-function">2. Recursive Function</a></h4>
<pre><code class="language-json">"Recursive Function": {
  "prefix": "letrec",
  "body": ["let rec ${1:name} ${2:param} =", "\t${3:body}", "in", "${0}"],
  "description": "Recursive function definition"
}
</code></pre>
<p>íŠ¸ë¦¬ê±°: <code>letrec</code> ì…ë ¥</p>
<p>ê²°ê³¼:</p>
<pre><code class="language-funlang">let rec |name| param =
    body
in

</code></pre>
<h4 id="3-if-then-else"><a class="header" href="#3-if-then-else">3. If-Then-Else</a></h4>
<pre><code class="language-json">"If-Then-Else": {
  "prefix": "if",
  "body": ["if ${1:condition}", "then ${2:consequent}", "else ${3:alternative}"],
  "description": "If-then-else expression"
}
</code></pre>
<p>íŠ¸ë¦¬ê±°: <code>if</code> ì…ë ¥</p>
<p>ê²°ê³¼:</p>
<pre><code class="language-funlang">if |condition|
then consequent
else alternative
</code></pre>
<h4 id="4-match-expression"><a class="header" href="#4-match-expression">4. Match Expression</a></h4>
<pre><code class="language-json">"Match Expression": {
  "prefix": "match",
  "body": ["match ${1:expr} with", "| ${2:pattern} -&gt; ${3:body}", "| ${4:_} -&gt; ${0:default}"],
  "description": "Pattern match expression"
}
</code></pre>
<p>íŠ¸ë¦¬ê±°: <code>match</code> ì…ë ¥</p>
<p>ê²°ê³¼:</p>
<pre><code class="language-funlang">match |expr| with
| pattern -&gt; body
| _ -&gt; default
</code></pre>
<h4 id="5-lambda"><a class="header" href="#5-lambda">5. Lambda</a></h4>
<pre><code class="language-json">"Lambda": {
  "prefix": "fun",
  "body": ["fun ${1:x} -&gt; ${0:body}"],
  "description": "Lambda expression"
}
</code></pre>
<p>íŠ¸ë¦¬ê±°: <code>fun</code> ì…ë ¥</p>
<p>ê²°ê³¼:</p>
<pre><code class="language-funlang">fun |x| -&gt; body
</code></pre>
<h4 id="6-match-list"><a class="header" href="#6-match-list">6. Match List</a></h4>
<pre><code class="language-json">"Match List": {
  "prefix": "matchlist",
  "body": ["match ${1:xs} with", "| [] -&gt; ${2:base}", "| ${3:h} :: ${4:t} -&gt; ${0:recursive}"],
  "description": "Pattern match on list (empty and cons)"
}
</code></pre>
<p>íŠ¸ë¦¬ê±°: <code>matchlist</code> ì…ë ¥</p>
<p>ê²°ê³¼:</p>
<pre><code class="language-funlang">match |xs| with
| [] -&gt; base
| h :: t -&gt; recursive
</code></pre>
<h3 id="ì™„ì „í•œ-snippetsfunlangjson"><a class="header" href="#ì™„ì „í•œ-snippetsfunlangjson">ì™„ì „í•œ snippets/funlang.json</a></h3>
<pre><code class="language-json">{
  "Let Binding": {
    "prefix": "let",
    "body": ["let ${1:name} = ${2:value} in", "${0}"],
    "description": "Let binding expression"
  },
  "Recursive Function": {
    "prefix": "letrec",
    "body": ["let rec ${1:name} ${2:param} =", "\t${3:body}", "in", "${0}"],
    "description": "Recursive function definition"
  },
  "If-Then-Else": {
    "prefix": "if",
    "body": ["if ${1:condition}", "then ${2:consequent}", "else ${3:alternative}"],
    "description": "If-then-else expression"
  },
  "Match Expression": {
    "prefix": "match",
    "body": ["match ${1:expr} with", "| ${2:pattern} -&gt; ${3:body}", "| ${4:_} -&gt; ${0:default}"],
    "description": "Pattern match expression"
  },
  "Lambda": {
    "prefix": "fun",
    "body": ["fun ${1:x} -&gt; ${0:body}"],
    "description": "Lambda expression"
  },
  "Match List": {
    "prefix": "matchlist",
    "body": ["match ${1:xs} with", "| [] -&gt; ${2:base}", "| ${3:h} :: ${4:t} -&gt; ${0:recursive}"],
    "description": "Pattern match on list (empty and cons)"
  }
}
</code></pre>
<h3 id="ìŠ¤ë‹ˆí«-í…ŒìŠ¤íŠ¸í•˜ê¸°"><a class="header" href="#ìŠ¤ë‹ˆí«-í…ŒìŠ¤íŠ¸í•˜ê¸°">ìŠ¤ë‹ˆí« í…ŒìŠ¤íŠ¸í•˜ê¸°</a></h3>
<ol>
<li><code>.fun</code> íŒŒì¼ì—ì„œ <code>let</code> ì…ë ¥</li>
<li>ìë™ ì™„ì„± ëª©ë¡ì— â€œLet Bindingâ€ í‘œì‹œ</li>
<li>Enter ë˜ëŠ” Tabìœ¼ë¡œ ì„ íƒ</li>
<li>Tabstop ì‚¬ì´ë¥¼ Tab í‚¤ë¡œ ì´ë™</li>
</ol>
<p><strong>í•¨ì •: ìŠ¤ë‹ˆí«ì—ì„œ <code>$</code>ì™€ <code>}</code> ì´ìŠ¤ì¼€ì´í”„í•˜ê¸°</strong></p>
<p>ìŠ¤ë‹ˆí« ë³¸ë¬¸ì—ì„œ ë¦¬í„°ëŸ´ <code>$</code>ë‚˜ <code>}</code>ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì´ìŠ¤ì¼€ì´í”„í•´ì•¼ í•œë‹¤:</p>
<pre><code class="language-json">"body": ["Price: \\$${1:amount}"]  // $ â†’ \$
</code></pre>
<hr>
<h2 id="packagejson-contributes-ì„¤ì •"><a class="header" href="#packagejson-contributes-ì„¤ì •">package.json Contributes ì„¤ì •</a></h2>
<p><strong><code>contributes</code></strong> í•„ë“œëŠ” Extensionì´ VS Codeì— ì œê³µí•˜ëŠ” ëª¨ë“  ì„ ì–¸ì  ê¸°ëŠ¥ì„ ë“±ë¡í•˜ëŠ” ê³³ì´ë‹¤.</p>
<h3 id="contributesì˜-ì£¼ìš”-í•„ë“œ"><a class="header" href="#contributesì˜-ì£¼ìš”-í•„ë“œ">contributesì˜ ì£¼ìš” í•„ë“œ</a></h3>
<pre><code class="language-json">"contributes": {
  "languages": [ /* ì–¸ì–´ ì •ì˜ */ ],
  "grammars": [ /* ë¬¸ë²• ë“±ë¡ */ ],
  "snippets": [ /* ìŠ¤ë‹ˆí« ë“±ë¡ */ ]
}
</code></pre>
<h3 id="languages-ê¸°ì—¬"><a class="header" href="#languages-ê¸°ì—¬">languages ê¸°ì—¬</a></h3>
<p>ì–¸ì–´ ID, í™•ì¥ì, ì„¤ì • íŒŒì¼, ì•„ì´ì½˜ì„ ì •ì˜í•œë‹¤:</p>
<pre><code class="language-json">"languages": [
  {
    "id": "funlang",
    "aliases": ["FunLang", "funlang"],
    "extensions": [".fun"],
    "configuration": "./language-configuration.json",
    "icon": {
      "light": "./images/funlang-icon.png",
      "dark": "./images/funlang-icon.png"
    }
  }
]
</code></pre>
<ul>
<li><strong><code>id</code></strong>: ì–¸ì–´ì˜ ê³ ìœ  ì‹ë³„ì (ë‹¤ë¥¸ ê³³ì—ì„œ ì°¸ì¡°ìš©)</li>
<li><strong><code>aliases</code></strong>: ëª…ë ¹ íŒ”ë ˆíŠ¸ì—ì„œ í‘œì‹œë˜ëŠ” ì´ë¦„ë“¤</li>
<li><strong><code>extensions</code></strong>: ì´ ì–¸ì–´ë¡œ ì¸ì‹í•  íŒŒì¼ í™•ì¥ì</li>
<li><strong><code>configuration</code></strong>: Language Configuration íŒŒì¼ ê²½ë¡œ</li>
<li><strong><code>icon</code></strong>: íŒŒì¼ ì•„ì´ì½˜ (ë¼ì´íŠ¸/ë‹¤í¬ í…Œë§ˆìš©)</li>
</ul>
<p><code>.fun</code> íŒŒì¼ì„ ì—´ë©´ VS Codeê°€ ìë™ìœ¼ë¡œ <code>funlang</code> ì–¸ì–´ë¡œ ì¸ì‹í•œë‹¤.</p>
<h3 id="grammars-ê¸°ì—¬"><a class="header" href="#grammars-ê¸°ì—¬">grammars ê¸°ì—¬</a></h3>
<p>TextMate ë¬¸ë²• íŒŒì¼ì„ ë“±ë¡í•œë‹¤:</p>
<pre><code class="language-json">"grammars": [
  {
    "language": "funlang",
    "scopeName": "source.funlang",
    "path": "./syntaxes/funlang.tmLanguage.json"
  }
]
</code></pre>
<ul>
<li><strong><code>language</code></strong>: ì´ ë¬¸ë²•ì´ ì ìš©ë  ì–¸ì–´ ID</li>
<li><strong><code>scopeName</code></strong>: TextMate ë¬¸ë²• íŒŒì¼ì˜ <code>scopeName</code>ê³¼ ì¼ì¹˜í•´ì•¼ í•¨</li>
<li><strong><code>path</code></strong>: ë¬¸ë²• íŒŒì¼ ê²½ë¡œ</li>
</ul>
<p>ì´ ë“±ë¡ìœ¼ë¡œ <code>funlang</code> íŒŒì¼ì— êµ¬ë¬¸ ê°•ì¡°ê°€ ì ìš©ëœë‹¤.</p>
<h3 id="snippets-ê¸°ì—¬"><a class="header" href="#snippets-ê¸°ì—¬">snippets ê¸°ì—¬</a></h3>
<p>ì½”ë“œ ìŠ¤ë‹ˆí« íŒŒì¼ì„ ë“±ë¡í•œë‹¤:</p>
<pre><code class="language-json">"snippets": [
  {
    "language": "funlang",
    "path": "./snippets/funlang.json"
  }
]
</code></pre>
<ul>
<li><strong><code>language</code></strong>: ìŠ¤ë‹ˆí«ì´ í™œì„±í™”ë  ì–¸ì–´ ID</li>
<li><strong><code>path</code></strong>: ìŠ¤ë‹ˆí« íŒŒì¼ ê²½ë¡œ</li>
</ul>
<p><code>funlang</code> íŒŒì¼ì—ì„œ <code>let</code>, <code>if</code> ë“±ì„ ì…ë ¥í•˜ë©´ ìŠ¤ë‹ˆí« ìë™ ì™„ì„±ì´ ë‚˜íƒ€ë‚œë‹¤.</p>
<h3 id="ê¸°íƒ€-í•„ìˆ˜-í•„ë“œë“¤"><a class="header" href="#ê¸°íƒ€-í•„ìˆ˜-í•„ë“œë“¤">ê¸°íƒ€ í•„ìˆ˜ í•„ë“œë“¤</a></h3>
<p>package.jsonì—ëŠ” <code>contributes</code> ì™¸ì—ë„ í•„ìˆ˜ í•„ë“œë“¤ì´ ìˆë‹¤:</p>
<pre><code class="language-json">{
  "publisher": "funlang",
  "engines": {
    "vscode": "^1.74.0"
  },
  "icon": "images/funlang-icon.png",
  "activationEvents": []
}
</code></pre>
<ul>
<li><strong><code>publisher</code></strong>: ê²Œì‹œì ID (VSIX íŒ¨í‚¤ì§• ì‹œ í•„ìˆ˜, ë§ˆì¼“í”Œë ˆì´ìŠ¤ ê²Œì‹œ ì‹œ ì‹¤ì œ ê³„ì • í•„ìš”)</li>
<li><strong><code>engines.vscode</code></strong>: ìµœì†Œ VS Code ë²„ì „</li>
<li><strong><code>icon</code></strong>: Extension ì•„ì´ì½˜ (128x128 PNG ê¶Œì¥)</li>
<li><strong><code>activationEvents</code></strong>: ë¹ˆ ë°°ì—´ = <code>contributes.languages</code>ì— ì˜í•œ ìë™ í™œì„±í™”</li>
</ul>
<h3 id="ì™„ì „í•œ-packagejson"><a class="header" href="#ì™„ì „í•œ-packagejson">ì™„ì „í•œ package.json</a></h3>
<pre><code class="language-json">{
  "name": "funlang",
  "displayName": "FunLang",
  "description": "FunLang language support with LSP",
  "version": "0.1.0",
  "publisher": "funlang",
  "icon": "images/funlang-icon.png",
  "engines": {
    "vscode": "^1.74.0"
  },
  "categories": [
    "Programming Languages"
  ],
  "activationEvents": [],
  "main": "./out/extension.js",
  "contributes": {
    "languages": [
      {
        "id": "funlang",
        "aliases": [
          "FunLang",
          "funlang"
        ],
        "extensions": [
          ".fun"
        ],
        "configuration": "./language-configuration.json",
        "icon": {
          "light": "./images/funlang-icon.png",
          "dark": "./images/funlang-icon.png"
        }
      }
    ],
    "grammars": [
      {
        "language": "funlang",
        "scopeName": "source.funlang",
        "path": "./syntaxes/funlang.tmLanguage.json"
      }
    ],
    "snippets": [
      {
        "language": "funlang",
        "path": "./snippets/funlang.json"
      }
    ]
  },
  "scripts": {
    "vscode:prepublish": "npm run compile",
    "compile": "tsc -p ./",
    "watch": "tsc -watch -p ./"
  },
  "dependencies": {
    "vscode-languageclient": "^9.0.1"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "@types/vscode": "^1.74.0",
    "@vscode/vsce": "^3.7.1",
    "typescript": "^5.0.0"
  }
}
</code></pre>
<hr>
<h2 id="extension-ì§„ì…ì -extensionts"><a class="header" href="#extension-ì§„ì…ì -extensionts">Extension ì§„ì…ì  (extension.ts)</a></h2>
<p><strong>extension.ts</strong>ëŠ” Extensionì˜ ëª…ë ¹ì  ì½”ë“œê°€ ì‹¤í–‰ë˜ëŠ” ì§„ì…ì ì´ë‹¤. ì—¬ê¸°ì„œ LSP í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‹œì‘í•˜ê³  ì„œë²„ í”„ë¡œì„¸ìŠ¤ë¥¼ ê´€ë¦¬í•œë‹¤.</p>
<h3 id="activate-í•¨ìˆ˜"><a class="header" href="#activate-í•¨ìˆ˜">activate í•¨ìˆ˜</a></h3>
<p>VS Codeê°€ Extensionì„ í™œì„±í™”í•  ë•Œ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ì´ë‹¤:</p>
<pre><code class="language-typescript">export function activate(context: ExtensionContext) {
  // 1. ì„œë²„ ê²½ë¡œ ê²°ì •
  // 2. ServerOptions ìƒì„±
  // 3. LanguageClientOptions ìƒì„±
  // 4. LanguageClient ìƒì„± ë° ì‹œì‘
}
</code></pre>
<h3 id="ì„œë²„-ëª¨ë“œ-ê°ì§€"><a class="header" href="#ì„œë²„-ëª¨ë“œ-ê°ì§€">ì„œë²„ ëª¨ë“œ ê°ì§€</a></h3>
<p>ê°œë°œ ì¤‘ì—ëŠ” <code>dotnet run</code>ìœ¼ë¡œ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ê³ , í”„ë¡œë•ì…˜ì—ì„œëŠ” íŒ¨í‚¤ì§•ëœ ë°”ì´ë„ˆë¦¬ë¥¼ ì‹¤í–‰í•œë‹¤:</p>
<pre><code class="language-typescript">const serverDir = context.asAbsolutePath(path.join('server'));
let serverOptions: ServerOptions;

if (fs.existsSync(serverDir)) {
  // í”„ë¡œë•ì…˜: íŒ¨í‚¤ì§•ëœ ë°”ì´ë„ˆë¦¬ ì‚¬ìš©
  const serverPath = path.join(serverDir, 'LangLSP.Server');
  serverOptions = {
    run: { command: serverPath, options: { cwd: serverDir } },
    debug: { command: serverPath, options: { cwd: serverDir } }
  };
} else {
  // ê°œë°œ: dotnet run ì‚¬ìš©
  serverOptions = {
    run: {
      command: 'dotnet',
      args: ['run', '--project', context.asAbsolutePath(
        path.join('..', 'src', 'LangLSP.Server', 'LangLSP.Server.fsproj')
      )],
      options: { cwd: context.asAbsolutePath('..') }
    },
    debug: {
      command: 'dotnet',
      args: ['run', '--project', context.asAbsolutePath(
        path.join('..', 'src', 'LangLSP.Server', 'LangLSP.Server.fsproj')
      )],
      options: { cwd: context.asAbsolutePath('..') }
    }
  };
}
</code></pre>
<p>**<code>fs.existsSync(serverDir)</code>**ë¡œ <code>client/server/</code> ë””ë ‰í† ë¦¬ê°€ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤:</p>
<ul>
<li><strong>ìˆìœ¼ë©´</strong>: íŒ¨í‚¤ì§•ëœ VSIX â†’ <code>server/LangLSP.Server</code> ë°”ì´ë„ˆë¦¬ ì‹¤í–‰</li>
<li><strong>ì—†ìœ¼ë©´</strong>: ê°œë°œ ëª¨ë“œ â†’ <code>dotnet run</code> ì‹¤í–‰</li>
</ul>
<p>ì´ë ‡ê²Œ í•˜ë©´ ê°œë°œ ì¤‘ì—ëŠ” ì„œë²„ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê³  F5ë¡œ ë””ë²„ê¹…í•  ìˆ˜ ìˆê³ , í”„ë¡œë•ì…˜ì—ì„œëŠ” ë¹ ë¥¸ ë°”ì´ë„ˆë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤.</p>
<h3 id="languageclientoptions"><a class="header" href="#languageclientoptions">LanguageClientOptions</a></h3>
<p>í´ë¼ì´ì–¸íŠ¸ê°€ ì–´ë–¤ íŒŒì¼ì„ ê´€ë¦¬í• ì§€ ì •ì˜í•œë‹¤:</p>
<pre><code class="language-typescript">const clientOptions: LanguageClientOptions = {
  documentSelector: [{ scheme: 'file', language: 'funlang' }],
  synchronize: {
    fileEvents: workspace.createFileSystemWatcher('**/*.fun')
  }
};
</code></pre>
<ul>
<li><strong><code>documentSelector</code></strong>: <code>scheme: 'file'</code> (ë¡œì»¬ íŒŒì¼), <code>language: 'funlang'</code> (ì–¸ì–´ ID)</li>
<li><strong><code>synchronize.fileEvents</code></strong>: <code>.fun</code> íŒŒì¼ ë³€ê²½ ê°ì§€ (ìƒì„±/ì‚­ì œ/ìˆ˜ì • ì‹œ ì„œë²„ì— ì•Œë¦¼)</li>
</ul>
<h3 id="languageclient-ìƒì„±-ë°-ì‹œì‘"><a class="header" href="#languageclient-ìƒì„±-ë°-ì‹œì‘">LanguageClient ìƒì„± ë° ì‹œì‘</a></h3>
<pre><code class="language-typescript">client = new LanguageClient(
  'funlangServer',
  'FunLang Language Server',
  serverOptions,
  clientOptions
);

client.start();
</code></pre>
<ul>
<li>ì²« ë²ˆì§¸ ì¸ì: ì„œë²„ ID (ë‚´ë¶€ìš©)</li>
<li>ë‘ ë²ˆì§¸ ì¸ì: ì‚¬ìš©ìì—ê²Œ í‘œì‹œë˜ëŠ” ì´ë¦„ (Output íŒ¨ë„ì— í‘œì‹œ)</li>
<li><code>client.start()</code>: ì„œë²„ í”„ë¡œì„¸ìŠ¤ ì‹œì‘, LSP ì—°ê²° ìˆ˜ë¦½</li>
</ul>
<h3 id="deactivate-í•¨ìˆ˜"><a class="header" href="#deactivate-í•¨ìˆ˜">deactivate í•¨ìˆ˜</a></h3>
<p>Extensionì´ ë¹„í™œì„±í™”ë  ë•Œ í˜¸ì¶œëœë‹¤:</p>
<pre><code class="language-typescript">export function deactivate(): Thenable&lt;void&gt; | undefined {
  if (!client) {
    return undefined;
  }
  return client.stop();
}
</code></pre>
<p><code>client.stop()</code>ì€ ì„œë²„ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•˜ê³  ë¦¬ì†ŒìŠ¤ë¥¼ ì •ë¦¬í•œë‹¤.</p>
<h3 id="ì™„ì „í•œ-extensionts"><a class="header" href="#ì™„ì „í•œ-extensionts">ì™„ì „í•œ extension.ts</a></h3>
<pre><code class="language-typescript">import * as path from 'path';
import * as fs from 'fs';
import { workspace, ExtensionContext } from 'vscode';
import {
  LanguageClient,
  LanguageClientOptions,
  ServerOptions
} from 'vscode-languageclient/node';

let client: LanguageClient;

export function activate(context: ExtensionContext) {
  const serverDir = context.asAbsolutePath(path.join('server'));
  let serverOptions: ServerOptions;

  if (fs.existsSync(serverDir)) {
    const serverPath = path.join(serverDir, 'LangLSP.Server');
    serverOptions = {
      run: { command: serverPath, options: { cwd: serverDir } },
      debug: { command: serverPath, options: { cwd: serverDir } }
    };
  } else {
    serverOptions = {
      run: {
        command: 'dotnet',
        args: ['run', '--project', context.asAbsolutePath(
          path.join('..', 'src', 'LangLSP.Server', 'LangLSP.Server.fsproj')
        )],
        options: { cwd: context.asAbsolutePath('..') }
      },
      debug: {
        command: 'dotnet',
        args: ['run', '--project', context.asAbsolutePath(
          path.join('..', 'src', 'LangLSP.Server', 'LangLSP.Server.fsproj')
        )],
        options: { cwd: context.asAbsolutePath('..') }
      }
    };
  }

  const clientOptions: LanguageClientOptions = {
    documentSelector: [{ scheme: 'file', language: 'funlang' }],
    synchronize: {
      fileEvents: workspace.createFileSystemWatcher('**/*.fun')
    }
  };

  client = new LanguageClient(
    'funlangServer',
    'FunLang Language Server',
    serverOptions,
    clientOptions
  );

  client.start();
}

export function deactivate(): Thenable&lt;void&gt; | undefined {
  if (!client) {
    return undefined;
  }
  return client.stop();
}
</code></pre>
<p>ì´ ì½”ë“œëŠ” VS Codeê°€ <code>.fun</code> íŒŒì¼ì„ ì—´ë©´ ìë™ìœ¼ë¡œ Language Serverë¥¼ ì‹œì‘í•˜ê³ , ëª¨ë“  LSP ê¸°ëŠ¥(ì§„ë‹¨, í˜¸ë²„, ìë™ ì™„ì„± ë“±)ì„ í™œì„±í™”í•œë‹¤.</p>
<hr>
<h2 id="vsix-íŒ¨í‚¤ì§•"><a class="header" href="#vsix-íŒ¨í‚¤ì§•">VSIX íŒ¨í‚¤ì§•</a></h2>
<p><strong>VSIX</strong>ëŠ” VS Code Extensionì˜ ë°°í¬ í˜•ì‹ì´ë‹¤. ZIP íŒŒì¼ê³¼ ìœ ì‚¬í•˜ì§€ë§Œ Extension ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì™€ ë©”íƒ€ë°ì´í„°ë¥¼ í¬í•¨í•œë‹¤.</p>
<h3 id="vsce-ë„êµ¬-ì„¤ì¹˜"><a class="header" href="#vsce-ë„êµ¬-ì„¤ì¹˜">vsce ë„êµ¬ ì„¤ì¹˜</a></h3>
<p>VS Code Extension Managerì¸ <code>@vscode/vsce</code>ë¥¼ ì„¤ì¹˜í•œë‹¤:</p>
<pre><code class="language-bash">cd client
npm install --save-dev @vscode/vsce
</code></pre>
<h3 id="íŒ¨í‚¤ì§•-3ë‹¨ê³„-í”„ë¡œì„¸ìŠ¤"><a class="header" href="#íŒ¨í‚¤ì§•-3ë‹¨ê³„-í”„ë¡œì„¸ìŠ¤">íŒ¨í‚¤ì§• 3ë‹¨ê³„ í”„ë¡œì„¸ìŠ¤</a></h3>
<p>VSIXë¥¼ ë§Œë“¤ë ¤ë©´ ì„¸ ë‹¨ê³„ë¥¼ ê±°ì¹œë‹¤:</p>
<h4 id="1ë‹¨ê³„-f-ì„œë²„-í¼ë¸”ë¦¬ì‹œ"><a class="header" href="#1ë‹¨ê³„-f-ì„œë²„-í¼ë¸”ë¦¬ì‹œ">1ë‹¨ê³„: F# ì„œë²„ í¼ë¸”ë¦¬ì‹œ</a></h4>
<p>Language Server ë°”ì´ë„ˆë¦¬ë¥¼ <code>client/server/</code> ë””ë ‰í† ë¦¬ì— ë¹Œë“œí•œë‹¤:</p>
<pre><code class="language-bash">cd ..  # í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¡œ
dotnet publish src/LangLSP.Server/LangLSP.Server.fsproj \
  -c Release \
  -o client/server \
  --self-contained false
</code></pre>
<p><strong>ì˜µì…˜ ì„¤ëª…:</strong></p>
<ul>
<li><code>-c Release</code>: ë¦´ë¦¬ìŠ¤ ë¹Œë“œ (ìµœì í™” í™œì„±í™”)</li>
<li><code>-o client/server</code>: ì¶œë ¥ ë””ë ‰í† ë¦¬</li>
<li><code>--self-contained false</code>: .NET ëŸ°íƒ€ì„ ë³„ë„ ì„¤ì¹˜ í•„ìš” (VSIX í¬ê¸° ê°ì†Œ)</li>
</ul>
<p><strong>ì¶œë ¥ í™•ì¸:</strong></p>
<pre><code class="language-bash">ls -lh client/server/
</code></pre>
<pre><code>LangLSP.Server       # ì‹¤í–‰ íŒŒì¼ (Linux/Mac)
LangLSP.Server.exe   # ì‹¤í–‰ íŒŒì¼ (Windows, ìˆëŠ” ê²½ìš°)
LangLSP.Server.dll   # ë©”ì¸ ì–´ì…ˆë¸”ë¦¬
LangLSP.*.dll        # í”„ë¡œì íŠ¸ ì˜ì¡´ì„±
FSharp.Core.dll
Ionide.LanguageServerProtocol.dll
...
</code></pre>
<p><strong>self-contained vs framework-dependent:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>ëª¨ë“œ</th><th>ì¥ì </th><th>ë‹¨ì </th></tr>
</thead>
<tbody>
<tr><td>framework-dependent (<code>false</code>)</td><td>VSIX í¬ê¸° ì‘ìŒ (3-5 MB)</td><td>.NET ëŸ°íƒ€ì„ í•„ìš”</td></tr>
<tr><td>self-contained (<code>true</code>)</td><td>ëŸ°íƒ€ì„ í¬í•¨, ë…ë¦½ ì‹¤í–‰</td><td>VSIX í¬ê¸° í¼ (50+ MB)</td></tr>
</tbody>
</table>
</div>
<p>ìš°ë¦¬ëŠ” framework-dependentë¥¼ ì„ íƒí–ˆë‹¤. ì‚¬ìš©ìê°€ .NET SDKë¥¼ ì´ë¯¸ ì„¤ì¹˜í–ˆë‹¤ê³  ê°€ì •í•œë‹¤.</p>
<h4 id="2ë‹¨ê³„-typescript-ì»´íŒŒì¼"><a class="header" href="#2ë‹¨ê³„-typescript-ì»´íŒŒì¼">2ë‹¨ê³„: TypeScript ì»´íŒŒì¼</a></h4>
<p><code>extension.ts</code>ë¥¼ JavaScriptë¡œ ì»´íŒŒì¼í•œë‹¤:</p>
<pre><code class="language-bash">cd client
npm run compile
</code></pre>
<p>ì´ ëª…ë ¹ì€ <code>tsc -p ./</code>ë¥¼ ì‹¤í–‰í•˜ì—¬ <code>src/extension.ts</code>ë¥¼ <code>out/extension.js</code>ë¡œ ì»´íŒŒì¼í•œë‹¤.</p>
<p><strong>ì¶œë ¥ í™•ì¸:</strong></p>
<pre><code class="language-bash">ls -l out/
</code></pre>
<pre><code>extension.js
extension.js.map
</code></pre>
<h4 id="3ë‹¨ê³„-vsix-íŒ¨í‚¤ì§•"><a class="header" href="#3ë‹¨ê³„-vsix-íŒ¨í‚¤ì§•">3ë‹¨ê³„: VSIX íŒ¨í‚¤ì§•</a></h4>
<p>vsceë¡œ VSIX íŒŒì¼ì„ ìƒì„±í•œë‹¤:</p>
<pre><code class="language-bash">npx vsce package --allow-missing-repository
</code></pre>
<p><strong>ì˜µì…˜ ì„¤ëª…:</strong></p>
<ul>
<li><code>--allow-missing-repository</code>: Git ë¦¬í¬ì§€í† ë¦¬ ì—†ì´ë„ íŒ¨í‚¤ì§• í—ˆìš© (ê°œë°œ ì¤‘)</li>
</ul>
<p><strong>ì¶œë ¥:</strong></p>
<pre><code>Executing prepublish script 'npm run compile'...
INFO  Detected presense of vscode-languageclient. Bundling extension...
INFO  Creating vsix package...
INFO  Extension packaged: /path/to/funlang-0.1.0.vsix (3.6 MB)
</code></pre>
<p><strong>ì„±ê³µ!</strong> <code>funlang-0.1.0.vsix</code> íŒŒì¼ì´ ìƒì„±ë˜ì—ˆë‹¤.</p>
<h3 id="vscodeignore-ì„¤ì •"><a class="header" href="#vscodeignore-ì„¤ì •">.vscodeignore ì„¤ì •</a></h3>
<p>VSIXì— í¬í•¨í•˜ì§€ ì•Šì„ íŒŒì¼ì„ ì§€ì •í•œë‹¤:</p>
<pre><code>.vscode/**
src/**
node_modules/**
tsconfig.json
test.fun
*.ts
!out/**
!server/**
!syntaxes/**
!snippets/**
!images/**
!language-configuration.json
</code></pre>
<p><strong>ê·œì¹™:</strong></p>
<ul>
<li><code>**</code>: ì œì™¸ (ì˜ˆ: <code>src/**</code> â†’ <code>src/</code> ì „ì²´ ì œì™¸)</li>
<li><code>!**</code>: í¬í•¨ (ì˜ˆ: <code>!out/**</code> â†’ <code>out/</code> ì „ì²´ í¬í•¨)</li>
</ul>
<p><strong>í¬í•¨ë˜ëŠ” ê²ƒ:</strong></p>
<ul>
<li><code>out/</code> (ì»´íŒŒì¼ëœ JS)</li>
<li><code>server/</code> (LSP ì„œë²„ ë°”ì´ë„ˆë¦¬)</li>
<li><code>syntaxes/</code>, <code>snippets/</code>, <code>images/</code> (ë¦¬ì†ŒìŠ¤)</li>
<li><code>language-configuration.json</code>, <code>package.json</code></li>
</ul>
<p><strong>ì œì™¸ë˜ëŠ” ê²ƒ:</strong></p>
<ul>
<li><code>src/</code> (TypeScript ì†ŒìŠ¤)</li>
<li><code>node_modules/</code> (npm ì˜ì¡´ì„±, vsceê°€ í•„ìš”í•œ ê²ƒë§Œ ë²ˆë“¤ë§)</li>
<li><code>*.ts</code> (TypeScript íŒŒì¼)</li>
</ul>
<h3 id="í”í•œ-íŒ¨í‚¤ì§•-ì—ëŸ¬"><a class="header" href="#í”í•œ-íŒ¨í‚¤ì§•-ì—ëŸ¬">í”í•œ íŒ¨í‚¤ì§• ì—ëŸ¬</a></h3>
<h4 id="ì—ëŸ¬-1-missing-publisher-name"><a class="header" href="#ì—ëŸ¬-1-missing-publisher-name">ì—ëŸ¬ 1: â€œMissing publisher nameâ€</a></h4>
<pre><code>ERROR  Missing publisher name
</code></pre>
<p><strong>í•´ê²°:</strong> package.jsonì— <code>publisher</code> í•„ë“œ ì¶”ê°€</p>
<pre><code class="language-json">{
  "publisher": "funlang"
}
</code></pre>
<h4 id="ì—ëŸ¬-2-missing-extension-icon"><a class="header" href="#ì—ëŸ¬-2-missing-extension-icon">ì—ëŸ¬ 2: â€œMissing extension iconâ€</a></h4>
<pre><code>ERROR  Extension icon not found: images/funlang-icon.png
</code></pre>
<p><strong>í•´ê²°:</strong> ì•„ì´ì½˜ íŒŒì¼ ìƒì„± ë˜ëŠ” <code>icon</code> í•„ë“œ ì œê±°</p>
<h4 id="ì—ëŸ¬-3-this-extension-consists-of-x-mb"><a class="header" href="#ì—ëŸ¬-3-this-extension-consists-of-x-mb">ì—ëŸ¬ 3: â€œThis extension consists of X MBâ€</a></h4>
<pre><code>WARNING  This extension consists of 52 MB of code. Please consider using .vscodeignore
</code></pre>
<p><strong>ì›ì¸:</strong> <code>node_modules/</code> ë˜ëŠ” ë¶ˆí•„ìš”í•œ íŒŒì¼ í¬í•¨</p>
<p><strong>í•´ê²°:</strong> .vscodeignoreì— ì¶”ê°€</p>
<h4 id="ì—ëŸ¬-4-serverlanglspserver-not-found"><a class="header" href="#ì—ëŸ¬-4-serverlanglspserver-not-found">ì—ëŸ¬ 4: â€œserver/LangLSP.Server not foundâ€</a></h4>
<p>VSIX ì„¤ì¹˜ í›„ ì‹¤í–‰ ì‹œ ì„œë²„ê°€ ì‹œì‘ë˜ì§€ ì•ŠëŠ” ê²½ìš°.</p>
<p><strong>ì›ì¸:</strong> <code>dotnet publish</code> ë¯¸ì‹¤í–‰ ë˜ëŠ” .vscodeignoreê°€ <code>server/</code> ì œì™¸</p>
<p><strong>í•´ê²°:</strong></p>
<ol>
<li><code>dotnet publish</code> ì¬ì‹¤í–‰</li>
<li>.vscodeignoreì— <code>!server/**</code> í™•ì¸</li>
</ol>
<hr>
<h2 id="ë¡œì»¬-ì„¤ì¹˜-ë°-í…ŒìŠ¤íŠ¸"><a class="header" href="#ë¡œì»¬-ì„¤ì¹˜-ë°-í…ŒìŠ¤íŠ¸">ë¡œì»¬ ì„¤ì¹˜ ë° í…ŒìŠ¤íŠ¸</a></h2>
<p>VSIX íŒŒì¼ì„ ìƒì„±í–ˆìœ¼ë©´ ë¡œì»¬ì— ì„¤ì¹˜í•˜ì—¬ ëª¨ë“  ê¸°ëŠ¥ì´ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•œë‹¤.</p>
<h3 id="vsix-ì„¤ì¹˜"><a class="header" href="#vsix-ì„¤ì¹˜">VSIX ì„¤ì¹˜</a></h3>
<pre><code class="language-bash">code --install-extension funlang-0.1.0.vsix
</code></pre>
<p>ì¶œë ¥:</p>
<pre><code>Installing extensions...
Extension 'funlang.funlang' v0.1.0 was successfully installed.
</code></pre>
<h3 id="ê²€ì¦-ì²´í¬ë¦¬ìŠ¤íŠ¸"><a class="header" href="#ê²€ì¦-ì²´í¬ë¦¬ìŠ¤íŠ¸">ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸</a></h3>
<h4 id="1-êµ¬ë¬¸-ê°•ì¡°-syntax-highlighting"><a class="header" href="#1-êµ¬ë¬¸-ê°•ì¡°-syntax-highlighting">1. êµ¬ë¬¸ ê°•ì¡° (Syntax Highlighting)</a></h4>
<pre><code class="language-bash">echo 'let x = 42 in x + 1' &gt; test.fun
code test.fun
</code></pre>
<p><strong>í™•ì¸:</strong></p>
<ul>
<li><code>let</code>, <code>in</code>: í‚¤ì›Œë“œ ìƒ‰ìƒ (ë³´ë¼ìƒ‰/íŒŒë€ìƒ‰)</li>
<li><code>x</code>: ë³€ìˆ˜ ìƒ‰ìƒ</li>
<li><code>42</code>: ìˆ«ì ìƒ‰ìƒ</li>
<li><code>+</code>: ì—°ì‚°ì ìƒ‰ìƒ</li>
</ul>
<h4 id="2-ì£¼ì„-í† ê¸€"><a class="header" href="#2-ì£¼ì„-í† ê¸€">2. ì£¼ì„ í† ê¸€</a></h4>
<p>íŒŒì¼ì—ì„œ:</p>
<ul>
<li>Ctrl+/ â†’ <code>//</code> ì£¼ì„ ì¶”ê°€/ì œê±°</li>
<li>Ctrl+Shift+A â†’ <code>(* *)</code> ë¸”ë¡ ì£¼ì„</li>
</ul>
<h4 id="3-ìë™-ë‹«ê¸°-auto-closing"><a class="header" href="#3-ìë™-ë‹«ê¸°-auto-closing">3. ìë™ ë‹«ê¸° (Auto-closing)</a></h4>
<ul>
<li><code>(</code> ì…ë ¥ â†’ <code>)</code> ìë™ ì‚½ì…</li>
<li><code>[</code> ì…ë ¥ â†’ <code>]</code> ìë™ ì‚½ì…</li>
<li><code>"</code> ì…ë ¥ â†’ <code>"</code> ìë™ ì‚½ì…</li>
<li><code>(*</code> ì…ë ¥ â†’ <code>*)</code> ìë™ ì‚½ì…</li>
</ul>
<h4 id="4-ìŠ¤ë‹ˆí«-snippets"><a class="header" href="#4-ìŠ¤ë‹ˆí«-snippets">4. ìŠ¤ë‹ˆí« (Snippets)</a></h4>
<p><code>test.fun</code>ì—ì„œ:</p>
<ul>
<li><code>let</code> ì…ë ¥ â†’ Tab â†’ ìŠ¤ë‹ˆí« í™•ì¥</li>
<li><code>if</code> ì…ë ¥ â†’ Tab â†’ if-then-else í…œí”Œë¦¿</li>
</ul>
<h4 id="5-í˜¸ë²„-hover"><a class="header" href="#5-í˜¸ë²„-hover">5. í˜¸ë²„ (Hover)</a></h4>
<pre><code class="language-funlang">let x = 42 in
let y = x + 1 in
y
</code></pre>
<p>ë³€ìˆ˜ <code>x</code>ì— ì»¤ì„œ â†’ í˜¸ë²„ ì •ë³´ í‘œì‹œ (<code>int</code> íƒ€ì…)</p>
<h4 id="6-ìë™-ì™„ì„±-completion"><a class="header" href="#6-ìë™-ì™„ì„±-completion">6. ìë™ ì™„ì„± (Completion)</a></h4>
<pre><code class="language-funlang">let x = 42 in
x&lt;Ctrl+Space&gt;
</code></pre>
<p>ìë™ ì™„ì„± ëª©ë¡ì— <code>x</code> í‘œì‹œ</p>
<h4 id="7-ì •ì˜ë¡œ-ì´ë™-go-to-definition"><a class="header" href="#7-ì •ì˜ë¡œ-ì´ë™-go-to-definition">7. ì •ì˜ë¡œ ì´ë™ (Go to Definition)</a></h4>
<pre><code class="language-funlang">let x = 42 in
x  â† ì—¬ê¸°ì„œ F12
</code></pre>
<p>ì»¤ì„œê°€ <code>x = 42</code>ë¡œ ì´ë™</p>
<h4 id="8-ì°¸ì¡°-ì°¾ê¸°-find-references"><a class="header" href="#8-ì°¸ì¡°-ì°¾ê¸°-find-references">8. ì°¸ì¡° ì°¾ê¸° (Find References)</a></h4>
<pre><code class="language-funlang">let x = 42 in
x  â† ì—¬ê¸°ì„œ Shift+F12
</code></pre>
<p>ì°¸ì¡° ëª©ë¡ íŒ¨ë„ì— ëª¨ë“  <code>x</code> ì‚¬ìš© ìœ„ì¹˜ í‘œì‹œ</p>
<h4 id="9-ì´ë¦„-ë°”ê¾¸ê¸°-rename"><a class="header" href="#9-ì´ë¦„-ë°”ê¾¸ê¸°-rename">9. ì´ë¦„ ë°”ê¾¸ê¸° (Rename)</a></h4>
<pre><code class="language-funlang">let x = 42 in
x  â† ì—¬ê¸°ì„œ F2 â†’ "y" ì…ë ¥ â†’ Enter
</code></pre>
<p>ëª¨ë“  <code>x</code>ê°€ <code>y</code>ë¡œ ë³€ê²½</p>
<h4 id="10-ì½”ë“œ-ì•¡ì…˜-code-actions"><a class="header" href="#10-ì½”ë“œ-ì•¡ì…˜-code-actions">10. ì½”ë“œ ì•¡ì…˜ (Code Actions)</a></h4>
<pre><code class="language-funlang">let x = 42 in
42  â† ë¯¸ì‚¬ìš© ë³€ìˆ˜ ê²½ê³ , ì „êµ¬ ì•„ì´ì½˜ í´ë¦­
</code></pre>
<p>â€œPrefix â€˜xâ€™ with underscoreâ€ ì•¡ì…˜ í‘œì‹œ</p>
<h3 id="output-íŒ¨ë„-í™•ì¸"><a class="header" href="#output-íŒ¨ë„-í™•ì¸">Output íŒ¨ë„ í™•ì¸</a></h3>
<p>LSP ì„œë²„ ë¡œê·¸ë¥¼ í™•ì¸í•˜ë ¤ë©´:</p>
<ol>
<li>View â†’ Output (Ctrl+Shift+U)</li>
<li>ë“œë¡­ë‹¤ìš´ì—ì„œ â€œFunLang Language Serverâ€ ì„ íƒ</li>
<li>ì„œë²„ ì‹œì‘ ë©”ì‹œì§€, ìš”ì²­/ì‘ë‹µ ë¡œê·¸ í™•ì¸</li>
</ol>
<p>ì˜ˆì‹œ:</p>
<pre><code>[Info] FunLang Language Server started
[Info] Received textDocument/didOpen: test.fun
[Info] Received textDocument/hover at line 1
</code></pre>
<p>ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ì´ ë¡œê·¸ì—ì„œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤.</p>
<h3 id="ì„¤ì¹˜-ì œê±°"><a class="header" href="#ì„¤ì¹˜-ì œê±°">ì„¤ì¹˜ ì œê±°</a></h3>
<p>í…ŒìŠ¤íŠ¸ í›„ Extensionì„ ì œê±°í•˜ë ¤ë©´:</p>
<pre><code class="language-bash">code --uninstall-extension funlang.funlang
</code></pre>
<p><strong>ì£¼ì˜:</strong> Extension IDëŠ” <code>publisher.name</code> í˜•ì‹ì´ë‹¤ (<code>funlang.funlang</code>).</p>
<h3 id="ë””ë²„ê¹…-íŒ"><a class="header" href="#ë””ë²„ê¹…-íŒ">ë””ë²„ê¹… íŒ</a></h3>
<h4 id="extensionì´-í™œì„±í™”ë˜ì§€-ì•ŠëŠ”-ê²½ìš°"><a class="header" href="#extensionì´-í™œì„±í™”ë˜ì§€-ì•ŠëŠ”-ê²½ìš°">Extensionì´ í™œì„±í™”ë˜ì§€ ì•ŠëŠ” ê²½ìš°</a></h4>
<ol>
<li><strong>activationEvents í™•ì¸</strong>: package.jsonì— ë¹ˆ ë°°ì—´ <code>[]</code> ë˜ëŠ” ì ì ˆí•œ ì´ë²¤íŠ¸ ì •ì˜</li>
<li><strong>ì–¸ì–´ ID ì¼ì¹˜</strong>: <code>contributes.languages[0].id</code>ì™€ extension.tsì˜ <code>documentSelector.language</code> ë™ì¼í•´ì•¼ í•¨</li>
<li><strong>VS Code ë²„ì „</strong>: <code>engines.vscode</code> ë²„ì „ì´ ë„ˆë¬´ ë†’ìœ¼ë©´ êµ¬ë²„ì „ VS Codeì—ì„œ ì‘ë™ ì•ˆ í•¨</li>
</ol>
<h4 id="lsp-ê¸°ëŠ¥ì´-ì‘ë™í•˜ì§€-ì•ŠëŠ”-ê²½ìš°"><a class="header" href="#lsp-ê¸°ëŠ¥ì´-ì‘ë™í•˜ì§€-ì•ŠëŠ”-ê²½ìš°">LSP ê¸°ëŠ¥ì´ ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²½ìš°</a></h4>
<ol>
<li><strong>ì„œë²„ ì‹¤í–‰ í™•ì¸</strong>: Output íŒ¨ë„ì—ì„œ â€œFunLang Language Serverâ€ ë¡œê·¸ í™•ì¸</li>
<li><strong>.NET ëŸ°íƒ€ì„</strong>: framework-dependent ë¹Œë“œëŠ” .NET ëŸ°íƒ€ì„ í•„ìš” (<code>dotnet --info</code>ë¡œ í™•ì¸)</li>
<li><strong>ì„œë²„ ê²½ë¡œ</strong>: extension.tsì˜ <code>serverPath</code>ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸</li>
<li><strong>VS Code ì¬ì‹œì‘</strong>: ê°€ë” Extension ìºì‹œ ë¬¸ì œë¡œ ì¬ì‹œì‘ í•„ìš”</li>
</ol>
<h4 id="êµ¬ë¬¸-ê°•ì¡°ê°€-ì‘ë™í•˜ì§€-ì•ŠëŠ”-ê²½ìš°"><a class="header" href="#êµ¬ë¬¸-ê°•ì¡°ê°€-ì‘ë™í•˜ì§€-ì•ŠëŠ”-ê²½ìš°">êµ¬ë¬¸ ê°•ì¡°ê°€ ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²½ìš°</a></h4>
<ol>
<li><strong>ë¬¸ë²• íŒŒì¼ ê²½ë¡œ</strong>: package.jsonì˜ <code>contributes.grammars[0].path</code> í™•ì¸</li>
<li><strong>scopeName ì¼ì¹˜</strong>: package.jsonê³¼ .tmLanguage.jsonì˜ <code>scopeName</code> ë™ì¼í•´ì•¼ í•¨</li>
<li><strong>í† í° ìŠ¤ì½”í”„ í™•ì¸</strong>: â€œDeveloper: Inspect Editor Tokens and Scopesâ€ ëª…ë ¹ìœ¼ë¡œ ìŠ¤ì½”í”„ í™•ì¸</li>
</ol>
<hr>
<h2 id="ì •ë¦¬-5"><a class="header" href="#ì •ë¦¬-5">ì •ë¦¬</a></h2>
<p>ì¶•í•˜í•œë‹¤! ìš°ë¦¬ëŠ” 12ê°œì˜ íŠœí† ë¦¬ì–¼ì„ í†µí•´ ì™„ì „í•œ Language Server Protocol êµ¬í˜„ì„ ì™„ì„±í–ˆë‹¤.</p>
<h3 id="ì „ì²´-ì—¬ì •-ë˜ëŒì•„ë³´ê¸°"><a class="header" href="#ì „ì²´-ì—¬ì •-ë˜ëŒì•„ë³´ê¸°">ì „ì²´ ì—¬ì • ë˜ëŒì•„ë³´ê¸°</a></h3>
<p><strong>Phase 1-4: LSP ê¸°ëŠ¥ êµ¬í˜„</strong></p>
<ol>
<li><strong>ì§„ë‹¨(Diagnostics)</strong>: íƒ€ì… ì˜¤ë¥˜, ë¯¸ì‚¬ìš© ë³€ìˆ˜ ê°ì§€</li>
<li><strong>í˜¸ë²„(Hover)</strong>: íƒ€ì… ì •ë³´ í‘œì‹œ</li>
<li><strong>ìë™ ì™„ì„±(Completion)</strong>: ìŠ¤ì½”í”„ ë‚´ ë³€ìˆ˜ì™€ í‚¤ì›Œë“œ ì œì•ˆ</li>
<li><strong>ì •ì˜ë¡œ ì´ë™(Go to Definition)</strong>: ë³€ìˆ˜ ì„ ì–¸ ìœ„ì¹˜ ì°¾ê¸°</li>
<li><strong>ì°¸ì¡° ì°¾ê¸°(Find References)</strong>: ëª¨ë“  ì‚¬ìš© ìœ„ì¹˜ ê²€ìƒ‰</li>
<li><strong>ì´ë¦„ ë°”ê¾¸ê¸°(Rename)</strong>: ëª¨ë“  ì°¸ì¡° ë™ì‹œ ë³€ê²½</li>
<li><strong>ì½”ë“œ ì•¡ì…˜(Code Actions)</strong>: ìë™ ìˆ˜ì • ì œì•ˆ</li>
</ol>
<p><strong>Phase 5: VS Code Extension íŒ¨í‚¤ì§•</strong></p>
<ol>
<li><strong>TextMate ë¬¸ë²•</strong>: êµ¬ë¬¸ ê°•ì¡°</li>
<li><strong>Language Configuration</strong>: ì£¼ì„, ê´„í˜¸, ë“¤ì—¬ì“°ê¸°</li>
<li><strong>ì½”ë“œ ìŠ¤ë‹ˆí«</strong>: ìì£¼ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´ í…œí”Œë¦¿</li>
<li><strong>VSIX íŒ¨í‚¤ì§•</strong>: ë°°í¬ ê°€ëŠ¥í•œ Extension</li>
</ol>
<h3 id="êµ¬í˜„í•œ-ê¸°ëŠ¥-ìš”ì•½"><a class="header" href="#êµ¬í˜„í•œ-ê¸°ëŠ¥-ìš”ì•½">êµ¬í˜„í•œ ê¸°ëŠ¥ ìš”ì•½</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>ê¸°ëŠ¥</th><th>í”„ë¡œí† ì½œ ë©”ì„œë“œ</th><th>í•µì‹¬ êµ¬í˜„</th></tr>
</thead>
<tbody>
<tr><td>ì§„ë‹¨</td><td><code>textDocument/publishDiagnostics</code></td><td><code>Diagnostics.analyze</code></td></tr>
<tr><td>í˜¸ë²„</td><td><code>textDocument/hover</code></td><td><code>Hover.getHoverInfo</code></td></tr>
<tr><td>ìë™ ì™„ì„±</td><td><code>textDocument/completion</code></td><td><code>Completion.getCompletionItems</code></td></tr>
<tr><td>ì •ì˜ë¡œ ì´ë™</td><td><code>textDocument/definition</code></td><td><code>Definition.findDefinition</code></td></tr>
<tr><td>ì°¸ì¡° ì°¾ê¸°</td><td><code>textDocument/references</code></td><td><code>References.findReferences</code></td></tr>
<tr><td>ì´ë¦„ ë°”ê¾¸ê¸°</td><td><code>textDocument/rename</code></td><td><code>Rename.renameSymbol</code></td></tr>
<tr><td>ì½”ë“œ ì•¡ì…˜</td><td><code>textDocument/codeAction</code></td><td><code>CodeActions.getCodeActions</code></td></tr>
</tbody>
</table>
</div>
<h3 id="extensionì˜-êµ¬ì„±-ìš”ì†Œ"><a class="header" href="#extensionì˜-êµ¬ì„±-ìš”ì†Œ">Extensionì˜ êµ¬ì„± ìš”ì†Œ</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>íŒŒì¼</th><th>ì—­í• </th></tr>
</thead>
<tbody>
<tr><td><code>package.json</code></td><td>Extension ë§¤ë‹ˆí˜ìŠ¤íŠ¸, contributes ì •ì˜</td></tr>
<tr><td><code>extension.ts</code></td><td>LSP í´ë¼ì´ì–¸íŠ¸ ì§„ì…ì </td></tr>
<tr><td><code>funlang.tmLanguage.json</code></td><td>TextMate êµ¬ë¬¸ ê°•ì¡° ê·œì¹™</td></tr>
<tr><td><code>language-configuration.json</code></td><td>í¸ì§‘ ê²½í—˜ ì„¤ì •</td></tr>
<tr><td><code>funlang.json</code> (snippets)</td><td>ì½”ë“œ ìŠ¤ë‹ˆí« í…œí”Œë¦¿</td></tr>
<tr><td><code>server/LangLSP.Server</code></td><td>LSP ì„œë²„ ë°”ì´ë„ˆë¦¬</td></tr>
</tbody>
</table>
</div>
<h3 id="ë‹¤ìŒ-ë‹¨ê³„-11"><a class="header" href="#ë‹¤ìŒ-ë‹¨ê³„-11">ë‹¤ìŒ ë‹¨ê³„</a></h3>
<p>ì´ íŠœí† ë¦¬ì–¼ ì‹œë¦¬ì¦ˆë¥¼ ì™„ë£Œí–ˆì§€ë§Œ, LSPëŠ” ë” ë§ì€ ê°€ëŠ¥ì„±ì„ ì œê³µí•œë‹¤:</p>
<h4 id="ì¶”ê°€-lsp-ê¸°ëŠ¥"><a class="header" href="#ì¶”ê°€-lsp-ê¸°ëŠ¥">ì¶”ê°€ LSP ê¸°ëŠ¥</a></h4>
<ol>
<li><strong>Semantic Tokens</strong>: ì˜ë¯¸ ê¸°ë°˜ êµ¬ë¬¸ ê°•ì¡° (TextMateë³´ë‹¤ ì •í™•)</li>
<li><strong>Inlay Hints</strong>: ì½”ë“œì— íƒ€ì… íŒíŠ¸ í‘œì‹œ (<code>x: int</code>)</li>
<li><strong>Document Symbols</strong>: íŒŒì¼ ê°œìš” (Outline ë·°)</li>
<li><strong>Workspace Symbols</strong>: í”„ë¡œì íŠ¸ ì „ì²´ ì‹¬ë³¼ ê²€ìƒ‰</li>
<li><strong>Formatting</strong>: ìë™ ì½”ë“œ í¬ë§¤íŒ…</li>
<li><strong>Code Lens</strong>: ì¸ë¼ì¸ ì •ë³´ í‘œì‹œ (ì°¸ì¡° ê°œìˆ˜ ë“±)</li>
<li><strong>Call Hierarchy</strong>: í•¨ìˆ˜ í˜¸ì¶œ ê´€ê³„ íƒìƒ‰</li>
<li><strong>Type Hierarchy</strong>: íƒ€ì… ê³„ì¸µ êµ¬ì¡°</li>
</ol>
<h4 id="ë‹¤ì¤‘-íŒŒì¼-ì§€ì›"><a class="header" href="#ë‹¤ì¤‘-íŒŒì¼-ì§€ì›">ë‹¤ì¤‘ íŒŒì¼ ì§€ì›</a></h4>
<p>í˜„ì¬ ìš°ë¦¬ LSPëŠ” ë‹¨ì¼ íŒŒì¼ë§Œ ì²˜ë¦¬í•œë‹¤. ë‹¤ì¤‘ íŒŒì¼ í”„ë¡œì íŠ¸ë¥¼ ì§€ì›í•˜ë ¤ë©´:</p>
<ol>
<li><strong>Module ì‹œìŠ¤í…œ</strong>: <code>import</code>/<code>export</code> êµ¬ë¬¸ ì¶”ê°€</li>
<li><strong>ì˜ì¡´ì„± í•´ì„</strong>: íŒŒì¼ ê°„ ì°¸ì¡° ì¶”ì </li>
<li><strong>í”„ë¡œì íŠ¸ ì „ì²´ íƒ€ì… ì²´í¬</strong>: ëª¨ë“  íŒŒì¼ ë™ì‹œ ë¶„ì„</li>
<li><strong>Workspace Diagnostics</strong>: í”„ë¡œì íŠ¸ ì „ì²´ ì§„ë‹¨</li>
</ol>
<h4 id="vs-code-ë§ˆì¼“í”Œë ˆì´ìŠ¤-ê²Œì‹œ"><a class="header" href="#vs-code-ë§ˆì¼“í”Œë ˆì´ìŠ¤-ê²Œì‹œ">VS Code ë§ˆì¼“í”Œë ˆì´ìŠ¤ ê²Œì‹œ</a></h4>
<p>VSIXë¥¼ ë§Œë“¤ì—ˆìœ¼ë‹ˆ ì´ì œ ë§ˆì¼“í”Œë ˆì´ìŠ¤ì— ê²Œì‹œí•  ìˆ˜ ìˆë‹¤:</p>
<ol>
<li><a href="https://marketplace.visualstudio.com/">Visual Studio Marketplace</a> ê³„ì • ìƒì„±</li>
<li>Personal Access Token ë°œê¸‰</li>
<li><code>vsce publish</code> ëª…ë ¹ìœ¼ë¡œ ê²Œì‹œ</li>
<li>ì‚¬ìš©ìê°€ ê²€ìƒ‰í•˜ì—¬ ì„¤ì¹˜ ê°€ëŠ¥</li>
</ol>
<p>ê²Œì‹œ ê°€ì´ë“œ: https://code.visualstudio.com/api/working-with-extensions/publishing-extension</p>
<h4 id="ë‹¤ë¥¸-ì—ë””í„°-ì§€ì›"><a class="header" href="#ë‹¤ë¥¸-ì—ë””í„°-ì§€ì›">ë‹¤ë¥¸ ì—ë””í„° ì§€ì›</a></h4>
<p>LSPëŠ” ì—ë””í„° ë…ë¦½ì ì´ë‹¤. ìš°ë¦¬ ì„œë²„ë¥¼ ë‹¤ë¥¸ ì—ë””í„°ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤:</p>
<ul>
<li><strong>Neovim</strong>: <code>nvim-lspconfig</code>ë¡œ ì„¤ì •</li>
<li><strong>Emacs</strong>: <code>lsp-mode</code> ì„¤ì •</li>
<li><strong>Sublime Text</strong>: LSP í”ŒëŸ¬ê·¸ì¸ ì‚¬ìš©</li>
<li><strong>Vim</strong>: vim-lsp í”ŒëŸ¬ê·¸ì¸</li>
</ul>
<h3 id="í•µì‹¬-êµí›ˆ"><a class="header" href="#í•µì‹¬-êµí›ˆ">í•µì‹¬ êµí›ˆ</a></h3>
<p>ì´ íŠœí† ë¦¬ì–¼ ì‹œë¦¬ì¦ˆì—ì„œ ë°°ìš´ í•µì‹¬ ê°œë…ë“¤:</p>
<ol>
<li><strong>LSPëŠ” í”„ë¡œí† ì½œ</strong>: ì–¸ì–´ì™€ ì—ë””í„° ë…ë¦½ì , JSON-RPC ê¸°ë°˜</li>
<li><strong>ì„œë²„ëŠ” ë¬´ìƒíƒœ(Stateless)ê°€ ì•„ë‹˜</strong>: ë¬¸ì„œë¥¼ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ê³  ê´€ë¦¬</li>
<li><strong>ìœ„ì¹˜ëŠ” 0-based</strong>: ì¤„ê³¼ ë¬¸ì ëª¨ë‘ 0ë¶€í„° ì‹œì‘</li>
<li><strong>RangeëŠ” end-exclusive</strong>: <code>[start, end)</code> í˜•ì‹</li>
<li><strong>AST íƒìƒ‰ì´ í•µì‹¬</strong>: ëŒ€ë¶€ë¶„ì˜ ê¸°ëŠ¥ì´ AST íƒìƒ‰ ê¸°ë°˜</li>
<li><strong>íƒ€ì… ì²´í¬ í†µí•©</strong>: FunLang íƒ€ì… ì²´ì»¤ë¥¼ ì¬ì‚¬ìš©í•˜ì—¬ ì •í™•í•œ íƒ€ì… ì •ë³´ ì œê³µ</li>
<li><strong>ì„ ì–¸ì  vs ëª…ë ¹ì </strong>: JSON ì„¤ì •(ë¬¸ë²•, ìŠ¤ë‹ˆí«)ê³¼ ì½”ë“œ(LSP í´ë¼ì´ì–¸íŠ¸) ë¶„ë¦¬</li>
</ol>
<h3 id="ë§ˆë¬´ë¦¬"><a class="header" href="#ë§ˆë¬´ë¦¬">ë§ˆë¬´ë¦¬</a></h3>
<p>FunLang Language ServerëŠ” ì´ì œ ì™„ì„±ë˜ì—ˆë‹¤. ë‹¹ì‹ ì€ ì´ì œ:</p>
<ul>
<li>LSP í”„ë¡œí† ì½œì˜ êµ¬ì¡°ì™€ ë™ì‘ ë°©ì‹ì„ ì´í•´í•œë‹¤</li>
<li>F#ìœ¼ë¡œ Language Serverë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤</li>
<li>VS Code Extensionì„ ë§Œë“¤ê³  íŒ¨í‚¤ì§•í•  ìˆ˜ ìˆë‹¤</li>
<li>êµ¬ë¬¸ ê°•ì¡°, ìŠ¤ë‹ˆí«, ì–¸ì–´ ì„¤ì •ì„ ì •ì˜í•  ìˆ˜ ìˆë‹¤</li>
</ul>
<p><strong>ì´ ì§€ì‹ì„ í™œìš©í•˜ì—¬ ë‹¹ì‹ ë§Œì˜ ì–¸ì–´ë¥¼ ìœ„í•œ Language Serverë¥¼ ë§Œë“¤ì–´ë³´ë¼!</strong></p>
<p>LSP ìŠ¤í™ ì°¸ì¡°: https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/</p>
<p>F# Compiler Services: https://fsharp.github.io/fsharp-compiler-docs/</p>
<p>Ionide LSP: https://github.com/ionide/LanguageServerProtocol</p>
<hr>
<p><strong>íŠœí† ë¦¬ì–¼ ì‹œë¦¬ì¦ˆ ì™„ë£Œ ğŸ‰</strong></p>
<p>ì´ íŠœí† ë¦¬ì–¼ì´ ë„ì›€ì´ ë˜ì—ˆê¸°ë¥¼ ë°”ë€ë‹¤. ë‹¹ì‹ ì˜ Language Server í”„ë¡œì íŠ¸ì— í–‰ìš´ì„ ë¹ˆë‹¤!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid-eefea253.min.js"></script>
        <script src="mermaid-init-ccf746f1.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
